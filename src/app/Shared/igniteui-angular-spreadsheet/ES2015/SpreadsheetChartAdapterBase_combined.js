/*
THIS INFRAGISTICS ULTIMATE SOFTWARE LICENSE  AGREEMENT ("AGREEMENT") LOCATED HERE:
https://www.infragistics.com/legal/license/igultimate-la
https://www.infragistics.com/legal/license/igultimate-eula
GOVERNS THE LICENSING, INSTALLATION AND USE OF INFRAGISTICS SOFTWARE. BY DOWNLOADING AND/OR INSTALLING AND USING INFRAGISTICS SOFTWARE:  you are indicating that you have read and understand this Agreement, and agree to be legally bound by it on behalf of the yourself and your company.
*/
import { Base, Type, markType, INotifyPropertyChanged_$type, PropertyChangedEventArgs, Nullable$1, IEnumerator$1_$type, IEnumerable$1_$type, IEnumerator_$type, IDisposable_$type, enumGetBox, typeCast, Number_$type, String_$type, fromEnum, getInstanceType, EnumUtil, runOn, delegateRemove, delegateCombine, fromEn, typeGetValue, Boolean_$type, Point_$type, PointUtil, getEnumerator, EventArgs, getBoxIfEnum, NotSupportedException, Stream, typeCastObjTo$t, Array_$type, Date_$type, IEquatable$1_$type, toEnum, Delegate_$type } from "../../igniteui-angular-core/ES2015/type";
import { WorksheetChart, OrderedSortCondition, FillSortCondition, FontColorSortCondition, IconSortCondition, CustomListSortCondition, SortCondition, RelativeIndex, WorksheetTableColumn, CellFill, WorkbookColorInfo, FormatConditionIconSet_$type, WorksheetRegionAddress, WorksheetTable, Worksheet, WorksheetRegion, CellConditionalFormat, CellFillPattern, Workbook, WorksheetCellFormatData, CellFillRectangularGradient, CellFillLinearGradient, CellAddress, ExcelUtils, WorksheetCell, DataValidationErrorStyle_$type, CustomFilter, RelativeDateRangeFilter, DatePeriodFilter, AverageFilter, TopOrBottomFilter, YearToDateFilter, CustomFilterCondition, FormatConditionIcon_$type, ExcelComparisonOperator_$type, RelativeDateRangeDuration_$type, RelativeDateRangeOffset_$type, DatePeriodFilterType_$type, WorksheetShape, WorksheetShapeGroupBase, WorksheetShapeGroup, WorksheetHyperlink, WorksheetItemPosition, MathUtilities, ShapeFillNoFill, ShapeFillSolid, ShapeFillImage, ShapeOutlineNoOutline, ShapeOutlineSolid, WorksheetImage, WorksheetShapeWithText, UnknownShape, FormattedString, WorkbookStyle, WorkbookFormatCollection, WorksheetCellFormatProxy, NamedReference, NamedReferenceBase, FormulaParser, CharUnicodeInfo, ListDataValidationRule, ExcelCalcValue, CellCalcReference, Formula, WorksheetCellAddress, CalcUtilities, WorksheetPaneSelection, NamedCalcReference, ChangeInfo, StructuredTableReference, RowColumnBase, TableCalcReferenceBase, FontUnderlineStyle_$type, FontSuperscriptSubscriptStyle_$type, HorizontalCellAlignment_$type, VerticalCellAlignment_$type, CellReferenceMode_$type, IWorkbookOwner_$type, CellBorderLineStyle_$type, DiagonalBorders_$type, IWorksheetCellFormat_$type, TextMetricsProviderBase, CellFillGradientStop, ChartGradientFill, ChartEmptyFill, ChartSolidFill, Colors, ValueFormatter, GetCellTextParameters, ErrorValue, IconFilter, WeakWorkbookOwner, WorksheetReferenceCollection, ConditionBase, FillPatternStyle_$type, HorizontalTextAlignment_$type, ExcelChangeAction_$type, IFilterable_$type, IWorkbookFont_$type, WorksheetProtectedRange, WorksheetCellBlock, WorkbookFontData, WorksheetMergedCellsRegion, ArrayFormula, StringElement, FormulaContext, RefToken, AreaToken, UnaryOperatorToken, BinaryOperatorToken, WorkbookFontProxy, FormattedStringElement, IRegionBlockingValue_$type, IFunctionToken_$type, FontColorFilter, FillFilter, FixedValuesFilter, IndexRange, CellSizeMeasurementContext, ArrayInteriorFormula, DataTableInteriorFormula, WorkbookBuiltInStyle, PaneLocation_$type, RegionLookupTable$1, WorksheetCellComment, NamedReferenceUnconnected, SortedIntRangeList, WorkbookLoadOptions, WorkbookSaveOptions, ColorsInternal, DateRangeFilter, WorkbookThemeColorType_$type } from "../../igniteui-angular-excel/ES2015/excel.core";
import { SortDirectionWithCustomListOptions_$type } from "./SortDirectionWithCustomListOptions";
import { Dictionary$2 } from "../../igniteui-angular-core/ES2015/Dictionary$2";
import { SpreadsheetSortDialogConditionType_$type } from "./SpreadsheetSortDialogConditionType";
import { ComboBoxListItem } from "./ComboBoxListItem";
import { ObservableCollectionExtended$1 } from "./ObservableCollectionExtended$1";
import { List$1 } from "../../igniteui-angular-core/ES2015/List$1";
import { KeyValuePair$2 } from "../../igniteui-angular-core/ES2015/KeyValuePair$2";
import { Tuple$2 } from "../../igniteui-angular-core/ES2015/Tuple$2";
import { StringBuilder } from "../../igniteui-angular-core/ES2015/StringBuilder";
import { Tuple } from "../../igniteui-angular-core/ES2015/Tuple";
import { stringFormat, stringCompare1, stringSplit, stringFormat1, isLetterOrDigit, indexOfAny, startsWith1, isDigit, trimEnd, stringEquals1 } from "../../igniteui-angular-core/ES2015/stringExtended";
import { SortContext_$type } from "./SortContext";
import { ObservableCollection$1 } from "../../igniteui-angular-core/ES2015/ObservableCollection$1";
import { SortTargetResult } from "./SortTargetResult";
import { ArgumentNullException } from "../../igniteui-angular-core/ES2015/ArgumentNullException";
import { ActiveRowIndexChangedEventArgs } from "./ActiveRowIndexChangedEventArgs";
import { ArgumentException } from "../../igniteui-angular-core/ES2015/ArgumentException";
import { Color } from "../../igniteui-angular-core/ES2015/Color";
import { ArgumentOutOfRangeException } from "../../igniteui-angular-core/ES2015/ArgumentOutOfRangeException";
import { HashSet$1 } from "../../igniteui-angular-core/ES2015/HashSet$1";
import { CellContentType_$type } from "./CellContentType";
import { nullableEquals, nullableNotEquals, nullableIsNull, unwrapNullable, wrapNullable, nullableLessThan, nullableGreaterThan, nullableLessThanOrEqual, nullableGreaterThanOrEqual } from "../../igniteui-angular-core/ES2015/nullable";
import { stringEmpty, stringReplace, stringIsNullOrEmpty, stringStartsWith, stringIsNullOrWhiteSpace, stringContains, stringToString$1 } from "../../igniteui-angular-core/ES2015/string";
import { DomWrapper_$type } from "../../igniteui-angular-core/ES2015/dom";
import { Rect } from "../../igniteui-angular-core/ES2015/Rect";
import { VisualElement } from "./VisualElement";
import { BaseDOMEventProxy } from "../../igniteui-angular-core/ES2015/BaseDOMEventProxy";
import { DropDown } from "./DropDown";
import { DropDownItem } from "./DropDownItem";
import { DropDownPosition } from "./DropDownPosition";
import { RelativePositionInfo } from "./RelativePositionInfo";
import { SpreadsheetCell } from "./SpreadsheetCell";
import { SpreadsheetCellRange } from "./SpreadsheetCellRange";
import { CoreUtilities } from "./CoreUtilities";
import { ISpreadsheetEditorValue_$type } from "./ISpreadsheetEditorValue";
import { SpreadsheetEditModeEnteringEventArgs } from "./SpreadsheetEditModeEnteringEventArgs";
import { SpreadsheetEditModeEnteredEventArgs } from "./SpreadsheetEditModeEnteredEventArgs";
import { SpreadsheetAction_$type } from "./SpreadsheetAction";
import { SpreadsheetEditModeExitingEventArgs } from "./SpreadsheetEditModeExitingEventArgs";
import { SpreadsheetEditModeExitedEventArgs } from "./SpreadsheetEditModeExitedEventArgs";
import { SpreadsheetTransactionOperation_$type } from "./SpreadsheetTransactionOperation";
import { SpreadsheetEditModeValidationErrorEventArgs } from "./SpreadsheetEditModeValidationErrorEventArgs";
import { EditModeDataValidationException } from "./EditModeDataValidationException";
import { isNaN_, truncate, intDivide, isInfinity, tryParseNumber } from "../../igniteui-angular-core/ES2015/number";
import { Thickness } from "../../igniteui-angular-core/ES2015/Thickness";
import { WorkbookFontSnapshot } from "./WorkbookFontSnapshot";
import { TextBoxVisualElement } from "./TextBoxVisualElement";
import { SpreadsheetEditorValue } from "./SpreadsheetEditorValue";
import { ClipboardHelper } from "./ClipboardHelper";
import { DataFormats } from "../../igniteui-angular-core/ES2015/DataFormats";
import { SpreadsheetContextMenuSubItem_$type } from "./SpreadsheetContextMenuSubItem";
import { SpreadsheetSpecialFilterMenuItems_$type } from "./SpreadsheetSpecialFilterMenuItems";
import { LongValue } from "./LongValue";
import { Enumerable } from "../../igniteui-angular-core/ES2015/Enumerable";
import { SpreadsheetUserPromptTrigger_$type } from "./SpreadsheetUserPromptTrigger";
import { ReadOnlyCollection$1 } from "../../igniteui-angular-core/ES2015/ReadOnlyCollection$1";
import { ElementLayer$1 } from "./ElementLayer$1";
import { PropertyChangeNotifierExtended } from "./PropertyChangeNotifierExtended";
import { SpreadsheetImageBackground } from "./SpreadsheetImageBackground";
import { PropertyChangeNotifier } from "./PropertyChangeNotifier";
import { SpreadsheetCellRenderInfoArray } from "./SpreadsheetCellRenderInfoArray";
import { MDList$1 } from "./MDList$1";
import { SpreadsheetDropDownButton } from "./SpreadsheetDropDownButton";
import { SpreadsheetGridLinePen } from "./SpreadsheetGridLinePen";
import { MDBitArray } from "./MDBitArray";
import { WeakReference } from "../../igniteui-angular-core/ES2015/WeakReference";
import { PropertyChangeListener$1 } from "./PropertyChangeListener$1";
import { IPropertyChangeListener_$type } from "./IPropertyChangeListener";
import { PropertyChangeListenerList } from "./PropertyChangeListenerList";
import { IntRange } from "./IntRange";
import { PredefinedSpreadsheetLayers } from "./PredefinedSpreadsheetLayers";
import { Size } from "../../igniteui-angular-core/ES2015/Size";
import { CT_Path2DArcTo, CT_Path2DClose, CT_Path2DCubicBezierTo, CT_AdjPoint2D, CT_Path2DLineTo, CT_Path2DMoveTo, CT_Path2DQuadBezierTo, IPath2DCommandVisitor$2_$type, CT_Path2D, CT_CustomGeometry2D, CT_GeomGuideList, CT_GeomRect, CT_TextBodyProperties, CT_Path2DList, ST_AdjAngle, ST_AdjCoordinate, CT_GeomGuide, CT_PresetGeometry2D, ICT_ShapePropertiesOwner_$type, IPath2DCommand_$type, ST_PathFillMode_$type } from "../../igniteui-angular-excel/ES2015/documents.openxml";
import { ShapeGuideVariables } from "./ShapeGuideVariables";
import { ImageData, ImageFormat, ST_PositiveCoordinate, ST_Angle, ST_ShapeType_$type } from "../../igniteui-angular-excel/ES2015/documents.core";
import { XmlConvert } from "../../igniteui-angular-core/ES2015/XmlConvert";
import { Convert } from "../../igniteui-angular-core/ES2015/Convert";
import { ShapeGuide } from "./ShapeGuide";
import { ContextMenu } from "./ContextMenu";
import { Brush } from "../../igniteui-angular-core/ES2015/Brush";
import { SpreadsheetResourceId_$type } from "./SpreadsheetResourceId";
import { LRUCache$2 } from "../../igniteui-angular-core/ES2015/LRUCache$2";
import { DefaultSpreadsheetColors } from "./DefaultSpreadsheetColors";
import { VisualElementConstraint } from "./VisualElementConstraint";
import { VisualElementThickness } from "./VisualElementThickness";
import { VisualElementDomBuilder } from "./VisualElementDomBuilder";
import { SpreadsheetMetricsCache } from "./SpreadsheetMetricsCache";
import { SpreadsheetMeasureHelper_MeasureStack } from "./SpreadsheetMeasureHelper_MeasureStack";
import { WorkbookDataObjectPastingEventArgs } from "./WorkbookDataObjectPastingEventArgs";
import { SpreadsheetDialogResult } from "./SpreadsheetDialogResult";
import { EditModeWorkbookFontInfo } from "./EditModeWorkbookFontInfo";
import { rectFromLiteral, rectToLiteral } from "../../igniteui-angular-core/ES2015/IgRect";
import { pointFromLiteral } from "../../igniteui-angular-core/ES2015/IgPoint";
import { SpreadsheetDialogServicesManager } from "./SpreadsheetDialogServicesManager";
import { ResolvedWorkbookFont } from "./ResolvedWorkbookFont";
import { IGFormattedTextDocument } from "./IGFormattedTextDocument";
import { VisualElementInputProxy } from "./VisualElementInputProxy";
import { SpreadsheetAreaLayoutManager_SheetLayerInfo$1 } from "./SpreadsheetAreaLayoutManager_SheetLayerInfo$1";
import { PixelConverter } from "./PixelConverter";
import { IElementLayerContainer_$type } from "./IElementLayerContainer";
import { IPlatformScrollBarAdapter_$type } from "./IPlatformScrollBarAdapter";
import { ScrollBarVisibilityCoordinator } from "./ScrollBarVisibilityCoordinator";
import { ScrollBarInfoMediator } from "./ScrollBarInfoMediator";
import { TimedOperation } from "./TimedOperation";
import { SpreadsheetHitTestResult } from "./SpreadsheetHitTestResult";
import { ScrollInfo } from "./ScrollInfo";
import { ExtendedScrollBarInfoMediator } from "./ExtendedScrollBarInfoMediator";
import { EqualityComparer$1 } from "../../igniteui-angular-core/ES2015/EqualityComparer$1";
import { boxArray$1, arrayGetLength, arrayCopyTo } from "../../igniteui-angular-core/ES2015/array";
import { arrayIndexOf1 } from "../../igniteui-angular-core/ES2015/arrayExtended";
import { ButtonVisualElement } from "./ButtonVisualElement";
import { RendererLayerVisualElement$2 } from "./RendererLayerVisualElement$2";
import { ISpreadsheetGraphics_$type } from "./ISpreadsheetGraphics";
import { RendererLayerVisualElementView$1 } from "./RendererLayerVisualElementView$1";
import { RendererElementLayer$2 } from "./RendererElementLayer$2";
import { ScrollBarVisualElement } from "./ScrollBarVisualElement";
import { JsScrollBar } from "./JsScrollBar";
import { JsScrollBarAdapter } from "./JsScrollBarAdapter";
import { RepeatButtonVisualElement } from "./RepeatButtonVisualElement";
import { RootVisualElement } from "./RootVisualElement";
import { SpreadsheetCursorHelper } from "./SpreadsheetCursorHelper";
import { ISpreadsheetInteractionManagerOwner_$type } from "./ISpreadsheetInteractionManagerOwner";
import { LayerVisualElement } from "./LayerVisualElement";
import { SpreadsheetToolTipContext } from "./SpreadsheetToolTipContext";
import { sizeToLiteral, sizeFromLiteral } from "../../igniteui-angular-core/ES2015/IgSize";
import { IRendererElementLayerView$2_$type } from "./IRendererElementLayerView$2";
import { PageStartScrollCache } from "./PageStartScrollCache";
import { ISpreadsheetResourceProvider_$type } from "./ISpreadsheetResourceProvider";
import { SpreadsheetHeaderContentLayerBase_HeaderInfo$1 } from "./SpreadsheetHeaderContentLayerBase_HeaderInfo$1";
import { HeaderVisual } from "./HeaderVisual";
import { HeaderVisualInfo } from "./HeaderVisualInfo";
import { SpreadsheetDrawingOperation } from "./SpreadsheetDrawingOperation";
import { NotImplementedException } from "../../igniteui-angular-core/ES2015/NotImplementedException";
import { LineVisualElement } from "./LineVisualElement";
import { SpreadsheetIconElement } from "./SpreadsheetIconElement";
import { SpreadsheetInvalidDataElement } from "./SpreadsheetInvalidDataElement";
import { ElementLayerViewSingle } from "./ElementLayerViewSingle";
import { ILayerRenderer_$type } from "./ILayerRenderer";
import { Spreadsheet_SimpleNamedReference } from "./Spreadsheet_SimpleNamedReference";
import { ReadOnlyNotifyCollection$1 } from "./ReadOnlyNotifyCollection$1";
import { InvalidOperationException } from "../../igniteui-angular-core/ES2015/InvalidOperationException";
import { UndoManager } from "./UndoManager";
import { WeakPropertyChangedHandler$1 } from "./WeakPropertyChangedHandler$1";
import { SpreadsheetMouseOperation } from "./SpreadsheetMouseOperation";
import { IgDialogWrapper } from "./IgDialogWrapper";
import { DeferredOperation } from "./DeferredOperation";
import { SpreadsheetCommandBuilder } from "./SpreadsheetCommandBuilder";
import { SpreadsheetCommandExecutingEventArgs } from "./SpreadsheetCommandExecutingEventArgs";
import { SpreadsheetCommandExecutedEventArgs } from "./SpreadsheetCommandExecutedEventArgs";
import { Localization } from "../../igniteui-angular-core/ES2015/Localization";
import { Environment } from "../../igniteui-angular-core/ES2015/Environment";
import { Spreadsheet_CustomEditValue } from "./Spreadsheet_CustomEditValue";
import { FormatCellsDialogTab_$type } from "./FormatCellsDialogTab";
import { FormatCellsDialogOptions } from "./FormatCellsDialogOptions";
import { FormatCellsDialogData } from "./FormatCellsDialogData";
import { WorkbookSerializationLoadException } from "./WorkbookSerializationLoadException";
import { WorkbookDataObjectCopyingEventArgs } from "./WorkbookDataObjectCopyingEventArgs";
import { WorkbookDataObjectSettingDataEventArgs } from "./WorkbookDataObjectSettingDataEventArgs";
import { WorkbookSerializationErrorEventArgs } from "./WorkbookSerializationErrorEventArgs";
import { IWorksheetUndoUnit_$type } from "./IWorksheetUndoUnit";
import { UndoTransaction } from "./UndoTransaction";
import { LockedEditRangeInfoForOperation } from "./LockedEditRangeInfoForOperation";
import { SpreadsheetEditRangePasswordNeededEventArgs } from "./SpreadsheetEditRangePasswordNeededEventArgs";
import { LockedEditRangeInfoForWorksheet } from "./LockedEditRangeInfoForWorksheet";
import { TableExpansionInfo } from "./TableExpansionInfo";
import { WorkbookSerializationLoadOptions } from "./WorkbookSerializationLoadOptions";
import { SpreadsheetActiveCellChangedEventArgs } from "./SpreadsheetActiveCellChangedEventArgs";
import { SpreadsheetActiveTableChangedEventArgs } from "./SpreadsheetActiveTableChangedEventArgs";
import { SpreadsheetActiveWorksheetChangedEventArgs } from "./SpreadsheetActiveWorksheetChangedEventArgs";
import { SpreadsheetHyperlinkExecutingEventArgs } from "./SpreadsheetHyperlinkExecutingEventArgs";
import { IOPath } from "../../igniteui-angular-core/ES2015/IOPath";
import { Uri } from "../../igniteui-angular-core/ES2015/Uri";
import { SpreadsheetCellDropDownItemSelectingEventArgs } from "./SpreadsheetCellDropDownItemSelectingEventArgs";
import { SpreadsheetWorkbookDirtiedEventArgs } from "./SpreadsheetWorkbookDirtiedEventArgs";
import { InvalidMultipleRangeSelection } from "./InvalidMultipleRangeSelection";
import { EditableComboBox } from "./EditableComboBox";
import { ExcelCellFormatCategory_$type } from "./ExcelCellFormatCategory";
import { WorksheetUndoTransaction } from "./WorksheetUndoTransaction";
import { ReadOnlyResolvedWorksheetCellFormatData } from "./ReadOnlyResolvedWorksheetCellFormatData";
import { LazyReadOnlyNotifyCollection$1 } from "./LazyReadOnlyNotifyCollection$1";
import { StringComparer } from "../../igniteui-angular-core/ES2015/StringComparer";
import { ISpreadsheetEditInfo_$type } from "./ISpreadsheetEditInfo";
import { MemoryStream } from "../../igniteui-angular-core/ES2015/MemoryStream";
import { SpreadsheetRenderCache_MeasureTextMetricsProvider } from "./SpreadsheetRenderCache_MeasureTextMetricsProvider";
import { Spreadsheet_NullSpreadsheetText } from "./Spreadsheet_NullSpreadsheetText";
import { CustomDOMEventProxy } from "./CustomDOMEventProxy";
import { Stack$1 } from "../../igniteui-angular-core/ES2015/Stack$1";
import { SpreadsheetVisualElementDomBuilder_CanvasCache } from "./SpreadsheetVisualElementDomBuilder_CanvasCache";
import { ComboBoxVisualElement } from "./ComboBoxVisualElement";
import { ToggleButtonVisualElement } from "./ToggleButtonVisualElement";
import { JSDataObject } from "./JSDataObject";
import { JsSpreadsheetText } from "./JsSpreadsheetText";
import { ResolvedWorksheetCellFormatDataFont } from "./ResolvedWorksheetCellFormatDataFont";
import { FormattedStringFontResolved } from "./FormattedStringFontResolved";
import { BrushUtilCore } from "../../igniteui-angular-core/ES2015/BrushUtilCore";
import { IGFormattedTextParagraph } from "./IGFormattedTextParagraph";
import { IGFormattedTextRun } from "./IGFormattedTextRun";
import { IGFormattedTextFont } from "./IGFormattedTextFont";
import { IGFormattedTextSettings } from "./IGFormattedTextSettings";
import { Encoding } from "../../igniteui-angular-core/ES2015/Encoding";
import { Regex } from "../../igniteui-angular-core/ES2015/Regex";
import { CultureInfo, NumberFormatInfo, DateTimeFormat } from "../../igniteui-angular-core/ES2015/culture";
import { UriParser } from "../../igniteui-angular-core/ES2015/UriParser";
import { AdapterIntRangeSet$1 } from "./AdapterIntRangeSet$1";
import { intSToU, numberToString2, tryParseInt32_1, tryParseNumber1, tryParseInt32_2, numberToString } from "../../igniteui-angular-core/ES2015/numberExtended";
import { dateFromValues, dateGetTimeOfDay, dateToday, dateAddHours, dateMinValue, dateGetDate, dateMaxValue, dateNow } from "../../igniteui-angular-core/ES2015/date";
import { dateToStringFormat, dateTryParse } from "../../igniteui-angular-core/ES2015/dateExtended";
import { timeSpanTotalDays, timeSpanTotalHours, timeSpanFromHours } from "../../igniteui-angular-core/ES2015/timespan";
import { SpreadsheetEditHelper_TextChangeWithOptions } from "./SpreadsheetEditHelper_TextChangeWithOptions";
import { XmlTextReader } from "../../igniteui-angular-core/ES2015/XmlTextReader";
import { StringReader } from "../../igniteui-angular-core/ES2015/StringReader";
import { GZipStream } from "../../igniteui-angular-excel/ES2015/excel.openxml";
import { CellBorderValue } from "./CellBorderValue";
import { RowCellFormatEnumerator } from "./RowCellFormatEnumerator";
import { ColumnCellFormatEnumerator } from "./ColumnCellFormatEnumerator";
import { PlatformTimer } from "./PlatformTimer";
import { SpreadsheetPaneManager_InternalFlags_$type } from "./SpreadsheetPaneManager_InternalFlags";
import { Queue$1 } from "../../igniteui-angular-core/ES2015/Queue$1";
import { DisposableAction } from "./DisposableAction";
import { SpreadsheetChartDataInfo } from "./SpreadsheetChartDataInfo";
import { SpreadsheetPaneManager_SetBorderHelper } from "./SpreadsheetPaneManager_SetBorderHelper";
import { ExtendedRangeScrollInfo } from "./ExtendedRangeScrollInfo";
import { SpreadsheetResolvedRenderFormat } from "./SpreadsheetResolvedRenderFormat";
import { WorksheetCellFormatDataEqualityComparer } from "./WorksheetCellFormatDataEqualityComparer";
import { WorkbookSerializationProviderBase } from "./WorkbookSerializationProviderBase";
import { ExcelWorkbookSerializationProvider_CellRangeTargetInfo } from "./ExcelWorkbookSerializationProvider_CellRangeTargetInfo";
import { WorkbookDataObjectLoadContext } from "./WorkbookDataObjectLoadContext";
import { ExcelWorkbookSerializationProvider_TargetColumnIndexHelper } from "./ExcelWorkbookSerializationProvider_TargetColumnIndexHelper";
import { CellRegionMapMany } from "./CellRegionMapMany";
import { CellRegionMapSingle } from "./CellRegionMapSingle";
import { WorkbookDataObjectSaveContext } from "./WorkbookDataObjectSaveContext";
import { StreamReader } from "../../igniteui-angular-core/ES2015/StreamReader";
import { PlainTextWorkbookSerializationProvider_ParseEditValue } from "./PlainTextWorkbookSerializationProvider_ParseEditValue";
import { PlainTextReader } from "./PlainTextReader";
import { PlainTextWriter } from "./PlainTextWriter";
import { StreamWriter } from "../../igniteui-angular-core/ES2015/StreamWriter";
import { IGExcelSerializationProvider_SyncPackageFactory } from "./IGExcelSerializationProvider_SyncPackageFactory";
import { Guid } from "../../igniteui-angular-core/ES2015/Guid";
import { IGExcelSerializationProvider_SelectionWorkbookSaveFilter } from "./IGExcelSerializationProvider_SelectionWorkbookSaveFilter";
import { StringWriter } from "../../igniteui-angular-core/ES2015/StringWriter";
import { SpreadsheetTabManager_InternalFlags_$type } from "./SpreadsheetTabManager_InternalFlags";
import { WorkbookUndoUnitBase } from "./WorkbookUndoUnitBase";
import { SpreadsheetVisualData } from "./SpreadsheetVisualData";
import { SpreadsheetHeaderAreaVisualData } from "./SpreadsheetHeaderAreaVisualData";
import { SpreadsheetCellAreaVisualData } from "./SpreadsheetCellAreaVisualData";
import { RectData } from "../../igniteui-angular-core/ES2015/RectData";
import { SpreadsheetRowColumnVisualData } from "./SpreadsheetRowColumnVisualData";
import { AdjustableVisualElement } from "./AdjustableVisualElement";
import { SpreadsheetDialogUtilities } from "./SpreadsheetDialogUtilities";
import { FormatCellsDialogBorderInfo } from "./FormatCellsDialogBorderInfo";
import { StyleAttributeMember } from "./StyleAttributeMember";
import { CheckboxElementInfo } from "./CheckboxElementInfo";
import { SpreadsheetDialogFormatCategory } from "./SpreadsheetDialogFormatCategory";
import { BorderLineButtonElementProxy } from "./BorderLineButtonElementProxy";
import { SingleCellSpreadsheetPreviewHelper } from "./SingleCellSpreadsheetPreviewHelper";
import { FormatCellsDialogManager_ElementVisibility_$type } from "./FormatCellsDialogManager_ElementVisibility";
import { SpreadsheetDialogFormat } from "./SpreadsheetDialogFormat";
import { ColorSortingCriteriaControl_ColorSortingCriteriaElementPart_$type } from "./ColorSortingCriteriaControl_ColorSortingCriteriaElementPart";
import { SortCriteriaRow_RowElementPart_$type } from "./SortCriteriaRow_RowElementPart";
import { tryParseBool } from "../../igniteui-angular-core/ES2015/bool";
import { ThemeColorPickerControlViewModel } from "./ThemeColorPickerControlViewModel";
import { DialogFontStyle_$type } from "./DialogFontStyle";
import { ISpreadsheetDialogFormatsService_$type } from "./ISpreadsheetDialogFormatsService";
import { SpreadsheetDialogFormatCategoryEx } from "./SpreadsheetDialogFormatCategoryEx";
import { FormatCellsDialogViewModel_FormatCellsDialogState } from "./FormatCellsDialogViewModel_FormatCellsDialogState";
/**
 * Defines a base class for spreadsheet chart adapters that creates and initializes a container element which contains the elements required to display the chart in a spreadsheet based on a [[WorksheetChart]] instance.
 */
export class SpreadsheetChartAdapterBase extends Base {
}
SpreadsheetChartAdapterBase.$t = markType(SpreadsheetChartAdapterBase, 'SpreadsheetChartAdapterBase');
/**
 * @hidden
 */
export class SortConditionWrapper extends Base {
    constructor(a, b, c) {
        super();
        this._f = 0;
        this._s = 0;
        this._x = 0;
        this._z = null;
        this._d = 0;
        this._k = null;
        this._ab = null;
        this._ac = null;
        this._a = null;
        this._ae = null;
        this._b = null;
        this._c = null;
        this.propertyChanged = null;
        this._k = a;
        this._aj(b, c);
    }
    _ak(a) {
        switch (a) {
            case "SortConditionType":
                switch (this._h) {
                    case 0:
                    case 1:
                    case 2:
                    case 3:
                        switch (this._e) {
                            case 2:
                                this._e = 0;
                                break;
                            case 3:
                                this._e = 1;
                                break;
                        }
                        break;
                    case 4: break;
                }
                this._k._cd(this);
                this._am();
                break;
            case "Column":
                this._k._cd(this);
                this._am();
                break;
        }
        let b = this.propertyChanged;
        if (null != b) {
            b(this, new PropertyChangedEventArgs(a));
        }
    }
    toString() {
        return stringFormat("{0} - {1}", this._w, enumGetBox(SpreadsheetSortDialogConditionType_$type, this._h));
    }
    _aj(a, b) {
        if (null == a) {
            this._y = 0;
            return;
        }
        let c = null;
        let d = 0;
        let e = getInstanceType(a);
        if (e == SortConditionWrapper._ai) {
            let f = a;
            c = f.value;
            d = f.key.index;
        }
        else if (e == SortConditionWrapper._ah) {
            let g = a;
            c = g.value;
            let h = g.key;
            d = h.index;
        }
        else {
        }
        let i = false;
        if (null != c) {
            let j = ((() => { let k = SortConditionWrapper._p.tryGetValue(getInstanceType(c), this._f); this._f = k.p1; return k.ret; })());
            if (!j) {
                return;
            }
            switch (this._f) {
                case 1:
                    {
                        let k = typeCast(FillSortCondition.$, c);
                        if (null != k) {
                            this._z = k.fill;
                        }
                        else {
                        }
                    }
                    break;
                case 2:
                    {
                        let l = typeCast(FontColorSortCondition.$, c);
                        if (null != l) {
                            this._z = l.fontColorInfo;
                        }
                        else {
                        }
                    }
                    break;
                case 3:
                    {
                        let m = typeCast(IconSortCondition.$, c);
                        if (null != m) {
                            let n = Tuple.a(FormatConditionIconSet_$type, Nullable$1.$.specialize(Number_$type), m.iconSet, m._iconIndex$i);
                            this._z = n;
                        }
                        else {
                        }
                    }
                    break;
                case 4:
                    {
                        let o = typeCast(CustomListSortCondition.$, c);
                        if (null != o) {
                            let p = new StringBuilder(0);
                            let q = new StringBuilder(0);
                            let r = new List$1(String_$type, 0);
                            for (let s of fromEnum(o.list)) {
                                if (p.c > 0) {
                                    p.l(", ");
                                }
                                p.l(s);
                                if (q.c > 0) {
                                    q.x(0, ", ");
                                }
                                q.x(0, s);
                                r.add(s);
                            }
                            this._ab = p.toString();
                            this._ac = q.toString();
                            this._a = r.toArray();
                            this._f = 0;
                            i = true;
                        }
                        else {
                        }
                    }
                    break;
                case 0: break;
                default: break;
            }
            let t1 = c.sortDirection;
            L0: while (true) {
                switch (t1) {
                    case 0:
                        this._d = i ? 2 : 0;
                        break;
                    case 1:
                        this._d = i ? 3 : 1;
                        break;
                    default:
                        t1 = 0;
                        continue L0;
                }
                break;
            }
        }
        d += b;
        this._y = d;
    }
    _ad(a) {
        return a ? this._ab : this._ac;
    }
    _v() {
        return this._k._au();
    }
    _al(a, b = false) {
        let c = a;
        let d = c + this._v();
        let e = this._s != d;
        let f = this._x != c;
        if (false == b && false == f && false == e) {
            return;
        }
        this._s = d;
        this._x = c;
        this._ak("Column");
        if (b || e) {
            this._ak("AbsoluteColumnIndex");
        }
        if (b || f) {
            this._ak("RelativeColumnIndex");
        }
    }
    _am() {
        this._k._b9(this);
        this._ak("ColorSortingCriteriaListItems");
    }
    _an() {
        switch (this._w) {
            case 0:
                this._af = this._k._bg;
                break;
            default:
                this._af = this._k._bq;
                break;
        }
    }
    _j() {
        let a = new SortConditionWrapper(this._k, null, 0);
        a._d = this._d;
        a._f = this._f;
        a._x = this._x;
        a._s = this._s;
        a._z = this._z;
        a._ab = this._ab;
        a._ac = this._ac;
        a._a = this._a;
        a._ae = this._ae;
        this._k._cd(a);
        return a;
    }
    _u() {
        let a = this._aa;
        let b = a == null;
        for (let c = 0; c < this._q.count; c++) {
            let d = this._q.item(c);
            let e = d.dataValue;
            let f = e == null;
            if (b) {
                if (f) {
                    return c;
                }
                else {
                    continue;
                }
            }
            if (Base.equalsStatic(e, a)) {
                return c;
            }
        }
        return -1;
    }
    _n(a, b) {
        let c = this._l;
        switch (this._h) {
            case 0:
                a = new OrderedSortCondition(c);
                b = null;
                return {
                    ret: true,
                    p0: a,
                    p1: b
                };
            case 1:
                let d = this._aa;
                if (null == d) {
                    let e = this._i._fs("SpreadsheetSortDialogConditionTypes_FillSortCondition_DisplayText");
                    b = new SortDialogViewModel_ApplySortErrorInfo(1, this, "Cell Color", this._i._fs("SortDialog_SortConditionError_FieldCannotBeNull", e));
                    a = null;
                    return {
                        ret: false,
                        p0: a,
                        p1: b
                    };
                }
                a = new FillSortCondition(d, c);
                b = null;
                return {
                    ret: true,
                    p0: a,
                    p1: b
                };
            case 2:
                let f = this._aa;
                if (WorkbookColorInfo.l_op_Equality(null, f)) {
                    let g = this._i._fs("SpreadsheetSortDialogConditionTypes_FontColorSortCondition_DisplayText");
                    b = new SortDialogViewModel_ApplySortErrorInfo(1, this, "Font Color", this._i._fs("SortDialog_SortConditionError_FieldCannotBeNull", g));
                    a = null;
                    return {
                        ret: false,
                        p0: a,
                        p1: b
                    };
                }
                a = new FontColorSortCondition(f, c);
                b = null;
                return {
                    ret: true,
                    p0: a,
                    p1: b
                };
            case 3:
                let h = this._aa;
                if (null == h) {
                    let i = this._i._fs("SpreadsheetSortDialogConditionTypes_IconSortCondition_DisplayText");
                    b = new SortDialogViewModel_ApplySortErrorInfo(1, this, "Conditional Formatting Icon", this._i._fs("SortDialog_SortConditionError_FieldCannotBeNull", i));
                    a = null;
                    return {
                        ret: false,
                        p0: a,
                        p1: b
                    };
                }
                a = new IconSortCondition(h.c, h.d, c);
                b = null;
                return {
                    ret: true,
                    p0: a,
                    p1: b
                };
            case 4:
                a = new CustomListSortCondition(c, ...this._a);
                b = null;
                return {
                    ret: true,
                    p0: a,
                    p1: b
                };
            default:
                a = null;
                b = null;
                return {
                    ret: false,
                    p0: a,
                    p1: b
                };
        }
    }
    get _af() {
        return this._ae;
    }
    set _af(a) {
        if (stringCompare1(this._ae, a, 0) == 0) {
            return;
        }
        this._ae = a;
        this._ak("SortByLabelText");
    }
    get _l() {
        switch (this._d) {
            case 0:
            case 2: return 0;
            case 1:
            case 3: return 1;
            default: return 0;
        }
    }
    get _i() {
        return this._k._e;
    }
    static get _p() {
        if (null == SortConditionWrapper._o) {
            let a = EnumUtil.getValues(SpreadsheetSortDialogConditionType_$type).length;
            SortConditionWrapper._o = new Dictionary$2(Type.$, SpreadsheetSortDialogConditionType_$type, 1, a);
            SortConditionWrapper._o.addItem(OrderedSortCondition.$, 0);
            SortConditionWrapper._o.addItem(FillSortCondition.$, 1);
            SortConditionWrapper._o.addItem(FontColorSortCondition.$, 2);
            SortConditionWrapper._o.addItem(IconSortCondition.$, 3);
            SortConditionWrapper._o.addItem(CustomListSortCondition.$, 4);
        }
        return SortConditionWrapper._o;
    }
    get _t() {
        return this._s;
    }
    set _t(a) {
        let b = a;
        let c = b - this._v();
        let d = this._s != b;
        let e = this._x != c;
        if (false == e && false == d) {
            return;
        }
        this._s = b;
        this._x = c;
        this._ak("Column");
        if (d) {
            this._ak("AbsoluteColumnIndex");
        }
        if (e) {
            this._ak("RelativeColumnIndex");
        }
    }
    get _q() {
        if (null == this._b) {
            this._b = new ObservableCollectionExtended$1(ComboBoxListItem.$, 0);
            this._am();
        }
        return this._b;
    }
    get _aa() {
        return this._z;
    }
    set _aa(a) {
        this._z = a;
        this._ak("ColorValue");
    }
    get _w() {
        return this._k._ar.indexOf(this);
    }
    get _m() {
        return this._k._ae(this);
    }
    get _y() {
        return this._x;
    }
    set _y(a) {
        this._al(a);
    }
    get _e() {
        return this._d;
    }
    set _e(a) {
        if (a == this._d) {
            return;
        }
        this._d = a;
        this._ak("SortDirection");
    }
    get _g() {
        return this._f;
    }
    set _g(a) {
        if (a == 4) {
            a = 0;
        }
        this._f = a;
        this._ak("SortConditionType");
    }
    get _h() {
        switch (this._f) {
            case 0:
                switch (this._e) {
                    case 0:
                    case 1: break;
                    case 2:
                    case 3: return 4;
                }
                break;
        }
        return this._f;
    }
    get _r() {
        if (null == this._c) {
            this._c = new ObservableCollectionExtended$1(ComboBoxListItem.$, 0);
            this._k._cd(this);
        }
        return this._c;
    }
}
SortConditionWrapper.$t = markType(SortConditionWrapper, 'SortConditionWrapper', Base.$, [INotifyPropertyChanged_$type]);
SortConditionWrapper._o = null;
SortConditionWrapper._ai = KeyValuePair$2.$.specialize(RelativeIndex.$, SortCondition.$);
SortConditionWrapper._ah = KeyValuePair$2.$.specialize(WorksheetTableColumn.$, SortCondition.$);
/**
 * @hidden
 */
export class SortDialogViewModel extends Base {
    constructor(a, b, c) {
        super();
        this._d = null;
        this._n = new WorksheetRegionAddress();
        this._ad = false;
        this._c = 0;
        this._q = null;
        this._i = null;
        this._aq = null;
        this._aw = Nullable$1.toNullable(Number_$type, null);
        this._ai = true;
        this._ag = false;
        this._j = new WorksheetRegionAddress();
        this._l = new WorksheetRegionAddress();
        this._al = true;
        this._aa = false;
        this._o = 0;
        this._s = false;
        this._a2 = null;
        this._a = null;
        this._am = null;
        this._ao = null;
        this._r = null;
        this._activeRowIndexChanged = null;
        this.propertyChanged = null;
        if (b == null) {
            throw new ArgumentNullException(0, "sortTarget");
        }
        this._d = a;
        this._c = b.a;
        this._r = c;
        switch (this._c) {
            case 0:
            case 1:
            case 2:
                this._n = b.d;
                this._ad = b.f;
                this._q = null;
                this._i = b.b;
                break;
            case 3:
                this._q = b.e;
                this._n = b.d;
                this._i = this._q.worksheet;
                break;
        }
        this._bt();
    }
    static _v(a, b) {
        let c = a == null;
        let d = b == null;
        if (c && d) {
            return true;
        }
        if (c != d) {
            return false;
        }
        return Base.equalsStatic(a, b);
    }
    _h(a) {
        let b = typeCast(ArgumentException.$, a);
        if (null != b) {
            let c = this._e._fs("SortDialog_SortConditionError_DuplicateItemSorted");
            return new SortDialogViewModel_ApplySortErrorInfo(0, c);
        }
        return new SortDialogViewModel_ApplySortErrorInfo(0, a.message);
    }
    _br(a) {
        if (null != this._aq) {
            let b = this._aq;
            b.collectionChanged = delegateRemove(b.collectionChanged, runOn(this, this._b4));
        }
        this._aq = new ObservableCollection$1(SortConditionWrapper.$, 0);
        let c = this._aq;
        c.collectionChanged = delegateCombine(c.collectionChanged, runOn(this, this._b4));
        if (null != a) {
            for (let d of fromEn(a)) {
                let e = this._at();
                let f = new SortConditionWrapper(this, d, e);
                if (this._af(f)) {
                    this._aq.add(f);
                }
            }
        }
        if (this._aq.count == 0) {
            this._f();
        }
        this._ax = Nullable$1.toNullable(Number_$type, 0);
    }
    _bs() {
        let a;
        if (null == this._ao) {
            this._ao = new ObservableCollection$1(ComboBoxListItem.$, 0);
        }
        let b = EnumUtil.getValues(SpreadsheetSortDialogConditionType_$type);
        let c = "SpreadsheetSortDialogConditionTypes_{0}_DisplayText";
        for (let e = 0; e < b.length; e++) {
            let d = b[e];
            if (d == 4) {
                continue;
            }
            let f = stringFormat(c, EnumUtil.getName(SpreadsheetSortDialogConditionType_$type, d));
            let g = this._d._fs(f);
            a = new ComboBoxListItem(enumGetBox(SpreadsheetSortDialogConditionType_$type, d), g);
            this._ao.add(a);
        }
    }
    _at() {
        switch (this._c) {
            case 0: break;
            case 1:
                let a = this._au();
                let b = this._av(this._i.sortSettings.region._h);
                let c = b - a;
                return c;
            case 3: break;
        }
        return 0;
    }
    _bt() {
        switch (this._c) {
            case 1:
                {
                    let a = this._i.sortSettings;
                    this._o = a.sortType;
                    this._s = true;
                    this._ag = this._o == 0 ? this._ad : false;
                    this._aa = a.caseSensitive;
                    this._br(a._sortConditions$i);
                }
                break;
            case 0:
                {
                    this._o = 0;
                    this._s = true;
                    this._ag = this._o == 0 ? this._ad : false;
                    this._aa = false;
                    this._br(null);
                }
                break;
            case 2:
                {
                    let b = this._i.filterSettings.sortSettings;
                    this._o = 0;
                    this._s = false;
                    this._ag = true;
                    this._aa = b.caseSensitive;
                    this._br(b._sortConditions$i);
                }
                break;
            case 3:
                {
                    let c = this._q.sortSettings;
                    this._o = 0;
                    this._s = false;
                    this._n = this._q._bs._h;
                    this._ag = true;
                    this._aa = c.caseSensitive;
                    this._br(c._sortConditions$i);
                }
                break;
            default: return;
        }
        this._ca();
        this._cc();
    }
    _bw(a, b) {
        this._b1(a, b);
    }
    _g() {
        let a = this._ax;
        if (a.hasValue) {
            return this._ar._inner[a.value];
        }
        return null;
    }
    _a6(a) {
        if (a.isAutomatic) {
            return SpreadsheetUtilities.di(this._d, "SortDialog_Text_Automatic");
        }
        let b = a._getResolvedColor1(this._d.workbook);
        return this._a7(b);
    }
    _a7(a) {
        return SpreadsheetUtilities.di(this._d, "SortDialog_Color_RGB", a.o, a.n, a.m);
    }
    _au() {
        let a = this._k._n ? this._k : this._m;
        return this._av(a);
    }
    _av(a) {
        switch (this._o) {
            case 1: return a._ac;
            case 0: return a._w;
            default: return a._w;
        }
    }
    _a8(a, ...b) {
        let c = this._d._fs(a, ...b);
        c = SpreadsheetUtilities.c2(c);
        return c;
    }
    _ay(a, b, c) {
        switch (c) {
            case 0:
            case 4: throw new ArgumentOutOfRangeException(0);
            case 1:
                {
                    let d = this._i._rows$i._aj(a);
                    let e = this._i._getCellConditionalFormat1(a, b);
                    if (e != null && e.cellFormat != null && e.cellFormat.fill != null) {
                        return e.cellFormat.fill;
                    }
                    else {
                        let f = this._i._b4(d, b);
                        let g = f._ar;
                        if (null == g) {
                            return CellFill.noColor;
                        }
                        let h = typeCast(CellFillPattern.$, g);
                        if (null != h && 0 == h.patternStyle) {
                            return CellFill.noColor;
                        }
                        return g;
                    }
                }
            case 2:
                {
                    let i = this._i._rows$i._aj(a);
                    let j = this._i._getCellConditionalFormat1(a, b);
                    if (j != null && j.cellFormat != null && j.cellFormat.font != null && WorkbookColorInfo.l_op_Inequality(j.cellFormat.font.colorInfo, null)) {
                        return j.cellFormat.font.colorInfo;
                    }
                    else {
                        let k = this._i._b4(i, b);
                        let l = k._bh;
                        let m = this._i.workbook;
                        let n = WorkbookColorInfo.automatic._getResolvedColor1(m);
                        let o = l._getResolvedColor1(m);
                        if (Color.b(n, o) || Color.c(Nullable$1.toNullable(Color.$, null), Nullable$1.toNullable(Color.$, o))) {
                            return WorkbookColorInfo.automatic;
                        }
                        else {
                            return l;
                        }
                    }
                }
            case 3:
                {
                    let p = this._i._getCellConditionalFormat1(a, b);
                    if (p != null) {
                        let q = p.iconInfo;
                        if (null != q) {
                            let r = Nullable$1.toNullable(Number_$type, q.iconIndex);
                            let s = q.iconSet;
                            if (r.hasValue && r.value < 0) {
                                return SpreadsheetUtilities.d1;
                            }
                            let t = Tuple.a(FormatConditionIconSet_$type, Nullable$1.$.specialize(Number_$type), s, r);
                            return t;
                        }
                    }
                    return SpreadsheetUtilities.d1;
                }
            default: return null;
        }
    }
    _az(a) {
        switch (a) {
            case 0:
            case 4: throw new ArgumentOutOfRangeException(0);
            case 1:
                {
                    return CellFill.noColor;
                }
            case 2:
                {
                    return WorkbookColorInfo.automatic;
                }
            case 3:
                {
                    return SpreadsheetUtilities.d1;
                }
            default: return null;
        }
    }
    _a9(a) {
        if (null == a) {
            return stringEmpty();
        }
        let b = this._d.workbook;
        let c = null;
        let d = typeCast(CellFill.$, a);
        if (null != d) {
            if (d == CellFill.noColor) {
                return SpreadsheetUtilities.di(this._d, "SortDialog_CellFill_NoColor");
            }
            if (typeCast(CellFillRectangularGradient.$, d) !== null || typeCast(CellFillLinearGradient.$, d) !== null) {
                return SpreadsheetUtilities.di(this._d, "SortDialog_CellFill_Gradient");
            }
            let e = typeCast(CellFillPattern.$, d);
            if (null != e) {
                c = e.backgroundColorInfo;
            }
        }
        if (WorkbookColorInfo.l_op_Equality(null, c)) {
            c = typeCast(WorkbookColorInfo.$, a);
        }
        if (WorkbookColorInfo.l_op_Inequality(null, c)) {
            return this._a6(c);
        }
        let f = typeCast(Tuple$2.$.specialize(FormatConditionIconSet_$type, Nullable$1.$.specialize(Number_$type)), a);
        if (null != f) {
            let g = f.d;
            if (g.hasValue) {
                return " ";
            }
            else {
                return this._d._fs("SortDialog_ConditionalFormatIcon_NoCellIcon");
            }
        }
        return stringEmpty();
    }
    _ae(a) {
        let b = this._ax;
        if (false == b.hasValue) {
            return false;
        }
        let c = a._w;
        if (c < 0 || c >= this._ar.count) {
            return false;
        }
        return c == b.value;
    }
    _af(a) {
        switch (this._c) {
            case 0: break;
            case 1:
                let b = a._t;
                switch (this._p) {
                    case 1:
                        if (b < this._n._ac || b > this._n._ae) {
                            return false;
                        }
                        break;
                    case 0:
                        if (b < this._n._w || b > this._n._x) {
                            return false;
                        }
                        break;
                }
                break;
            case 3: break;
        }
        return true;
    }
    get _ac() {
        return this._ax.hasValue;
    }
    _bx(a, b) {
        this._ar.insert(a, b);
    }
    _by(a) {
        let b = a ? this._z : this._y;
        let c = a ? -1 : 1;
        if (b) {
            let d = this._ax.value;
            let e = d + c;
            let f = this._g();
            this._ar.remove(f);
            this._ar.insert(e, f);
            this._ax = Nullable$1.toNullable(Number_$type, e);
        }
        else {
            let g = a ? "CanMoveUp" : "CanMoveDown";
        }
    }
    _b3(a, b) {
        let c = this._ax;
        this._ax = a;
        if (b && nullableEquals(c, a)) {
            this._bw(c, this._ax);
        }
    }
    _b5(a, b, c, d) {
        let e;
        if (d < c.count) {
            e = c.item(d);
            e.dataValue = a;
            e.displayText = b;
        }
        else {
            e = new ComboBoxListItem(a, b);
            c.add(e);
        }
    }
    _b6() {
        for (let a of fromEnum(this._ar)) {
            a._am();
        }
    }
    _b7() {
        for (let a of fromEnum(this._ar)) {
            this._cd(a);
        }
    }
    _b9(a) {
        let b = a._h;
        switch (b) {
            case 4:
            case 0: return;
        }
        let c = a._t;
        let d;
        let e = a._q;
        e.clear();
        let f = new HashSet$1(Base.$, 0);
        switch (this._o) {
            case 1:
                {
                    let g = c;
                    let h = this._k._w;
                    let i = this._k._x;
                    for (let j = h; j <= i; j++) {
                        let k = this._ay(g, j, b);
                        if (false == f.contains(k)) {
                            f.add_1(k);
                            let l = this._a9(k);
                            d = new ComboBoxListItem(k, l);
                            e.add(d);
                        }
                    }
                }
                break;
            case 0:
                {
                    if (this._k._n) {
                        let m = c;
                        let n = this._k._ac;
                        let o = this._k._ae;
                        let p = (o - n) + 1;
                        for (let q = n; q <= o; q++) {
                            let r = this._ay(q, m, b);
                            if (false == f.contains(r)) {
                                f.add_1(r);
                                let s = this._a9(r);
                                d = new ComboBoxListItem(r, s);
                                if (typeCast(WorkbookColorInfo.$, d.dataValue) !== null && d.dataValue.isAutomatic) {
                                    e.insert(0, d);
                                }
                                else {
                                    e.add(d);
                                }
                            }
                        }
                    }
                    else {
                        let t = this._az(b);
                        f.add_1(t);
                        let u = this._a9(t);
                        d = new ComboBoxListItem(t, u);
                        e.add(d);
                    }
                }
                break;
            default: break;
        }
        let v = false;
        for (let w of fromEnum(e)) {
            if (SortDialogViewModel._v(a._aa, w.dataValue)) {
                v = true;
                break;
            }
        }
        if (false == v) {
            a._aa = null;
        }
    }
    _b8() {
        let a;
        if (null == this._am) {
            this._am = new ObservableCollection$1(ComboBoxListItem.$, 0);
        }
        let b;
        switch (this._p) {
            case 1:
                b = "SortDialog_SortDirectionLeftOrRight_{0}";
                break;
            case 0:
                b = "SortDialog_SortDirectionTopOrBottom_{0}";
                break;
            default:
                b = "SortDialog_SortDirectionTopOrBottom_{0}";
                break;
        }
        let c = 0;
        let d = enumGetBox(SortDirectionWithCustomListOptions_$type, c);
        let e = stringFormat(b, d.toString());
        let f = this._d._fs(e);
        if (this._am.count >= 1) {
            a = this._am._inner[0];
            a.displayText = f;
        }
        else {
            a = new ComboBoxListItem(d, f);
            this._am.add(a);
        }
        c = 1;
        d = enumGetBox(SortDirectionWithCustomListOptions_$type, c);
        e = stringFormat(b, d.toString());
        f = this._d._fs(e);
        if (this._am.count >= 2) {
            a = this._am._inner[1];
            a.displayText = f;
        }
        else {
            a = new ComboBoxListItem(d, f);
            this._am.add(a);
        }
    }
    _ca() {
        let a;
        switch (this._p) {
            case 1:
                a = "SortDialog_Row_ColumnHeader";
                break;
            case 0:
                a = "SortDialog_Column_ColumnHeader";
                break;
            default:
                a = "SortDialog_Column_ColumnHeader";
                break;
        }
        this._a3 = this._a8(a);
    }
    _cb(a) {
        let b;
        if (null == this._a) {
            this._a = new ObservableCollectionExtended$1(ComboBoxListItem.$, 0);
        }
        else {
            if (false == a) {
                this._a.clear();
                for (let c of fromEnum(this._ar)) {
                    c._al(0, true);
                }
            }
        }
        switch (this._o) {
            case 1:
                {
                    let d = this._k;
                    let e = d._w;
                    let f = d._ac;
                    let g = d._ae;
                    let h = (g - f) + 1;
                    for (let i = f; i <= g; i++) {
                        let j = CellAddress.x(i, false, this._i.workbook.currentFormat, 1, false, this._i.workbook.cellReferenceMode);
                        j = stringReplace(j, "$", stringEmpty());
                        let k = this._d._fs("SortDialog_RowName", j);
                        b = new ComboBoxListItem(i, k);
                        this._a.add(b);
                    }
                }
                break;
            case 0:
                {
                    let l = this._ak ? this._m : this._k;
                    let m = l._ac;
                    let n = l._w;
                    let o = l._x;
                    let p = (o - n) + 1;
                    let q = this._i._rows$i._aj(m);
                    for (let r = n; r <= o; r++) {
                        let s;
                        if (this._ak && null != q) {
                            s = SpreadsheetUtilities.dg(q, r);
                        }
                        else {
                            let t = CellAddress.w(r, false, 16384, -1, false, this._i.workbook.cellReferenceMode);
                            t = stringReplace(t, "$", stringEmpty());
                            s = this._d._fs("SortDialog_ColumnName", t);
                        }
                        let u = r - n;
                        if (u < this._a.count) {
                            b = this._a._inner[u];
                            b.dataValue = r;
                            b.displayText = s;
                        }
                        else {
                            b = new ComboBoxListItem(r, s);
                            this._a.add(b);
                        }
                    }
                }
                break;
            default: break;
        }
    }
    _cc() {
        switch (this._c) {
            case 1:
            case 0:
                {
                    let t1 = this._p;
                    L0: while (true) {
                        switch (t1) {
                            case 1:
                                this._aj = false;
                                break;
                            case 0:
                                this._aj = true;
                                break;
                            default:
                                t1 = 0;
                                continue L0;
                        }
                        break;
                    }
                }
                break;
            case 2:
            case 3:
                this._aj = false;
                break;
            default: return;
        }
    }
    _cd(a) {
        let b;
        let c;
        let d;
        let e = a._r;
        let f = this._p == 0;
        let g = SpreadsheetUtilities.l(this._i, this._j, a._y, f);
        let h;
        let t1 = g;
        L0: while (true) {
            switch (t1) {
                case 1:
                case 3:
                case 2:
                    h = stringFormat("SortDialog_SortDirection_{0}_{1}", EnumUtil.getName(CellContentType_$type, g), "{0}");
                    break;
                case 0:
                default:
                    t1 = 1;
                    continue L0;
            }
            break;
        }
        b = 0;
        c = enumGetBox(SortDirectionWithCustomListOptions_$type, b);
        let i = stringFormat(h, c.toString());
        d = this._d._fs(i);
        this._b5(c, d, e, 0);
        b = 1;
        c = enumGetBox(SortDirectionWithCustomListOptions_$type, b);
        i = stringFormat(h, c.toString());
        d = this._d._fs(i);
        this._b5(c, d, e, 1);
        if (4 == a._h) {
            c = enumGetBox(SortDirectionWithCustomListOptions_$type, 2);
            d = a._ad(true);
            this._b5(c, d, e, 2);
            c = enumGetBox(SortDirectionWithCustomListOptions_$type, 3);
            d = a._ad(false);
            this._b5(c, d, e, 3);
        }
        else {
            while (e.count > 2) {
                e.removeAt(2);
            }
        }
    }
    _ce() {
        if (false == this._al) {
            return;
        }
        let a = this._n;
        switch (this._c) {
            case 1:
            case 0:
                {
                    let b = a._ac;
                    if (this._ad) {
                        if (a._ac != 0) {
                            b--;
                        }
                        else {
                        }
                    }
                    this._l = new WorksheetRegionAddress(1, b, b, a._w, a._x);
                    switch (this._p) {
                        case 0:
                            let c;
                            if (this._ad) {
                                c = this._ag ? a._ac : b;
                            }
                            else {
                                c = this._ag ? a._ac + 1 : a._ac;
                            }
                            this._j = new WorksheetRegionAddress(1, c, a._ae, a._w, a._x);
                            break;
                        case 1:
                            this._j = new WorksheetRegionAddress(1, b, a._ae, a._w, a._x);
                            break;
                    }
                }
                break;
            case 2:
                {
                    let d = this._i.filterSettings;
                    let e = d.sortAndFilterAreaRegion;
                    this._j = e != null ? e._h : WorksheetRegionAddress._b;
                    let f = d.region._h;
                    this._l = new WorksheetRegionAddress(1, f._ac, f._ac, f._w, f._x);
                }
                break;
            case 3:
                {
                    this._j = this._q.dataAreaRegion._h;
                    this._l = this._q.headerRowRegion._h;
                }
                break;
            default: break;
        }
        if (this._r != null) {
            this._r(this._j);
        }
        this._al = false;
    }
    _f() {
        let a = new SortConditionWrapper(this, null, 0);
        this._ar.add(a);
        this._ax = Nullable$1.toNullable(Number_$type, this._ar.count - 1);
        return a;
    }
    _u(a) {
        let b = this._ar;
        let c;
        switch (this._c) {
            case 2:
                {
                    let d = this._i.filterSettings.sortSettings;
                    d.caseSensitive = this._ab;
                    let e = new List$1(KeyValuePair$2.$.specialize(RelativeIndex.$, SortCondition.$), 0);
                    for (let f of fromEnum(b)) {
                        let g = new RelativeIndex(f._y);
                        if (false == ((() => { let h = f._n(c, a); c = h.p0; a = h.p1; return h.ret; })())) {
                            return {
                                ret: false,
                                p0: a
                            };
                        }
                        e.add(new KeyValuePair$2(RelativeIndex.$, SortCondition.$, 1, g, c));
                    }
                    if (e.count > 0) {
                        try {
                            d._sortConditions$i.clear();
                            d._sortConditions$i.addRange(e);
                        }
                        catch (h) {
                            a = this._h(h);
                            return {
                                ret: false,
                                p0: a
                            };
                        }
                    }
                    a = null;
                    return {
                        ret: true,
                        p0: a
                    };
                }
            case 0:
            case 1:
                {
                    let i = this._i.sortSettings;
                    i.caseSensitive = this._ab;
                    i.sortType = this._p;
                    i._setRegion(this._k.toString());
                    let j = new List$1(KeyValuePair$2.$.specialize(RelativeIndex.$, SortCondition.$), 0);
                    for (let k of fromEnum(b)) {
                        let l = new RelativeIndex(k._y);
                        if (false == ((() => { let m = k._n(c, a); c = m.p0; a = m.p1; return m.ret; })())) {
                            return {
                                ret: false,
                                p0: a
                            };
                        }
                        j.add(new KeyValuePair$2(RelativeIndex.$, SortCondition.$, 1, l, c));
                    }
                    if (j.count > 0) {
                        try {
                            if (i._sortConditions$i != null) {
                                i._sortConditions$i.clear();
                            }
                            i._sortConditions$i.addRange(j);
                        }
                        catch (m) {
                            a = this._h(m);
                            return {
                                ret: false,
                                p0: a
                            };
                        }
                    }
                    a = null;
                    return {
                        ret: true,
                        p0: a
                    };
                }
            case 3:
                {
                    let n = this._q.sortSettings;
                    n.caseSensitive = this._ab;
                    let o = new List$1(KeyValuePair$2.$.specialize(WorksheetTableColumn.$, SortCondition.$), 0);
                    for (let p of fromEnum(b)) {
                        let q = this._q._columns$i._item(p._y);
                        if (false == ((() => { let r = p._n(c, a); c = r.p0; a = r.p1; return r.ret; })())) {
                            return {
                                ret: false,
                                p0: a
                            };
                        }
                        o.add(new KeyValuePair$2(WorksheetTableColumn.$, SortCondition.$, 1, q, c));
                    }
                    if (o.count > 0) {
                        try {
                            n._sortConditions$i.clear();
                            n._sortConditions$i.addRange(o);
                        }
                        catch (r) {
                            a = this._h(r);
                            return {
                                ret: false,
                                p0: a
                            };
                        }
                    }
                    a = null;
                    return {
                        ret: true,
                        p0: a
                    };
                }
            default:
                a = null;
                return {
                    ret: false,
                    p0: a
                };
        }
    }
    _bu() {
        let a = this._g();
        if (null != a) {
            let b = this._ar._inner[this._aw.value];
            if (null != b) {
                let c = b._j();
                let d = this._ax.value + 1;
                this._bx(d, c);
                this._b3(Nullable$1.toNullable(Number_$type, d), true);
            }
        }
        else {
        }
    }
    _bv() {
        if (this._ac) {
            let a = this._ar;
            let b = this._ax.value;
            let c = Nullable$1.toNullable(Number_$type, b);
            a.removeAt(b);
            if (this._aq.count == 0) {
                c = Nullable$1.toNullable(Number_$type, null);
            }
            else if (nullableEquals(this._aq.count, c)) {
                c.postDecrement();
            }
            this._b3(c, true);
        }
        else {
        }
    }
    _bz() {
        this._by(false);
    }
    _b0() {
        this._by(true);
    }
    get _ak() {
        switch (this._c) {
            case 1:
            case 0:
                {
                    let t1 = this._p;
                    L0: while (true) {
                        switch (t1) {
                            case 1: return false;
                            case 0: return this._ah;
                            default:
                                t1 = 0;
                                continue L0;
                        }
                        break;
                    }
                }
            case 2:
            case 3: return this._ah;
            default: return this._ah;
        }
    }
    _b1(a, b) {
        if (null != this._activeRowIndexChanged) {
            let c = new ActiveRowIndexChangedEventArgs(a, b);
            this._activeRowIndexChanged(this, c);
        }
        this._b2("ActiveRowIndex");
    }
    _b2(a) {
        switch (a) {
            case "SortOrientation":
                this._al = true;
                this._cb(false);
                this._ca();
                this._b8();
                this._cc();
                this._b7();
                this._b6();
                break;
            case "MyDataHasHeaders":
                this._cb(true);
                break;
        }
        let b = this.propertyChanged;
        if (null != b) {
            b(this, new PropertyChangedEventArgs(a));
        }
    }
    get _k() {
        this._ce();
        return this._j;
    }
    get _m() {
        this._ce();
        return this._l;
    }
    get _e() {
        return this._d;
    }
    get _ax() {
        return this._aw;
    }
    set _ax(a) {
        let b = this._aw;
        let c = a;
        if (nullableEquals(b, c)) {
            return;
        }
        this._aw = a;
        this._bw(b, c);
    }
    get _a0() {
        return this._a8("SortDialog_AddLevel");
    }
    get _t() {
        return this._s;
    }
    get _a1() {
        return this._a8("SortDialog_Cancel");
    }
    get _w() {
        return this._ac;
    }
    get _x() {
        return this._ac;
    }
    get _y() {
        if (false == this._ac) {
            return false;
        }
        return this._ax.value < (this._ar.count - 1);
    }
    get _z() {
        if (false == this._ac) {
            return false;
        }
        return this._ax.value > 0;
    }
    get _ab() {
        return this._aa;
    }
    set _ab(a) {
        if (a == this._aa) {
            return;
        }
        this._aa = a;
    }
    get _a3() {
        return this._a2;
    }
    set _a3(a) {
        if (stringCompare1(this._a2, a, 0) == 0) {
            return;
        }
        this._a2 = a;
        this._b2("ColumnColumnHeaderText");
    }
    get _an() {
        if (null == this._am) {
            this._b8();
        }
        return this._am;
    }
    get _a4() {
        return this._a8("SortDialog_CopyLevel");
    }
    get _a5() {
        return this._a8("SortDialog_DeleteLevel");
    }
    get _b() {
        if (null == this._a) {
            this._cb(false);
        }
        return this._a;
    }
    get _ba() {
        return this._a8("SortDialog_MoveDown");
    }
    get _bb() {
        return this._a8("SortDialog_MoveUp");
    }
    get _ah() {
        return this._ag;
    }
    set _ah(a) {
        this._ag = a;
        this._al = true;
        this._b2("MyDataHasHeaders");
    }
    get _aj() {
        return this._ai;
    }
    set _aj(a) {
        if (a == this._ai) {
            return;
        }
        this._ai = a;
        this._b2("MyDataHasHeadersEnabled");
    }
    get _bc() {
        return this._a8("SortDialog_MyDataHasHeaders");
    }
    get _bd() {
        return this._a8("SortDialog_OK");
    }
    get _be() {
        return this._a8("SortDialog_Options");
    }
    get _bf() {
        return this._a8("SortDialog_Order_ColumnHeader");
    }
    get _bg() {
        return this._a8("SortDialog_SortBy_Label");
    }
    get _ap() {
        if (null == this._ao) {
            this._bs();
        }
        return this._ao;
    }
    get _ar() {
        return this._aq;
    }
    get _bh() {
        return this._a8("SortDialog_Title");
    }
    get _bi() {
        return this._a8("SortDialog_SortOn_ColumnHeader");
    }
    get _bk() {
        return this._a8("SortOptionsDialog_CaseSensitive");
    }
    get _bj() {
        return this._a8("SortOptionsDialog_Cancel");
    }
    get _bn() {
        return this._a8("SortOptionsDialog_SortLeftToRight");
    }
    get _bo() {
        return this._a8("SortOptionsDialog_SortTopToBottom");
    }
    get _bp() {
        return this._a8("SortOptionsDialog_Title");
    }
    get _bl() {
        return this._a8("SortOptionsDialog_OK");
    }
    get _bm() {
        return this._a8("SortOptionsDialog_Orientation");
    }
    get _p() {
        return this._o;
    }
    set _p(a) {
        if (a == this._o) {
            return;
        }
        this._o = a;
        this._b2("SortOrientation");
    }
    get _bq() {
        return this._a8("SortDialog_ThenBy_Label");
    }
    _b4(a, b) {
        switch (b.action) {
            case 1:
                if (b.oldStartingIndex == 0 && this._aq.count > 0) {
                    this._aq._inner[0]._an();
                }
                break;
            case 0:
                for (let c of fromEn(b.newItems)) {
                    let d = c;
                    d._an();
                }
                if (b.newStartingIndex == 0 && this._aq.count > 1) {
                    this._aq._inner[1]._an();
                }
                break;
        }
    }
}
SortDialogViewModel.$t = markType(SortDialogViewModel, 'SortDialogViewModel', Base.$, [INotifyPropertyChanged_$type]);
/**
 * @hidden
 */
export class SortDialogViewModel_ApplySortErrorInfo extends Base {
    constructor(a, ..._rest) {
        super();
        this.a = null;
        this.d = null;
        this.c = null;
        a = (a == void 0) ? 0 : a;
        switch (a) {
            case 0:
                {
                    let c = _rest[0];
                    this.c = c;
                }
                break;
            case 1:
                {
                    let c = _rest[0];
                    let d = _rest[1];
                    let e = _rest[2];
                    this.a = c;
                    this.d = d;
                    this.c = e;
                }
                break;
        }
    }
    get b() {
        return null != this.a ? this.a._w : -1;
    }
}
SortDialogViewModel_ApplySortErrorInfo.$t = markType(SortDialogViewModel_ApplySortErrorInfo, 'SortDialogViewModel_ApplySortErrorInfo');
/**
 * @hidden
 */
export class CellDropDown extends Base {
    constructor(a) {
        super();
        this.b = null;
        this.a = null;
        this.e = null;
        this.b = a;
    }
    get c() {
        return this.a != null && this.a.f;
    }
    f() {
        if (this.a != null) {
            let a = this.a;
            let b = this.e;
            this.a = null;
            this.e = null;
            a.ao();
            a.aq();
            b.remove();
            b.destroy();
        }
    }
    d(a, b, c, d, e) {
        this.f();
        if (this.b._fa == null) {
            return false;
        }
        let f = this.b._n(a);
        if (f == null || c.count == 0) {
            return false;
        }
        let g = this.b._fa;
        let h = new List$1(DropDownItem.$, 0);
        for (let i = 0; i < c.count; i++) {
            let j = c._inner[i];
            let k = new DropDownItem();
            k.p = j;
            k.m = i;
            h.add(k);
        }
        let l = new DropDownPosition();
        l.a = 2 | 4;
        l.b = 1 | 4;
        l.c = RelativePositionInfo.d;
        l.d = RelativePositionInfo.d;
        l.e = RelativePositionInfo.e;
        l.f = RelativePositionInfo.d;
        let m = this.b._bh.a7.rootWrapper;
        b = b.copy();
        let n = f;
        while (n != this.b._bh) {
            b.x += n.ax;
            b.y += n.a2;
            n = n._parent;
        }
        this.e = g.createElement("div");
        this.e.setRawStyleProperty("position", "relative");
        this.e.setRawStyleProperty("width", "0px");
        this.e.setRawStyleProperty("height", "0px");
        if (m.getChildCount() == 0) {
            m.append(this.e);
        }
        else {
            m.getChildAt(0).before(this.e);
        }
        this.a = new DropDown(g, this.e, h, null, null, (o, p) => {
            o.addClass("comboboxitem");
            o.setText(p.p);
        });
        let o = this.a;
        o.itemClicked = delegateCombine(o.itemClicked, (o, p) => e(typeGetValue(p.m)));
        let p = this.a;
        p.closed = delegateCombine(p.closed, (p, q) => {
            if (this.b._v.hasKeyboardFocusWithin) {
                this.b._v.focus();
            }
        });
        this.a.y = (q, r, s, t) => {
            t.preventDefault();
            t.stopPropagation();
            this.a.l(r, s);
            return true;
        };
        this.a.ac.setRawStyleProperty("min-width", b.width + "px");
        this.a.ac.addClass("comboboxdropdown");
        this.a.ac.listen("blur", (q) => this.f());
        this.a.ai = d;
        this.a.a0(b, l);
        this.a.ac.focus();
        return true;
    }
}
CellDropDown.$t = markType(CellDropDown, 'CellDropDown');
/**
 * @hidden
 */
export class SpreadsheetCellEditManager extends Base {
    constructor(a) {
        super();
        this.f = null;
        this.a = null;
        this.h = new SpreadsheetCell();
        this.m = new SpreadsheetCellRange();
        this.n = new SpreadsheetCellRange();
        this.w = null;
        this.u = null;
        this.s = null;
        this.j = null;
        this.aj = 0;
        CoreUtilities.y(a);
        this.f = a;
    }
    get i() {
        return this.h;
    }
    get x() {
        return this.w;
    }
    get l() {
        return this.j;
    }
    get o() {
        return this.m;
    }
    get p() {
        return this.n;
    }
    get c() {
        return this.a;
    }
    get t() {
        return this.s;
    }
    get v() {
        return this.u;
    }
    get g() {
        return this.f;
    }
    am() {
        let a = stringEmpty();
        let b = this.g._a8;
        if (b != null) {
            let c = null;
            let d = this.g._am._c;
            c = b._fk(d);
            if (c != null) {
                let e = b._bc;
                let f = e._rows$i.item(d.row);
                let g = e._b4(f, d.column);
                a = (((h) => h != null ? h : stringEmpty())(SpreadsheetUtilities.df(c, e, g)));
            }
        }
        return a;
    }
    an(a) {
        if (this.f.isInEditMode) {
            this.f.cellEditMode = a ? 1 : 2;
        }
    }
    ax(a, b) {
        this.f.activeSelectionCellRangeFormat._u(b);
    }
    ay() {
        if (this.a != null && !this.f._dh) {
            this.a._m(false);
            this.f._dr = true;
            this.f._ge();
        }
    }
    y(a, b, c = null, d = false, e = false) {
        try {
            this.f._g9(true);
            return this.z(a, b, c, d, e);
        }
        finally {
            this.f._g9(false);
        }
    }
    z(a, b, c = null, d = false, e = false) {
        if (!this.ae(1, true)) {
            return false;
        }
        this.f._v.verifyLayout();
        if (this.f.isInEditMode) {
            return false;
        }
        if (this.f._bd != null && !this.f._cx(false)) {
            return false;
        }
        if (!this.ah) {
            return false;
        }
        let f = this.f._a8;
        if (f == null) {
            return false;
        }
        let g = f.getCellRange(a);
        let h = f._e1(g);
        if (SpreadsheetCell._l_op_Equality_Lifted$i(h, Nullable$1.toNullable(SpreadsheetCell.$, null))) {
            return false;
        }
        let i = f._ar(h.value);
        if (i == null) {
            return false;
        }
        if (!this.aa(i)) {
            return false;
        }
        this.f.selectionMode = 0;
        this.f.isInEndMode = false;
        f._b2(i, h.value, true);
        this.ap();
        if (this.g.isInEditMode) {
            return false;
        }
        if (f._bc.isProtected && f._bc.protection.selectionMode == 2) {
            return false;
        }
        let j = g._c;
        let k = new SpreadsheetEditModeEnteringEventArgs(j);
        this.f._h0(k);
        if (k.cancel) {
            return false;
        }
        if (this.f._a8._br(a) == false) {
            return false;
        }
        if (this.g.isInEditMode) {
            return false;
        }
        if (false == d && !this.f._v.focus()) {
            return false;
        }
        if (this.a == null) {
            this.a = this.b();
        }
        this.h = j;
        this.m = f.getCellRange(a);
        this.n = this.m;
        this.w = (f._a8(a) || CellFill._createSolidFill1(ExcelUtils.gw(255, 255, 255)))._c(f._bc.workbook);
        this.u = f;
        this.s = i;
        this.j = this.k(f, j);
        this.f.isInEditMode = true;
        if (this.j.a.r == false && this.j.b._a4 == 6 && this.n.lastColumn < this.j.a.x) {
            this.n = new SpreadsheetCellRange(this.n.firstRow, this.n.firstColumn, this.n.lastRow, this.j.a.x);
        }
        this.aj = NaN;
        i._al = true;
        this.an(b);
        this.ax(a, this.a);
        this.as(c, b, d, e);
        this.f._ge();
        this.f._hz(new SpreadsheetEditModeEnteredEventArgs(j));
        return true;
    }
    k(a, b) {
        return a._s(b);
    }
    ae(a, b, c = false, d = true) {
        try {
            this.f._g9(true);
            return this.af(a, b, c, d);
        }
        finally {
            this.f._g9(false);
        }
    }
    af(a, b, c = false, d = true) {
        if (!this.g.isInEditMode) {
            if (this.f._bd != null) {
                return this.f._cx(a == 0, b);
            }
            return true;
        }
        let e = this.h;
        let f = this.d();
        let g = f != null ? f.unformattedText : null;
        let h = a != 0;
        let i = new SpreadsheetEditModeExitingEventArgs(e, h, !b, g);
        this.f._h2(i);
        if (i.canCancel && i.cancel) {
            return false;
        }
        if (i.acceptChanges != h) {
            if (!i.acceptChanges) {
                a = 0;
            }
            else {
                a = 1;
            }
        }
        let j = this.q(a, b, d);
        if (!b && (j & 1) == 1) {
            if ((j & 2) == 2 && this.f.cellEditMode == 1) {
                this.f._cz(151, null, null);
            }
            return false;
        }
        this.f.isInEditMode = false;
        this.ax(e, null);
        this.f.cellEditMode = 0;
        this.f._ds = true;
        this.f._ge();
        this.f._h1(new SpreadsheetEditModeExitedEventArgs(e));
        if (c && (j & 4) == 4) {
            return false;
        }
        return true;
    }
    d() {
        if (!this.f.isInEditMode) {
            return null;
        }
        return this.e();
    }
    al() {
        if (this.f.isInEditMode == false) {
            return NaN;
        }
        if (isNaN_(this.aj)) {
            this.aj = this.ak();
        }
        return this.aj;
    }
    ar() {
        this.aj = NaN;
        this.f._ge();
    }
    au() {
        if (!this.g.isInEditMode) {
            if (false == this.y(this.g.activeCell, false, null, true)) {
                this.g._v.focus();
            }
        }
        else {
            this.an(false);
        }
    }
    aw() {
        if (this.a != null) {
            this.a._o();
        }
    }
    ai() {
        if (this.f.isInEditMode && this.u != null && this.u._bc._d6) {
            let a = this.u._bc._dataValidationRules$i._e(SpreadsheetUtilities.az(this.h.row, this.h.column));
            if (a != null && a._k != 0) {
                return true;
            }
        }
        return false;
    }
    q(a, b, c) {
        if (!this.f.isInEditMode) {
            return 0;
        }
        let d = 0;
        if (a != 0) {
            let e = this.f;
            let f = this.u._bc;
            let g = this.h;
            let h = (i, j, k, l) => {
                let m = this.ai();
                let n = 1;
                let o = () => {
                    n = j();
                    if (n == 2) {
                        let p = f._bi(g.row, g.column);
                        if (p != null) {
                            d |= 2;
                            let q = new SpreadsheetEditModeValidationErrorEventArgs(g, p, b);
                            q.action = p.showErrorMessageForInvalidValue ? 0 : 3;
                            e._h3(q);
                            switch (q.action) {
                                case 3: break;
                                case 2:
                                    n = 0;
                                    break;
                                case 1:
                                    n = 1;
                                    break;
                                case 0:
                                    n = this.r(n, p);
                                    break;
                            }
                            if (n == 0) {
                                d |= 4;
                            }
                            if (n != 2) {
                                throw new EditModeDataValidationException();
                            }
                        }
                    }
                };
                e._gi(i, o, l, void 0, k, void 0, m);
                return n;
            };
            let i = new SpreadsheetEditHelper(this.u, this.s, this.h, this.f.isFixedDecimalEnabled, this.f.fixedDecimalPlaceCount, runOn(this.f, this.f._dz), h);
            let j = this.d();
            if (j != null) {
                let k = i.e(a, j, b == false, j.unformattedText, this.j.c);
                if (k == 1 && !b) {
                    return d |= 1;
                }
                if (k == 2 && f._fd.count > 0 && f._bi(g.row, g.column) == null) {
                    if (f._ei(g.row, g.column)) {
                        if (this.u != null) {
                            this.u._g0();
                        }
                    }
                }
            }
        }
        let l = this.s;
        this.w = null;
        this.j = null;
        this.s = null;
        this.u = null;
        l._al = false;
        this.at();
        if (c) {
            this.f._v.focus();
        }
        return d;
    }
    r(a, b) {
        let c = stringIsNullOrEmpty(b.errorMessageTitle) ? stringEmpty() : b.errorMessageTitle;
        let d = !stringIsNullOrEmpty(b.errorMessageDescription);
        let e = stringFormat(d ? "CustomValidation{0}Message" : "DefaultValidation{0}Message", EnumUtil.getName(DataValidationErrorStyle_$type, b.errorStyle));
        let f = d ? this.f._fs(e, b.errorMessageDescription) : this.f._fs(e);
        switch (b.errorStyle) {
            case 2:
                if (2 == this.f._v.showMessageBox(f, c, 1, 64, 1)) {
                    a = 0;
                }
                break;
            case 1:
                let g = this.f._v.showMessageBox(f, c, 3, 48, 7);
                if (g == 2) {
                    a = 0;
                }
                else if (g == 7) {
                    a = 1;
                }
                break;
            default:
            case 0:
                if (2 == this.f._v.showMessageBox(f, c, 1, 16, 1)) {
                    a = 0;
                }
                else {
                    a = 1;
                }
                break;
        }
        return a;
    }
}
SpreadsheetCellEditManager.$t = markType(SpreadsheetCellEditManager, 'SpreadsheetCellEditManager');
/**
 * @hidden
 */
export class JsCellEditManager extends SpreadsheetCellEditManager {
    constructor(a) {
        super(a);
    }
    get_ac() {
        return true;
    }
    get ac() {
        return this.get_ac();
    }
    get_ad() {
        return true;
    }
    get ad() {
        return this.get_ad();
    }
    get_ah() {
        return !this.g.isDisabled;
    }
    get ah() {
        return this.get_ah();
    }
    a0(a, b) {
        a.cg = b.a.e;
        a.ck = b.a.f;
        a.dg = new Thickness(1, b.a.y, b.a.ac, b.a.z, b.a.v);
        a.ci = new WorkbookFontSnapshot(b.b);
        a.c6 = this.v._d8;
        a.dc = ExcelUtils.al(b.a.ar) ? b.b._bh._getResolvedColor1(this.g.workbook) : b.a.ar;
    }
    as(a, b, c, d) {
        let e = this.g._ay;
        this.a0(e, this.l);
        if (!c) {
            this.g._v.focus();
        }
        if (a != null) {
            let f = this.g._m();
            if (a == e.c9) {
            }
            else if (f != null && f == e && f.a7 != null) {
                let g = (e.c9 != null ? e.c9 : "").length;
                SpreadsheetUtilities.bk(e.a7.rootWrapper.getNativeElement(), 0, g);
                this.g._bj.ai(a);
            }
            else {
                e.c9 = a;
            }
        }
        else if (false == d) {
            let h = true;
            let i = this.g._bh.dp.ci.cf;
            if (i.a7 != null && SpreadsheetUtilities.a5(i, document.activeElement)) {
                h = false;
            }
            if (e.a7 != null && h) {
                let j = (e.c9 != null ? e.c9 : "").length;
                SpreadsheetUtilities.bk(e.a7.rootWrapper.getNativeElement(), j, j);
            }
        }
    }
    ap() {
    }
    aa(a) {
        this.g._at.l(false);
        return this.g._bh != null;
    }
    ak() {
        let a = this.g._ay;
        let b = a.c9;
        let c = this.v._d8;
        let d = a.dg.c + a.dg.d;
        let e = this.g._a0.i(b, a.ci, a.dg, c);
        e -= d;
        e /= c;
        e += d;
        return e;
    }
    b() {
        return null;
    }
    ab(a) {
        let b = SpreadsheetUtilities.dd(a);
        let c = this.g._ay;
        if (b != null && c != null) {
            try {
                if ((document.queryCommandSupported && !document.queryCommandSupported(b))) {
                    return false;
                }
                if (a == 150) {
                    return true;
                }
                if (((typeof document.queryCommandEnabled === "function"))) {
                    return (document.queryCommandEnabled(b));
                }
            }
            catch (d) {
            }
        }
        return true;
    }
    at() {
        this.ao();
    }
    e() {
        let a = stringEmpty();
        if (this.g._ay != null) {
            a = this.g._ay.c9;
        }
        return new SpreadsheetEditorValue(a, this.l.b);
    }
    ag(a, b = true) {
        if (!this.g.isInEditMode) {
            return false;
        }
        let c = SpreadsheetUtilities.dd(a);
        if (c == null) {
            return false;
        }
        try {
            switch (a) {
                case 149:
                    this.g._ga();
                    break;
                case 148:
                    this.g._ga();
                    this.g._bj.ai(null);
                    break;
                case 150:
                    let d = ClipboardHelper.e();
                    if (d != null && d.getDataPresent(DataFormats.d)) {
                        this.g._bj.ai(d.getData(DataFormats.d));
                    }
                    break;
                default:
                    document.execCommand(c);
                    break;
            }
        }
        catch (e) {
        }
        return true;
    }
    ao() {
        let a = this.g._ay;
        if (a != null) {
            let b = this.g._am._c;
            let c = this.g._a8;
            let d = c._s(b);
            if (this.g.isInEditMode && this.l != null) {
                this.a0(a, d);
            }
            else {
                a.c9 = SpreadsheetUtilities.df(c._fk(b), c._bc, d.b);
            }
            a.cv = true;
        }
    }
    aq() {
    }
    av(a, b) {
    }
    az() {
        let a = this.g._bh;
        if (a == null) {
            return;
        }
        let b = a.dp.ci.cf;
        let c = this.g._ay;
        let d;
        if (this.g.isInEditMode && c != null) {
            if (this.g._m() == b) {
                d = b.co;
            }
            else {
                d = c.c9;
            }
        }
        else {
            d = this.am();
        }
        b.co = d;
    }
}
JsCellEditManager.$t = markType(JsCellEditManager, 'JsCellEditManager', SpreadsheetCellEditManager.$);
/**
 * @hidden
 */
export class SpreadsheetMenuBuilder$1 extends Base {
    constructor($t, a) {
        super();
        this.$t = null;
        this.c = null;
        this.$t = $t;
        this.$type = this.$type.specialize(this.$t);
        this.c = a;
    }
    af(a) {
        return a;
    }
    e(a, b) {
        return this.n(a);
    }
    as(a, b) {
        let c;
        switch (b) {
            case 4:
            case 0:
            case 1:
                c = EnumUtil.getName(SpreadsheetContextMenuSubItem_$type, b);
                break;
            default:
            case 5:
            case 3:
            case 2: return this.ar(a, this.c.activeCell);
        }
        let d;
        switch (a) {
            case 153:
                d = "ShiftDown";
                break;
            case 152:
                d = "ShiftRight";
                break;
            case 147:
            case 146:
                d = "Column";
                break;
            case 144:
            case 145:
                d = "Row";
                break;
            case 155:
                d = "ShiftUp";
                break;
            case 154:
                d = "ShiftLeft";
                break;
            default:
                d = EnumUtil.getName(SpreadsheetAction_$type, a);
                break;
        }
        return this.af(this.ay("MenuItem_" + c + "_" + d));
    }
    ar(a, b) {
        let c;
        switch (a) {
            case 189: return this.af(SpreadsheetUtilities.db(this.c, b));
            case 187: return this.af(SpreadsheetUtilities.dk(true, this.c, b));
            case 186: return this.af(SpreadsheetUtilities.dk(false, this.c, b));
            case 203:
                c = "MenuItem_Sort_Custom";
                break;
            case 190:
                c = "MenuItem_ReapplyFilter";
                break;
            case 100:
                c = "MenuItem_InsertWorksheets";
                break;
            case 89:
            case 91:
                c = "MenuItem_Hide";
                break;
            case 90:
            case 92:
                c = "MenuItem_Unhide";
                break;
            case 94:
                c = "MenuItem_AutoFit_Columns";
                break;
            case 93:
                c = "MenuItem_AutoFit_Rows";
                break;
            case 145:
            case 147:
                c = "MenuItem_Insert";
                break;
            case 144:
            case 146:
                c = "MenuItem_Delete";
                break;
            default:
                c = "MenuItem_" + EnumUtil.getName(SpreadsheetAction_$type, a);
                break;
        }
        return this.af(this.ay(c));
    }
    at(a) {
        let b;
        switch (a) {
            case 0:
                b = "MenuItem_Insert";
                break;
            case 1:
                b = "MenuItem_Delete";
                break;
            case 11:
                b = "MenuItem_SortByCellColorHeader";
                break;
            case 2:
            case 3:
            case 4:
            case 5:
            case 9:
            case 8:
            case 6:
            case 7:
            case 10:
            case 12:
            case 13:
            case 14:
            case 15:
            case 16:
            case 17:
                b = "MenuItem_" + EnumUtil.getName(SpreadsheetContextMenuSubItem_$type, a);
                break;
            default:
                b = "";
                break;
        }
        return this.af(this.ay(b));
    }
    av(a) {
        if (WorkbookColorInfo.l_op_Equality(a, null) || a.isAutomatic) {
            return this.c._fs("MenuItem_Automatic");
        }
        let b = a._getResolvedColor1(this.c.workbook);
        return this.ax(b);
    }
    ax(a) {
        return this.c._fs("MenuItem_ColorValue", a.o, a.n, a.m);
    }
    au(a) {
        if (a == null || a == CellFill.noColor) {
            return this.ay("MenuItem_NoFill");
        }
        let b = typeCast(CellFillPattern.$, a);
        if (b != null) {
            if (b.patternStyle == 0) {
                return this.ay("MenuItem_NoFill");
            }
            else if (b.patternStyle == 1) {
                return this.av(b.backgroundColorInfo);
            }
            else {
                return this.av(b.patternColorInfo);
            }
        }
        return this.ay("MenuItem_GradientFill");
    }
    aw(a) {
        let b = SpreadsheetUtilities.ao(a);
        if (b == -1) {
            return this.ay("MenuItem_NoIcon");
        }
        return this.ay("Icon_" + EnumUtil.getName(FormatConditionIcon_$type, b));
    }
    ay(a) {
        let b = this.c._fs(a);
        return b;
    }
    i(a, b) {
        return this.k(this.af(this.c._fs("MenuItem_Filter_" + EnumUtil.getName(ExcelComparisonOperator_$type, a))), this.ao(a));
    }
    ao(a) {
        return "Op" + "_" + EnumUtil.getName(ExcelComparisonOperator_$type, a);
    }
    j(a, b, c) {
        return this.k(this.af(this.c._fs("MenuItem_Filter_" + EnumUtil.getName(RelativeDateRangeDuration_$type, a) + "_" + EnumUtil.getName(RelativeDateRangeOffset_$type, b))), this.ap(a, b));
    }
    ap(a, b) {
        return "RelDate" + "_" + EnumUtil.getName(RelativeDateRangeDuration_$type, a) + "_" + EnumUtil.getName(RelativeDateRangeOffset_$type, b);
    }
    h(a, b, c) {
        let d;
        switch (a) {
            default:
            case 1:
                d = this.af(this.c._fs("MenuItem_Filter_QuarterNumber", b));
                break;
            case 0:
                d = SpreadsheetUtilities.dh(b, this.c.workbook._e6);
                break;
        }
        return this.k(d, this.an(a, b));
    }
    an(a, b) {
        return "DatePeriod" + "_" + EnumUtil.getName(DatePeriodFilterType_$type, a) + "_" + b.toString();
    }
    g(a, b) {
        return this.k(this.af(this.c._fs("MenuItem_Filter_" + EnumUtil.getName(SpreadsheetSpecialFilterMenuItems_$type, a))), this.am(a));
    }
    am(a) {
        return "CustomFilter" + "_" + EnumUtil.getName(SpreadsheetSpecialFilterMenuItems_$type, a);
    }
    f(a) {
        return this.k(this.ar(a, this.c.activeCell), "Action" + "_" + EnumUtil.getName(SpreadsheetAction_$type, a));
    }
    a() {
        let a = new Array(0);
        let b = [this.p(11, a), this.p(12, a), this.p(13, a), this.o(), this.f(203)];
        let c = [this.p(15, a), this.p(16, a), this.p(17, a)];
        let d = [this.i(0, 7), this.i(1, 7), this.o(), this.i(6, 7), this.i(8, 7), this.o(), this.i(10, 7), this.i(11, 7), this.o(), this.g(0, 7)];
        let e = [this.i(0, 6), this.i(1, 6), this.o(), this.i(2, 6), this.i(3, 6), this.i(4, 6), this.i(5, 6), this.g(1, 6), this.o(), this.g(2, 6), this.g(3, 6), this.g(4, 6), this.o(), this.g(0, 6)];
        let f = [this.i(0, 8), this.o(), this.g(5, 8), this.g(6, 8), this.g(1, 8), this.o(), this.j(0, 2, 8), this.j(0, 1, 8), this.j(0, 0, 8), this.o(), this.j(1, 2, 8), this.j(1, 1, 8), this.j(1, 0, 8), this.o(), this.j(2, 2, 8), this.j(2, 1, 8), this.j(2, 0, 8), this.o(), this.j(3, 2, 8), this.j(3, 1, 8), this.j(3, 0, 8), this.o(), this.j(4, 2, 8), this.j(4, 1, 8), this.j(4, 0, 8), this.o(), this.g(7, 8), this.o(), this.p(9, [this.h(1, 1, 9), this.h(1, 2, 9), this.h(1, 3, 9), this.h(1, 4, 9), this.o(), this.h(0, 1, 9), this.h(0, 2, 9), this.h(0, 3, 9), this.h(0, 4, 9), this.h(0, 5, 9), this.h(0, 6, 9), this.h(0, 7, 9), this.h(0, 8, 9), this.h(0, 9, 9), this.h(0, 10, 9), this.h(0, 11, 9), this.h(0, 12, 9)]), this.o(), this.g(0, 8)];
        return [this.f(187), this.f(186), this.p(10, b), this.o(), this.f(189), this.p(14, c), this.p(7, d), this.p(6, e), this.p(8, f)];
    }
    a1($tArg, a, b, c, d, e, f) {
        this.a0(a);
        let g = 0;
        let h = new List$1($tArg, 0);
        c((i) => h.add(i));
        if (h == null) {
            h.add(f);
        }
        for (let i of fromEnum(h)) {
            let j = e(i);
            let k = d(b, j, i);
            if (j) {
                g++;
            }
            this.az(a, k);
        }
        this.bc(a, h.count > 1 || g > 0);
    }
    b(a) {
        switch (a) {
            case 7:
                {
                    let b = [this.e(174, 0), this.e(175, 0), this.e(176, 0), this.e(177, 0)];
                    let c = [this.e(178, 1), this.e(179, 1)];
                    let d = [this.e(180, 4), this.e(181, 4), this.e(182, 4)];
                    let e = [this.e(189, 3), this.e(190, 3), this.o(), this.e(191, 3), this.e(192, 3), this.e(193, 3), this.e(194, 3)];
                    let f = [this.e(187, 2), this.e(186, 2), this.e(195, 2), this.e(196, 2), this.e(197, 2), this.e(203, 2)];
                    let g = [this.e(183, 5), this.e(184, 5)];
                    return [this.n(148), this.n(149), this.n(150), this.o(), this.p(0, b), this.p(1, c), this.p(4, d), this.n(79), this.o(), this.p(2, f), this.p(3, e), this.p(5, g), this.o(), this.n(198), this.n(202), this.n(164), this.n(165)];
                }
            case 2:
                {
                    let h = [this.e(152, 0), this.e(153, 0), this.e(145, 0), this.e(147, 0)];
                    let i = [this.e(154, 1), this.e(155, 1), this.e(144, 1), this.e(146, 1)];
                    let j = [this.e(189, 3), this.e(190, 3), this.o(), this.e(191, 3), this.e(192, 3), this.e(193, 3), this.e(194, 3)];
                    let k = [this.e(187, 2), this.e(186, 2), this.e(195, 2), this.e(196, 2), this.e(197, 2), this.e(203, 2)];
                    return [this.n(148), this.n(149), this.n(150), this.o(), this.p(0, h), this.p(1, i), this.n(79), this.o(), this.p(3, j), this.p(2, k), this.o(), this.n(198), this.n(202), this.n(164), this.n(165)];
                }
            case 0: return [this.n(148), this.n(149), this.n(150), this.o(), this.n(147), this.n(146), this.n(79), this.o(), this.n(198), this.n(89), this.n(90), this.n(94), this.o(), this.n(165)];
            case 5: return [this.n(148), this.n(149), this.n(150)];
            case 4: return [this.n(148), this.n(149), this.n(150)];
            case 1: return [this.n(148), this.n(149), this.n(150), this.o(), this.n(145), this.n(144), this.n(79), this.o(), this.n(198), this.n(91), this.n(92), this.n(93), this.o(), this.n(165)];
            case 6: return [this.n(148), this.n(149), this.n(150), this.o(), this.n(198), this.n(156), this.n(157), this.n(79), this.o(), this.n(165)];
            case 3: return [this.n(100), this.n(114), this.n(113), this.o(), this.n(111), this.o(), this.n(112)];
        }
        return null;
    }
    z(a) {
        if (!stringIsNullOrEmpty(a) && stringStartsWith(a, "CustomFilter")) {
            let b = stringSplit(a, ["_"], 0);
            if (b.length > 0 && b[0] == "CustomFilter") {
                return Nullable$1.toNullable(SpreadsheetSpecialFilterMenuItems_$type, EnumUtil.getEnumValue(SpreadsheetSpecialFilterMenuItems_$type, EnumUtil.parse(SpreadsheetSpecialFilterMenuItems_$type, b[1], true)));
            }
        }
        return this.$type.getStaticFields(SpreadsheetMenuBuilder$1.$).ad;
    }
    aa(a) {
        if (a != null && stringStartsWith(a, "Op")) {
            let b = stringSplit(a, ["_"], 0);
            if (b.length > 0 && b[0] == "Op") {
                return Nullable$1.toNullable(ExcelComparisonOperator_$type, EnumUtil.getEnumValue(ExcelComparisonOperator_$type, EnumUtil.parse(ExcelComparisonOperator_$type, b[1], true)));
            }
        }
        return this.$type.getStaticFields(SpreadsheetMenuBuilder$1.$).ae;
    }
    y(a) {
        let b = this.x(a);
        if (nullableNotEquals(b, null)) {
            return Nullable$1.toNullable(SpreadsheetAction_$type, b.value);
        }
        let c = this.aq(a);
        if (c != null && c.indexOf("_") > 0) {
            if (stringStartsWith(c, "Action") && c.length > "Action".length + 1) {
                let d = c.substr("Action".length + 1);
                let e;
                if (((() => { let f = EnumUtil.tryParse$1(SpreadsheetAction_$type, d, true, e); e = f.p2; return f.ret; })())) {
                    return Nullable$1.toNullable(SpreadsheetAction_$type, e);
                }
            }
        }
        return this.$type.getStaticFields(SpreadsheetMenuBuilder$1.$).ac;
    }
    a4(a) {
        let b = this.c._bp(LongValue.a(), null);
        let c = new SpreadsheetMenuBuilder_InitializeItemsState$1(this.$t);
        c.d = b;
        c.c = this.c.activeCell;
        c.e = this.c.activeTable;
        c.a = 0;
        c.f = null;
        this.a5(a, c);
    }
    a2(a, b) {
        let c = this.c._bp(LongValue.a(), b);
        let d = SpreadsheetUtilities.w(this.c.activeWorksheet, b.row, b.column);
        let e = d.a;
        if (e == 0) {
            e = 1;
        }
        let f = new SpreadsheetMenuBuilder_InitializeItemsState$1(this.$t);
        f.c = b;
        f.e = typeCast(TableSortFilterArea.$, d) !== null ? d.ah.table : null;
        f.a = e;
        f.d = c;
        f.f = b.toString();
        f.b = d;
        if (d.g) {
            let g = null;
            let h = typeCast(CustomFilter.$, d.b);
            let i = typeCast(YearToDateFilter.$, d.b);
            let j = typeCast(RelativeDateRangeFilter.$, d.b);
            let k = typeCast(DatePeriodFilter.$, d.b);
            let l = typeCast(AverageFilter.$, d.b);
            let m = typeCast(TopOrBottomFilter.$, d.b);
            if (i != null) {
                g = this.am(7);
            }
            else if (l != null) {
                g = this.am(l.type == 0 ? 3 : 4);
            }
            else if (k != null) {
                g = this.an(k.type, k.value);
            }
            else if (j != null) {
                g = this.ap(j.duration, j.offset);
            }
            else if (m != null) {
                g = this.am(2);
            }
            else if (h != null) {
                if (h.condition1 != null) {
                    if (h.condition2 != null) {
                        if (h.condition1.comparisonOperator == 3 && h.condition2.comparisonOperator == 4) {
                            g = this.am(1);
                        }
                    }
                    else {
                        g = this.ao(h.condition1.comparisonOperator);
                    }
                }
                if (g == null) {
                    g = this.am(0);
                }
            }
            f.g = g;
        }
        this.a5(a, f);
    }
    a3(a, b, c) {
        let d = this.c._cq(b, c.f, c.d);
        let e = true;
        switch (b) {
            case 164:
            case 165:
            case 112:
                e = d;
                break;
            case 99:
            case 100:
                e = this.c.allowAddWorksheet;
                break;
            case 114:
                e = this.c.allowDeleteWorksheet;
                break;
            case 189:
                this.be(a, this.ar(b, c.c));
                break;
            case 187:
            case 186:
                let f = c.a == 0 ? this.ar(b, c.c) : this.af(SpreadsheetUtilities.dj(b == 187, this.c, c.a));
                this.be(a, f);
                let g = false;
                if (c.b != null) {
                    let h = 0;
                    for (let i of fromEnum(c.b.p())) {
                        let j = typeCast(OrderedSortCondition.$, i);
                        if (j != null) {
                            let k = j.sortDirection == 0;
                            let l = b == 187;
                            if (k == l) {
                                g = true;
                            }
                        }
                        h++;
                    }
                    if (h > 1) {
                        g = false;
                    }
                }
                this.bb(a, g);
                break;
        }
        this.bc(a, d);
        this.bd(a, e);
    }
    a5(a, b) {
        for (let c of fromEnum(a)) {
            let d = this.x(c);
            if (nullableNotEquals(d, null)) {
                this.a3(c, d.value, b);
            }
            else {
                let e = this.aq(c);
                if (e != null && e.indexOf("_") > 0) {
                    if (stringStartsWith(e, "Action") && e.length > "Action".length + 1) {
                        let f = e.substr("Action".length + 1);
                        let g;
                        if (((() => { let h = EnumUtil.tryParse$1(SpreadsheetAction_$type, f, true, g); g = h.p2; return h.ret; })())) {
                            this.a3(c, g, b);
                        }
                    }
                    else if (stringStartsWith(e, "CustomFilter") || stringStartsWith(e, "DatePeriod") || stringStartsWith(e, "Op") || stringStartsWith(e, "RelDate")) {
                        this.bc(c, 0 == (b.d.i & 64));
                        this.bb(c, e == b.g);
                    }
                }
            }
            let h = this.w(c);
            if (h != null) {
                this.a5(h, b);
                let i = this.ab(c);
                if (nullableNotEquals(i, null)) {
                    let j = b.a;
                    switch (i.value) {
                        case 6:
                            this.bd(c, j == 0 || j == 3);
                            break;
                        case 7:
                            this.bd(c, j == 0 || j == 1);
                            break;
                        case 8:
                            this.bd(c, j == 0 || j == 2);
                            break;
                        case 10:
                        case 14:
                            {
                                let k = false;
                                for (let l of fromEnum(h)) {
                                    if (!this.v(l) && this.r(l)) {
                                        k = true;
                                        break;
                                    }
                                }
                                this.bc(c, k);
                                break;
                            }
                        case 11:
                            this.a1(CellFill.$, c, false, runOn(b.b, b.b.ac), runOn(this, this.d), runOn(b.b, b.b.k), CellFill.noColor);
                            break;
                        case 12:
                            this.a1(WorkbookColorInfo.$, c, false, runOn(b.b, b.b.ad), runOn(this, this.l), runOn(b.b, b.b.l), WorkbookColorInfo.automatic);
                            break;
                        case 13:
                            this.a1(Tuple$2.$.specialize(FormatConditionIconSet_$type, Nullable$1.$.specialize(Number_$type)), c, false, runOn(b.b, b.b.af), runOn(this, this.m), runOn(b.b, b.b.m), SpreadsheetUtilities.d1);
                            break;
                        case 15:
                            this.a1(CellFill.$, c, true, runOn(b.b, b.b.ac), runOn(this, this.d), runOn(b.b, b.b.h), CellFill.noColor);
                            break;
                        case 16:
                            this.a1(WorkbookColorInfo.$, c, true, runOn(b.b, b.b.ad), runOn(this, this.l), runOn(b.b, b.b.i), WorkbookColorInfo.automatic);
                            break;
                        case 17:
                            this.a1(Tuple$2.$.specialize(FormatConditionIconSet_$type, Nullable$1.$.specialize(Number_$type)), c, true, runOn(b.b, b.b.af), runOn(this, this.m), runOn(b.b, b.b.j), SpreadsheetUtilities.d1);
                            break;
                    }
                    if (this.t(i.value) && this.s(c)) {
                        let m = false;
                        for (let n of fromEnum(h)) {
                            if (this.q(n)) {
                                m = true;
                                break;
                            }
                        }
                        if (m == false && b.g != null) {
                            switch (i.value) {
                                case 7:
                                case 8:
                                case 6:
                                    let o = this.am(0);
                                    for (let p of fromEnum(h)) {
                                        if (this.s(p) && o == this.aq(p)) {
                                            this.bb(p, true);
                                            m = true;
                                            break;
                                        }
                                    }
                                    break;
                            }
                        }
                        this.bb(c, m);
                    }
                }
            }
            this.ba(c);
        }
    }
    t(a) {
        switch (a) {
            case 9:
            case 8:
            case 3:
            case 15:
            case 14:
            case 16:
            case 17:
            case 6:
            case 2:
            case 11:
            case 10:
            case 12:
            case 13:
            case 7: return true;
            default: return false;
        }
    }
    a7(a, b) {
        this.c._cz(a, b, null);
    }
    a8(a, b) {
        let c = EnumUtil.getEnumValue(SpreadsheetAction_$type, EnumUtil.parse(SpreadsheetAction_$type, a, true));
        this.a7(c, b);
    }
    u(a) {
        if (!stringIsNullOrEmpty(a)) {
            let b = stringSplit(a, ["_"], 0);
            switch (b[0]) {
                case "Action":
                case "Op":
                case "RelDate":
                case "DatePeriod":
                case "CustomFilter": return true;
            }
        }
        return false;
    }
    a6(a, b, c) {
        let d = SpreadsheetUtilities.w(this.c.activeWorksheet, c.row, c.column);
        let e = a ? 43 : 34;
        this.c._gi(e, () => {
            if (typeCast(CellFill.$, b) !== null) {
                let f = b;
                if (a) {
                    if (d.h(f)) {
                        d.n();
                    }
                    else {
                        d.t(f);
                    }
                }
                else {
                    d.ag(new FillSortCondition(f));
                }
            }
            else if (typeCast(WorkbookColorInfo.$, b) !== null) {
                let g = b;
                if (a) {
                    if (d.i(g)) {
                        d.n();
                    }
                    else {
                        d.v(g);
                    }
                }
                else {
                    d.ag(new FontColorSortCondition(g));
                }
            }
            else if (typeCast(Tuple$2.$.specialize(FormatConditionIconSet_$type, Nullable$1.$.specialize(Number_$type)), b) !== null) {
                let h = b;
                if (a) {
                    if (d.j(h)) {
                        d.n();
                    }
                    else {
                        d.w(h.c, h.d);
                    }
                }
                else {
                    d.ag(new IconSortCondition(h.c, h.d));
                }
            }
            else {
            }
        });
    }
    a9(a, b) {
        if (!stringIsNullOrEmpty(a)) {
            let c = stringSplit(a, ["_"], 0);
            let d = SpreadsheetUtilities.w(this.c.activeWorksheet, b.row, b.column);
            if (c.length > 0) {
                switch (c[0]) {
                    case "Action":
                        this.a8(c[1], b);
                        break;
                    case "Op":
                        let e = EnumUtil.getEnumValue(ExcelComparisonOperator_$type, EnumUtil.parse(ExcelComparisonOperator_$type, c[1], true));
                        this.bf(d, e);
                        break;
                    case "RelDate":
                        let f = EnumUtil.getEnumValue(RelativeDateRangeDuration_$type, EnumUtil.parse(RelativeDateRangeDuration_$type, c[1], true));
                        let g = EnumUtil.getEnumValue(RelativeDateRangeOffset_$type, EnumUtil.parse(RelativeDateRangeOffset_$type, c[2], true));
                        let h = typeCast(RelativeDateRangeFilter.$, d.b);
                        if (h != null && h.duration == f && h.offset == g) {
                            d.n();
                        }
                        else {
                            d.x(g, f);
                        }
                        break;
                    case "DatePeriod":
                        let i = EnumUtil.getEnumValue(DatePeriodFilterType_$type, EnumUtil.parse(DatePeriodFilterType_$type, c[1], true));
                        let j = parseInt(c[2]);
                        let k = typeCast(DatePeriodFilter.$, d.b);
                        if (k != null && k.type == i && k.value == j) {
                            d.n();
                        }
                        else {
                            d.u(i, j);
                        }
                        break;
                    case "CustomFilter":
                        let l = EnumUtil.getEnumValue(SpreadsheetSpecialFilterMenuItems_$type, EnumUtil.parse(SpreadsheetSpecialFilterMenuItems_$type, c[1], true));
                        switch (l) {
                            case 0:
                                this.bf(d, 13);
                                break;
                            case 5:
                                this.bf(d, 4);
                                break;
                            case 6:
                                this.bf(d, 2);
                                break;
                            case 1:
                                this.bf(d, 12);
                                break;
                            case 3:
                                let m = typeCast(AverageFilter.$, d.b);
                                if (m != null && m.type == 0) {
                                    d.n();
                                }
                                else {
                                    d.s(0);
                                }
                                break;
                            case 4:
                                let n = typeCast(AverageFilter.$, d.b);
                                if (n != null && n.type == 1) {
                                    d.n();
                                }
                                else {
                                    d.s(1);
                                }
                                break;
                            case 2:
                                this.bg(d);
                                break;
                            case 7:
                                let o = typeCast(YearToDateFilter.$, d.b);
                                if (o != null) {
                                    d.n();
                                }
                                else {
                                    d.z();
                                }
                                break;
                        }
                        break;
                }
            }
        }
    }
    ba(a) {
    }
    bf(a, b) {
        let c = typeCast(TableSortFilterArea.$, a);
        if (c != null) {
            this.c.showFilterDialogForTable(c.ah, b);
        }
        else {
            let d = typeCast(WorksheetSortFilterArea.$, a);
            if (d != null) {
                this.c.showFilterDialogForWorksheet(d.ai, b);
            }
        }
    }
    bg(a) {
        let b = typeCast(TableSortFilterArea.$, a);
        if (b != null) {
            this.c.showTopOrBottomDialogForTable(b.ah);
        }
        else {
            let c = typeCast(WorksheetSortFilterArea.$, a);
            if (c != null) {
                this.c.showTopOrBottomDialogForWorksheet(c.ai);
            }
        }
    }
    bh(a) {
        let b = null;
        let c = null;
        for (let d of fromEnum(a)) {
            let e = this.v(d);
            let f = this.s(d);
            if (!f) {
                if (e) {
                    if (b != null && c == null) {
                        c = d;
                    }
                }
            }
            else if (e) {
                if (c != null && this.s(c)) {
                    this.bd(c, false);
                }
                c = d;
                b = null;
            }
            else {
                if (c != null && !this.s(c)) {
                    this.bd(c, true);
                }
                c = null;
                b = d;
                let g = this.w(d);
                if (g != null) {
                    this.bh(g);
                }
            }
        }
        if (c != null) {
            this.bd(c, false);
        }
    }
}
SpreadsheetMenuBuilder$1.$t = markType(SpreadsheetMenuBuilder$1, 'SpreadsheetMenuBuilder$1', Base.$, null, function () {
    this.ad = Nullable$1.toNullable(SpreadsheetSpecialFilterMenuItems_$type, null);
    this.ae = Nullable$1.toNullable(ExcelComparisonOperator_$type, null);
    this.ac = Nullable$1.toNullable(SpreadsheetAction_$type, null);
});
/**
 * @hidden
 */
export class TsSpreadsheetMenuBuilder extends SpreadsheetMenuBuilder$1 {
    constructor(a) {
        super(DropDownItem.$, a);
    }
    af(a) {
        return SpreadsheetUtilities.c2(a);
    }
    az(a, b) {
        a.k.add(b);
    }
    bi(a, b, c = null) {
        let d = new DropDownItem();
        d.p = a;
        d.m = b;
        if (!stringIsNullOrEmpty(c)) {
            d.n = "ui-igspreadsheet-" + c + "-icon";
        }
        return d;
    }
    a0(a) {
        a.k.clear();
    }
    d(a, b, c) {
        let d = this.bi(this.au(c), Tuple.a(Boolean_$type, Base.$, a, c));
        d.e = b;
        d.d = true;
        return d;
    }
    e(a, b) {
        return this.bi(this.as(a, b), enumGetBox(SpreadsheetAction_$type, a), EnumUtil.getName(SpreadsheetAction_$type, a).toLowerCase());
    }
    k(a, b) {
        return this.bi(a, b, b.toLowerCase());
    }
    l(a, b, c) {
        let d = this.bi(this.av(c), Tuple.a(Boolean_$type, Base.$, a, c));
        d.e = b;
        d.d = true;
        return d;
    }
    m(a, b, c) {
        let d = this.bi(this.aw(c), Tuple.a(Boolean_$type, Base.$, a, c));
        d.e = b;
        d.d = true;
        return d;
    }
    n(a) {
        return this.bi(this.ar(a, this.c.activeCell), enumGetBox(SpreadsheetAction_$type, a), EnumUtil.getName(SpreadsheetAction_$type, a).toLowerCase());
    }
    o() {
        let a = new DropDownItem();
        a.p = "-";
        return a;
    }
    p(a, b) {
        let c = this.bi(this.at(a), enumGetBox(SpreadsheetContextMenuSubItem_$type, a));
        for (let d = 0; d < b.length; d++) {
            c.k.add(b[d]);
        }
        return c;
    }
    x(a) {
        if (typeCast(SpreadsheetAction_$type, a.m) !== null) {
            return Nullable$1.toNullable(SpreadsheetAction_$type, EnumUtil.getEnumValue(SpreadsheetAction_$type, a.m));
        }
        return this.$type.getStaticFields(SpreadsheetMenuBuilder$1.$).ac;
    }
    aq(a) {
        return typeCast(String_$type, a.m);
    }
    q(a) {
        return a.e;
    }
    r(a) {
        return a.f;
    }
    s(a) {
        return a.h;
    }
    w(a) {
        return a.k;
    }
    ab(a) {
        if (typeCast(SpreadsheetContextMenuSubItem_$type, a.m) !== null) {
            return Nullable$1.toNullable(SpreadsheetContextMenuSubItem_$type, EnumUtil.getEnumValue(SpreadsheetContextMenuSubItem_$type, a.m));
        }
        return TsSpreadsheetMenuBuilder.bj;
    }
    v(a) {
        return a.g;
    }
    ba(a) {
        super.ba(a);
        let b = this.y(a);
        if (b.hasValue) {
            switch (b.value) {
                case 203:
                case 198:
                    a.f = false;
                    a.h = false;
                    break;
            }
        }
        else if (typeof a.m === 'string') {
            let c = this.z(a.m);
            if (c.hasValue) {
                switch (c.value) {
                    case 6:
                    case 5:
                    case 1:
                    case 0:
                    case 2:
                        a.f = false;
                        a.h = false;
                        break;
                }
            }
            else {
                let d = this.aa(a.m);
                if (d.hasValue) {
                    a.f = false;
                    a.h = false;
                }
            }
        }
        if (a.c) {
            let e = 0;
            for (let f of fromEnum(a.k)) {
                if (f.h && !f.g) {
                    e++;
                }
            }
            if (e == 0) {
                a.h = false;
            }
        }
    }
    bb(a, b) {
        a.e = b;
    }
    bc(a, b) {
        a.f = b;
    }
    bd(a, b) {
        a.h = b;
    }
    be(a, b) {
        a.p = b;
    }
}
TsSpreadsheetMenuBuilder.$t = markType(TsSpreadsheetMenuBuilder, 'TsSpreadsheetMenuBuilder', SpreadsheetMenuBuilder$1.$.specialize(DropDownItem.$));
TsSpreadsheetMenuBuilder.bj = Nullable$1.toNullable(SpreadsheetContextMenuSubItem_$type, null);
/**
 * @hidden
 */
export class SpreadsheetTabEditManager extends Base {
    constructor(a) {
        super();
        this.a = null;
        this.d = false;
        this.a = a;
    }
    get j() {
        return this.d;
    }
    get b() {
        return this.a;
    }
    get c() {
        return this.a._bf._p;
    }
    e() {
        if (!this.a._d7(true)) {
            return false;
        }
        if (!this.i) {
            return false;
        }
        let a = Enumerable.ag(SpreadsheetTabInfo.$, this.a._bf._k, (b) => b._j == this.a.activeWorksheet);
        if (a == null || !this.f(a)) {
            return false;
        }
        this.a._bf._a7(a);
        this.m(a, a._j.name, 31);
        if (this.c != null) {
            this.o();
        }
        return this.c != null;
    }
    g(a, b, c) {
        if (this.d) {
            return false;
        }
        this.d = true;
        this.a._g9(true);
        try {
            return this.h(a, b, c);
        }
        finally {
            this.a._g9(false);
            this.d = false;
        }
    }
    h(a, b, c) {
        if (this.c == null) {
            return true;
        }
        let d = this.c;
        let e = this.l();
        let f = d._j;
        if (!a) {
            try {
                Worksheet._aw(e, "name");
            }
            catch (g) {
                if (b) {
                    return this.h(true, true, c);
                }
                this.o();
                if (this.k(d) == false) {
                    let h = new SpreadsheetUserPromptInfo(3, this.a._fs("SheetNameError_Message_Invalid", e), g, e, false);
                    this.a._dz(h);
                }
                return false;
            }
            try {
                if (f.workbook != null) {
                    f.workbook._jd(f, e, "value");
                }
            }
            catch (i) {
                if (b) {
                    return this.h(true, true, c);
                }
                this.o();
                if (this.k(d) == false) {
                    let j = new SpreadsheetUserPromptInfo(4, this.a._fs("SheetNameError_Message_NameIsUsed", e), i, e, false);
                    this.a._dz(j);
                }
                return false;
            }
        }
        if (this.c == d) {
            this.n(d, c);
            this.a._bf._a8();
            if (!a) {
                f.name = e;
            }
        }
        return this.c == null;
    }
}
SpreadsheetTabEditManager.$t = markType(SpreadsheetTabEditManager, 'SpreadsheetTabEditManager');
/**
 * @hidden
 */
export class JsTabEditManager extends SpreadsheetTabEditManager {
    constructor(a) {
        super(a);
    }
    get_i() {
        return true;
    }
    get i() {
        return this.get_i();
    }
    f(a) {
        return true;
    }
    p(a) {
        if (a != null) {
            let b = a._ac;
            if (b != null) {
                return b.cm.getChildAt(0);
            }
        }
        return null;
    }
    l() {
        let a = this.p(this.c);
        return a != null ? a.getProperty("value") : "";
    }
    m(a, b, c) {
        let d = a._ac;
        let e = d.a7.createElement("input");
        e.setProperty("type", "text");
        e.setProperty("minlength", 1);
        e.setProperty("maxlength", c);
        e.setProperty("value", b);
        e.setAttribute("tabIndex", 0);
        e.setRawStyleProperty("width", this.b._a0.j(a, b, true) + "px");
        e.listen("input", (f) => {
            let g = (((h) => h != null ? h : "")(this.l()));
            d.cl = this.b._a0.j(a, g);
            d.q = true;
            d._parent.cf.aj();
            let h = this.b._a0.j(a, g, true);
            if (h < 3) {
                h = 3;
            }
            e.setRawStyleProperty("width", (h + "px"));
        });
        d.cm.setText("");
        d.cm.append(e);
        e.focus();
    }
    n(a, b) {
        let c = this.p(a);
        if (c != null) {
            c.unlistenAll();
            c.remove();
        }
        let d = a._ac;
        SpreadsheetVisualElementDomBuilder.ba(d.cm, a._ae);
        d.cv = -1;
        if (d._parent != null) {
            d._parent.cf.aj();
        }
        if (!b) {
            this.b._v.focus();
        }
    }
    k(a) {
        return false;
    }
    o() {
        let a = this.p(this.c);
        if (a != null) {
            let b = a.getNativeElement();
            let c = a.getProperty("value");
            let d = (c.length);
            SpreadsheetUtilities.bk(b, 0, d);
            a.focus();
        }
    }
    q() {
        if (this.c != null && !this.j) {
            let a = this.p(this.c);
            if (a != null) {
                a.focus();
            }
        }
    }
}
JsTabEditManager.$t = markType(JsTabEditManager, 'JsTabEditManager', SpreadsheetTabEditManager.$);
/**
 * @hidden
 */
export class SpreadsheetShapeContainerElement extends VisualElement {
    constructor(a, b) {
        super(b, "ShapeContainer");
        this.cf = null;
        this.cg = null;
        this.cj = 0;
        this.ch = false;
        this.cg = a;
        this.cf = new PaneShapeVisualManager(a, this);
    }
    b7(a, b, c, d) {
        super.b7(a, b, c, d);
        this.cf.n();
        for (let e = 0; e < this.a9; e++) {
            let f = typeCast(SpreadsheetShapeVisualElementBase.$, this.b(e));
            if (f != null && f.cg != null && !f.ab) {
                let g = f.cg;
                let h = g.d;
                let i = SpreadsheetUtilities.b9(h);
                i = Workbook._er(h.worksheet.workbook, i, true);
                f.ck = i;
                f.cm = g.n;
                let j = f.cg.t;
                f.al(j.x - i, j.y - i, j.width + i * 2, j.height + i * 2);
            }
        }
    }
    get ck() {
        return this.cj;
    }
    set ck(a) {
        if (a != this.cj) {
            this.cj = a;
            this.ci = true;
        }
    }
    get ci() {
        return this.ch;
    }
    set ci(a) {
        if (a != this.ch) {
            this.ch = a;
            if (a) {
                this.b1();
            }
        }
    }
}
SpreadsheetShapeContainerElement.$t = markType(SpreadsheetShapeContainerElement, 'SpreadsheetShapeContainerElement', VisualElement.$);
/**
 * @hidden
 */
export class ShapeVisualManager extends Base {
    constructor(a, b) {
        super();
        this.b = null;
        this.a = null;
        this.c = false;
        this.g = null;
        this.h = null;
        this.e = false;
        this.b = a;
        this.c = b;
        this.g = new List$1(SpreadsheetShape.$, 0);
        this.h = new ReadOnlyCollection$1(SpreadsheetShape.$, 1, this.g);
        this.a = new RotationHelper();
    }
    get f() {
        return this.h;
    }
    static k(a, b) {
        for (let c of fromEnum(b)) {
            if (c.i && c.a != null) {
                b.remove(c);
                a.a = c.a;
                a.g = true;
                a.h = true;
                return a.a.g;
            }
        }
        return null;
    }
    n() {
        let a = this.b._r;
        if (this.i(a, 0) != this.g.count) {
            let b = new HashSet$1(SpreadsheetShape.$, 0);
            for (let c = 0; c < this.g.count; c++) {
                b.add_1(this.g._inner[c]);
            }
            this.g.clear();
            this.l(a);
            for (let d = 0; d < this.g.count; d++) {
                b.remove(this.g._inner[d]);
            }
            for (let e = 0; e < this.g.count; e++) {
                let f = this.g._inner[e];
                if (f.o == null) {
                    f.o = this.j(f, b);
                }
            }
            for (let g of fromEnum(b)) {
                this.m(g);
                g.m = null;
            }
            this.e = true;
        }
        this.o(a);
    }
    static p(a) {
        let b = a.x + a.width / 2;
        let c = a.y + a.height / 2;
        return new Rect(0, b - a.height / 2, c - a.width / 2, a.height, a.width);
    }
    static q(a, b, c, d) {
        return new Rect(0, c ? b.left + (b.right - a.right) : a.x, d ? b.top + (b.bottom - a.bottom) : a.y, a.width, a.height);
    }
    static r(a) {
        return a._getBoundsInTwips();
    }
    o(a) {
        if (a == null) {
            return;
        }
        let b = this.b._s;
        let c = this.b.columnScrollRegion;
        let d = this.b.rowScrollRegion;
        for (let e = 0; e < a.count; e++) {
            let f = a.item(e);
            let g = f.d;
            let h = ShapeVisualManager.r(g);
            f.v = h;
            f.e = g.flippedHorizontally;
            f.f = g.flippedVertically;
            f.k = g._b6;
            let i = h.copy();
            if (SpreadsheetUtilities.bl(g)) {
                i = ShapeVisualManager.p(i);
            }
            if (f.b != null) {
                let j = f.c;
                let k = f.b;
                let l = k.s;
                let m = k.v;
                if (typeCast(WorksheetShapeGroupBase.$, g) !== null && ExcelUtils.bd(j.d._b6) && ExcelUtils.bd(g._b6) && (j == k || ExcelUtils.bd(k.d._b6))) {
                    let n = i.width < i.height;
                    let o = n ? l.width / l.height : l.height / l.width;
                    let p = i.width * o;
                    let q = i.height / o;
                    let r = n ? (i.width - p) / 2 : (i.height - q) / 2;
                    i.x = i.x - r;
                    i.width = p;
                    i.y = i.y + r;
                    i.height = q;
                }
                else {
                    i.x = l.left + ((i.x - m.x) / m.width) * l.width;
                    i.width = (i.width / m.width) * l.width;
                    i.y = l.top + ((i.y - m.y) / m.height) * l.height;
                    i.height = (i.height / m.height) * l.height;
                }
                i = ShapeVisualManager.q(i, l, k.e, k.f);
                if (k.e != k.f) {
                    f.k = 360 - f.k;
                }
                f.f = f.f != k.f;
                f.e = f.e != k.e;
                if (k.k % 360 != 0) {
                    this.a.h(i.x, i.y, i.right, i.bottom, k.k, k.s.x + (k.s.width / 2), k.s.y + (k.s.height / 2), false);
                    let s = this.a.m;
                    let t = s.x + s.width / 2;
                    let u = s.y + s.height / 2;
                    i.x = t - i.width / 2;
                    i.y = u - i.height / 2;
                }
                f.k += k.k;
            }
            f.s = i;
            let v = c._bl();
            let w = d._bl();
            let x = g.sheet.workbook;
            let y = this.c ? c._bx : 1;
            let z = (b.convertTwipsToPixels(i.x, false) - v) * y;
            let aa = (b.convertTwipsToPixels(i.right, false) - v) * y;
            let ab = (b.convertTwipsToPixels(i.y, true) - w) * y;
            let ac = (b.convertTwipsToPixels(i.bottom, true) - w) * y;
            f.u = new Rect(0, z, ab, aa - z, ac - ab);
            f.k = f.k % 360;
            if (f.k % 360 != 0) {
                this.a.g(z, ab, aa, ac, f.k, false);
                let ad = this.a.m;
                z = ad.left;
                ab = ad.top;
                aa = ad.right;
                ac = ad.bottom;
            }
            f.t = new Rect(0, z, ab, aa - z, ac - ab);
            if (f.j != null) {
                this.o(f.j);
            }
        }
    }
    l(a) {
        if (a != null) {
            for (let b of fromEnum(a)) {
                if (b.d.visible) {
                    if (this.d(b)) {
                        this.g.add(b);
                    }
                    if (b.j != null) {
                        this.l(b.j);
                    }
                }
            }
        }
    }
    i(a, b) {
        if (a == null) {
            return -1;
        }
        for (let c = 0; c < a.count; c++) {
            let d = a.item(c);
            if (!d.d.visible || !this.d(d)) {
                if (d.o != null) {
                    return -1;
                }
            }
            else {
                if (b >= this.g.count) {
                    return -1;
                }
                if (d != this.g._inner[b]) {
                    return -1;
                }
                b++;
            }
            if (d.j != null) {
                b = this.i(d.j, b);
                if (b < 0) {
                    return b;
                }
            }
        }
        return b;
    }
}
ShapeVisualManager.$t = markType(ShapeVisualManager, 'ShapeVisualManager');
/**
 * @hidden
 */
export class PaneShapeVisualManager extends ShapeVisualManager {
    constructor(a, b) {
        super(a._j, false);
        this.t = null;
        this.s = null;
        this.t = a;
        this.s = b;
    }
    d(a) {
        if (a.i) {
            return this.b._s.spreadsheetOwnerState._l._b(a.d);
        }
        else if (typeCast(WorksheetShapeGroup.$, a.d) !== null) {
            return false;
        }
        return SpreadsheetUtilities.a4(a.d, false);
    }
    j(a, b) {
        if (a.i) {
            let c = this.t._j._s.spreadsheetOwnerState._l;
            if (c == null) {
                return null;
            }
            let d = new SpreadsheetChartVisualElement(this.s, c, this.t._j._s);
            d.cg = a;
            return d;
        }
        else if (SpreadsheetUtilities.a4(a.d, false)) {
            let e = null;
            for (let f of fromEnum(b)) {
                e = typeCast(SpreadsheetShapeVisualElement.$, f.o);
                if (e != null) {
                    b.remove(f);
                    e.ci = true;
                    e.cg = a;
                    return e;
                }
            }
            e = new SpreadsheetShapeVisualElement(this.s);
            e.cg = a;
            return e;
        }
        return null;
    }
    m(a) {
        let b = typeCast(VisualElement.$, a.o);
        if (b != null && !b.ab) {
            b.ab = true;
            a.m = null;
            a.o = null;
        }
    }
}
PaneShapeVisualManager.$t = markType(PaneShapeVisualManager, 'PaneShapeVisualManager', ShapeVisualManager.$);
/**
 * Provides information about a visualization of a group of rows and columns in a [[Worksheet]]
 */
export class SpreadsheetPane extends PropertyChangeNotifierExtended {
    constructor(a, b, c, d) {
        super();
        this._x = null;
        this._ad = null;
        this._m = null;
        this._ai = null;
        this._i = null;
        this._j = null;
        this._g = null;
        this._v = null;
        this._z = null;
        this._ab = null;
        this._af = null;
        this._o = null;
        this._aj = false;
        this._ak = true;
        /**
         * @hidden
         */
        this._s = null;
        this._ay = null;
        this._an = 0;
        this._n = null;
        CoreUtilities.z(d, "owner");
        this._ai = new PropertyChangeListener$1(SpreadsheetPane.$, this, SpreadsheetPane._aq, false);
        let e = c(this);
        this._s = d;
        let f = PropertyChangeListenerList.e(SpreadsheetRowScrollRegion.$, this._ad, a, this._ai, true);
        this._ad = f.p0;
        let g = PropertyChangeListenerList.e(SpreadsheetColumnScrollRegion.$, this._x, b, this._ai, true);
        this._x = g.p0;
        let h = PropertyChangeListenerList.e(ObservableCollectionExtended$1.$.specialize(SpreadsheetCellValueInfo.$), this._m, new ObservableCollectionExtended$1(SpreadsheetCellValueInfo.$, 0), this, false);
        this._m = h.p0;
        let i = PropertyChangeListenerList.e(ObservableCollectionExtended$1.$.specialize(SpreadsheetShape.$), this._o, new ObservableCollectionExtended$1(SpreadsheetShape.$, 0), this, false);
        this._o = i.p0;
        let j = PropertyChangeListenerList.e(SpreadsheetSelection.$, this._af, e, this, true);
        this._af = j.p0;
        let k = PropertyChangeListenerList.e(ObservableCollectionExtended$1.$.specialize(SpreadsheetDropDownButton.$), this._n, new ObservableCollectionExtended$1(SpreadsheetDropDownButton.$, 0), this, false);
        this._n = k.p0;
    }
    /**
     * Returns the [[SpreadsheetColumnScrollRegion]] that contains the pane.
     */
    get columnScrollRegion() {
        return this._x;
    }
    /**
     * Returns the [[SpreadsheetRowScrollRegion]] that contains the pane.
     */
    get rowScrollRegion() {
        return this._ad;
    }
    /**
     * Returns an object that represents the selection within the pane.
     * <p class="body"><b>Note:</b> Only the selection of the active pane is rendered.</p>
     */
    get selection() {
        return this._af;
    }
    /**
     * Returns a range that represents the current visible range.
     */
    get visibleRange() {
        return new SpreadsheetCellRange(this._ad.startIndex, this._x.startIndex, this._ad.endIndex, this._x.endIndex);
    }
    /**
     * @hidden
     */
    get _ag() {
        return this.rowScrollRegion._ab;
    }
    /**
     * @hidden
     */
    get _ac() {
        return this._ab;
    }
    /**
     * @hidden
     */
    set _ac(a) {
        if (this._ab != a) {
            this._ab = a;
            this.a("Background");
        }
    }
    /**
     * @hidden
     */
    get _w() {
        return this._v;
    }
    /**
     * @hidden
     */
    set _w(a) {
        this._v = a;
        this.a("CellFillArray");
    }
    /**
     * @hidden
     */
    get _ao() {
        return this._an;
    }
    /**
     * @hidden
     */
    set _ao(a) {
        if (this._an != a) {
            this._an = a;
            this.a("CellTextArrangeVersion");
        }
    }
    /**
     * @hidden
     */
    get _k() {
        return this._i;
    }
    /**
     * @hidden
     */
    set _k(a) {
        this._i = a;
        this.a("CellValueArray");
    }
    /**
     * @hidden
     */
    get _p() {
        return this._m;
    }
    /**
     * @hidden
     */
    get _q() {
        return this._n;
    }
    /**
     * @hidden
     */
    get _aa() {
        return this._z;
    }
    /**
     * @hidden
     */
    set _aa(a) {
        if (this._z != a) {
            this._z = a;
            this.a("GridlinePen");
        }
    }
    /**
     * @hidden
     */
    get _al() {
        return this._aj;
    }
    /**
     * @hidden
     */
    set _al(a) {
        if (this._aj != a) {
            this._aj = a;
            this.a("HideActiveCellContent");
        }
    }
    /**
     * @hidden
     */
    get _l() {
        return this._j;
    }
    /**
     * @hidden
     */
    set _l(a) {
        this._j = a;
        this.a("HyperlinkArray");
    }
    /**
     * @hidden
     */
    get _h() {
        return this._g;
    }
    /**
     * @hidden
     */
    set _h(a) {
        this._g = a;
        this.a("InvalidCellArray");
    }
    /**
     * @hidden
     */
    get _ap() {
        return CoreUtilities.p(this._ay);
    }
    /**
     * @hidden
     */
    set _ap(a) {
        if (a != this._ap) {
            this._ay = a == null ? null : new WeakReference(a);
            this.a("Panel");
        }
    }
    /**
     * @hidden
     */
    get _r() {
        return this._o;
    }
    /**
     * @hidden
     */
    get _am() {
        return this._ak;
    }
    /**
     * @hidden
     */
    set _am(a) {
        this._ak = a;
    }
    scrollCellIntoView() {
        let n;
        if (arguments.length === 1) {
            if (typeCast(SpreadsheetCell.$, arguments[0]) !== null) {
                n = 0;
            }
            else if (typeof arguments[0] === 'string') {
                n = 1;
            }
            else if (arguments[0] == null) {
                n = 1;
            }
        }
        switch (n) {
            case 0: return this._scrollCellIntoView.apply(this, arguments);
            case 1: return this._scrollCellIntoView1.apply(this, arguments);
            default: throw new Error('Invalid arguments');
        }
    }
    /**
     * @hidden
     */
    _scrollCellIntoView(a) {
        this._scrollRangeIntoView(new SpreadsheetCellRange(a.row, a.column));
    }
    /**
     * @hidden
     */
    _scrollCellIntoView1(a) {
        this._scrollCellIntoView(new SpreadsheetCell(a));
    }
    /**
     * Used to ensure that a specified column is fully in view within the [[visibleRange]].
     * @param index 0 based index of the column to be brought into view.
     * @throws [[ArgumentOutOfRangeException]] The 'index' must be 0 or greater.
     */
    scrollColumnIntoView(index) {
        if (index < 0) {
            throw new ArgumentOutOfRangeException(0);
        }
        this._s._scrollRangeIntoView$i(this, Nullable$1.toNullable(IntRange.$, null), Nullable$1.toNullable(IntRange.$, new IntRange(1, index, index)));
    }
    scrollRangeIntoView() {
        let n;
        if (arguments.length === 1) {
            if (typeCast(SpreadsheetCellRange.$, arguments[0]) !== null) {
                n = 0;
            }
            else if (typeof arguments[0] === 'string') {
                n = 1;
            }
            else if (arguments[0] == null) {
                n = 1;
            }
        }
        switch (n) {
            case 0: return this._scrollRangeIntoView.apply(this, arguments);
            case 1: return this._scrollRangeIntoView1.apply(this, arguments);
            default: throw new Error('Invalid arguments');
        }
    }
    /**
     * @hidden
     */
    _scrollRangeIntoView(a) {
        this._s._scrollRangeIntoView$i(this, Nullable$1.toNullable(IntRange.$, new IntRange(1, a.firstRow, a.lastRow)), Nullable$1.toNullable(IntRange.$, new IntRange(1, a.firstColumn, a.lastColumn)));
    }
    /**
     * @hidden
     */
    _scrollRangeIntoView1(a) {
        this._scrollRangeIntoView(new SpreadsheetCellRange(a));
    }
    /**
     * Used to ensure that a specified row is fully in view within the [[visibleRange]].
     * @param index 0 based index of the row to be brought into view.
     * @throws [[ArgumentOutOfRangeException]] The 'index' must be 0 or greater.
     */
    scrollRowIntoView(index) {
        if (index < 0) {
            throw new ArgumentOutOfRangeException(0);
        }
        this._s._scrollRangeIntoView$i(this, Nullable$1.toNullable(IntRange.$, new IntRange(1, index, index)), Nullable$1.toNullable(IntRange.$, null));
    }
    /**
     * @hidden
     */
    _t(a) {
        return new SpreadsheetCell(this.rowScrollRegion._ag(a.y)._j, this.columnScrollRegion._ag(a.x)._j);
    }
    /**
     * @hidden
     */
    _ar(a, b, c) {
        switch (b != null ? b : "") {
            case "StartIndex":
            case "EndIndex":
                if (a == this.rowScrollRegion || a == this.columnScrollRegion) {
                    this.a("VisibleRange");
                }
                break;
        }
    }
    /**
     * @hidden
     */
    static _aq(a, b, c, d) {
        a._ar(b, c, d);
    }
}
SpreadsheetPane.$t = markType(SpreadsheetPane, 'SpreadsheetPane', PropertyChangeNotifierExtended.$);
/**
 * @hidden
 */
export class SpreadsheetPaneShapeLayer extends ElementLayer$1 {
    constructor(a, b) {
        super(SpreadsheetPane.$, a, b, PredefinedSpreadsheetLayers.t);
        this._k = null;
        this._l = null;
        this._l = new SpreadsheetShapeContainerElement(this, b.c);
        this._k = new ShapeLayerObserver(a, () => {
            this._e();
            this._l.t = true;
        });
    }
    _g(a) {
        let b = new Rect(0, 0, 0, a.width, a.height);
        if (this._l != null) {
            let c = this._j.columnScrollRegion._bx;
            this._l.ck = c;
            this._l.al(0, 0, a.width / c, a.height / c);
        }
        return b;
    }
    dispose() {
        super.dispose();
        this._k.dispose();
        if (this._l != null) {
            this._l.ab = true;
            this._l = null;
        }
    }
    _h(a) {
        return new Size(0);
    }
}
SpreadsheetPaneShapeLayer.$t = markType(SpreadsheetPaneShapeLayer, 'SpreadsheetPaneShapeLayer', ElementLayer$1.$.specialize(SpreadsheetPane.$));
/**
 * @hidden
 */
export class ShapeGeometryPathBuilder extends Base {
    constructor(a, b, c, d) {
        super();
        this.a = 0;
        this.b = 0;
        this.e = 0;
        this.f = 0;
        this.c = 0;
        this.d = 0;
        this.e = a;
        this.f = b;
        this.c = c;
        this.d = d;
        this.a = c;
        this.b = d;
    }
    m(a, b, c, d) {
        let e = this.a + 2 / 3 * (a - this.a);
        let f = this.b + 2 / 3 * (b - this.b);
        let g = c + 2 / 3 * (a - c);
        let h = d + 2 / 3 * (b - d);
        this.j(e, f, g, h, c, d);
    }
    static g(a, b, c) {
        let d = Math.PI * 2;
        let e = Math.PI * a / 180;
        if (Math.abs(Math.cos(e)) < 1E-05 || Math.abs(Math.sin(e)) < 1E-05) {
            return e;
        }
        let f = Math.atan2(Math.sin(e) / Math.abs(c), Math.cos(e) / Math.abs(b));
        let g = truncate(MathUtilities.f(e / d)) - truncate(MathUtilities.f(f / d));
        return f + g * d;
    }
    visitCT_Path2DArcTo(value, argument) {
        return this._visitCT_Path2DArcTo$i.apply(this, arguments);
    }
    _visitCT_Path2DArcTo$i(a, b) {
        let c = ShapeGeometry.i(b, a.d);
        let d = ShapeGeometry.i(b, a.c);
        let e = ShapeGeometry.h(b, a.a);
        let f = ShapeGeometry.h(b, a.b);
        let g = f / 180 * Math.PI;
        let h = ShapeGeometryPathBuilder.g(e, c, d);
        let i = this.a - c * Math.cos(h);
        let j = this.b - d * Math.sin(h);
        this.h(i, j, c, d, e, f);
        let k = ShapeGeometryPathBuilder.g(e + f, c, d);
        let l = i + c * Math.cos(k);
        let m = j + d * Math.sin(k);
        this.a = l;
        this.b = m;
        return true;
    }
    visitCT_Path2DClose(value, argument) {
        return this._visitCT_Path2DClose$i.apply(this, arguments);
    }
    _visitCT_Path2DClose$i(a, b) {
        this.i();
        return true;
    }
    visitCT_Path2DCubicBezierTo(value, argument) {
        return this._visitCT_Path2DCubicBezierTo$i.apply(this, arguments);
    }
    _visitCT_Path2DCubicBezierTo$i(a, b) {
        let c = ShapeGeometry.i(b, a.a.a) + this.c;
        let d = ShapeGeometry.i(b, a.a.b) + this.d;
        let e = ShapeGeometry.i(b, a.b.a) + this.c;
        let f = ShapeGeometry.i(b, a.b.b) + this.d;
        let g = ShapeGeometry.i(b, a.c.a) + this.c;
        let h = ShapeGeometry.i(b, a.c.b) + this.d;
        this.j(c, d, e, f, g, h);
        this.a = g;
        this.b = h;
        return true;
    }
    visitCT_Path2DLineTo(value, argument) {
        return this._visitCT_Path2DLineTo$i.apply(this, arguments);
    }
    _visitCT_Path2DLineTo$i(a, b) {
        let c = ShapeGeometry.i(b, a.a.a) + this.c;
        let d = ShapeGeometry.i(b, a.a.b) + this.d;
        this.k(c, d);
        this.a = c;
        this.b = d;
        return true;
    }
    visitCT_Path2DMoveTo(value, argument) {
        return this._visitCT_Path2DMoveTo$i.apply(this, arguments);
    }
    _visitCT_Path2DMoveTo$i(a, b) {
        let c = ShapeGeometry.i(b, a.a.a) + this.c;
        let d = ShapeGeometry.i(b, a.a.b) + this.d;
        this.l(c, d);
        this.a = c;
        this.b = d;
        return true;
    }
    visitCT_Path2DQuadBezierTo(value, argument) {
        return this._visitCT_Path2DQuadBezierTo$i.apply(this, arguments);
    }
    _visitCT_Path2DQuadBezierTo$i(a, b) {
        let c = ShapeGeometry.i(b, a.a.a) + this.c;
        let d = ShapeGeometry.i(b, a.a.b) + this.d;
        let e = ShapeGeometry.i(b, a.b.a) + this.c;
        let f = ShapeGeometry.i(b, a.b.b) + this.d;
        this.m(c, d, e, f);
        this.a = e;
        this.b = f;
        return true;
    }
}
ShapeGeometryPathBuilder.$t = markType(ShapeGeometryPathBuilder, 'ShapeGeometryPathBuilder', Base.$, [IPath2DCommandVisitor$2_$type.specialize(ShapeGuideVariables.$, Boolean_$type)]);
/**
 * @hidden
 */
export class SvgPathCreator extends ShapeGeometryPathBuilder {
    constructor(a, b, c, d, e) {
        super(b, c, d, e);
        this.n = null;
        this.n = a;
    }
    h(a, b, c, d, e, f) {
        if (f >= 360) {
            this.o(d, c, e, 180, a, b);
            this.o(d, c, e + 180, 180, a, b);
        }
        else {
            this.o(d, c, e, f, a, b);
        }
    }
    i() {
        this.n.l(" Z");
    }
    j(a, b, c, d, e, f) {
        this.n.l(" C ");
        this.p(a, b);
        this.n.l(", ");
        this.p(c, d);
        this.n.l(", ");
        this.p(e, f);
    }
    k(a, b) {
        this.n.l(" L ");
        this.p(a, b);
    }
    l(a, b) {
        this.n.l(" M ");
        this.p(a, b);
    }
    m(a, b, c, d) {
        this.n.l(" Q ");
        this.p(a, b);
        this.n.l(", ");
        this.p(c, d);
    }
    o(a, b, c, d, e, f) {
        let g = ShapeGeometryPathBuilder.g(c + d, b, a);
        let h = e + b * Math.cos(g);
        let i = f + a * Math.sin(g);
        this.n.l(" A ");
        this.p(b, a);
        this.n.l(" 0 ");
        this.n.l(Math.abs(d) >= 180 ? "1 " : "0 ");
        this.n.l(d >= 0 ? "1 " : "0 ");
        this.p(h, i);
    }
    p(a, b) {
        this.n.k(a * this.e);
        this.n.l(" ");
        this.n.k(b * this.f);
    }
}
SvgPathCreator.$t = markType(SvgPathCreator, 'SvgPathCreator', ShapeGeometryPathBuilder.$);
/**
 * @hidden
 */
export class ShapeGeometry extends Base {
    constructor(a, b) {
        super();
        this.e = null;
        this.l = null;
        this.f = null;
        this.g = null;
        this.l = a;
        this.e = b;
        this.f = new List$1(ShapeGuide.$, 0);
        this.g = new List$1(ShapeGuide.$, 0);
    }
    static m(a, b, c, d) {
        if (b == null || typeCast(ShapeFillNoFill.$, b) !== null) {
            a.l(" fill-opacity=\"0\"");
        }
        else if (typeCast(ShapeFillSolid.$, b) !== null) {
            let e = b;
            let f = c != null ? c.workbook : null;
            let g = e.colorInfo._aj(f, false, true);
            a.l(" fill=\"");
            a.l(g.l == 0 ? "none" : g.colorString);
            a.l("\"");
        }
        else if (typeCast(ShapeFillImage.$, b) !== null) {
            let h = b._f;
            let i = d(h);
            a.l(" fill=\"");
            a.l("url(#" + i + ")");
            a.l("\"");
        }
    }
    static o(a, b, c, d) {
        if (b == null || typeCast(ShapeOutlineNoOutline.$, b) !== null) {
        }
        else if (typeCast(ShapeOutlineSolid.$, b) !== null) {
            let e = 1;
            let f = b;
            let g = c != null ? c.workbook : null;
            let h = f.colorInfo._aj(g, false, true);
            let i = ExcelUtils.c1(f._d);
            i = Math.max(Workbook._er(c.workbook, i, true) * d, e);
            if (h.l != 0) {
                a.l(" stroke=\"");
                a.l(h.colorString);
                a.l("\"");
            }
            a.l(" stroke-width=\"");
            a.k(i);
            a.l("\"");
            a.l(" stroke-linejoin=\"miter\" stroke-miterlimit=\"10\"");
        }
    }
    static t(a, b, c, d, e, f, g) {
        let h = a.c;
        let i = null;
        let j = (k) => {
            if (i == null) {
                i = new Dictionary$2(ImageData.$, String_$type, 0);
            }
            let l;
            if (!((() => { let m = i.tryGetValue(k, l); l = m.p1; return m.ret; })())) {
                let m = stringIsNullOrEmpty(g._b8) ? "img" : XmlConvert.v(g._b8);
                l = m + i.count;
                i.item(k, l);
            }
            return l;
        };
        let k = typeCast(WorksheetImage.$, g);
        let l = k != null && k._image != null ? new ShapeFillImage(new ImageData(0, k._image.d, k._image.b)) : null;
        let m;
        if (l == null || SpreadsheetUtilities.at(g) == null) {
            m = ShapeGeometry.s(StringBuilder.$, a, b * 15, c * 15, g, (n, o, p, q, r, s, t, u, v) => ShapeGeometry.q(n, o, p, q, r, s, t, u, v, d / r, e / s, f, j, l));
        }
        else {
            m = ShapeGeometry.s(StringBuilder.$, a, b * 15, c * 15, g, (n, o, p, q, r, s, t, u, v) => ShapeGeometry.q(n, o, p, q, r, s, t, null, v, d / r, e / s, f, j, l));
            ShapeGeometry.s(StringBuilder.$, a, b * 15 + (d * 15), c * 15 + (e * 15), g, (n, o, p, q, r, s, t, u, v) => ShapeGeometry.q(n, o, p, q, r, s, null, u, null, d / r / 2, e / s / 2, f, j, null));
        }
        if (i != null && i.count > 0) {
            let n = "<defs>";
            for (let o of fromEnum(i)) {
                n += "<pattern patternUnits=\"userSpaceOnUse\" x=\"" + d + "\" y=\"" + e + "\" width=\"" + b + "\" height=\"" + c + "\" id=\"" + o.value + "\">";
                n += "   <image preserveAspectRatio=\"none\"";
                n += " xlink:href=\"";
                n += "data:" + ImageFormat.s(o.key.d) + ";base64," + Convert.toBase64String(o.key.b);
                n += "\"";
                n += " width=\"" + b + "\"";
                n += " height=\"" + c + "\"";
                n += "/>";
                n += "</pattern>";
            }
            n += "</defs>";
            a.x(h, n);
        }
        return m;
    }
    static q(a, b, c, d, e, f, g, h, i, j, k, l, m, n) {
        let o = new StringBuilder(0);
        let p = new SvgPathCreator(o, e, f, j, k);
        for (let q of fromEnum(c.b)) {
            q._accept$2$i(ShapeGuideVariables.$, Boolean_$type, p, d);
        }
        if (g != null || h != null) {
            a.l("<path d=\"");
            a.l(o.toString());
            a.l("\"");
            ShapeGeometry.m(a, g, b, m);
            ShapeGeometry.o(a, h, b, l);
            a.l("/>");
        }
        if (i != null) {
            a.l("<path d=\"");
            a.l(o.toString());
            a.l("\"");
            ShapeGeometry.m(a, i, b, m);
            ShapeGeometry.o(a, h, b, l);
            a.l("/>");
        }
        if (n != null) {
            a.l("<path d=\"");
            a.l(o.toString());
            a.l("\"");
            ShapeGeometry.m(a, n, b, m);
            a.l("/>");
        }
    }
    static s($t, a, b, c, d, e) {
        if (d == null) {
            return Rect.empty;
        }
        let f = null;
        if (typeCast(UnknownShape.$, d) !== null && typeCast(CT_CustomGeometry2D.$, d._en) !== null) {
            f = PredefinedShapes.b.c(d._en);
        }
        else if (nullableNotEquals(d._b1, null)) {
            f = PredefinedShapes.b.d(EnumUtil.getName(ST_ShapeType_$type, d._b1.value));
        }
        else if (typeCast(WorksheetImage.$, d) !== null) {
            f = PredefinedShapes.b.d(EnumUtil.getName(ST_ShapeType_$type, 4));
        }
        if (f == null) {
            return Rect.empty;
        }
        let g = SpreadsheetUtilities.as(d);
        let h = SpreadsheetUtilities.at(d);
        let i = SpreadsheetUtilities.a0(d);
        let j = d.worksheet;
        let k = ExcelUtils.dm(b);
        let l = ExcelUtils.dm(c);
        let m = new ShapeGuideVariables();
        m.f = k;
        m.e = l;
        if (f.g.count == 0 && f.f.count == 0) {
            f.r();
        }
        ShapeGeometry.n(m, f.f);
        if (i != null) {
            let n = new List$1(ShapeGuide.$, 0);
            ShapeGeometry.p(i, n);
            ShapeGeometry.n(m, n);
        }
        ShapeGeometry.n(m, f.g);
        if (f.e.f != null) {
            let o = f.e.f.b;
            for (let p = 0; p < o.count; p++) {
                let q = o._inner[p];
                let r = ST_PositiveCoordinate.g(q.g, Nullable$1.toNullable(ST_PositiveCoordinate.$, null)) ? k / ST_PositiveCoordinate.o(q.g.value) : 1;
                let s = ST_PositiveCoordinate.g(q.e, Nullable$1.toNullable(ST_PositiveCoordinate.$, null)) ? l / ST_PositiveCoordinate.o(q.e.value) : 1;
                let t = g;
                let u = null;
                let v = h;
                if (nullableEquals(q.f, false)) {
                    v = null;
                }
                let w = q.d;
                switch (!nullableIsNull(w) ? w.value : 1) {
                    case 0:
                        t = null;
                        break;
                    case 1: break;
                    case 4:
                        u = ShapeGeometry.a;
                        break;
                    case 5:
                        u = ShapeGeometry.b;
                        break;
                    case 2:
                        u = ShapeGeometry.c;
                        break;
                    case 3:
                        u = ShapeGeometry.d;
                        break;
                }
                e(a, j, q, m, r, s, t, v, u);
            }
        }
        let x;
        if (f.e.e == null) {
            x = Rect.empty;
        }
        else {
            let y = typeCast(WorksheetShapeWithText.$, d);
            if (y == null || !y._d0) {
                x = Rect.empty;
            }
            else {
                let z = y.text;
                let aa = f.e.e;
                let ab = ShapeGeometry.i(m, aa.b);
                let ac = ShapeGeometry.i(m, aa.d);
                let ad = ShapeGeometry.i(m, aa.c);
                let ae = ShapeGeometry.i(m, aa.a);
                let af = typeCast(CT_TextBodyProperties.$, z._o);
                if (af != null) {
                    let ag = ShapeGeometry.j(af.j, 9.6);
                    let ah = ShapeGeometry.j(af.s, 4.8);
                    let ai = ShapeGeometry.j(af.m, 9.6);
                    let aj = ShapeGeometry.j(af.f, 4.8);
                    ab += ag;
                    ad -= ai;
                    ac += ah;
                    ae -= aj;
                }
                if (ad <= ab || ae <= ac) {
                    x = Rect.empty;
                }
                else {
                    x = new Rect(0, ab, ac, ad - ab, ae - ac);
                }
            }
        }
        return x;
    }
    static h(a, b) {
        if (nullableNotEquals(b.e, null)) {
            return a.c(b.e.value.a) / 60000;
        }
        if (ST_Angle.g(b.d, Nullable$1.toNullable(ST_Angle.$, null))) {
            return b.d.value.n();
        }
        return 0;
    }
    static i(a, b) {
        return ShapeGeometry.k(a, b) / 15;
    }
    static j(a, b) {
        if (nullableNotEquals(a, null)) {
            let c = a.value.j();
            c = ExcelUtils.c1(c);
            return c / 15;
        }
        return b;
    }
    static k(a, b) {
        if (nullableNotEquals(b.e, null)) {
            let c = a.c(b.e.value.a);
            c = ExcelUtils.c1(truncate(c));
            return c;
        }
        if (nullableNotEquals(b.d, null)) {
            return b.d.value.k();
        }
        return 0;
    }
    static n(a, b) {
        for (let c of fromEnum(b)) {
            let d = c.b(a);
            a.b.item(c.c, c);
            a.g(c.c, d);
        }
    }
    static p(a, b) {
        if (a != null) {
            for (let c of fromEnum(a.b)) {
                b.add(ShapeGuide.a(c.b, c.a));
            }
        }
    }
    r() {
        ShapeGeometry.p(this.e.c, this.f);
        ShapeGeometry.p(this.e.d, this.g);
    }
}
ShapeGeometry.$t = markType(ShapeGeometry, 'ShapeGeometry');
ShapeGeometry.a = new ShapeFillSolid(new WorkbookColorInfo(Color.u(102, 0, 0, 0)));
ShapeGeometry.b = new ShapeFillSolid(new WorkbookColorInfo(Color.u(51, 0, 0, 0)));
ShapeGeometry.c = new ShapeFillSolid(new WorkbookColorInfo(Color.u(102, 255, 255, 255)));
ShapeGeometry.d = new ShapeFillSolid(new WorkbookColorInfo(Color.u(51, 255, 255, 255)));
/**
 * @hidden
 */
export class SpreadsheetContextMenu extends Base {
    constructor(a) {
        super();
        this.b = null;
        this.e = null;
        this.a = null;
        this.d = 0;
        this.c = new SpreadsheetCell();
        this.b = a;
        this.e = new TsSpreadsheetMenuBuilder(a);
    }
    l(a = true) {
        if (this.a != null && this.a.f) {
            if (a) {
                this.o();
            }
            this.a.o();
        }
    }
    o() {
        if (this.g(document.activeElement)) {
            if (this.d == 5) {
                this.b._bh.dp.ci.cf.a7.rootWrapper.focus();
            }
            else {
                this.b._v.focus();
            }
        }
    }
    m() {
        if (this.a != null) {
            this.a.o();
        }
    }
    h() {
        return this.a != null && this.a.f;
    }
    i(a) {
        return this.h() && this.d == a;
    }
    g(a) {
        return this.a != null && this.a.e(a);
    }
    n() {
        this.m();
    }
    j(a, b, c, d = null) {
        if (this.b._bh == null || this.b._bh.a7 == null) {
            return false;
        }
        if (b == null) {
            return false;
        }
        let e = b.cd();
        e.x += c.x;
        e.y += c.y;
        if (this.a == null) {
            this.a = new ContextMenu();
            let f = this.a;
            f.itemClick = delegateCombine(f.itemClick, (f, g) => {
                if (this.d == 8) {
                    if (this.e.u(typeCast(String_$type, g.m))) {
                        this.l();
                        this.e.a9(g.m, this.c);
                    }
                    else {
                        let h = typeCast(Tuple$2.$.specialize(Boolean_$type, Base.$), g.m);
                        if (h != null) {
                            this.l();
                            this.e.a6(h.c, h.d, this.c);
                        }
                    }
                }
                else {
                    if (typeCast(SpreadsheetAction_$type, g.m) !== null) {
                        let i = EnumUtil.getEnumValue(SpreadsheetAction_$type, g.m);
                        this.l();
                        this.b.executeCommand(i);
                    }
                }
            });
            this.a.k = (g, h) => {
                let i = typeCast(Tuple$2.$.specialize(Boolean_$type, Base.$), g.m);
                if (i != null && i.d != null) {
                    let j = i.c;
                    let k = i.d;
                    let l = null;
                    if (typeCast(Tuple$2.$.specialize(FormatConditionIconSet_$type, Nullable$1.$.specialize(Number_$type)), k) !== null) {
                        let m = SpreadsheetUtilities.ao(k);
                        l = SpreadsheetUtilities.cf(this.b, m, 16, 16);
                    }
                    else if (typeCast(WorkbookColorInfo.$, k) !== null) {
                        let n = k;
                        if (!n.isAutomatic) {
                            l = SpreadsheetUtilities.cg(this.b, n, 60, 16, SpreadsheetContextMenu.f);
                        }
                    }
                    else if (typeCast(CellFill.$, k) !== null) {
                        let o = k;
                        if (!SpreadsheetUtilities.bc(o)) {
                            l = SpreadsheetUtilities.ce(this.b, o, 60, 16, SpreadsheetContextMenu.f);
                        }
                    }
                    if (l != null) {
                        l.setRawStyleProperty("vertical-align", "middle");
                        l.setRawStyleProperty("margin-right", "5px");
                        h.append(l);
                        let p = this.b._fa.createElement("span");
                        p.setText(g.p);
                        h.append(p);
                        return true;
                    }
                }
                return false;
            };
        }
        let g;
        if (this.d != a || this.a.i.count == 0) {
            this.d = a;
            this.a.i.clear();
            if (a == 8) {
                g = this.e.a();
            }
            else {
                g = this.e.b(a);
            }
            this.a.i.o(g);
        }
        else {
            g = this.a.i;
        }
        if (a == 8) {
            this.c = new SpreadsheetCell(d.d, d.c);
            this.e.a2(g, this.c);
        }
        else {
            this.e.a4(g);
        }
        this.e.bh(g);
        this.b._fy(true);
        let h = this.b._bh.a7;
        let i = d != null ? d.g.width : 0;
        let j = d != null ? d.g.height : 0;
        let k = new Rect(0, e.x - i, e.y - j, i, j);
        let l = new DropDownPosition();
        l.a = 2 | 4;
        l.b = 1 | 4;
        if (d != null) {
            l.c = RelativePositionInfo.d;
            l.d = RelativePositionInfo.d;
        }
        else {
            l.c = RelativePositionInfo.e;
            l.d = RelativePositionInfo.e;
            l.b = l.b | 2;
        }
        l.e = RelativePositionInfo.e;
        l.f = RelativePositionInfo.d;
        this.a.p(h, h.rootWrapper, k, l);
        return true;
    }
    k(a, b, c) {
        return SpreadsheetUtilities.cz;
    }
}
SpreadsheetContextMenu.$t = markType(SpreadsheetContextMenu, 'SpreadsheetContextMenu');
SpreadsheetContextMenu.f = new WorkbookColorInfo(Color.u(255, 130, 130, 130));
/**
 * @hidden
 */
export class SpreadsheetMeasureHelper extends Base {
    constructor(a) {
        super();
        this.d = null;
        this.k = null;
        this.r = null;
        this.q = null;
        this.p = null;
        this.n = null;
        this.o = null;
        this.m = null;
        this.l = null;
        this.a = null;
        this.e = null;
        this.d = a;
        this.e = new LRUCache$2(String_$type, Number_$type, 0, 100);
        let b = EnumUtil.getValues(SpreadsheetResourceId_$type);
        let c = new Array(b.length);
        for (let e = 0; e < b.length; e++) {
            let d = b[e];
            let f = DefaultSpreadsheetColors.getDefaultColor(d);
            c[d] = Brush.create(f.colorString);
        }
        this.a = c;
    }
    get s() {
        return this.r;
    }
    u() {
        this.e.i();
    }
    b(a, b) {
        let c = SpreadsheetUtilities.b3(a.getCssDefaultPropertyValue(b, "width"), NaN);
        let d = SpreadsheetUtilities.b3(a.getCssDefaultPropertyValue(b, "min-width"), NaN);
        let e = SpreadsheetUtilities.b3(a.getCssDefaultPropertyValue(b, "max-width"), NaN);
        let f = SpreadsheetUtilities.b3(a.getCssDefaultPropertyValue(b, "height"), NaN);
        let g = SpreadsheetUtilities.b3(a.getCssDefaultPropertyValue(b, "min-height"), NaN);
        let h = SpreadsheetUtilities.b3(a.getCssDefaultPropertyValue(b, "max-height"), NaN);
        let i = this.c(a, b, "margin-");
        let j = this.c(a, b, "border-", "-width");
        let k = this.c(a, b, "padding-");
        if (i == null && isNaN_(c) && isNaN_(d) && isNaN_(e) && isNaN_(f) && isNaN_(g) && isNaN_(h)) {
            return null;
        }
        return new VisualElementConstraint(c, d, e, f, g, h, i, j, k);
    }
    c(a, b, c = "margin-", d = "") {
        let e = SpreadsheetUtilities.b3(a.getCssDefaultPropertyValue(b, c + "left" + d), 0);
        let f = SpreadsheetUtilities.b3(a.getCssDefaultPropertyValue(b, c + "right" + d), 0);
        let g = SpreadsheetUtilities.b3(a.getCssDefaultPropertyValue(b, c + "top" + d), 0);
        let h = SpreadsheetUtilities.b3(a.getCssDefaultPropertyValue(b, c + "bottom" + d), 0);
        return new VisualElementThickness(e, g, f, h);
    }
    f(a, b, c, d = false) {
        a.addClass(b);
        let e = c ? d ? a.outerWidthWithMargin() : a.outerWidth() : d ? a.outerHeightWithMargin() : a.outerHeight();
        a.removeClass(b);
        return e;
    }
    t() {
        return this.l == null ? null : this.l.getNativeElement();
    }
    g(a, b, c, d, e) {
        if (this.m == null) {
            return 0;
        }
        if (a != null && a.length > 0 && a.charCodeAt(a.length - 1) == 10) {
            a += " ";
        }
        else if (stringIsNullOrEmpty(a)) {
            a = " ";
        }
        SpreadsheetVisualElementDomBuilder.a8(this.m, b, d);
        SpreadsheetVisualElementDomBuilder.a9(this.m, c);
        this.m.setAttribute("wrap", "soft");
        this.m.setRawStyleProperty("width", e + "px");
        this.m.setProperty(VisualElementDomBuilder.l, a);
        return this.m.getProperty("scrollHeight");
    }
    ab(a, b, c) {
        a.addClass(b);
        let d = c ? a.outerWidthWithMargin() : a.outerWidth();
        let e = c ? a.outerHeightWithMargin() : a.outerHeight();
        a.removeClass(b);
        return new Size(1, d, e);
    }
    h(a, b) {
        let c;
        if (this.e.d(a)) {
            c = this.e.item(a);
        }
        else {
            this.p.setAttribute("style", a);
            this.q.setRawStyleProperty("font", b);
            c = this.q.getProperty("scrollHeight");
            this.e.item(a, c);
        }
        return c;
    }
    v(a) {
        this.w();
        let b = a.createElement("div");
        b.setAttribute("style", "display:block;position:absolute;visibility:hidden;opacity:0");
        a.append(b);
        this.k = a.getSubRenderer(b);
        this.r = a.createElement("div");
        this.r.setAttribute("style", "display:block;position:absolute;visibility:hidden;");
        b.append(this.r);
        this.q = a.createElement("div");
        this.q.setAttribute("style", "display:block;position:absolute;visibility:hidden;white-space:nowrap;border:0;padding:0;margin:0;");
        this.p = a.createElement("span");
        this.p.setProperty("innerHTML", "Wj");
        this.q.append(this.p);
        b.append(this.q);
        this.n = a.createElement("div");
        this.n.addClass(this.d.css.tabItem);
        this.n.addClass(this.d.css.tabItemSelected);
        this.n.addClass(this.d.css.tabItemActive);
        this.n.addClass("ui-state-default");
        this.o = SpreadsheetVisualElementDomBuilder.al(a.getSubRenderer(this.n), this.d.css);
        this.k.append(this.n);
        this.m = a.createElement("textarea");
        this.m.setRawStyleProperty("height", "1px");
        this.m.setRawStyleProperty("overflow", "hidden");
        SpreadsheetVisualElementDomBuilder.a7(this.m);
        this.k.append(this.m);
        this.l = a.createElement("img");
        let c = SpreadsheetRenderCache.aj;
        this.l.setAttribute("src", "data:image/png;base64," + c);
        this.k.append(this.l);
        this.aa();
    }
    i(a, b, c, d) {
        if (this.m == null) {
            return 0;
        }
        SpreadsheetVisualElementDomBuilder.a8(this.m, b, d);
        SpreadsheetVisualElementDomBuilder.a9(this.m, c);
        this.m.setAttribute("wrap", "off");
        this.m.setRawStyleProperty("width", "1px");
        this.m.setProperty(VisualElementDomBuilder.l, stringIsNullOrEmpty(a) ? " " : a);
        return this.m.getProperty("scrollWidth");
    }
    j(a, b = null, c = false) {
        if (this.n == null) {
            return 18;
        }
        if (a._t) {
            this.n.addClass(this.d.css.tabItemProtected);
        }
        else {
            this.n.removeClass(this.d.css.tabItemProtected);
        }
        SpreadsheetVisualElementDomBuilder.ba(this.o, b != null ? b : a._ae);
        return c ? this.o.outerWidthWithMargin() : this.n.outerWidthWithMargin();
    }
    w() {
        if (this.k != null) {
            this.k.rootWrapper.remove();
            this.k = null;
            this.n = null;
            this.m = null;
            this.o = null;
            this.l = null;
        }
    }
    x(a, b, c, d, e, f) {
        this.y(a, b, c, "background-color");
        this.y(a, b, d, "color");
        this.y(a, b, e, f ? "border-right-color" : "border-bottom-color");
    }
    y(a, b, c, d) {
        if (c >= 0) {
            let e = a.getCssDefaultPropertyValue(b, d);
            if (stringIsNullOrEmpty(e)) {
                e = DefaultSpreadsheetColors.getDefaultColor(c).colorString;
            }
            this.a[c] = Brush.create(e);
        }
    }
    aa() {
        if (this.k == null) {
            return;
        }
        let a = this.k;
        let b = this.d.css;
        let c = this.d._a1;
        a.startCSSQuery();
        let d = a.createElement("div");
        d.setAttribute("style", "display:block;position:absolute;");
        let e = a.createElement("div");
        d.append(e);
        try {
            this.x(a, b.columnHeader, 24, 28, 33, true);
            this.x(a, b.columnHeaderSelected, 25, 29, 34, true);
            this.x(a, b.columnHeaderSelectedCells, 26, 30, 35, true);
            this.x(a, b.columnHeaderHover, 27, 31, 36, true);
            this.x(a, b.columnHeaderSelected + " " + "ui-state-highlight", -1, 32, -1, true);
            this.x(a, b.rowHeader, 11, 15, 19, false);
            this.x(a, b.rowHeaderSelected, 12, 16, 20, false);
            this.x(a, b.rowHeaderSelectedCells, 13, 17, 21, false);
            this.x(a, b.rowHeaderHover, 14, 18, 22, false);
            this.x(a, b.rowHeaderSelected + " " + "ui-state-highlight", -1, 23, -1, false);
            this.x(a, b.invalidData, -1, -1, 64, true);
            this.x(a, b.automaticGridline, 38, -1, -1, true);
            this.x(a, b.headerResizeLine, 39, -1, -1, true);
            this.x(a, b.headerResizeLine, 40, -1, -1, false);
            this.x(a, b.cellSelection, 0, -1, 1, true);
            this.y(a, b.cellSelection, 2, "outline-color");
            this.x(a, b.cellSelectionHandle, 5, -1, 6, true);
            this.x(a, b.dropDownButton, 66, 67, 65, true);
            this.x(a, b.dropDownButtonOpen, 69, 70, 68, true);
            this.y(a, b.cellSelection + " " + "ui-state-highlight", 3, "outline-color");
            this.a[37] = this.a[4] = this.a[3];
            a.append(d);
            let f = " " + "ui-state-disabled";
            c.x = this.f(e, b.tabAreaBorder, false);
            c.v = this.f(e, b.columnSplitter, true);
            c.t = this.f(e, b.rowSplitter, false);
            c.w = this.f(e, b.columnSplitter + f, true);
            c.u = this.f(e, b.rowSplitter + f, false);
            c.aa = this.f(e, b.tabAreaSplitter, true);
            c.z = this.f(e, b.tabAreaSplitter, false);
            c.b = this.b(a, b.formulaBar);
            c.c = this.b(a, b.nameBoxContainer);
            c.a = this.b(a, b.formulaBarButtonContainer);
            c.ap = this.ab(e, b.nameBoxSplitter, true);
            c.ao = this.ab(e, b.formulaBarTextAreaSplitter, true);
            c.an = this.ab(e, b.formulaBarExpandButton, true);
            c.al = this.ab(e, b.formulaBarCancelButton, true);
            c.am = this.ab(e, b.formulaBarEnterButton, true);
            this.z(a, b, c);
            c.s = this.f(e, b.scrollBarVertical, true, true);
            c.r = this.f(e, b.scrollBarHorizontal, false, true);
            c.d = this.b(a, b.scrollBarHorizontal);
            c.e = this.b(a, b.scrollBarVertical);
            c.p = this.f(e, b.scrollBarArrowRight, true);
            c.q = this.f(e, b.scrollBarArrowLeft, true);
            c.aj = this.f(e, b.scrollBarArrowDown, false);
            c.ak = this.f(e, b.scrollBarArrowUp, false);
            c.ai = this.f(e, b.scrollPreviousTabButton, true);
            c.ah = this.f(e, b.scrollPreviousTabButton, false);
            c.ag = this.f(e, b.scrollNextTabButton, true);
            c.af = this.f(e, b.scrollNextTabButton, false);
            c.ac = this.f(e, b.scrollFirstTabButton, true);
            c.ab = this.f(e, b.scrollFirstTabButton, false);
            c.ae = this.f(e, b.scrollLastTabButton, true);
            c.ad = this.f(e, b.scrollLastTabButton, false);
            c.i = this.f(e, b.activatePreviousHiddenTabButton, true);
            c.h = this.f(e, b.activatePreviousHiddenTabButton, false);
            c.g = this.f(e, b.activateNextHiddenTabButton, true);
            c.f = this.f(e, b.activateNextHiddenTabButton, false);
            c.k = this.f(e, b.addNewWorksheetButton, true);
            c.j = this.f(e, b.addNewWorksheetButton, false);
        }
        finally {
            d.remove();
            a.endCSSQuery();
        }
        SpreadsheetVisualElementDomBuilder.ba(this.o, "Wj");
        let g = ["", "ui-state-hover", "ui-state-active", "ui-state-active" + " " + "ui-state-hover", b.tabItemProtected, b.tabItemProtected + " " + "ui-state-hover", b.tabItemProtected + " " + "ui-state-active", b.tabItemProtected + " " + "ui-state-active" + " " + "ui-state-hover"];
        let h = this.n.getAttribute("className");
        let i = 0;
        for (let j = 0; j < g.length; j++) {
            let k = g[j];
            if (j > 0) {
                this.n.addClass(g[j]);
            }
            i = Math.max(this.n.outerHeightWithMargin(), i);
            if (j > 0) {
                this.n.removeClass(g[j]);
            }
        }
        this.n.setAttribute("className", h);
        c.y = i;
    }
    z(a, b, c) {
        let d = new SpreadsheetMeasureHelper_MeasureStack(a);
        let e = d.e("div", b.formulaBar);
        let f = d.e("div", b.formulaBarTextAreaContainer);
        let g = d.e("textarea").rootWrapper;
        SpreadsheetVisualElementDomBuilder.a5(g);
        g.setProperty("rows", 1);
        g.setProperty("value", "Wj");
        this.d._a1.m = g.getProperty("scrollHeight");
        g.setProperty("rows", 2);
        g.setProperty("value", "Wj\r\nWj");
        this.d._a1.n = g.getProperty("scrollHeight");
        g.setProperty("rows", 3);
        g.setProperty("value", "Wj\r\nWj\r\nWj");
        this.d._a1.o = g.getProperty("scrollHeight");
        d.c();
        d.c();
        let h = d.e("div", b.nameBoxContainer).rootWrapper;
        let i = d.e("div");
        let j = i.rootWrapper;
        let k = SpreadsheetVisualElementDomBuilder.am(i);
        this.d._a1.l = j.getProperty("scrollHeight");
        SpreadsheetVisualElementDomBuilder.as(k);
        d.f();
    }
}
SpreadsheetMeasureHelper.$t = markType(SpreadsheetMeasureHelper, 'SpreadsheetMeasureHelper');
/**
 * @hidden
 */
export let ISpreadsheetView_$type = new Type(null, 'ISpreadsheetView');
/**
 * @hidden
 */
export class SpreadsheetView extends Base {
    constructor(a) {
        super();
        this.b = null;
        this.a = null;
        this.b = a;
    }
    beforeExecuteCommand(command, commandParameter, sourceElement) {
        return unwrapNullable(this._beforeExecuteCommand$i.apply(this, arguments));
    }
    _beforeExecuteCommand$i(a, b, c) {
        switch (a) {
            case 148:
            case 149:
            case 150:
                let d = SpreadsheetUtilities.dd(a);
                let e = this.b._bj;
                if (e != null && !e.af(a) && ((typeof document.queryCommandSupported === "function")) && (document.queryCommandSupported(d))) {
                    let f = e.aj;
                    e.aj = new List$1(String_$type, 0);
                    try {
                        document.execCommand(d);
                        if (e.aj != null && e.aj.contains(SpreadsheetUtilities.de(a))) {
                            return Nullable$1.toNullable(Boolean_$type, true);
                        }
                    }
                    finally {
                        e.aj = f;
                    }
                }
                break;
        }
        return SpreadsheetUtilities.cz;
    }
    createChartTitleElement(a, b) {
        if (a == null) {
            return null;
        }
        let c = a.wrapText;
        let d = SpreadsheetUtilities.ab(a._aj);
        let e = false;
        let f = a.workbook;
        let g = new ResolvedWorkbookFont(a.defaultFont, f._styles$i.normalStyle.styleFormat.font, f);
        let h = a.text;
        let i = h != null ? SpreadsheetUtilities.q(h, d, g, e) : SpreadsheetUtilities.t(this.b._fr(a), f, d, g, e);
        let j = a.border;
        let k = j == null ? 7 : j.lineStyle;
        let l = k == 7 || j.widthInPoints == 0 ? 0 : Math.max(Workbook._er(f, Workbook._eq(j.widthInPoints) / 2, false, true), 1);
        let m = this.b._fa.createElement("div");
        m.setRawStyleProperty("position", "relative");
        m.setRawStyleProperty("display", "inline-block");
        let n = this.b._fa.createElement("div");
        n.setRawStyleProperty("display", "table");
        n.setRawStyleProperty("position", "relative");
        let o = SpreadsheetUtilities.c5(a._ad, f);
        let p = !stringIsNullOrEmpty(o) ? "background:" + o + ";" : "";
        let q = JsSpreadsheetRenderCache.a6(i, this.b.workbook, 1, c, NaN, p);
        n.setProperty("innerHTML", q);
        n.setRawStyleProperty("padding", l + "px");
        n.setRawStyleProperty("margin", "auto");
        m.append(n);
        let r = this.b._fa.createElement("div");
        SpreadsheetUtilities.eg(r);
        SpreadsheetUtilities.d8(r, l, j, 0, f);
        m.append(r);
        return m.getNativeElement();
    }
    createRenderCache() {
        return new JsSpreadsheetRenderCache(this.b);
    }
    get hasKeyboardFocusWithin() {
        return SpreadsheetUtilities.a5(this.b._bh, document.activeElement);
    }
    get isCellDropDownOpen() {
        return this.b._at.i(8) || this.b._c6;
    }
    get isInNameBox() {
        if (this.b._bh != null) {
            return SpreadsheetUtilities.a5(this.b._bh.dp.cg, document.activeElement);
        }
        return false;
    }
    get isScrollLockToggled() {
        return this.b.isScrollLocked;
    }
    get updateEditorValueMode() {
        return 0;
    }
    addCellTextLocations(a, b) {
        let c = typeCast(PaneLayerContainer.$, b._ap);
        if (c != null) {
            let d = c.e;
            for (let e = 0, f = d.a9; e < f; e++) {
                let g = d.b(e);
                if (g.bx == "SpreadsheetCellValueLayer") {
                    let h = g.a9;
                    for (let i = 0, j = g.a9; i < j; i++) {
                        let k = g.b(i);
                        if (k.bx == "SpreadsheetCellValue") {
                            let l = k;
                            let m = new Rect(0, l.co + l.ax, l.cp + l.a2, l.cq, l.cn);
                            a.item(new SpreadsheetCell(l.cg.ak, l.cg.ab), m);
                        }
                    }
                }
            }
        }
    }
    closeMenu() {
        this.b._at.l();
    }
    createCellEditManager() {
        return new JsCellEditManager(this.b);
    }
    createTabEditManager() {
        return new JsTabEditManager(this.b);
    }
    focus() {
        if (this.b._ay != null && this.b._ay.a7 != null) {
            SpreadsheetUtilities.d7(this.b._ay.a7.rootWrapper.getNativeElement());
            return true;
        }
        return true;
    }
    getLayoutManager() {
        return this.b._ad;
    }
    notifyCanExecuteChanged() {
        this.b.scheduleArrange();
    }
    onDataObjectPasting(a) {
    }
    onHasPendingChangeNotification() {
        this.b.scheduleArrange();
    }
    onNameBoxValueChanged() {
    }
    onNameBoxWidthChanged() {
    }
    onSheetManagerChanged(a, b) {
        if (a != null) {
            a._al._j.al();
        }
        if (this.b._ad != null) {
            this.b._ad.e3 = false;
            this.b._ad.e2 = false;
        }
    }
    onStateVerified() {
    }
    remeasureRootPanel() {
        this.b._fy(false);
    }
    shouldIncludeClipboardFormat(a, b) {
        return true;
    }
    shouldCopyToClipboard(a, b) {
        return true;
    }
    showCellDropDown(pane, cellRect, dropdownItems, initialSelectedIndex, onSelectionCommitted) {
        arguments[1] = rectFromLiteral(arguments[1]);
        return this._showCellDropDown$i.apply(this, arguments);
    }
    _showCellDropDown$i(a, b, c, d, e) {
        return this.b._d5(a, b, c, d, e);
    }
    showSelectAllContextMenu(context, relativePoint) {
        arguments[1] = pointFromLiteral(arguments[1]);
        return this._showSelectAllContextMenu$i.apply(this, arguments);
    }
    _showSelectAllContextMenu$i(a, b) {
        this.b._at.j(6, a, b);
    }
    ShowPaneContextMenu(pane, area, relativePoint) {
        arguments[2] = pointFromLiteral(arguments[2]);
        return this._ShowPaneContextMenu$i.apply(this, arguments);
    }
    _ShowPaneContextMenu$i(a, b, c) {
        let d = this.b._n(a);
        this.b._at.j(b, d, c);
    }
    ShowHeaderContextMenu(scrollRegion, relativePoint) {
        arguments[1] = pointFromLiteral(arguments[1]);
        return this._ShowHeaderContextMenu$i.apply(this, arguments);
    }
    _ShowHeaderContextMenu$i(a, b) {
        let c = a._aw ? 1 : 0;
        let d = this.b._o(a);
        this.b._at.j(c, d, b);
    }
    ShowTabContextMenu(tab, point) {
        arguments[1] = pointFromLiteral(arguments[1]);
        return this._ShowTabContextMenu$i.apply(this, arguments);
    }
    _ShowTabContextMenu$i(a, b) {
        this.b._at.j(3, a._ac, b);
    }
    showFilterMenu(a, b) {
        let c = this.b._n(a);
        return this.b._at.j(8, c, { $type: Point_$type, x: b.g.right, y: b.g.bottom }, b);
    }
    showMessageBox(a, b, c, d, e) {
        VisualElementInputProxy.q++;
        switch (c) {
            case 0:
                {
                    window.alert(a);
                    return e;
                }
            case 1:
                {
                    return window.confirm(a) ? 1 : 2;
                }
            case 4:
                {
                    return window.confirm(a) ? 6 : 7;
                }
            case 3:
                {
                    return window.confirm(a) ? 6 : 2;
                }
        }
        return e;
    }
    get usesLogicalPixels() {
        return false;
    }
    verifyLayout() {
    }
    showFilterDialog(a) {
        let b = new FilterDialogManager(this.b, a);
        b.u();
    }
    showTopOrBottomDialog(a) {
        let b = new TopOrBottomDialogManager(this.b, a);
        b.q();
    }
    showCustomSortDialog(a, b) {
        let c = new SortDialogManager(this.b, a);
        c.aj(b);
    }
    showFormatCellsDialog(a, b) {
        let c = new FormatCellsDialogManager(this.b, a, b);
        c.ea();
    }
    get spreadsheetDialogServicesManager() {
        if (null == this.a) {
            this.a = new SpreadsheetDialogServicesManager();
        }
        return this.a;
    }
    getRect(scrollRegion) {
        return rectToLiteral(this._getRect$i.apply(this, arguments));
    }
    _getRect$i(a) {
        let b = this.b._o(a);
        return b != null ? b.ce() : Rect.empty;
    }
    getPaneRect(pane) {
        return rectToLiteral(this._getPaneRect$i.apply(this, arguments));
    }
    _getPaneRect$i(a) {
        let b = this.b._n(a);
        return b != null ? b.ce() : Rect.empty;
    }
    initializeEditFont(a, b) {
    }
}
SpreadsheetView.$t = markType(SpreadsheetView, 'SpreadsheetView', Base.$, [ISpreadsheetView_$type]);
/**
 * @hidden
 */
export class SpreadsheetAreaLayoutManager extends Base {
    constructor() {
        super();
        this.b = null;
        this.m = null;
        this.v = null;
        this.g = new SpreadsheetAreaLayoutManager_RowColumnInfo(true);
        this.f = new SpreadsheetAreaLayoutManager_RowColumnInfo(false);
        this.ao = null;
        this.aq = 0;
        this.o = null;
        this.ei = null;
        this.ar = 0;
        this.d = 0;
        this.as = 0;
        this.at = 0;
        this.ep = null;
        this.en = null;
        this.w = null;
        this.au = 0;
        this.t = null;
        this.s = null;
        this.et = new Size();
        this.eo = null;
        this.y = null;
        this.a = 0;
        this.z = false;
        this.aa = false;
        this.ab = false;
        this.ai = false;
        this.ac = false;
        this.ad = false;
        this.ag = false;
        this.ah = false;
        this.ae = false;
        this.af = false;
        this.v = new PropertyChangeListener$1(SpreadsheetAreaLayoutManager.$, this, SpreadsheetAreaLayoutManager.ds, false);
        this.ao = new List$1(SpreadsheetAreaLayoutManager_SheetLayerInfo$1.$.specialize(SpreadsheetPane.$), 0);
    }
    get h() {
        return this.f;
    }
    get e() {
        return this.d;
    }
    get aj() {
        return this.ag;
    }
    get ev() {
        return this.et;
    }
    get ap() {
        return this.ao;
    }
    get x() {
        return this.w;
    }
    set x(a) {
        this.w = a;
    }
    get er() {
        return this.eo;
    }
    get i() {
        return this.g;
    }
    get n() {
        return this.m;
    }
    set n(a) {
        if (a != this.m) {
            let b = this.m;
            let c = PropertyChangeListenerList.e(SpreadsheetPaneManager.$, this.m, a, this.v, true);
            this.m = c.p0;
            if (this.m != null) {
                this.f.e = this.m._dg;
                this.g.e = this.m._dm;
            }
            else {
                this.g.e = this.f.e = boxArray$1(new Array(0));
            }
            this.cs();
            this.dm(b, a);
        }
    }
    get c() {
        return this.b;
    }
    set c(a) {
        if (a != this.b) {
            let b = PropertyChangeListenerList.e(Spreadsheet.$, this.b, a, this.v, true);
            this.b = b.p0;
            this.n = this.b != null ? this.b._a8 : null;
            this.p = this.b != null ? this.b._bf : null;
        }
    }
    get p() {
        return this.o;
    }
    set p(a) {
        if (a != this.o) {
            let b = this.o;
            let c = PropertyChangeListenerList.e(SpreadsheetTabManager.$, this.o, a, this.v, true);
            this.o = c.p0;
            this.du(b, a);
        }
    }
    get be() {
        return this.m != null ? this.m._d8 : 1;
    }
    bt(a, b, c, d, e, f, g) {
        let h = f;
        let i = g;
        let j = c / b;
        let k = this.b._ai.l;
        let l = k.a.e == 7 ? k.a.t : k.a.j;
        if (l) {
            return {
                p5: f,
                p6: g
            };
        }
        switch (k.a.e) {
            case 5: break;
            case 1:
            case 4:
                {
                    if (f + d > g) {
                        g = f + d;
                        let m = a.columnScrollRegion._ag(g);
                        g = a.columnScrollRegion._bn(m._j, false);
                    }
                    break;
                }
            case 3:
                {
                    f = Math.max(Math.min(f, g - d), 0);
                    if (h > f) {
                        let n = a.columnScrollRegion._ag(f);
                        f = Math.max(a.columnScrollRegion._bn(n._j, true), 0);
                    }
                    break;
                }
            case 2:
            case 7:
            case 6:
                {
                    if (g - f < d) {
                        let o = (g - f) / 2 + f;
                        let p = Math.min(d, j);
                        if (f > o - p / 2) {
                            f = o - p / 2;
                            g = o + (p / 2);
                            let q = g - j;
                            let r = 0 - f;
                            let s = Math.max(q, r);
                            if (s > 0) {
                                f += s;
                                g -= s;
                            }
                            let t = a.columnScrollRegion._ag(f);
                            let u = a.columnScrollRegion._bn(t._j, true);
                            let v = a.columnScrollRegion._ag(g - e);
                            let w = a.columnScrollRegion._bn(v._j, false);
                            let x = o - u;
                            let y = w - o;
                            let z = Math.min(x, y);
                            f = o - z;
                            g = o + z;
                        }
                    }
                    break;
                }
        }
        return {
            p5: f,
            p6: g
        };
    }
    df(a) {
    }
    eu(a) {
        this.df(a);
        let b = a;
        let c = new Rect(0, 0, 0, a.width, a.height);
        let d = this.g.i;
        let e = this.aq;
        let f = 0;
        if (this.ag || this.ae) {
            let g, h;
            let i = ((() => { let j = this.aw(Math.max(a.width - d, 0), g, h); g = j.p1; h = j.p2; return j.ret; })());
            if (this.ah) {
                this.cb(new Rect(0, i, a.height - e, g, e));
            }
            if (this.ag) {
                this.ca(new Rect(0, 0, a.height - e, Math.min(i, this.bd), e));
                f = i + g;
            }
            if (this.af) {
                this.b9(new Rect(0, 0, a.height - e, a.width - d, this.a9));
            }
            if (this.ae) {
                this.b8(new Rect(0, 0, a.height - e, a.width, e));
            }
        }
        if (this.g.a != null) {
            this.b3(this.g, true, this.f.g, a, d, 0, this.t, this.aq);
            c.width = Math.max(c.width - d, 0);
        }
        if (this.f.a != null) {
            this.b3(this.f, false, this.g.g, a, e, f, this.s, this.f.i);
        }
        c.height = Math.max(c.height - e, 0);
        this.eo = c.copy();
        let j = this.bu(this.g, SpreadsheetUtilities.e3(c.x, c.y + this.f.g), c);
        c = j.p2;
        let k = this.bu(this.f, SpreadsheetUtilities.e3(c.x, c.y), c);
        c = k.p2;
        if (this.ac) {
            let l = new Rect(0, c.x - this.g.h, c.y - this.f.h, this.g.h, this.f.h);
            this.b4(l);
        }
        let m = 30;
        let n = new Rect(0, c.x - this.g.h, c.y - this.f.h, c.width + this.g.h + d, c.height + this.f.h + e);
        n.inflate(m, m);
        this.ep = n;
        let o = Rect.empty;
        if (this.g.c) {
            o = new Rect(0, c.x - this.g.h, c.y + this.m._dn.item(0).actualExtent, c.width + this.g.h, this.m._d3);
            let p = o.copy();
            if (!this.g.e.item(0).isFrozen) {
                o.width += d;
            }
            if (CoreUtilities.f(o.top, c.bottom)) {
                o.height = 0;
            }
            this.b5(true, o);
            if (this.g.d) {
                let q = new Rect(0, p.x, this.at - p.height / 2, p.width, p.height);
                if (this.f.d) {
                    if (this.as < n.x || this.as >= n.right) {
                        q = p;
                    }
                }
                if (this.at < n.y || this.at >= n.bottom) {
                    q = p;
                }
                if (q.y < c.y) {
                    q.y = c.y;
                }
                else if (q.bottom > c.bottom) {
                    q.y = c.bottom - q.height;
                }
                this.b7(true, q);
            }
        }
        let r = Rect.empty;
        if (this.f.c) {
            r = new Rect(0, c.x + this.m._dh.item(0).actualExtent, c.y - this.f.h, this.m._d4, c.height + this.f.h);
            let s = r.copy();
            if (!this.f.e.item(0).isFrozen) {
                r.height += e;
            }
            if (CoreUtilities.f(r.left, c.right)) {
                r.width = 0;
            }
            this.b5(false, r);
            if (this.f.d) {
                let t = new Rect(0, this.as - s.width / 2, s.y, s.width, s.height);
                if (this.g.d) {
                    if (this.at < n.y || this.at >= n.bottom) {
                        t = s;
                    }
                }
                if (this.as < n.x || this.as >= n.right) {
                    t = s;
                }
                if (t.x < c.x) {
                    t.x = c.x;
                }
                else if (t.right > c.right) {
                    t.x = c.right - t.width;
                }
                this.b7(false, t);
            }
        }
        let u = Rect.empty;
        if (this.ad) {
            let v = new Rect(0, r.x, o.y, r.width, o.height);
            this.b6(v);
            let w = r.x - o.x + (r.width / 2);
            let x = o.y - r.y + (o.height / 2);
            u = new Rect(0, w - 9, x - 9, 18, 18);
        }
        this.cv(u);
        this.en = c;
        this.b1(c);
        this.bx(a);
        this.by(this.en);
        return b;
    }
    bu(a, b, c) {
        let d = b.x;
        let e = b.y;
        let f = 0;
        let g = 0;
        if (a.f.count > 0) {
            let h = this.be;
            let i = a.e;
            let j = a.h;
            let k = a.b;
            if (k) {
                f = j;
            }
            else {
                g = j;
            }
            let l = -1;
            for (let m of fromEnum(i)) {
                l++;
                if (k) {
                    g = m.actualExtent + 1;
                    e -= 1;
                }
                else {
                    f = m.actualExtent + 1;
                    d -= 1;
                }
                let n = new Rect(0, d, e, f, g);
                this.b0(SpreadsheetScrollRegion.$, a.f._inner[l].b, n);
                if (k) {
                    e += g + this.m._d3;
                }
                else {
                    d += f + this.m._d4;
                }
            }
            if (k) {
                c.x += j;
                c.width = Math.max(c.width - j, 0);
            }
            else {
                c.y += j;
                c.height = Math.max(c.height - j, 0);
            }
        }
        return {
            p2: c
        };
    }
    bx(a) {
        let b = this.l();
        let c = this.j();
        let d = new Rect(4);
        let e = Rect.empty;
        if (b != null) {
            let f = Enumerable.ag(SpreadsheetAreaLayoutManager_SheetLayerInfo$1.$.specialize(SpreadsheetPane.$), this.ao, (g) => g.a == b);
            if (f != null) {
                let g = this.b.isInEditMode;
                let h = this.x;
                let i = 1 / h.d;
                let j = -this.a2(f.c.x);
                let k = -this.a3(f.c.y);
                let l = b.rowScrollRegion._bx;
                let m = f.c.width;
                let n = f.c.height;
                let o = b.columnScrollRegion._bn(c.firstColumn, true);
                let p = b.rowScrollRegion._bn(c.firstRow, true);
                let q = b.columnScrollRegion._bn(c.lastColumn, false);
                let r = b.rowScrollRegion._bn(c.lastRow, false);
                let s = q;
                let t = r;
                r = Math.max(r, p + this.ay());
                if (g) {
                    let u = this.bt(b, l, m, this.b._ai.al(), i, o, q);
                    o = u.p5;
                    q = u.p6;
                }
                let v = Math.max(Math.min(q - o, (m - (o * l)) / l) - i, 0);
                let w = Math.max(Math.min(r - p, (n - (p * l)) / l) - i, 0);
                let x = f.c.x + h.h(o * l) - j;
                let y = f.c.x + h.h(o * l + v) - j;
                let z = f.c.y + h.h(p * l) - k;
                let aa = f.c.y + h.h(p * l + w) - k;
                d.x = x;
                d.y = z;
                d.width = Math.max(y - x, 0);
                d.height = Math.max(aa - z, 0);
                let ab = f.c.x + h.h(s * l) - j;
                let ac = f.c.y + h.h(t * l) - k;
                let ad = new Rect(0, x, z, Math.max(ab - x - i, 0), Math.max(ac - z - i, 0));
                let ae = b.rowScrollRegion._ag(r - i);
                if (ae._j > c.lastRow) {
                    let af = b.rowScrollRegion._bn(ae._j, false);
                    w = Math.max(Math.min(af - p, (n - (p * l)) / l) - i, 0);
                }
                ad.union(new Rect(0, x, z, Math.max(v * l, 0), Math.max(w * l, 0)));
                e = f.c;
                this.bw(ad, e);
            }
        }
        this.bv(d, e);
    }
    by(a) {
        if (this.m != null) {
            let b = this.a8;
            let c = this.a7;
            let d = Enumerable.ag(SpreadsheetAreaLayoutManager_SheetLayerInfo$1.$.specialize(SpreadsheetPane.$), this.ao, (e) => e.a == this.m._ao);
            let e = d != null ? d.a._ag : null;
            let f = this.m._bc._jg;
            if (!this.ai) {
                this.bz(new Rect(0, -10000, -10000, b, c));
            }
            else if (this.d == 2) {
                this.bz(new Rect(0, this.as - this.ei.x, this.at - this.ei.y, b, c));
            }
            else if (PointUtil.notEquals(f, null)) {
                this.bz(new Rect(0, f.x + this.en.x, f.y + this.en.y, b, c));
            }
            else if (e != null) {
                let g = d.c;
                let h = e._r;
                let i = d.a.rowScrollRegion._bx;
                let j = d.a.rowScrollRegion._bn(h.firstRow, true) * i;
                let k = d.a.rowScrollRegion._bn(h.lastRow, false) * i;
                let l = d.a.columnScrollRegion._bn(h.firstColumn, true) * i;
                let m = d.a.columnScrollRegion._bn(h.lastColumn, false) * i;
                let n = 5;
                let o = SpreadsheetUtilities.e3(l + (m - l) / 2, k + n);
                let p = this.es(d, new Rect(2, SpreadsheetUtilities.e3(l, j), SpreadsheetUtilities.e3(m, k)));
                let q = this.em(d, o);
                let r = new Rect(0, q.x, q.y, b, c);
                if (!a.containsRect(r)) {
                    if (r.y < a.y) {
                        r.y = a.y;
                    }
                    else if (r.bottom > a.bottom) {
                        r.y = Math.max(a.y, a.bottom - r.height);
                    }
                    if (r.x < a.x) {
                        r.x = a.x;
                    }
                    else if (r.right > a.right) {
                        r.x = Math.max(a.x, a.right - r.width);
                    }
                    let s = new Rect(0, a.x, a.y, a.width, g.height);
                    s.intersect(p);
                    if (s.isEmpty == false && s.intersectsWith(r)) {
                        let t = Math.max(a.y, Math.min(this.em(d, SpreadsheetUtilities.e3(0, j + (k - j) / 2)).y, a.bottom - r.height));
                        if (a.right - s.right >= n + r.width) {
                            r.x = s.right + n;
                            r.y = t;
                        }
                        else if (s.top >= n + r.height) {
                            r.y = s.y - (n + r.height);
                        }
                        else if (s.left >= n + r.width) {
                            r.x = s.left - (n + r.width);
                            r.y = t;
                        }
                        else {
                            let u = new Array(4);
                            u[0] = new Rect(0, s.left - (n + r.width), t, r.width, r.height);
                            u[1] = new Rect(0, r.x, s.y - (n + r.height), r.width, r.height);
                            u[2] = new Rect(0, s.right + n, t, r.width, r.height);
                            u[3] = new Rect(0, r.x, s.bottom + n, r.width, r.height);
                            let v = -1;
                            let w = 0;
                            for (let x = 0; x < u.length; x++) {
                                let y = new Rect(0, a.x, a.y, a.width, a.height);
                                y.intersect(u[x]);
                                if (y.isEmpty == false) {
                                    let z = y.width * y.height;
                                    if (z > w) {
                                        v = x;
                                        w = z;
                                    }
                                }
                            }
                            if (v >= 0) {
                                r = u[v];
                            }
                        }
                    }
                }
                this.bz(r);
            }
        }
    }
    b1(a) {
        let b = a.x;
        let c = a.y;
        let d = this.be;
        let e = this.f.e.count;
        for (let f = 0; f < this.ao.count; f++) {
            let g = intDivide(f, e);
            let h = f % e;
            let i = this.g.e.item(g);
            let j = this.f.e.item(h);
            let k = new Rect(0, b, c, j.actualExtent, i.actualExtent);
            this.ao._inner[f].c = k;
            this.b0(SpreadsheetPane.$, this.ao._inner[f].b, k);
            if (h == e - 1) {
                b = a.x;
                c += i.actualExtent + this.m._d3;
            }
            else {
                b += j.actualExtent + this.m._d4;
            }
        }
    }
    b3(a, b, c, d, e, f, g, h) {
        let i = a.a;
        if (i == null) {
            return;
        }
        let j = a.e;
        let k = getEnumerator((j || boxArray$1(new Array(0))));
        let l = i.e.getEnumerator();
        let m = 0;
        let n = b ? new Rect(0, d.width - e, f, e, 0) : new Rect(0, f, d.height - e, 0, e);
        let o = c;
        while (k.moveNext()) {
            l.moveNext();
            let p = l.current.b;
            let q = k.current;
            let r = q.actualExtent;
            if (p != null) {
                r = Math.max(r + o - f, 0);
                o = 0;
                if (b) {
                    n.height = r;
                }
                else {
                    n.width = r;
                }
                this.b2(p, n);
                if (b) {
                    n.y += r + this.m._d3;
                }
                else {
                    n.x += r + this.m._d4;
                }
                f = 0;
            }
            else {
                o += r;
            }
            m++;
        }
        if (m == 0 && g != null) {
            let s = b ? d.height : d.width;
            o -= h;
            s = Math.max(s + o - f, 0);
            o = 0;
            if (b) {
                n.height = s;
            }
            else {
                n.width = s;
            }
            this.b2(g, n);
        }
    }
    av(a, b) {
        return {
            ret: ((() => { let c = this.aw(this.au, a, b); a = c.p1; b = c.p2; return c.ret; })()),
            p0: a,
            p1: b
        };
    }
    aw(a, b, c) {
        this.au = a;
        b = 0;
        c = a;
        let d = 0;
        if (this.g != null && this.g.e.count > 0) {
            c = this.g.g;
        }
        if (this.ag) {
            if (this.f.e != null) {
                for (let e = 0; e < this.f.e.count; e++) {
                    let f = this.f.e.item(e);
                    c += f.actualExtent;
                    if (e > 0) {
                        c += this.m._d4;
                    }
                    if (this.f.a != null && this.f.a.e.item(e).b != null) {
                        break;
                    }
                }
            }
            if (this.ah) {
                b = this.bc;
                c = Math.max(c - b, 0);
            }
            d = this.p._a1 / 1000 * c;
        }
        return {
            ret: d,
            p1: b,
            p2: c
        };
    }
    cc() {
        if (this.d != 0) {
            let a = this.d;
            this.d = 0;
            if (this.g.d) {
                this.g.d = false;
                this.d4(true);
            }
            if (this.f.d) {
                this.f.d = false;
                this.d4(false);
            }
            this.cd();
            this.di(a, 0);
        }
    }
    ce() {
        if (this.y != null) {
            this.y.c();
            this.y = null;
        }
    }
    cq(a) {
        for (let b of fromEnum(this.g.a.e)) {
            if (b.b != null) {
                a(b.b);
            }
        }
        for (let c of fromEnum(this.f.a.e)) {
            if (c.b != null) {
                a(c.b);
            }
        }
        if (this.s != null) {
            a(this.s);
        }
        if (this.t != null) {
            a(this.t);
        }
    }
    j() {
        if (this.b == null) {
            return SpreadsheetCellRange.empty;
        }
        if (this.b.isInEditMode) {
            return this.b._ai.p;
        }
        return this.b._am;
    }
    l() {
        if (this.b == null) {
            return null;
        }
        if (this.b.isInEditMode) {
            return this.b._ai.t;
        }
        return this.b._a5;
    }
    ax() {
        this.m._jn(this.m._jo);
        return this.f.h + this.aq + 2;
    }
    a2(a) {
        return 0;
    }
    a3(a) {
        return 0;
    }
    k(a) {
        let b = this.ej(a);
        for (let c = 0; c < this.ao.count; c++) {
            let d = this.ao._inner[c];
            let e = this.eq(SpreadsheetPane.$, d.b);
            if (e.containsPoint(b)) {
                let f = d.a;
                let g = this.ek(d, b);
                let h = new WorksheetItemPosition();
                if (!((() => { let i = f.rowScrollRegion._az(g.y / f.rowScrollRegion._bx, h); h = i.p1; return i.ret; })())) {
                    return null;
                }
                let i = h._j;
                if (!((() => { let j = f.columnScrollRegion._az(g.x / f.columnScrollRegion._bx, h); h = j.p1; return j.ret; })())) {
                    return null;
                }
                let j = h._j;
                return new SpreadsheetCellHitTestResult(new SpreadsheetCell(i, j), f);
            }
        }
        for (let k = 0; k < 2; k++) {
            let l = k == 0;
            let m = l ? this.g : this.f;
            if (m != null) {
                for (let n = 0; n < m.f.count; n++) {
                    let o = m.f._inner[n];
                    let p = this.eq(SpreadsheetScrollRegion.$, o.b);
                    if (p.containsPoint(b)) {
                        let q = o.a;
                        let r = this.el(o, b);
                        let s = new WorksheetItemPosition();
                        if (!((() => { let t = q._az((l ? r.y : r.x) / q._bx, s); s = t.p1; return t.ret; })())) {
                            return null;
                        }
                        return new SpreadsheetHeaderHitTestResult(s._j, q);
                    }
                }
            }
        }
        return null;
    }
    cs() {
        if (!this.ab) {
            return;
        }
        let a = this.m != null ? this.m._fu : null;
        this.ai = a != null;
        if (!this.ai) {
            this.cr();
        }
        else {
            this.d9(a.d, a.c);
        }
    }
    dg(a) {
    }
    ew(a) {
        this.dg(a);
        let b = new Size(0);
        this.et = new Size(1, a.width, a.height);
        let c = this.m;
        if (c != null) {
            c._i5();
        }
        let d = c != null ? c._bc.workbook : null;
        {
            let e = Workbook._fc(d);
            try {
                let f, g;
                if (c != null) {
                    g = c._ca;
                    f = c._ce;
                }
                else if (this.o != null && this.o._y != null) {
                    f = (this.o._y.windowOptions.scrollBars & 2) != 0;
                    g = (this.o._y.windowOptions.scrollBars & 1) != 0;
                }
                else {
                    f = g = false;
                }
                if (f == false) {
                    let h = this.d0(this.g, this.t);
                    this.t = h.p1;
                }
                else {
                    let i = this.c6(this.g, this.t);
                    this.t = i.p1;
                }
                if (g == false) {
                    let j = this.d0(this.f, this.s);
                    this.s = j.p1;
                }
                else {
                    let k = this.c6(this.f, this.s);
                    this.s = k.p1;
                }
                let l = this.g.i;
                let m = this.f.i;
                let n = new Size(1, a.width, a.height);
                if (c != null && c._ce) {
                    n.width = Math.max(n.width - l, 0);
                }
                let o = new Size(1, Number.POSITIVE_INFINITY, Number.POSITIVE_INFINITY);
                let p = this.o != null && this.o._ah;
                if (p != this.ag) {
                    this.ag = p;
                    if (!p) {
                        this.d7();
                    }
                    else {
                        this.co();
                    }
                }
                if (this.ag) {
                    if (m > 0) {
                        m += this.w.d;
                    }
                    this.dd(o);
                    m = Math.max(m, this.ba);
                }
                let q = p;
                if (q != this.af) {
                    this.af = q;
                    if (!q) {
                        this.d6();
                    }
                    else {
                        this.cn();
                    }
                }
                if (this.af) {
                    this.dc(o);
                }
                let r = p || g;
                if (r != this.ae) {
                    this.ae = r;
                    if (!r) {
                        this.d5();
                    }
                    else {
                        this.cm();
                    }
                }
                if (this.ae) {
                    this.db(o);
                }
                let s = p && g;
                if (s != this.ah) {
                    this.ah = s;
                    if (!s) {
                        this.d8();
                    }
                    else {
                        this.cp();
                    }
                }
                if (this.ah) {
                    this.de(o);
                    m = Math.max(m, this.bb);
                }
                this.aq = m;
                if (g || p) {
                    n.height = Math.max(n.height - m, 0);
                }
                let t = this.a6(this.f);
                let u = this.a6(this.g);
                if (c != null) {
                    c._d4 = t;
                    c._d3 = u;
                }
                let v = this.f.c && this.g.c;
                if (v != this.ad) {
                    this.ad = v;
                    if (!v) {
                        this.d3();
                    }
                    else {
                        this.ck();
                    }
                }
                if (this.ad) {
                    this.c9(new Size(1, c._d4, c._d3));
                }
                let w = c != null && c._bc.displayOptions.showRowAndColumnHeaders;
                let x = c != null && w ? c._al._j.x(c._bc, c._d1) : 0;
                this.f.h = x;
                let y = Math.max(n.height - x, 0);
                let z = c != null ? c._eh(y) : 0;
                let aa = c != null && w ? c._al._j.ab(z, c._bc, c._d0) : 0;
                this.g.h = aa;
                this.f.g = this.f.h;
                this.g.g = this.g.h;
                if (c != null) {
                    c._dx = this.f.g;
                    c._d2 = this.g.g;
                    c._dn.item(0)._bv = c._dn.item(0)._v == 2 ? this.f.g : 0;
                    c._dh.item(0)._bv = c._dh.item(0)._v == 2 ? this.g.g : 0;
                }
                n.height = Math.max(n.height - this.f.g, 0);
                n.width = Math.max(n.width - this.g.g, 0);
                let ab = c != null ? c._jn(n) : new Size(0);
                b.width += ab.width + l + this.g.h;
                b.height += ab.height + m + this.f.h;
                this.c4();
                this.a5(this.f);
                this.a5(this.g);
                let ac = this.f.f.count > 0 && this.g.f.count > 0;
                if (ac != this.ac) {
                    this.ac = ac;
                    if (!ac) {
                        this.d1();
                    }
                    else {
                        this.ci();
                    }
                }
                if (this.ac) {
                    this.c7(new Size(1, this.g.h, this.f.h));
                }
                this.c1(a);
                if (this.ag) {
                    let ad, ae;
                    let af = isInfinity(a.width) ? 0 : Math.max(a.width - l, 0);
                    let ag = ((() => { let ah = this.aw(af, ad, ae); ad = ah.p1; ae = ah.p2; return ah.ret; })());
                    if (this.o != null) {
                        this.o._as = Math.max(ag - this.bd, 0);
                    }
                    if (this.bd > ag) {
                        this.dd(new Size(1, ag, Number.POSITIVE_INFINITY));
                    }
                }
                if (!this.ab) {
                    this.ab = true;
                    this.ch();
                }
                this.cs();
                this.c2(o);
            }
            finally {
                if (e != null) {
                    e.dispose();
                }
            }
        }
        return b;
    }
    c1(a) {
        if (!this.z) {
            this.z = true;
            this.cf();
        }
        let b = this.l();
        let c = new Size(0);
        if (b != null) {
            let d = this.b.isInEditMode;
            let e = this.j();
            let f = 1 / this.x.d;
            let g = b.rowScrollRegion._bx;
            let h = b.columnScrollRegion.actualExtent;
            let i = b.rowScrollRegion.actualExtent;
            let j = b.columnScrollRegion._bn(e.firstColumn, true);
            let k = b.rowScrollRegion._bn(e.firstRow, true);
            let l = b.columnScrollRegion._bn(e.lastColumn, false);
            let m = b.rowScrollRegion._bn(e.lastRow, false);
            if (d) {
                let n = this.bt(b, g, h, this.b._ai.al(), f, j, l);
                j = n.p5;
                l = n.p6;
            }
            let o = Math.max(Math.min(l - j, (h - (j * g)) / g) - f, 0);
            let p = Math.max((i - (k * g)) / g - f, 0);
            c.width = o;
            c.height = p;
        }
        this.cz(c);
        if (!this.aa) {
            this.aa = true;
            this.cg();
        }
        this.c0(new Size(1, Number.POSITIVE_INFINITY, Number.POSITIVE_INFINITY));
    }
    a5(a) {
        let b = a.e;
        let c = b.count;
        let d = a.f;
        let e = this.m != null && this.m._bc.displayOptions.showRowAndColumnHeaders;
        let f = a.b;
        let g = 0;
        this.eg(SpreadsheetScrollRegion.$, e ? b : boxArray$1(new Array(0)), d, (h) => {
        }, (h) => {
        }, runOn(this, this.q));
        if (c > 0) {
            let h = new Size(1, Number.POSITIVE_INFINITY, Number.POSITIVE_INFINITY);
            for (let i of fromEnum(d)) {
                this.c3(SpreadsheetScrollRegion.$, i.b, h);
            }
        }
        return g;
    }
    c4() {
        let a = this.m != null ? this.m._dl : boxArray$1(new Array(0));
        let b = this.ao;
        this.eg(SpreadsheetPane.$, a, b, (c) => c.a._ap = c.b, (c) => c.a._ap = null, runOn(this, this.r));
        if (this.m != null) {
            let c = this.be;
            for (let d of fromEnum(b)) {
                let e = d.a;
                let f = new Size(1, e.columnScrollRegion.actualExtent, e.rowScrollRegion.actualExtent);
                this.c3(SpreadsheetPane.$, d.b, f);
            }
        }
    }
    c6(a, b) {
        let c = a.a;
        if (c == null) {
            c = a.a = new ScrollBarVisibilityCoordinator();
        }
        let d = a.e;
        let e = a.b;
        this.ef(d, c, e ? 1 : 0);
        let f = getEnumerator((d || boxArray$1(new Array(0))));
        let g = c.e.getEnumerator();
        let h = 0;
        let i = 0;
        let j = 0;
        while (f.moveNext()) {
            g.moveNext();
            let k = g.current.b;
            let l = f.current;
            let m = l.actualExtent;
            if (k != null) {
                let n = Math.max(m + i, 0);
                if (n == 0) {
                    n = Number.POSITIVE_INFINITY;
                }
                let o = e ? new Size(1, Number.POSITIVE_INFINITY, n) : new Size(1, n, Number.POSITIVE_INFINITY);
                this.c5(k, o);
                i = 0;
                j = Math.max(j, e ? this.a0(k) : this.az(k));
            }
            else {
                i += m;
            }
            h++;
        }
        if (h == 0) {
            if (b == null) {
                b = this.u(e ? 1 : 0);
                this.ct(b, null);
            }
            this.c5(b, new Size(1, Number.POSITIVE_INFINITY, Number.POSITIVE_INFINITY));
            j = Math.max(j, e ? this.a0(b) : this.az(b));
        }
        else {
            let p = this.dv(b);
            b = p.p0;
        }
        a.i = j;
        return {
            p1: b
        };
    }
    a6(a) {
        let b = a.e;
        let c = b.count > 1;
        if (c != a.c) {
            a.c = c;
            if (c) {
                this.cj(a.b);
            }
            else {
                this.d2(a.b);
            }
        }
        if (a.c) {
            this.cu(a.b, b.item(0)._v == 2, b.item(0), b.item(1));
            this.c8(a.b, new Size(1, Number.POSITIVE_INFINITY, Number.POSITIVE_INFINITY));
            if (a.d) {
                this.da(a.b, new Size(1, Number.POSITIVE_INFINITY, Number.POSITIVE_INFINITY));
            }
            return this.a1(a.b);
        }
        else {
            return 0;
        }
    }
    dh() {
        if (this.m != null) {
            this.m._bc._jg = null;
        }
    }
    di(a, b) {
    }
    dj(a) {
        this.as = a.x;
        this.at = a.y;
        if (this.d == 2) {
            let b = this.as;
            let c = this.at;
            if (this.as < this.en.x) {
                b = this.en.x;
            }
            else if (this.as > this.en.right) {
                b = this.en.right;
            }
            if (this.at < this.en.y) {
                c = this.en.y;
            }
            else if (this.at > this.en.bottom) {
                c = this.en.bottom;
            }
            this.as = b;
            this.at = c;
        }
        else if (this.d == 3) {
            let d = Math.max(Math.min(a.x - this.ei.x, this.ar), 0);
            let e = truncate(Math.max(Math.min(MathUtilities.f((d / this.ar) * 1000), 1000), 0));
            if (this.p != null && this.p._y != null) {
                this.p._y.windowOptions.tabBarWidth = e;
            }
        }
        this.cw();
    }
    dk() {
        switch (this.d) {
            default:
            case 0:
            case 3:
                this.cc();
                break;
            case 1:
                this.dn();
                break;
            case 2:
                let a = SpreadsheetUtilities.e3(this.as - this.ei.x - this.en.x, this.at - this.ei.y - this.en.y);
                this.cc();
                if (this.m != null) {
                    this.m._bc._jg = a;
                }
                break;
        }
    }
    ak(a, b, c) {
        this.ce();
        if (b.a() == 1) {
            this.a = a;
            if (b.e() == 2) {
                this.b._g2(a == 0 || a == 2, a == 1 || a == 2);
            }
            else if (!this.b._d7(true)) {
            }
            else {
                this.ei = b.h();
                this.as = c.x;
                this.at = c.y;
                if (b.d()) {
                    this.y = new TimedOperation(runOn(this, this.dr), SpreadsheetUtilities.cl);
                }
            }
            return true;
        }
        return false;
    }
    al(a) {
        if (this.y != null) {
            let b = a.h();
            let c = this.ei;
            if (Math.abs(b.x - c.x) > 16 || Math.abs(b.y - c.y) > 16) {
                this.ec();
            }
            return true;
        }
        return false;
    }
    dq(a) {
        this.ce();
    }
    dp() {
        this.ce();
    }
    dn() {
        let a = this.as;
        let b = this.at;
        let c = this.g.d;
        let d = this.f.d;
        let e = this.ep;
        let f = this.en;
        this.cc();
        if (!e.containsLocation(a, b)) {
            if (c && d) {
                return;
            }
            if (c && (b < e.y || b >= e.bottom)) {
                return;
            }
            if (d && (a < e.x || a >= e.right)) {
                return;
            }
        }
        let g = Nullable$1.toNullable(Number_$type, null);
        let h = Nullable$1.toNullable(Number_$type, null);
        if (c) {
            g = Nullable$1.toNullable(Number_$type, this.m._ei(true, b - f.y, f.height - this.m._d3, this.f.g));
        }
        if (d) {
            h = Nullable$1.toNullable(Number_$type, this.m._ei(false, a - f.x, f.width - this.m._d4, this.g.g));
        }
        let i = this.m._bc.displayOptions.unfrozenPaneSettings;
        if (nullableNotEquals(g, null)) {
            i.topPaneHeight = g.value;
        }
        if (nullableNotEquals(h, null)) {
            i.leftPaneWidth = h.value;
        }
    }
    dr() {
        this.ec();
    }
    dt(a, b, c) {
        let d = false;
        switch (b != null ? b : "") {
            case "Add":
            case "Remove":
            case "Replace":
            case "Move":
            case "Reset":
                if (this.m != null && this.m._cl(a)) {
                    d = true;
                }
                else if (getInstanceType(a) == SpreadsheetUtilities.d5) {
                    d = true;
                }
                break;
            case "":
                if (a == this.m || typeCast(SpreadsheetScrollRegion.$, a) !== null) {
                    d = true;
                }
                break;
            case "Extent":
            case "IsFrozen":
                if (typeCast(SpreadsheetScrollRegion.$, a) !== null) {
                    d = true;
                }
                break;
            case "ActiveCellPane":
            case "HasHorizontalScrollBar":
            case "HasVerticalScrollBar":
            case "IsLayoutDirty":
            case "ZoomLevel":
            case "ActiveCellInputMessage":
                if (a == this.m) {
                    d = true;
                }
                break;
            case "ActiveCellInputMessagePosition":
                if (a == this.m) {
                    this.cw();
                }
                break;
            case "HasSingleSelectionWithAllRowsAndColumns":
                if (this.ac && a == this.m) {
                    this.cy();
                }
                break;
            case "Offset":
                if (typeCast(SpreadsheetScrollInfo.$, a) !== null) {
                    d = true;
                }
                break;
            case "IsVisible":
            case "Width":
            case "ScrollBars":
                if (a == this.o) {
                    d = true;
                }
                break;
            case "ActiveCellAsRange":
                if (typeCast(SpreadsheetSelection.$, a) !== null) {
                    if (this.z) {
                        d = true;
                    }
                    if (this.m != null && this.m._fu != null) {
                        this.cw();
                    }
                }
                break;
            case "SheetManager":
                if (a == this.b) {
                    this.n = a._a8;
                }
                break;
            case "IsInEditMode":
                if (a == this.b) {
                    d = true;
                }
                break;
        }
        if (d) {
            this.cx();
        }
    }
    static ds(a, b, c, d) {
        a.dt(b, c, d);
    }
    dv(a) {
        if (a != null) {
            let b = a;
            a = null;
            this.dz(b);
        }
        return {
            p0: a
        };
    }
    d0(a, b) {
        let c = a.a;
        if (c != null) {
            let d = Enumerable.a(ScrollBarInfoMediator.$, c.e);
            for (let f = 0; f < d.length; f++) {
                let e = d[f];
                let g = e.b;
                c.h(e);
                e.k();
                if (g != null) {
                    this.dz(g);
                }
            }
            a.a = null;
            a.i = 0;
        }
        let h = this.dv(b);
        b = h.p0;
        return {
            p1: b
        };
    }
    ea(a, b, c) {
        this.cc();
        let d = this.d;
        this.d = a;
        this.as = c.x;
        this.at = c.y;
        if (!this.am(b)) {
            this.cc();
        }
        if (this.d == a) {
            this.di(d, a);
        }
    }
    eb(a, b) {
        this.ei = a;
        this.ea(2, 0, b);
    }
    ec() {
        this.ed(this.a == 0 || this.a == 2, this.a == 1 || this.a == 2, SpreadsheetUtilities.e3(this.as, this.at));
    }
    ed(a, b, c) {
        this.ce();
        if (a && !this.g.c) {
            a = false;
        }
        if (b && !this.f.c) {
            b = false;
        }
        if (a == false && b == false) {
            return;
        }
        if (a) {
            this.g.d = true;
            this.cl(true);
        }
        if (b) {
            this.f.d = true;
            this.cl(false);
        }
        let d = a ? b ? 16 : 15 : 14;
        this.ea(1, d, c);
    }
    an(a, b) {
        if (this.b._de) {
            return false;
        }
        this.ei = a;
        let c;
        let d = this.av(c, this.ar);
        c = d.p0;
        this.ar = d.p1;
        this.ea(3, 18, b);
        return true;
    }
    ee(a, b, c) {
        let d = b.e;
        let e = new List$1(IPlatformScrollBarAdapter_$type, 0);
        let f = a == null ? new Array(0) : Enumerable.a(SpreadsheetScrollRegion.$, a);
        let g = Enumerable.a(SpreadsheetScrollInfo.$, Enumerable.o(SpreadsheetScrollRegion.$, SpreadsheetScrollInfo.$, f, (h) => h._x));
        let h = new Dictionary$2(ScrollInfo.$, ScrollBarInfoMediator.$, 0);
        for (let i = d.count - 1; i >= 0; i--) {
            let j = d.item(i);
            let k = arrayIndexOf1(ScrollInfo.$, g, j.d);
            if (k >= 0 && (f[k].isFrozen == (j.b == null))) {
                h.item(j.d, j);
            }
            else {
                if (j.b != null) {
                    e.add(j.b);
                }
                j.k();
            }
            b.h(j);
        }
        for (let l = 0; l < g.length; l++) {
            let m = g[l];
            let n;
            if (!((() => { let o = h.tryGetValue(m, n); n = o.p1; return o.ret; })())) {
                n = new ExtendedScrollBarInfoMediator(m);
                n.g = () => {
                };
                if (!f[l].isFrozen) {
                    let o;
                    if (e.count > 0) {
                        let p = e.count - 1;
                        o = e._inner[p];
                        e.removeAt(p);
                    }
                    else {
                        o = this.u(c);
                    }
                    n.b = o;
                    this.ct(o, m);
                }
            }
            b.f(n);
        }
        for (let q of fromEnum(e)) {
            this.dz(q);
        }
    }
    ef(a, b, c) {
        let d = b.e;
        if (a == null) {
            if (d.count == 0) {
                return;
            }
        }
        else {
            let e = getEnumerator(a);
            let f = d.getEnumerator();
            let g = false;
            do {
                let h = e.moveNext();
                let i = f.moveNext();
                if (h != i) {
                    g = true;
                }
                else if (!h) {
                    break;
                }
                else if (e.current._x != f.current.d) {
                    g = true;
                }
                else {
                    let j = f.current.b != null;
                    let k = !e.current.isFrozen;
                    if (j != k) {
                        g = true;
                    }
                }
            } while (!g);
            if (!g) {
                return;
            }
        }
        this.ee(a, b, c);
    }
    eg($t, a, b, c, d, e) {
        let f = a.count != b.count;
        let g = EqualityComparer$1.defaultEqualityComparerValue($t);
        if (!f) {
            for (let h = 0; h < b.count; h++) {
                if (!g.equalsC(b._inner[h].a, a.item(h))) {
                    f = true;
                    break;
                }
            }
        }
        if (f) {
            let i = Enumerable.z(SpreadsheetAreaLayoutManager_SheetLayerInfo$1.$.specialize($t), b);
            b.clear();
            for (let j = 0; j < a.count; j++) {
                let k = i.i((l) => g.equalsC(l.a, a.item(j)));
                b.add(null);
                if (k >= 0) {
                    b._inner[j] = i._inner[k];
                    i.removeAt(k);
                }
            }
            for (let l = 0; l < i.count; l++) {
                let m = i._inner[l];
                if (null != d) {
                    d(m);
                }
                this.dl($t, m.b);
            }
            for (let n = 0; n < a.count; n++) {
                if (b._inner[n] == null) {
                    let o = e(a.item(n));
                    b._inner[n] = new SpreadsheetAreaLayoutManager_SheetLayerInfo$1($t, a.item(n), o);
                    if (null != c) {
                        c(b._inner[n]);
                    }
                }
            }
        }
    }
    eh() {
        this.n = this.b != null ? this.b._a8 : null;
    }
}
SpreadsheetAreaLayoutManager.$t = markType(SpreadsheetAreaLayoutManager, 'SpreadsheetAreaLayoutManager');
/**
 * @hidden
 */
export class VisualElementSpreadsheetAreaLayoutManager extends SpreadsheetAreaLayoutManager {
    constructor(a) {
        super();
        this.ez = null;
        this.e2 = false;
        this.e3 = false;
        this.ez = a;
    }
    ey(a) {
        let b = a._aw ? this.i : this.h;
        for (let c of fromEnum(b.f)) {
            if (c.a == a) {
                return c.b.e;
            }
        }
        return null;
    }
    ex(a) {
        for (let b of fromEnum(this.ap)) {
            if (b.a == a) {
                return b.b.e;
            }
        }
        return null;
    }
    dg(a) {
        super.dg(a);
        this.e3 = true;
    }
    df(a) {
        if (!this.e3) {
            this.ew(a);
        }
        super.df(a);
        this.e2 = true;
    }
    cw() {
        this.ez.q = true;
        this.e2 = false;
        let a = this.c;
        if (a != null) {
            a.scheduleArrange();
        }
    }
    cx() {
        this.ez.q = true;
        this.e3 = false;
        this.e2 = false;
        let a = this.c;
        if (a != null) {
            a.scheduleArrange();
        }
    }
    e4() {
        this.cx();
    }
}
VisualElementSpreadsheetAreaLayoutManager.$t = markType(VisualElementSpreadsheetAreaLayoutManager, 'VisualElementSpreadsheetAreaLayoutManager', SpreadsheetAreaLayoutManager.$);
/**
 * @hidden
 */
export class JsSpreadsheetAreaLayoutManager extends VisualElementSpreadsheetAreaLayoutManager {
    constructor(a) {
        super(a);
        this.fc = null;
        this.fn = new Size(0);
        this.fb = null;
        this.fd = null;
        this.fh = null;
        this.ff = null;
        this.fe = null;
        this.e6 = null;
        this.e5 = null;
        this.fg = null;
        this.fi = null;
        this.e9 = null;
        this.e7 = null;
        this.e8 = null;
    }
    fa(a) {
        if (a != null) {
            a.ab = true;
        }
        return null;
    }
    cf() {
        this.fc = new SpreadsheetInplaceEditorElement(this.ez);
        this.fc.bu = 1000;
        let a = this.fc;
        a.cellValueChanged = delegateCombine(a.cellValueChanged, runOn(this, this.fl));
    }
    fl(a, b) {
        this.c._ai.ar();
        this.cx();
    }
    dw() {
        this.fc = this.fa(this.fc);
    }
    cz(a) {
        this.fn.width = a.width;
        this.fn.height = a.height;
    }
    bv(a, b) {
        let c = this.be;
        let d = a.copy();
        d.width *= c;
        d.height *= c;
        if (b.containsRect(d)) {
            this.fc.am(d);
            this.fc.de = null;
        }
        else {
            if (b.intersectsWith(d)) {
                this.fc.am(d);
                d.intersect(b);
                this.fc.de = d;
            }
            else {
                if (d.bottom < b.y) {
                    d.y = b.y;
                    d.height = 0;
                }
                if (d.y > b.bottom) {
                    d.y = b.bottom;
                    d.height = 0;
                }
                if (d.right < b.x) {
                    d.x = b.x;
                    d.width = 0;
                }
                if (d.x > b.right) {
                    d.x = b.right;
                    d.width = 0;
                }
                this.fc.am(d);
                this.fc.de = Rect.empty;
            }
        }
    }
    ay() {
        let a = this.c._ai.l;
        if (a == null) {
            return 0;
        }
        let b = this.be;
        let c = this.fn.width;
        let d = truncate((Math.ceil(c * b)));
        let e = this.c._ay;
        let f = e.c9;
        let g = e.dg.e + e.dg.b;
        let h = this.c._a0.g(f, e.ci, e.dg, b, d);
        h -= g;
        h /= b;
        h += g;
        return h;
    }
    cg() {
        this.fb = new SpreadsheetInplaceBackgroundElement(this.ez);
        this.fb.bu = 900;
    }
    dx() {
        this.fb = this.fa(this.fb);
    }
    c0(a) {
    }
    bw(a, b) {
        let c = a.copy();
        this.fb.am(c);
        if (b.containsRect(c)) {
            this.fb.cn = null;
        }
        else {
            c.intersect(b);
            this.fb.cn = c;
        }
    }
    get_e0() {
        return this.fc;
    }
    get e0() {
        return this.get_e0();
    }
    ch() {
        this.fd = new SpreadsheetInputMessageElement(this.ez);
        this.fd.bu = 800;
        this.fd.ac = false;
    }
    dy() {
        this.fd = this.fa(this.fd);
    }
    bz(a) {
        this.fd.am(a);
    }
    c2(a) {
    }
    cr() {
        this.fd.ac = false;
    }
    d9(a, b) {
        this.fd.cm(b, a);
        this.fd.ac = true;
    }
    get_a8() {
        return this.fd.cj;
    }
    get a8() {
        return this.get_a8();
    }
    get_a7() {
        return this.fd.ci;
    }
    get a7() {
        return this.get_a7();
    }
    eq($t, a) {
        let b = a;
        let c = b.e;
        return new Rect(0, c.ax, c.a2, c.a3, c.av);
    }
    q(a) {
        let b = a._aw ? "SpreadsheetRowHeaderContainer" : "SpreadsheetColumnHeaderContainer";
        let c = this.ez.c(b);
        let d = null;
        if (c != null) {
            c.ab = false;
            d = c.b(0);
            this.fm(SpreadsheetScrollRegion.$, d);
        }
        else {
            c = new SpreadsheetLayerContainerElement$1(SpreadsheetScrollRegion.$, this.ez, b);
            c.bu = 200;
        }
        if (d == null) {
            d = new RendererLayerVisualElement$2(SpreadsheetScrollRegion.$, ISpreadsheetGraphics_$type, c, "SpreadsheetRenderer");
        }
        this.fj(SpreadsheetScrollRegion.$, d, new SpreadsheetHeaderBackgroundLayer(a, new RendererLayerVisualElementView$1(SpreadsheetScrollRegion.$, d)));
        this.fj(SpreadsheetScrollRegion.$, d, new SpreadsheetHeaderGridlineLayer(a, new RendererLayerVisualElementView$1(SpreadsheetScrollRegion.$, d)));
        this.fj(SpreadsheetScrollRegion.$, d, new SpreadsheetHeaderContentLayer(a, new RendererLayerVisualElementView$1(SpreadsheetScrollRegion.$, d)));
        this.fj(SpreadsheetScrollRegion.$, d, new SpreadsheetHeaderSelectionLayer(a, new RendererLayerVisualElementView$1(SpreadsheetScrollRegion.$, d)));
        let e = new ScrollRegionLayerContainer(c, a);
        c.cg = e.d;
        return e;
    }
    fm($t, a) {
        let b = new List$1(RendererElementLayer$2.$.specialize($t, ISpreadsheetGraphics_$type), 1, a.cp());
        for (let c of fromEnum(b)) {
            a.cs(c);
            c.dispose();
            c._d.detach(c);
        }
    }
    fj($t, a, b) {
        b._d.attach(b);
        a.cr(b);
    }
    r(a) {
        let b = this.ez.c("SpreadsheetPaneContainer");
        let c = null;
        let d = null;
        let e = null;
        let f = null;
        let g = null;
        let h = null;
        if (b != null) {
            b.ab = false;
            c = b.b(0);
            d = b.b(1).cf;
            e = b.b(2);
            f = b.b(3).cf;
            g = b.b(4).cf;
            h = b.b(5).cf;
            this.fm(SpreadsheetPane.$, c);
            d.d();
            this.fm(SpreadsheetPane.$, e);
            f.d();
            g.d();
            h.d();
        }
        else {
            b = new SpreadsheetLayerContainerElement$1(SpreadsheetPane.$, this.ez, "SpreadsheetPaneContainer");
            c = new RendererLayerVisualElement$2(SpreadsheetPane.$, ISpreadsheetGraphics_$type, b, "SpreadsheetRenderer");
            d = new SpreadsheetCellValueLayerElement(b).cf;
            e = new RendererLayerVisualElement$2(SpreadsheetPane.$, ISpreadsheetGraphics_$type, b, "SpreadsheetRenderer");
            f = new SpreadsheetSingleLayerElement(b, "Layer").cf;
            g = new SpreadsheetDrawingLayerElement(b).cf;
            h = new SpreadsheetDrawingLayerElement(b).cf;
        }
        this.fj(SpreadsheetPane.$, c, new SpreadsheetPaneCellBackgroundLayer(a, new RendererLayerVisualElementView$1(SpreadsheetPane.$, c)));
        this.fj(SpreadsheetPane.$, c, new SpreadsheetPaneGridlineLayer(a, new RendererLayerVisualElementView$1(SpreadsheetPane.$, c)));
        d.attach(new SpreadsheetPaneCellValueLayer(a, d));
        this.fj(SpreadsheetPane.$, e, new SpreadsheetPaneCellBorderLayer(a, new RendererLayerVisualElementView$1(SpreadsheetPane.$, e)));
        this.fj(SpreadsheetPane.$, e, new SpreadsheetPaneButtonLayer(a, new RendererLayerVisualElementView$1(SpreadsheetPane.$, e)));
        this.fj(SpreadsheetPane.$, e, new SpreadsheetPaneSelectionLayer(a, new RendererLayerVisualElementView$1(SpreadsheetPane.$, e)));
        f.attach(new SpreadsheetPaneShapeLayer(a, f));
        g.attach(new SpreadsheetPaneInvalidDataLayer(a, g));
        h.attach(new SpreadsheetPaneInteractionOverlayLayer(a, h));
        let i = new PaneLayerContainer(b, a);
        b.cg = i.d;
        return i;
    }
    dl($t, a) {
        let b = a;
        this.fa(b.e);
    }
    c3($t, a, b) {
        let c = a;
        c.f(b);
    }
    b0($t, a, b) {
        let c = a;
        c.e.am(b);
    }
    u(a) {
        let b = new JsScrollBarAdapter(new JsScrollBar(a, this.ez));
        let c = b.a.a;
        c.bu = 300;
        this.fk(c);
        return b;
    }
    fk(a) {
        let b = a.cl == 0;
        let c = this.c._a1;
        a.h = b ? c.d : c.e;
        if (b) {
            a.cg.a3 = c.q;
            a.cf.a3 = c.p;
        }
        else {
            a.cg.av = c.ak;
            a.cf.av = c.aj;
        }
    }
    dz(a) {
        let b = a;
        b.d();
    }
    ct(a, b) {
        a.setIsEnabled(b != null);
    }
    b2(a, b) {
        let c = a;
        c.a.a.am(b);
    }
    c5(a, b) {
    }
    a0(a) {
        return this.c._a1.s;
    }
    az(a) {
        return this.c._a1.r;
    }
    ci() {
        this.fh = new SpreadsheetSelectAllButtonElement(this.ez);
        this.fh.bu = 100;
    }
    d1() {
        this.fh = this.fa(this.fh);
    }
    b4(a) {
        this.fh.am(a);
    }
    c7(a) {
        this.cy();
    }
    cy() {
        if (this.fh != null) {
            this.fh.cg = this.n._cd;
        }
    }
    cu(a, b, c, d) {
        let e = a ? this.ff : this.fe;
        e.u = b;
    }
    cj(a) {
        let b;
        if (a) {
            this.ff = b = new SpreadsheetPaneSplitterElement(this.ez, 0);
        }
        else {
            this.fe = b = new SpreadsheetPaneSplitterElement(this.ez, 1);
        }
        b.bu = 400;
    }
    d2(a) {
        if (a) {
            this.ff = this.fa(this.ff);
        }
        else {
            this.fe = this.fa(this.fe);
        }
    }
    b5(a, b) {
        let c = a ? this.ff : this.fe;
        c.am(b);
    }
    c8(a, b) {
    }
    a1(a) {
        let b = a ? this.ff : this.fe;
        let c = this.c._a1;
        return b.u ? a ? c.t : c.v : a ? c.u : c.w;
    }
    cl(a) {
        let b = new VisualElement(this.ez, a ? "RowSplitterPreview" : "ColSplitterPreview");
        b.bu = 600;
        b.w = false;
        if (a) {
            this.e6 = b;
        }
        else {
            this.e5 = b;
        }
    }
    d4(a) {
        if (a) {
            this.e6 = this.fa(this.e6);
        }
        else {
            this.e5 = this.fa(this.e5);
        }
    }
    b7(a, b) {
        let c = a ? this.e6 : this.e5;
        c.am(b);
    }
    da(a, b) {
    }
    cv(a) {
    }
    ck() {
        this.fg = new SpreadsheetPaneSplitterElement(this.ez, 2);
        this.fg.bu = 500;
    }
    d3() {
        this.fg = this.fa(this.fg);
    }
    b6(a) {
        this.fg.am(a);
    }
    c9(a) {
    }
    co() {
        this.fi = new SpreadsheetTabItemAreaElement(this.ez, "TabItemArea");
        this.fi.cm.cf.h = this.c._bf;
        this.fi.ch.ac = this.c.allowAddWorksheet;
        this.fi.bu = 330;
        this.fi.cq();
    }
    d7() {
        this.fi.cm.cf.h = null;
        this.fi = this.fa(this.fi);
    }
    ca(a) {
        this.fi.al(a.x, a.y, a.width, a.height);
    }
    dd(a) {
        this.fi.cm.cf.a8();
    }
    get_ba() {
        let a = this.c._a1.y;
        if (this.fi.co > a) {
            a = this.fi.co;
        }
        return a;
    }
    get ba() {
        return this.get_ba();
    }
    get_bd() {
        let a = this.fi.cp;
        if (!this.fi.ch.ac) {
            a -= this.fi.ch.a3;
        }
        return a + this.fi.cm.cf.bb;
    }
    get bd() {
        return this.get_bd();
    }
    get_e1() {
        return this.fi;
    }
    get e1() {
        return this.get_e1();
    }
    cp() {
        this.e9 = new SpreadsheetTabAreaSplitterElement(this.ez);
        this.e9.bu = 370;
    }
    d8() {
        this.e9 = this.fa(this.e9);
    }
    cb(a) {
        this.e9.am(a);
    }
    de(a) {
    }
    get_bb() {
        return this.c._a1.z;
    }
    get bb() {
        return this.get_bb();
    }
    get_bc() {
        return this.c._a1.aa;
    }
    get bc() {
        return this.get_bc();
    }
    cm() {
        this.e7 = new VisualElement(this.ez, "TabAreaBackground");
        this.e7.bu = 225;
        this.e7.w = false;
    }
    d5() {
        this.e7 = this.fa(this.e7);
    }
    b8(a) {
        this.e7.am(a);
    }
    db(a) {
    }
    cn() {
        this.e8 = new VisualElement(this.ez, "TabAreaBorder");
        this.e8.bu = 250;
        this.e8.w = false;
    }
    d6() {
        this.e8 = this.fa(this.e8);
    }
    b9(a) {
        this.e8.am(a);
    }
    dc(a) {
    }
    get_a9() {
        return this.c._a1.x;
    }
    get a9() {
        return this.get_a9();
    }
    du(a, b) {
        this.cx();
        this.cw();
    }
    dm(a, b) {
        this.cx();
        this.cw();
    }
    cd() {
        this.ez.bw = null;
        this.ez.d().dk(this.ez);
    }
    di(a, b) {
        super.di(a, b);
        switch (a) {
            case 2:
                if (this.fd != null) {
                    this.fd.s = false;
                }
                break;
            case 3:
                if (this.e9 != null) {
                    this.e9.s = false;
                }
                break;
            case 1:
                if (this.ff != null) {
                    this.ff.s = false;
                }
                if (this.fe != null) {
                    this.fe.s = false;
                }
                if (this.fg != null) {
                    this.fg.s = false;
                }
                break;
        }
        switch (b) {
            case 2:
                if (this.fd != null) {
                    this.fd.s = true;
                }
                break;
            case 3:
                if (this.e9 != null) {
                    this.e9.s = true;
                }
                break;
            case 1:
                if (this.e6 != null) {
                    this.ff.s = true;
                }
                if (this.e5 != null) {
                    this.fe.s = true;
                }
                if (this.e6 != null && this.e5 != null) {
                    this.fg.s = true;
                }
                break;
        }
    }
    am(a) {
        if (this.ez.d().cq(this.ez)) {
            this.ez.bw = SpreadsheetCursorHelper.a(a);
            return true;
        }
        return false;
    }
    ek(a, b) {
        let c = a.b.e;
        return { $type: Point_$type, x: b.x - (c.ax), y: b.y - (c.a2) };
    }
    el(a, b) {
        let c = a.b.e;
        return { $type: Point_$type, x: b.x - (c.ax), y: b.y - (c.a2) };
    }
    es(a, b) {
        let c = a.b.e;
        return new Rect(0, b.x + (c.ax), b.y + (c.a2), b.width, b.height);
    }
    em(a, b) {
        let c = a.b.e;
        return { $type: Point_$type, x: b.x + (c.ax), y: b.y + (c.a2) };
    }
    ej(a) {
        return { $type: Point_$type, x: a.x - this.ez.ax, y: a.y - this.ez.a2 };
    }
    dt(a, b, c) {
        super.dt(a, b, c);
        switch (b) {
            case "AllowAddWorksheet":
                if (this.fi != null) {
                    this.fi.ch.ac = this.c.allowAddWorksheet;
                }
                break;
            case "IsInEditMode":
                if (a == this.c) {
                    if (this.fc != null) {
                        this.fc.c3 = this.c.isInEditMode;
                        this.fc.cw = true;
                    }
                    if (this.fb != null) {
                        this.fb.cg = this.c._ai.x;
                    }
                }
                break;
        }
    }
    e4() {
        super.e4();
        if (this.fi != null) {
            this.fi.cm.cf.bd();
            this.fi.cm.cf.aj();
            this.fi.cq();
        }
        this.cq((a) => {
            let b = a.a.a;
            this.fk(b);
            b.t = true;
        });
    }
}
JsSpreadsheetAreaLayoutManager.$t = markType(JsSpreadsheetAreaLayoutManager, 'JsSpreadsheetAreaLayoutManager', VisualElementSpreadsheetAreaLayoutManager.$);
/**
 * @hidden
 */
export class SpreadsheetElementLayerContainer$1 extends Base {
    constructor($t, a, b) {
        super();
        this.$t = null;
        this.e = null;
        this.b = null;
        this.d = null;
        this.a = null;
        this.$t = $t;
        this.$type = this.$type.specialize(this.$t);
        CoreUtilities.y(a);
        CoreUtilities.y(b);
        this.e = a;
        this.b = b;
        this.d = this.c();
    }
    f(a) {
        for (let b = 0, c = this.e.a9; b < c; b++) {
            let d = typeCast(LayerVisualElement.$, this.e.b(b));
            if (d != null) {
                d.cg(a);
            }
        }
    }
    focusControlIfNeeded() {
        let a = document.activeElement;
        let b = typeCast(SpreadsheetVisualElement.$, this.e.d());
        if (b != null && (a == null || b.dq._v.hasKeyboardFocusWithin)) {
            b.dq._v.focus();
        }
    }
    getRelativeSpreadsheetControlBounds() {
        return rectToLiteral(this._getRelativeSpreadsheetControlBounds$i.apply(this, arguments));
    }
    _getRelativeSpreadsheetControlBounds$i() {
        let a = this.e.d();
        return new Rect(0, a.ax - this.e.ax, a.a2 - this.e.a2, a.a3, a.av);
    }
    getLayerContainerSize() {
        return sizeToLiteral(this._getLayerContainerSize$i.apply(this, arguments));
    }
    _getLayerContainerSize$i() {
        return new Size(1, this.e.a3, this.e.av);
    }
    hideToolTip() {
        this.e.b0();
    }
    isMouseOver() {
        return this.e.y;
    }
    isToolTipAllowed() {
        return true;
    }
    onCursorChanged(a) {
        this.e.bw = SpreadsheetCursorHelper.a(a);
    }
    showToolTip(a) {
        this.e.ca(a.b.toString(), a.d.x, a.d.y, a.c);
    }
}
SpreadsheetElementLayerContainer$1.$t = markType(SpreadsheetElementLayerContainer$1, 'SpreadsheetElementLayerContainer$1', Base.$, [ISpreadsheetInteractionManagerOwner_$type, IElementLayerContainer_$type]);
/**
 * @hidden
 */
export class PaneLayerContainer extends SpreadsheetElementLayerContainer$1 {
    constructor(a, b) {
        super(SpreadsheetPane.$, a, b);
    }
    c() {
        return new SpreadsheetPaneInteractionManager(this.b, this);
    }
}
PaneLayerContainer.$t = markType(PaneLayerContainer, 'PaneLayerContainer', SpreadsheetElementLayerContainer$1.$.specialize(SpreadsheetPane.$));
/**
 * @hidden
 */
export class SpreadsheetRendererElementLayer$1 extends RendererElementLayer$2 {
    constructor($tViewModel, a, b, c) {
        super($tViewModel, ISpreadsheetGraphics_$type, a, b, c);
        this.$tViewModel = null;
        this.$tViewModel = $tViewModel;
        this.$type = this.$type.specialize(this.$tViewModel);
    }
}
SpreadsheetRendererElementLayer$1.$t = markType(SpreadsheetRendererElementLayer$1, 'SpreadsheetRendererElementLayer$1', RendererElementLayer$2.$.specialize(0, ISpreadsheetGraphics_$type));
/**
 * Base class for the object that represents a row or column of [[SpreadsheetPane]] instances.
 */
export class SpreadsheetScrollRegion extends PropertyChangeNotifierExtended {
    constructor() {
        super();
        this._w = null;
        this._cd = 0;
        this._ca = 0;
        this._bb = 0;
        this._bc = 0;
        this._a3 = 0;
        this._ao = false;
        this._a6 = 0;
        this._bd = 0;
        this._k = null;
        this._j = null;
        this._p = null;
        this._q = null;
        this._u = 0;
        this._by = null;
        this._bz = null;
        this._b1 = null;
        this._b2 = null;
        this._b3 = null;
        this._be = 0;
        this._a5 = 0;
        this._a4 = 0;
        this._a9 = 1;
        this._ba = 1;
        this._b0 = null;
        this._ae = null;
        this._aa = null;
        this._y = null;
        this._n = null;
        this._cc = 0;
        this._cb = 0;
        this._ac = null;
        this._ck = Nullable$1.toNullable(Number_$type, null);
        this._g = null;
        this._h = null;
        this._cl = Nullable$1.toNullable(Number_$type, null);
        this._a7 = 0;
        this._cn = Nullable$1.toNullable(Number_$type, null);
        this._cm = Nullable$1.toNullable(Number_$type, null);
        this._an = true;
        this._ah = 0;
        /**
         * @hidden
         */
        this._bg = 0;
        /**
         * @hidden
         */
        this._bh = 0;
        this._a8 = 0;
        /**
         * @hidden
         */
        this._ak = null;
        /**
         * @hidden
         */
        this._am = null;
        /**
         * @hidden
         */
        this._al = null;
        let a = PropertyChangeListenerList.e(SpreadsheetScrollInfo.$, this._w, new SpreadsheetScrollInfo(this), this, false);
        this._w = a.p0;
        let b = PropertyChangeListenerList.e(ObservableCollectionExtended$1.$.specialize(WorksheetItemPosition.$), this._k, new ObservableCollectionExtended$1(WorksheetItemPosition.$, 2, false, false), this, false);
        this._k = b.p0;
        this._l = this._k;
    }
    /**
     * @hidden
     */
    e(sender, property, extraInfo) {
        switch (property != null ? property : "") {
            case "":
            case "Offset":
                if (sender == this._w) {
                    this._g = this._h = null;
                }
                break;
            case "Add":
            case "Remove":
            case "Replace":
            case "Move":
            case "Reset":
                if (sender == this._k) {
                    this._g = this._h = null;
                }
                break;
        }
        super.e(sender, property, extraInfo);
    }
    /**
     * Returns the actual displayed width or height of the area.
     */
    get actualExtent() {
        return this._a3;
    }
    /**
     * Returns the actual displayed width or height of the area.
     */
    set actualExtent(a) {
        if (this._a3 != a) {
            this._a3 = a;
            this.a("ActualExtent");
        }
    }
    /**
     * Returns the index of the last visible item including partially visible.
     */
    get endIndex() {
        return this._ca;
    }
    /**
     * Returns the index of the last visible item including partially visible.
     */
    set endIndex(a) {
        if (this._ca != a) {
            this._ca = a;
            this.a("EndIndex");
        }
    }
    /**
     * Returns a boolean indicating if the area supports scrolling.
     */
    get isFrozen() {
        return this._ao;
    }
    /**
     * Returns a boolean indicating if the area supports scrolling.
     */
    set isFrozen(a) {
        if (this._ao != a) {
            this._ao = a;
            this.a("IsFrozen");
        }
    }
    /**
     * Returns the index of the first visible item.
     */
    get startIndex() {
        return this._cd;
    }
    /**
     * Returns the index of the first visible item.
     */
    set startIndex(a) {
        if (this._cd != a) {
            this._cd = a;
            this.a("StartIndex");
        }
    }
    /**
     * @hidden
     */
    get _ab() {
        return this._aa;
    }
    /**
     * @hidden
     */
    set _ab(a) {
        if (a != this._aa) {
            let b = this._aa;
            let c = PropertyChangeListenerList.e(SpreadsheetSelection.$, this._aa, a, this, true);
            this._aa = c.p0;
            this.a("ActiveSelection");
        }
    }
    /**
     * @hidden
     */
    get _l() {
        return this._j;
    }
    /**
     * @hidden
     */
    set _l(a) {
        if (this._j != a) {
            if (this._j != this._m && this._j != null) {
                SpreadsheetUtilities.ec(this._j, this);
            }
            this._j = a;
            if (a != null && a != this._m) {
                SpreadsheetUtilities.d6(this._j, this, true);
            }
            this.a("ActualItemPositions");
        }
    }
    /**
     * @hidden
     */
    get _z() {
        return this._y;
    }
    /**
     * @hidden
     */
    set _z(a) {
        if (this._y != a) {
            this._y = a;
            this.a("AdjacentRowColumn");
        }
    }
    /**
     * @hidden
     */
    get _ap() {
        return this._an;
    }
    /**
     * @hidden
     */
    set _ap(a) {
        if (this._an != a) {
            this._an = a;
            this.a("AreHeadersVisible");
        }
    }
    /**
     * @hidden
     */
    get _b4() {
        return this._by;
    }
    /**
     * @hidden
     */
    set _b4(a) {
        this._by = a;
    }
    /**
     * @hidden
     */
    get _b5() {
        return this._bz;
    }
    /**
     * @hidden
     */
    set _b5(a) {
        this._bz = a;
    }
    /**
     * @hidden
     */
    get _r() {
        return this._p;
    }
    /**
     * @hidden
     */
    set _r(a) {
        if (this._p != a) {
            this._p = a;
            this.a("CurrentScrollPageCache");
        }
    }
    /**
     * @hidden
     */
    get _bi() {
        return this._a4;
    }
    /**
     * @hidden
     */
    set _bi(a) {
        if (this._a4 != a) {
            this._a4 = a;
            this.a("DpiX");
        }
    }
    /**
     * @hidden
     */
    get _bj() {
        return this._a5;
    }
    /**
     * @hidden
     */
    set _bj(a) {
        if (this._a5 != a) {
            this._a5 = a;
            this.a("DpiY");
        }
    }
    /**
     * @hidden
     */
    get _bk() {
        return this._a6;
    }
    /**
     * @hidden
     */
    set _bk(a) {
        this._a6 = a;
    }
    /**
     * @hidden
     */
    get _b6() {
        return this._b0;
    }
    /**
     * @hidden
     */
    set _b6(a) {
        if (this._b0 != a) {
            this._b0 = a;
            this.a("GetHeaderText");
        }
    }
    /**
     * @hidden
     */
    get _b7() {
        return this._b1;
    }
    /**
     * @hidden
     */
    set _b7(a) {
        this._b1 = a;
    }
    /**
     * @hidden
     */
    get _b8() {
        return this._b2;
    }
    /**
     * @hidden
     */
    set _b8(a) {
        this._b2 = a;
    }
    /**
     * @hidden
     */
    get _b9() {
        return this._b3;
    }
    /**
     * @hidden
     */
    set _b9(a) {
        this._b3 = a;
    }
    /**
     * @hidden
     */
    get _af() {
        return this._ae;
    }
    /**
     * @hidden
     */
    set _af(a) {
        if (this._ae != a) {
            this._ae = a;
            this.a("HeaderFont");
        }
    }
    /**
     * @hidden
     */
    get _co() {
        return this._ck;
    }
    /**
     * @hidden
     */
    set _co(a) {
        if (nullableNotEquals(this._ck, a)) {
            this._ck = a;
            this.a("HotTrackedIndex");
        }
    }
    /**
     * @hidden
     */
    get _cp() {
        return this._cl;
    }
    /**
     * @hidden
     */
    set _cp(a) {
        if (nullableNotEquals(a, this._cl)) {
            this._cl = a;
            if (nullableEquals(this._cl, null)) {
                this._l = this._m;
            }
            else {
                let b = new ObservableCollectionExtended$1(WorksheetItemPosition.$, 0);
                b._a3(this._m);
                this._l = b;
            }
            this.a("ItemBeingResized");
        }
    }
    /**
     * @hidden
     */
    get _bp() {
        return this._a7;
    }
    /**
     * @hidden
     */
    set _bp(a) {
        if (this._a7 != a) {
            this._a7 = a;
            this.a("ItemBeingResizedRelativeEdge");
        }
    }
    /**
     * @hidden
     */
    get _m() {
        return this._k;
    }
    /**
     * @hidden
     */
    get _ch() {
        return this._cb;
    }
    /**
     * @hidden
     */
    set _ch(a) {
        if (this._cb != a) {
            this._cb = a;
            this.a("MaxItemExtent");
        }
    }
    /**
     * @hidden
     */
    get _bq() {
        return this._a8;
    }
    /**
     * @hidden
     */
    set _bq(a) {
        if (this._a8 != a) {
            this._a8 = a;
            this.a("MaxScrollRangeExtent");
        }
    }
    /**
     * @hidden
     */
    get _ci() {
        return this._cc;
    }
    /**
     * @hidden
     */
    set _ci(a) {
        if (this._cc != a) {
            this._cc = a;
            this.a("MaxItemIndex");
        }
    }
    /**
     * @hidden
     */
    get _s() {
        return this._q;
    }
    /**
     * @hidden
     */
    set _s(a) {
        if (this._q != a) {
            this._q = a;
            this.a("MaxScrollPageCache");
        }
    }
    /**
     * @hidden
     */
    get _cq() {
        return this._cm;
    }
    /**
     * @hidden
     */
    set _cq(a) {
        if (nullableNotEquals(this._cm, a)) {
            this._cm = a;
            this.a("NextVisibleItemIndex");
        }
    }
    /**
     * @hidden
     */
    get _br() {
        return this._a9;
    }
    /**
     * @hidden
     */
    set _br(a) {
        if (this._a9 != a) {
            this._a9 = a;
            this.a("PixelSizeX");
        }
    }
    /**
     * @hidden
     */
    get _bs() {
        return this._ba;
    }
    /**
     * @hidden
     */
    set _bs(a) {
        if (this._ba != a) {
            this._ba = a;
            this.a("PixelSizeY");
        }
    }
    /**
     * @hidden
     */
    get _bt() {
        return this._bb;
    }
    /**
     * @hidden
     */
    set _bt(a) {
        if (this._bb != a) {
            this._bb = a;
            this.a("PreferredExtent");
            this.a("PreferredExtentResolved");
        }
    }
    /**
     * @hidden
     */
    get _bu() {
        return Math.max(this._bb - this._bc, 0);
    }
    /**
     * @hidden
     */
    get _cr() {
        return this._cn;
    }
    /**
     * @hidden
     */
    set _cr(a) {
        if (nullableNotEquals(this._cn, a)) {
            this._cn = a;
            this.a("PreviousVisibleItemIndex");
        }
    }
    /**
     * @hidden
     */
    get _bv() {
        return this._bc;
    }
    /**
     * @hidden
     */
    set _bv(a) {
        if (this._bc != a) {
            this._bc = a;
            this.a("ReservedExtent");
            this.a("PreferredExtentResolved");
        }
    }
    /**
     * @hidden
     */
    get _ad() {
        return this._ac;
    }
    /**
     * @hidden
     */
    set _ad(a) {
        if (a != this._ac) {
            let b = this._ac;
            let c = PropertyChangeListenerList.e(ISpreadsheetResourceProvider_$type, this._ac, a, this, true);
            this._ac = c.p0;
            this.a("ResourceProvider");
        }
    }
    /**
     * @hidden
     */
    get _x() {
        return this._w;
    }
    /**
     * @hidden
     */
    get _ai() {
        return this._ah;
    }
    /**
     * @hidden
     */
    set _ai(a) {
        if (this._ah != a) {
            this._ah = a;
            this.a("SelectionMode");
        }
    }
    /**
     * @hidden
     */
    get _o() {
        return this._n;
    }
    /**
     * @hidden
     */
    set _o(a) {
        this._n = a;
    }
    /**
     * @hidden
     */
    get _v() {
        return this._u;
    }
    /**
     * @hidden
     */
    set _v(a) {
        if (this._u != a) {
            this._u = a;
            this.a("SizingMode");
        }
    }
    /**
     * @hidden
     */
    get _bw() {
        return this._bd;
    }
    /**
     * @hidden
     */
    set _bw(a) {
        this._bd = a;
    }
    /**
     * @hidden
     */
    get _bx() {
        return this._be;
    }
    /**
     * @hidden
     */
    set _bx(a) {
        if (a != this._be) {
            this._be = a;
            this._g = null;
            this.a("ZoomLevel");
        }
    }
    /**
     * @hidden
     */
    static _aq(a, b) {
        let c = null;
        if (b != null && b.count > 0) {
            c = (d, e) => {
                if (d._h < e) {
                    return -1;
                }
                else if (d._i > e) {
                    return 1;
                }
                else {
                    return 0;
                }
            };
            return CoreUtilities.n(IntRange.$, Number_$type, b, c, a) >= 0;
        }
        return false;
    }
    /**
     * @hidden
     */
    _t(a) {
        let b = nullableEquals(a, this._ck);
        if (this._ar()) {
            if (this._as(a)) {
                if (this._ax(a)) {
                    return b ? 4 : 2;
                }
                else if (!b) {
                    return 1;
                }
            }
        }
        if (b) {
            return 3;
        }
        return 0;
    }
    /**
     * @hidden
     */
    _ag(a) {
        let b = new WorksheetItemPosition();
        let c = this._az(a, b);
        b = c.p1;
        return b;
    }
    /**
     * @hidden
     */
    _cf(a) {
        if (a >= this.startIndex && a <= this.endIndex) {
            for (let b = 0, c = this._k.count; b < c; b++) {
                if (this._k._inner[b]._j == a) {
                    return b;
                }
            }
        }
        return -1;
    }
    /**
     * @hidden
     */
    _aj(a) {
        let b = this.startIndex;
        let c = this.endIndex;
        if (a) {
            if (this._bk > 0 && c > b) {
                c--;
            }
            if (this._bw > 0 && b < c) {
                b++;
            }
        }
        return new IntRange(1, b, c);
    }
    /**
     * @hidden
     */
    _a1(a) {
        if (a > this._ci) {
            return boxArray$1(new Array(0));
        }
        let b = this.actualExtent / this._bx;
        let c = this._b5(b);
        return this._b3(a, c);
    }
    /**
     * @hidden
     */
    _bl() {
        return this._b4(truncate(MathUtilities.f(this._w._ac)));
    }
    /**
     * @hidden
     */
    _i(a, b = false) {
        let c = b ? this._j : this._k;
        let d = a ? this._g : this._h;
        if (c != this._k) {
            d = null;
        }
        if (d == null) {
            let e = c.count;
            if (e == 0) {
                d = new Array(0);
            }
            else {
                let f = a ? this._bx : 1;
                d = new Array(e + 1);
                for (let g = 0; g < e; g++) {
                    d[g] = this._bm(c._inner[g], true) * f;
                }
                d[e] = this._bm(c._inner[e - 1], false) * f;
                if (c == this._k) {
                    if (a) {
                        this._g = d;
                    }
                    else {
                        this._h = d;
                    }
                }
            }
        }
        return d;
    }
    /**
     * @hidden
     */
    _bm(a, b, c = true) {
        let d = a._m;
        if (!b) {
            d += a._i;
        }
        if (c) {
            d -= truncate(MathUtilities.f(this._w._ac));
        }
        return this._b4(d);
    }
    /**
     * @hidden
     */
    _bn(a, b, c = true) {
        let d = this._m.count;
        let e = this._m;
        let f = new WorksheetItemPosition();
        if (d == 0 || a < e._inner[0]._j || a > e._inner[d - 1]._j) {
            f = this._b7(a);
        }
        else {
            let g = CoreUtilities.n(WorksheetItemPosition.$, Number_$type, e, (h, i) => Base.compareSimple(h._j, i), a);
            if (g < 0) {
                b = true;
                g = ~g;
            }
            f = e._inner[g];
        }
        return this._bm(f, b, c);
    }
    /**
     * @hidden
     */
    _bo(a, b) {
        if (b <= 0) {
            return this._bn(a, true);
        }
        else if (b >= 100) {
            return this._bn(a, false);
        }
        else {
            let c = this._bn(a, true);
            let d = this._bn(a, false);
            return c + (d - c) * (b / 100);
        }
    }
    /**
     * @hidden
     */
    _cg(a, b) {
        if (b >= this.startIndex && a <= this.endIndex) {
            for (let c = 0, d = this._k.count; c < d; c++) {
                let e = this._k._inner[c]._j;
                if (a <= e) {
                    return e <= b ? c : -1;
                }
            }
        }
        return -1;
    }
    /**
     * @hidden
     */
    _ar() {
        let a = this._a2();
        if (a != null && a.count > 0) {
            let b = a.item(0);
            let c = a.item(a.count - 1);
            return b._i <= this.endIndex && c._h >= this.startIndex;
        }
        return false;
    }
    /**
     * @hidden
     */
    _as(a) {
        if (this._ai == 2) {
            return false;
        }
        let b = this._a2();
        return SpreadsheetScrollRegion._aq(a, b);
    }
    /**
     * @hidden
     */
    _au(a, b = false) {
        let c = b ? this._j : this._k;
        if (c.count > 0 && a < c.count) {
            if (a == c.count - 1) {
                let d = c._inner[c.count - 1]._j;
                if (nullableEquals(this._cm, null)) {
                    return d != this._ci;
                }
                return this._cm.value - d > 1;
            }
            return c._inner[a + 1]._j - c._inner[a]._j > 1;
        }
        return false;
    }
    /**
     * @hidden
     */
    _av(a, b = false) {
        let c = b ? this._j : this._k;
        if (c.count > 0 && a < c.count) {
            if (a == 0) {
                if (nullableEquals(this._cn, null)) {
                    return c._inner[0]._j > 0;
                }
                return c._inner[0]._j - this._cn.value > 1;
            }
            return c._inner[a]._j - c._inner[a - 1]._j > 1;
        }
        return false;
    }
    /**
     * @hidden
     */
    _ax(a) {
        if (this._ai == 2) {
            return false;
        }
        let b = this._a0();
        return SpreadsheetScrollRegion._aq(a, b);
    }
    /**
     * @hidden
     */
    _ay(a) {
        return a == this._a0() || a == this._a2();
    }
    /**
     * @hidden
     */
    _az(a, b) {
        let c = this._b4(truncate(MathUtilities.f(this._w._ac)));
        c += a;
        let d = this._b5(Math.max(c, 0));
        b = this._b8(d);
        return {
            ret: b._m <= d && d < b._l,
            p1: b
        };
    }
}
SpreadsheetScrollRegion.$t = markType(SpreadsheetScrollRegion, 'SpreadsheetScrollRegion', PropertyChangeNotifierExtended.$);
/**
 * @hidden
 */
export class SpreadsheetHeaderContentLayerBase$1 extends SpreadsheetRendererElementLayer$1 {
    constructor($tVisual, a, b, c) {
        super(SpreadsheetScrollRegion.$, a, b, PredefinedSpreadsheetLayers.o);
        this.$tVisual = null;
        this._x = null;
        this._z = null;
        this._u = null;
        this._y = false;
        this.$tVisual = $tVisual;
        this.$type = this.$type.specialize(this.$tVisual);
        this._y = c;
        this._z = new Dictionary$2(Number_$type, SpreadsheetHeaderContentLayerBase_HeaderInfo$1.$.specialize(this.$tVisual), 0);
        this._x = new PropertyChangeListener$1(SpreadsheetHeaderContentLayerBase$1.$.specialize(this.$tVisual), this, runOn(this, this._af), false);
        SpreadsheetUtilities.d6(a, this._x, true);
    }
    _g(a) {
        if (this._y) {
            super._g(a);
        }
        let b = new Rect(0, 0, 0, a.width, a.height);
        let c = this._j;
        let d = c._bx;
        let e = c._aw;
        let f = 0;
        let g = 0;
        let h = a.width / d;
        let i = a.height / d;
        let j = c._i(false, true);
        let k = j.length - 1;
        let l = c._l;
        let m = c._ar();
        let n = c._ad;
        let o = 1;
        let p = 1;
        if (e) {
            g += p;
        }
        else {
            f += p;
        }
        let q = Math.max(h - f, 0);
        let r = Math.max(i - g - o, 0);
        for (let s = 0; s < k; s++) {
            let t = j[s];
            let u = j[s + 1];
            let v = l._inner[s];
            let w = this._z.item(v._j);
            if (e) {
                g = t + p;
                i = u + p;
                r = Math.max(i - g - o, 0);
            }
            else {
                f = t + p;
                h = u + p;
                q = Math.max(h - f, 0);
            }
            let x = c._t(v._j);
            if (w.c) {
                if (w.b != x) {
                    w.c = false;
                    w.b = x;
                    this._ab(c, w, v._j, c._b6(v._j));
                }
            }
            else {
                w.b = x;
            }
            if (w.e > q || w.d > r) {
                let y = Math.min(q, w.e);
                let z = Math.min(r, w.d);
                w.f(w.e / 2 - y / 2, w.d / 2 - z / 2, y, z);
            }
            else {
                w.g();
            }
            w.h(f + q / 2 - w.e / 2, g + r / 2 - w.d / 2);
            w.c = true;
        }
        return b;
    }
    _h(a) {
        if (this._y) {
            super._h(a);
        }
        let b = this._j;
        let c = new Size(0);
        let d = b._aw;
        let e = b._bx;
        if (b == null || b._l.count == 0) {
            this._ah();
            this._z.clear();
        }
        else {
            let f = new Dictionary$2(Number_$type, SpreadsheetHeaderContentLayerBase_HeaderInfo$1.$.specialize(this.$tVisual), 3, this._z);
            this._z.clear();
            for (let g of fromEnum(b._l)) {
                let h;
                if (((() => { let i = f.tryGetValue(g._j, h); h = i.p1; return i.ret; })())) {
                    this._z.addItem(g._j, h);
                    f.removeItem(g._j);
                }
            }
            let i = Enumerable.z(this.$tVisual, Enumerable.o(SpreadsheetHeaderContentLayerBase_HeaderInfo$1.$.specialize(this.$tVisual), this.$tVisual, f.values, (j) => j.a));
            f.clear();
            let j = i.count - 1;
            for (let k of fromEnum(b._l)) {
                let l;
                if (!((() => { let m = this._z.tryGetValue(k._j, l); l = m.p1; return m.ret; })()) || this._u == null) {
                    if (l == null) {
                        this._z.item(k._j, l = this._v());
                        if (j >= 0) {
                            l.a = i._inner[j];
                            i.removeAt(j--);
                        }
                        else {
                            l.a = this._t();
                        }
                    }
                    let m = k._j;
                    l.c = false;
                    this._ab(b, l, m, b._b6(m));
                }
                if (d) {
                    let n = l.e * e;
                    if (n > c.width) {
                        c.width = n;
                    }
                }
                else if (!d) {
                    let o = l.d * e;
                    if (o > c.height) {
                        c.height = o;
                    }
                }
            }
            for (let p = 0, q = i.count; p < q; p++) {
                this._ai(i._inner[p]);
            }
        }
        if (this._u == null) {
            this._u = this._v();
            this._ab(b, this._u, 100, b._b6(100));
        }
        if (d) {
            let r = this._u.e * e;
            if (r > c.width) {
                c.width = r;
            }
        }
        else if (!d) {
            let s = this._u.d * e;
            if (s > c.height) {
                c.height = s;
            }
        }
        if (d) {
            c.width += 3 * b._br;
        }
        else {
            c.height += 3 * b._bs;
        }
        if (d) {
            c.width += b._br;
        }
        else {
            c.height += b._bs;
        }
        let t = d ? c.width : c.height;
        return c;
    }
    _p() {
        super._p();
        if (this._j != null) {
            SpreadsheetUtilities.ec(this._j, this._x);
        }
    }
    get__m() {
        return 2;
    }
    get _m() {
        return this.get__m();
    }
    _q(a, b, c, d) {
    }
    get__s() {
        return this._j._o.renderCache;
    }
    get _s() {
        return this.get__s();
    }
    get _aa() {
        return this._z.values;
    }
    static _w($tVisual, a, b) {
        let c;
        switch (b) {
            default:
            case 0:
                c = a ? 15 : 28;
                break;
            case 2:
                c = a ? 16 : 29;
                break;
            case 4:
                c = a ? 23 : 32;
                break;
            case 1:
                c = a ? 17 : 30;
                break;
            case 3:
                c = a ? 18 : 31;
                break;
        }
        return c;
    }
    _ag(a, b, c) {
        let d = false;
        let e = false;
        switch (b != null ? b : "") {
            case "Add":
            case "Remove":
            case "Replace":
            case "Move":
            case "Reset":
                if (a == this._j._l) {
                    e = d = true;
                }
                else if (this._j._ay(a)) {
                    e = true;
                }
                break;
            case "ZoomLevel":
                if (a == this._j) {
                    e = d = true;
                    this._ae();
                    if (this._j._o.renderCache.p) {
                        this._u = null;
                    }
                }
                break;
            case "HeaderFont":
            case "GetHeaderText":
            case "ResourceProvider":
                if (a == this._j) {
                    this._u = null;
                    e = d = true;
                }
                break;
            case "ActualItemPositions":
                if (a == this._j) {
                    e = d = true;
                }
                break;
            case "HotTrackedIndex":
            case "SelectionMode":
                if (a == this._j) {
                    e = true;
                }
                break;
            case "ResourceVersion":
                if (a == this._j._ad) {
                    this._u = null;
                    e = d = true;
                }
                break;
            case "":
            case "Offset":
                if (a == this._j._x) {
                    e = true;
                }
                break;
        }
        if (d) {
            this._ac();
        }
        if (e) {
            this._ad();
        }
    }
    _af(a, b, c, d) {
        a._ag(b, c, d);
    }
}
SpreadsheetHeaderContentLayerBase$1.$t = markType(SpreadsheetHeaderContentLayerBase$1, 'SpreadsheetHeaderContentLayerBase$1', SpreadsheetRendererElementLayer$1.$.specialize(SpreadsheetScrollRegion.$));
/**
 * @hidden
 */
export class SpreadsheetHeaderContentLayer extends SpreadsheetHeaderContentLayerBase$1 {
    constructor(a, b) {
        super(HeaderVisual.$, a, b, true);
    }
    _v() {
        return new HeaderVisualInfo();
    }
    _t() {
        return new HeaderVisual();
    }
    _ab(a, b, c, d) {
        let e = b;
        let f = a._o.renderCache;
        e.p = c;
        e.q = d;
        let g = a._bx;
        b.d = f.w(f.l, truncate((g * 100)), a._bs);
        b.e = f.z(a, d);
    }
    _ad() {
        this._e();
        this._o();
    }
    _ac() {
        this._f();
    }
    _ae() {
    }
    _q(a, b, c, d) {
        let e = this._j._aw;
        let f = this._j._bx;
        let g = this._j._af;
        for (let h of fromEnum(this._aa)) {
            let i = h;
            let j = SpreadsheetHeaderContentLayerBase$1._w(HeaderVisual.$, e, i.b);
            let k = (i.n + i.e / 2) * f;
            let l = (i.o + i.d / 2) * f;
            a.drawHeaderText(g, i.q, k, l, j, f);
        }
        super._q(a, b, c, d);
    }
    _ah() {
    }
    _ai(a) {
    }
}
SpreadsheetHeaderContentLayer.$t = markType(SpreadsheetHeaderContentLayer, 'SpreadsheetHeaderContentLayer', SpreadsheetHeaderContentLayerBase$1.$.specialize(HeaderVisual.$));
/**
 * @hidden
 */
export class SpreadsheetCellValueInfo extends Base {
    constructor() {
        super(...arguments);
        this.an = null;
        this.d = null;
        this.h = null;
        this.w = 0;
        this.af = 0;
        this.ab = 0;
        this.ak = 0;
        this.x = 0;
        this.ag = 0;
        this.ao = null;
        this.ap = null;
        this.aa = 0;
        this.ae = 0;
        this.ad = 0;
        this.am = Nullable$1.toNullable(Number_$type, null);
        this.al = Nullable$1.toNullable(Number_$type, null);
        this.v = 0;
        this.ac = 0;
        this.y = 0;
        this.z = 0;
        this.ah = 0;
        this.ai = 0;
        this.e = 0;
        this.f = 0;
        this.g = null;
        this.ar = new Color();
        this.c = null;
        this.u = 0;
        this.a = null;
        this.b = 0;
    }
    o(a) {
        return this.b == a.b && this.e == a.e && this.f == a.f && this.c == a.c;
    }
    get r() {
        return this.m(1);
    }
    set r(a) {
        this.aq(1, a);
    }
    get i() {
        return this.m(2);
    }
    set i(a) {
        this.aq(2, a);
    }
    get aj() {
        let a = this.y;
        switch (this.e) {
            case 0:
            case 1:
            case 4:
            case 5:
            case 7:
            case 3:
                a += this.ah + this.ai;
                break;
        }
        return a;
    }
    get s() {
        return this.m(4);
    }
    set s(a) {
        this.aq(4, a);
    }
    get j() {
        return this.m(8);
    }
    set j(a) {
        this.aq(8, a);
    }
    get t() {
        return this.m(16);
    }
    set t(a) {
        this.aq(16, a);
    }
    get n() {
        return this.m(32);
    }
    set n(a) {
        this.aq(32, a);
    }
    get k() {
        return this.m(64);
    }
    set k(a) {
        this.aq(64, a);
    }
    get q() {
        return this.m(128);
    }
    set q(a) {
        this.aq(128, a);
    }
    get l() {
        return this.m(256);
    }
    set l(a) {
        this.aq(256, a);
    }
    get p() {
        return this.m(512);
    }
    set p(a) {
        this.aq(512, a);
    }
    m(a) {
        return (this.b & a) != 0;
    }
    aq(a, b) {
        if (b) {
            this.b |= a;
        }
        else {
            this.b &= ~a;
        }
    }
}
SpreadsheetCellValueInfo.$t = markType(SpreadsheetCellValueInfo, 'SpreadsheetCellValueInfo');
/**
 * @hidden
 */
export class SpreadsheetPaneCellValueLayerBase$1 extends SpreadsheetRendererElementLayer$1 {
    constructor($tVisual, a, b, c) {
        super(SpreadsheetPane.$, a, b, PredefinedSpreadsheetLayers.o);
        this.$tVisual = null;
        this._u = null;
        this._x = null;
        this._v = false;
        this.$tVisual = $tVisual;
        this.$type = this.$type.specialize(this.$tVisual);
        this._v = c;
        this._x = new List$1(SpreadsheetPaneCellValueLayerBase_CellInfo$1.$.specialize(this.$tVisual), 0);
        this._u = new PropertyChangeListener$1(SpreadsheetPaneCellValueLayerBase$1.$.specialize(this.$tVisual), this, runOn(this, this._ac), false);
        SpreadsheetUtilities.d6(a, this._u, true);
    }
    get__m() {
        return 2;
    }
    get _m() {
        return this.get__m();
    }
    _p() {
        if (this._j != null) {
            SpreadsheetUtilities.ec(this._j, this._u);
        }
    }
    get__s() {
        return this._j._s.renderCache;
    }
    get _s() {
        return this.get__s();
    }
    _q(a, b, c, d) {
        let e = this._j;
        if (e != null) {
            let f = e.columnScrollRegion._br;
            let g = d.x;
            let h = d.y;
            let i = e.columnScrollRegion;
            let j = e.rowScrollRegion;
            let k = i._bx;
            let l = b.d;
            let m = l / 2;
            let n = -g;
            let o = -h;
            let p = ExcelUtils.gv;
            let q = this._v;
            for (let r of fromEnum(this._x)) {
                let s = r.a;
                let t = s.a;
                let u = s.d != null && s.d.iconInfo != null ? s.d.iconInfo.icon : -1;
                if (t == null && u == -1) {
                    continue;
                }
                let v = c.x + i._bn(s.ab, true, q) * k;
                let w = s.e == 4 ? s.ab : s.x;
                let x = c.x + i._bn(w, false, q) * k;
                let y = c.y + j._bn(s.ak, true, q) * k;
                let z = c.y + j._bn(s.ag, false, q) * k;
                let aa = x - v;
                let ab = z - y;
                y += s.ac * k;
                z -= s.v * k;
                if (u != -1) {
                    let ac = Math.floor(s.ah * k);
                    let ad = v + ((s.y + (intDivide(s.ai, 2))) * k);
                    let ae = y;
                    let af = (intDivide(s.ai, 2) + 3) * k;
                    switch (s.f) {
                        default:
                        case -1:
                        case 2:
                        case 4:
                        case 3:
                            ae = z - (ac + af);
                            break;
                        case 0:
                            y += af;
                            break;
                        case 1:
                            ae = y + (z - y) / 2 - ac / 2;
                            break;
                    }
                    a.drawIcon(u, b.h(ad) - n, b.h(ae) - o, ac, ac, v, y, x - v, z - y);
                }
                if (t == null || s.ap == null) {
                    continue;
                }
                let ag = t.a && s.c != null && (s.c.b * k) < aa;
                let ah = ag ? s.c.b * k : 0;
                let ai = t.b ? 1 : 2;
                if (ag && s.e == 4) {
                    if (s.k) {
                        continue;
                    }
                    let aj = ah;
                    let ak = c.x + i._bn(s.x, false, q) * k;
                    let al = ak - v;
                    while (al > aj) {
                        ah += aj;
                        al -= aj;
                    }
                }
                let am = Math.max(t.c / 1.5, 1);
                if (ag) {
                    v += s.aj * k;
                    x -= s.z * k;
                    aa = ah;
                    switch (s.e) {
                        default:
                        case -1:
                        case 1:
                        case 0:
                        case 4:
                            x = v + aa;
                            break;
                        case 2:
                        case 6:
                        case 5:
                        case 7:
                            v = v + (x - v) / 2 - aa / 2;
                            x = v + aa;
                            break;
                        case 3:
                            x -= l;
                            v = x - aa;
                            break;
                    }
                }
                else {
                    x -= l;
                    v += am;
                    x -= am;
                }
                v = b.h(v) - n;
                x = b.h(x) - n;
                let an = t.c * k;
                let ao = an;
                an /= 3;
                let ap = an % l;
                if (ap != 0) {
                    an += ap < an / 2 ? -ap : l - ap;
                }
                if (an < l) {
                    an = l;
                }
                if (aa > an * 2) {
                    p = s.ar;
                    let aq = an / 2;
                    let ar = s.u * k;
                    let as;
                    switch (s.f) {
                        default:
                        case -1:
                        case 2:
                        case 4:
                        case 3:
                            as = z - ao;
                            break;
                        case 0:
                            as = y + ar;
                            break;
                        case 1:
                            as = y + (z - y) / 2 + ar / 2 - l;
                            break;
                    }
                    z = b.h(z);
                    if (ai == 1) {
                        let at = b.h(as + an);
                        at -= (aq - h);
                        if (at <= z) {
                            a._drawLine4$i(an, p, f, v, at, x, at);
                        }
                    }
                    else {
                        let au = b.h(as);
                        au -= (aq - h);
                        if (au <= z) {
                            a._drawLine4$i(an, p, f, v, au, x, au);
                        }
                        au += an * 2;
                        if (au <= z) {
                            a._drawLine4$i(an, p, f, v, au, x, au);
                        }
                    }
                }
            }
        }
    }
    get _w() {
        return this._x;
    }
    _z(a, b, c) {
        let d = 0;
        for (let e of fromEnum(b)) {
            let f;
            while (d < c.count && c._inner[d] == null) {
                d++;
            }
            if (d < c.count) {
                f = c._inner[d];
                f.a = e;
                c._inner[d] = null;
                d++;
            }
            else {
                f = new SpreadsheetPaneCellValueLayerBase_CellInfo$1(this.$tVisual, e, this._t());
            }
            a.add(f);
        }
    }
    _ad(a, b, c) {
        let d = false;
        switch (b != null ? b : "") {
            case "":
            case "Offset":
                if (a == this._j.rowScrollRegion._x || a == this._j.columnScrollRegion._x) {
                    d = true;
                }
                break;
            case "Add":
            case "Remove":
            case "Replace":
            case "Move":
            case "Reset":
                if (a == this._j._k || a == this._j._p) {
                    d = true;
                }
                break;
            case "HideActiveCellContent":
                if (a == this._j) {
                    d = true;
                }
                break;
        }
        if (d) {
            this._e();
            this._o();
            this._n();
        }
    }
    _ac(a, b, c, d) {
        a._ad(b, c, d);
    }
    _ae() {
        let a = this._j;
        if (a != null) {
            a._ao++;
        }
        if (a == null || a._p.count == 0) {
            this._af();
            this._x.clear();
        }
        else {
            let b = Nullable$1.toNullable(SpreadsheetCell.$, null);
            if (a._al) {
                b = Nullable$1.toNullable(SpreadsheetCell.$, a.rowScrollRegion._ab._r._c);
            }
            let c = a._p;
            for (let d = 0, e = this._x.count; d < e; d++) {
                let f = this._x._inner[d];
                let g = f.a;
                if (SpreadsheetCell._l_op_Inequality_Lifted$i(b, Nullable$1.toNullable(SpreadsheetCell.$, null)) && g.w == b.value.column && g.ak == b.value.row) {
                    continue;
                }
                g.an = getBoxIfEnum(this.$tVisual, f.b);
            }
            let h = new List$1(SpreadsheetCellValueInfo.$, 0);
            for (let i = 0, j = c.count; i < j; i++) {
                let k = c._inner[i];
                if (k.an == null) {
                    if (k.ap == null) {
                        if (k.d == null || k.d.iconInfo == null || k.d.iconInfo.icon == -1) {
                            continue;
                        }
                    }
                    if (SpreadsheetCell._l_op_Inequality_Lifted$i(b, Nullable$1.toNullable(SpreadsheetCell.$, null)) && k.w == b.value.column && k.ak == b.value.row) {
                        continue;
                    }
                    let l = typeCast(String_$type, k.ap);
                    if (l != null && l.length == 0) {
                        continue;
                    }
                    h.add(k);
                }
                else {
                    k.an = this.$type.getStaticFields(SpreadsheetPaneCellValueLayerBase$1.$)._y;
                }
            }
            let m = new List$1(SpreadsheetPaneCellValueLayerBase_CellInfo$1.$.specialize(this.$tVisual), 0);
            for (let n = 0, o = this._x.count; n < o; n++) {
                let p = this._x._inner[n];
                if (p.a.an == this.$type.getStaticFields(SpreadsheetPaneCellValueLayerBase$1.$)._y) {
                    m.add(p);
                    this._x._inner[n] = null;
                }
                else {
                    p.a.an = null;
                }
            }
            let q = this._x;
            this._x = m;
            if (h.count > 0) {
                this._z(this._x, h, q);
            }
            let r = a.rowScrollRegion._br;
            let s = a.columnScrollRegion._bx;
            let t = this._v;
            for (let u = 0, v = this._x.count; u < v; u++) {
                let w = this._x._inner[u];
                let x = w.a;
                let y = a.columnScrollRegion._bn(x.ab, true, t) + x.aj;
                let z = a.rowScrollRegion._bn(x.ak, true, t) + x.ac;
                let aa = a.columnScrollRegion._bn(x.x, false, t) - x.z - r;
                if (w.a.an == this.$type.getStaticFields(SpreadsheetPaneCellValueLayerBase$1.$)._y) {
                    w.a.an = null;
                }
                else {
                    let ab = a.rowScrollRegion._bn(x.ag, false, t) - x.v - r;
                    this._aa(w.b, x, y, z, aa, ab);
                }
                if (x.e == 3 && aa < y) {
                    y = aa;
                }
                this._ab(w.b, y, z);
            }
            for (let ac = 0, ad = q.count; ac < ad; ac++) {
                let ae = q._inner[ac];
                if (ae != null) {
                    this._ag(ae.b);
                }
            }
        }
    }
}
SpreadsheetPaneCellValueLayerBase$1.$t = markType(SpreadsheetPaneCellValueLayerBase$1, 'SpreadsheetPaneCellValueLayerBase$1', SpreadsheetRendererElementLayer$1.$.specialize(SpreadsheetPane.$), null, function () {
    this._y = {};
});
/**
 * @hidden
 */
export class SpreadsheetCellValueElement extends VisualElement {
    constructor(a, b) {
        super(a, "SpreadsheetCellValue");
        this.cv = null;
        this.ck = false;
        this.cr = 0;
        this.cu = null;
        this.cp = 0;
        this.co = 0;
        this.ct = null;
        this.cq = 0;
        this.cn = 0;
        this.cs = null;
        this.cm = 0;
        this.cl = 0;
        this.ci = false;
        this.cf = null;
        this.ch = null;
        this.ch = b;
    }
    get cg() {
        return this.cf;
    }
    set cg(a) {
        if (a != this.cf) {
            this.ci = true;
            this.cf = a;
            this.b1();
        }
    }
    get cj() {
        return this.ci;
    }
    set cj(a) {
        if (a != this.ci) {
            this.ci = a;
            if (a) {
                this.b1();
            }
        }
    }
}
SpreadsheetCellValueElement.$t = markType(SpreadsheetCellValueElement, 'SpreadsheetCellValueElement', VisualElement.$);
/**
 * @hidden
 */
export class SpreadsheetPaneCellValueLayer extends SpreadsheetPaneCellValueLayerBase$1 {
    constructor(a, b) {
        super(SpreadsheetCellValueElement.$, a, b, false);
    }
    _g(a) {
        this._ae();
        let b = this._ah.cg;
        let c = this._ah.ci;
        c.g(this._s);
        this._q(c, SpreadsheetPaneCellValueLayer._ai, new Rect(1, 0, 0, a), PointUtil.create());
        c.f();
        SpreadsheetDrawingElementHelper.a(b, c, 0);
        let d = this._j;
        let e = d.columnScrollRegion._bx;
        let f = e * d.columnScrollRegion._b4(truncate(MathUtilities.f(d.columnScrollRegion._x._ac)));
        let g = e * d.rowScrollRegion._b4(truncate(MathUtilities.f(d.rowScrollRegion._x._ac)));
        let h = e * d.columnScrollRegion._b4(truncate(Math.ceil(d.columnScrollRegion._bq)));
        let i = e * d.rowScrollRegion._b4(truncate(Math.ceil(d.rowScrollRegion._bq)));
        b.al(-f, -g, h, i);
        return super._g(a);
    }
    _t() {
        return this._ah.ch(null);
    }
    _z(a, b, c) {
        let d = c.count;
        let e = b.count;
        for (let f = 0, g = b.count; f < g; f++) {
            let h = b._inner[f];
            for (let i = 0; i < d; i++) {
                let j = c._inner[f];
                if (j != null && j.f(h)) {
                    e--;
                    c._inner[f] = null;
                    b._inner[f] = null;
                    j.c(h);
                    a.add(j);
                    break;
                }
            }
        }
        if (e > 0) {
            let k = this._ah;
            let l = 0;
            for (let m = 0, n = b.count; m < n; m++) {
                if (b._inner[m] != null) {
                    while (l < d && c._inner[l] == null) {
                        l++;
                    }
                    let o;
                    if (l < d) {
                        o = c._inner[l];
                        c._inner[l] = null;
                        l++;
                        o.c(b._inner[m]);
                    }
                    else {
                        o = new SpreadsheetPaneCellValueLayer_JsCellInfo(b._inner[m], k.ch(b._inner[m]));
                    }
                    a.add(o);
                }
            }
        }
    }
    _aa(a, b, c, d, e, f) {
        let g = this._j.columnScrollRegion;
        let h = g._bx;
        a.ab = false;
        a.cg = b;
        a.al(c * h, d * h, (e - c) * h, (f - d) * h);
    }
    _ab(a, b, c) {
        let d = this._j.rowScrollRegion._bx;
        a.al(b * d, c * d, a.a3, a.av);
    }
    _af() {
        this._ah.cl();
    }
    _ag(a) {
        this._ah.ck(a);
    }
    get _ah() {
        return this._d.c;
    }
}
SpreadsheetPaneCellValueLayer.$t = markType(SpreadsheetPaneCellValueLayer, 'SpreadsheetPaneCellValueLayer', SpreadsheetPaneCellValueLayerBase$1.$.specialize(SpreadsheetCellValueElement.$));
SpreadsheetPaneCellValueLayer._ai = new PixelConverter();
/**
 * @hidden
 */
export class SpreadsheetPaneCellValueLayerBase_CellInfo$1 extends Base {
    constructor($tVisual, a, b) {
        super();
        this.$tVisual = null;
        this.a = null;
        this.b = null;
        this.$tVisual = $tVisual;
        this.$type = this.$type.specialize(this.$tVisual);
        this.a = a;
        this.b = b;
    }
}
SpreadsheetPaneCellValueLayerBase_CellInfo$1.$t = markType(SpreadsheetPaneCellValueLayerBase_CellInfo$1, 'SpreadsheetPaneCellValueLayerBase_CellInfo$1');
/**
 * @hidden
 */
export class SpreadsheetPaneCellValueLayer_JsCellInfo extends SpreadsheetPaneCellValueLayerBase_CellInfo$1 {
    constructor(a, b) {
        super(SpreadsheetCellValueElement.$, a, b);
        this.e = false;
        this.d = null;
        this.c(a);
    }
    c(a) {
        this.a = a;
        this.e = a.e == 4;
        this.d = a.c;
        return this;
    }
    f(a) {
        let b = a.e == 4;
        return b == this.e && Base.equalsStatic(this.d, a.c);
    }
}
SpreadsheetPaneCellValueLayer_JsCellInfo.$t = markType(SpreadsheetPaneCellValueLayer_JsCellInfo, 'SpreadsheetPaneCellValueLayer_JsCellInfo', SpreadsheetPaneCellValueLayerBase_CellInfo$1.$.specialize(SpreadsheetCellValueElement.$));
/**
 * @hidden
 */
export class SpreadsheetInstructionGraphics extends Base {
    constructor(a) {
        super();
        this.a = null;
        this.e = null;
        this.d = null;
        this.b = null;
        this.a = a;
        this.e = new List$1(SpreadsheetDrawingOperation.$, 0);
        this.d = new List$1(SpreadsheetDrawingOperation.$, 0);
    }
    g(a) {
        this.b = a;
        this.d.o(this.e);
        this.e.clear();
    }
    f() {
        this.b = null;
    }
    c(a) {
        let b;
        let c = this.d.count - 1;
        if (c >= 0) {
            b = this.d._inner[c];
            this.d.removeAt(c);
        }
        else {
            b = new SpreadsheetDrawingOperation();
        }
        b.b = a;
        return b;
    }
    drawDropDownGlyph(a, b, c, d, e) {
        throw new NotImplementedException(0);
    }
    drawEllipse(a, b, c, d, e, f, g) {
        let h = this.c(2);
        h.a = 6;
        h.i = this.b.ba(b);
        h.d = c * a;
        h.e = d;
        h.g = e;
        h.f = d + f;
        h.h = e + g;
        this.e.add(h);
    }
    drawHeaderText(a, b, c, d, e, f = 1) {
        throw new NotImplementedException(0);
    }
    drawIcon(a, b, c, d, e, f, g, h, i) {
        if (a != -1) {
            let j = this.c(1);
            j.c = a;
            j.i = null;
            j.e = b;
            j.g = c;
            j.f = b + d;
            j.h = c + e;
            this.e.add(j);
        }
    }
    drawLine3(a, b, c, d, e, f) {
        throw new NotImplementedException(0);
    }
    drawLine4(penWidth, color, dpiFactor, x1, y1, x2, y2) {
        arguments[1] = Color.create(arguments[1]);
        return this._drawLine4$i.apply(this, arguments);
    }
    _drawLine4$i(a, b, c, d, e, f, g) {
        this._drawLine2$i(6, b, c * a, d, e, f, g);
    }
    drawLine2(pen, color, dpiFactor, x1, y1, x2, y2) {
        arguments[1] = Color.create(arguments[1]);
        return this._drawLine2$i.apply(this, arguments);
    }
    _drawLine2$i(a, b, c, d, e, f, g) {
        let h = this.c(0);
        h.a = a;
        h.i = b.colorString;
        h.d = c;
        h.e = d;
        h.g = e;
        h.f = f;
        h.h = g;
        this.e.add(h);
    }
    drawLine1(a, b, c, d, e, f, g) {
        throw new NotImplementedException(0);
    }
    drawLine(a, b, c, d, e, f, g) {
        let h = this.c(0);
        h.a = a;
        h.i = this.b.ba(b);
        h.d = c;
        h.e = d;
        h.g = e;
        h.f = f;
        h.h = g;
        this.e.add(h);
    }
    drawRectangle1(a, b, c, d, e, f, g) {
        throw new NotImplementedException(0);
    }
    drawRectangle(a, b, c, d, e, f, g) {
        throw new NotImplementedException(0);
    }
    fillRectangle1(a, b, c, d, e) {
        throw new NotImplementedException(0);
    }
    fillRectangle5(a, b, c, d, e) {
        throw new NotImplementedException(0);
    }
    fillRectangle3(a, b, c, d, e) {
        throw new NotImplementedException(0);
    }
    fillRectangle4(a, b, c, d, e, f, g) {
        throw new NotImplementedException(0);
    }
    fillRectangle(a, b, c, d, e, f, g) {
        throw new NotImplementedException(0);
    }
    fillRectangle2(a, b, c, d, e, f, g, h, i) {
        throw new NotImplementedException(0);
    }
    getFarPixelAdjustment(a) {
        throw new NotImplementedException(0);
    }
}
SpreadsheetInstructionGraphics.$t = markType(SpreadsheetInstructionGraphics, 'SpreadsheetInstructionGraphics', Base.$, [ISpreadsheetGraphics_$type]);
/**
 * @hidden
 */
export class SpreadsheetDrawingElementHelper extends Base {
    static a(a, b, c) {
        let d = a.a9;
        let e = 0;
        let f = 0;
        let g = 0;
        for (let h = 0, i = b.e.count; h < i; h++) {
            let j = b.e._inner[h];
            let k, l, m, n;
            switch (j.b) {
                case 0:
                    let o = Math.max(c, j.d);
                    if (j.g == j.h) {
                        k = j.e;
                        m = j.f - k;
                        l = j.g - o / 2;
                        n = j.d;
                    }
                    else if (j.e == j.f) {
                        l = j.g;
                        n = j.h - l;
                        k = j.e - o / 2;
                        m = j.d;
                    }
                    else {
                        continue;
                    }
                    let p = null;
                    for (; e < d; e++) {
                        let q = a.b(e);
                        if (q.bx == "Line") {
                            p = q;
                            e++;
                            break;
                        }
                    }
                    if (p == null) {
                        p = new LineVisualElement(a, "Line");
                    }
                    p.ci = j.i;
                    p.al(k, l, m, n);
                    break;
                case 1:
                    k = j.e;
                    m = j.f - k;
                    l = j.g;
                    n = j.h - l;
                    let r = null;
                    for (; f < d; f++) {
                        let s = a.b(f);
                        if (s.bx == "Icon") {
                            r = s;
                            f++;
                            break;
                        }
                    }
                    if (r == null) {
                        r = new SpreadsheetIconElement(a);
                    }
                    r.cg = j.c;
                    r.al(k, l, m, n);
                    break;
                case 2:
                    k = j.e;
                    m = j.f - k;
                    l = j.g;
                    n = j.h - l;
                    let t = null;
                    for (; g < d; g++) {
                        let u = a.b(g);
                        if (u.bx == "InvalidData") {
                            t = u;
                            g++;
                            break;
                        }
                    }
                    if (t == null) {
                        t = new SpreadsheetInvalidDataElement(a);
                    }
                    t.cm = j.i;
                    t.ck = Math.max(j.d, c);
                    let v = t.ck;
                    t.al(k - v / 2, l - v / 2, m + v, n + v);
                    break;
            }
        }
        let w = e;
        if (f < w) {
            w = f;
        }
        if (g < w) {
            w = g;
        }
        for (let x = w; x < d; x++) {
            let y = a.b(x).bx;
            if ((x >= e && y == "Line") || (x >= f && y == "Icon") || (x >= g && y == "InvalidData")) {
                a.b(x).ab = true;
            }
        }
    }
}
SpreadsheetDrawingElementHelper.$t = markType(SpreadsheetDrawingElementHelper, 'SpreadsheetDrawingElementHelper');
/**
 * @hidden
 */
export class SpreadsheetSingleLayerView extends ElementLayerViewSingle {
    constructor(a) {
        super();
        this.c = null;
        this.c = a;
    }
    d() {
        let a = this.b;
        a.dispose();
        this.detach(a);
    }
    invalidateMeasure() {
        this.c.t = true;
    }
    invalidateArrange() {
        this.c.t = true;
    }
    createRenderer() {
        return new SpreadsheetSingleLayerView_Renderer(this);
    }
    releaseRenderer(a) {
    }
}
SpreadsheetSingleLayerView.$t = markType(SpreadsheetSingleLayerView, 'SpreadsheetSingleLayerView', ElementLayerViewSingle.$, [IRendererElementLayerView$2_$type.specialize(SpreadsheetPane.$, ISpreadsheetGraphics_$type)]);
/**
 * @hidden
 */
export class SpreadsheetSingleLayerView_Renderer extends Base {
    constructor(a) {
        super();
        this.a = null;
        this.a = a;
    }
    onUnloaded() {
        this.a = null;
    }
    invalidateLayout() {
        if (this.a != null) {
            this.a.invalidateArrange();
        }
    }
    invalidateRender() {
        if (this.a != null) {
            this.a.invalidateArrange();
        }
    }
    measure(availableSize) {
        arguments[0] = sizeFromLiteral(arguments[0]);
        return this._measure$i.apply(this, arguments);
    }
    _measure$i(a) {
    }
    arrange(finalSize) {
        arguments[0] = sizeFromLiteral(arguments[0]);
        return this._arrange$i.apply(this, arguments);
    }
    _arrange$i(a) {
    }
}
SpreadsheetSingleLayerView_Renderer.$t = markType(SpreadsheetSingleLayerView_Renderer, 'SpreadsheetSingleLayerView_Renderer', Base.$, [ILayerRenderer_$type]);
/**
 * @hidden
 */
export class SpreadsheetSingleLayerElement extends VisualElement {
    constructor(a, b) {
        super(a, b);
        this.cf = null;
        this.cf = new SpreadsheetSingleLayerView(this);
        this.w = false;
    }
    bz() {
        let a = this.cf.b;
        if (a != null) {
            a.dispose();
            this.cf.detach(a);
        }
        super.bz();
    }
    b7(a, b, c, d) {
        super.b7(a, b, c, d);
        let e = new Size(1, c, d);
        this.cf.b._h(e);
        this.cf.b._g(e);
    }
    b5() {
        super.b5();
        this.t = true;
    }
}
SpreadsheetSingleLayerElement.$t = markType(SpreadsheetSingleLayerElement, 'SpreadsheetSingleLayerElement', VisualElement.$);
/**
 * @hidden
 */
export class SpreadsheetCellValueLayerElement extends SpreadsheetSingleLayerElement {
    constructor(a) {
        super(a, "SpreadsheetCellValueLayer");
        this.cg = null;
        this.cj = null;
        this.ci = null;
        this.ci = new SpreadsheetInstructionGraphics(this);
        this.cj = new List$1(SpreadsheetCellValueElement.$, 0);
        this.cg = new VisualElement(this, "CellContainer");
        this.w = false;
    }
    b5() {
        super.b5();
        this.cl();
    }
    ch(a) {
        let b = this.cf.b;
        for (let c = 0, d = this.cj.count; c < d; c++) {
            let e = this.cj._inner[c];
            if (a.o(e.cg)) {
                this.cj.removeAt(c);
                e.ch = b._j;
                e.ac = true;
                return e;
            }
        }
        if (this.cj.count > 300) {
            let f = this.cj.count - 1;
            let g = this.cj._inner[f];
            this.cj.removeAt(f);
            g.ch = b._j;
            g.ac = true;
            return g;
        }
        return new SpreadsheetCellValueElement(this.cg, b._j);
    }
    ck(a) {
        if (this.cj.count < 1000) {
            a.ac = false;
            this.cj.add(a);
        }
        else {
            a.ab = true;
        }
    }
    cl() {
        for (let a = 0, b = this.cg.a9; a < b; a++) {
            let c = this.cg.b(a);
            if (c.ac && c.bx == "SpreadsheetCellValue") {
                c.ac = false;
                this.cj.add1(c);
            }
        }
    }
}
SpreadsheetCellValueLayerElement.$t = markType(SpreadsheetCellValueLayerElement, 'SpreadsheetCellValueLayerElement', SpreadsheetSingleLayerElement.$);
/**
 * @hidden
 */
export class SpreadsheetDrawingLayerElement extends SpreadsheetSingleLayerElement {
    constructor(a) {
        super(a, "SpreadsheetDrawingLayer");
        this.cg = null;
        this.cg = new SpreadsheetInstructionGraphics(this);
    }
    b7(a, b, c, d) {
        super.b7(a, b, c, d);
        let e = this.cf.b;
        let f = this.cg;
        f.g(e._s);
        e._q(f, SpreadsheetDrawingLayerElement.ch, new Rect(0, 0, 0, c, d), PointUtil.create());
        f.f();
        SpreadsheetDrawingElementHelper.a(this, f, 1);
    }
}
SpreadsheetDrawingLayerElement.$t = markType(SpreadsheetDrawingLayerElement, 'SpreadsheetDrawingLayerElement', SpreadsheetSingleLayerElement.$);
SpreadsheetDrawingLayerElement.ch = new PixelConverter();
/**
 * @hidden
 */
export class ScrollRegionLayerContainer extends SpreadsheetElementLayerContainer$1 {
    constructor(a, b) {
        super(SpreadsheetScrollRegion.$, a, b);
    }
    c() {
        return new SpreadsheetScrollRegionInteractionManager(this.b, this);
    }
}
ScrollRegionLayerContainer.$t = markType(ScrollRegionLayerContainer, 'ScrollRegionLayerContainer', SpreadsheetElementLayerContainer$1.$.specialize(SpreadsheetScrollRegion.$));
/**
 * @hidden
 */
export class Spreadsheet extends PropertyChangeNotifierExtended {
    constructor() {
        super();
        this._az = null;
        this._e9 = null;
        this._cc = false;
        this._i9 = new Rect(0, 0, 0, 0, 0);
        this._bg = null;
        this._bi = null;
        this._as = null;
        this.css = null;
        this.createRendererContainer = null;
        this._a1 = new SpreadsheetMetricsCache();
        this._cd = false;
        this._eb = null;
        this._cj = false;
        this._height = 0;
        this._width = 0;
        this._fm = null;
        this._ei = 1;
        this._e8 = null;
        this._p = null;
        this._eg = new List$1(Spreadsheet_ElementCommandInfo.$, 0);
        this._i5 = null;
        this._s = null;
        this._t = null;
        this._a7 = null;
        this._b1 = null;
        this._ac = null;
        this._bs = null;
        this._j = null;
        this._b0 = null;
        this._l = null;
        this._z = 0;
        this._bq = null;
        this._ah = null;
        this._bb = null;
        this._b6 = null;
        this._b3 = null;
        this._be = null;
        this._ab = null;
        this._ao = null;
        this._eh = null;
        this._aa = null;
        this._fe = 0;
        this._y = null;
        this._a2 = null;
        this._fu = null;
        this._ec = null;
        this._fl = null;
        this._ae = new SpreadsheetCell();
        this._al = new SpreadsheetCellRange();
        this._a4 = null;
        this._a9 = null;
        this._by = null;
        this._bv = null;
        this._b8 = true;
        this._b9 = true;
        this._ca = true;
        this._cb = true;
        this._aj = 0;
        this._bm = null;
        this._av = 0;
        this._fd = 2;
        this._ce = true;
        this._cf = false;
        this._cg = true;
        this._ch = false;
        this._ci = false;
        this._ck = true;
        this._ej = 102;
        this._aq = 0;
        this._g = null;
        this._b4 = null;
        this._i6 = null;
        this._bt = null;
        this._ff = 100;
        this._fp = null;
        this._bk = null;
        this._w = null;
        this._fc = 0;
        this._e6 = null;
        this._b7 = false;
        this.actionExecuted = null;
        this.actionExecuting = null;
        this.activeCellChanged = null;
        this.activePaneChanged = null;
        this.activeTableChanged = null;
        this.activeWorksheetChanged = null;
        this._cellDropDownItemSelecting = null;
        this.editModeExiting = null;
        this.editModeExited = null;
        this.editModeEntering = null;
        this.editModeEntered = null;
        this.editModeValidationError = null;
        this.editRangePasswordNeeded = null;
        this.hyperlinkExecuting = null;
        this.selectionChanged = null;
        this.userPromptDisplaying = null;
        this.workbookDirtied = null;
        this._v = new Spreadsheet_NullView(this);
        this._b0 = new PropertyChangeListener$1(Spreadsheet.$, this, Spreadsheet._hd, false);
        this._bq = new DeferredOperation(runOn(this, this._i0));
        this._l = SpreadsheetCommandBuilder.b();
        this._j = new ReadOnlyNotifyCollection$1(SpreadsheetPane.$, boxArray$1(new Array(0)));
        this._b1 = new PixelConverter();
        this._ac = new Spreadsheet_WorkbookOwner(this);
        this._bs = this._ac;
        this._aa = new Spreadsheet_NameBoxList(this);
        this._ab = new Spreadsheet_SelectionWorksheetCellFormat(this);
        this._ao = new SpreadsheetCellRangeFormat(this._ab);
        let a = PropertyChangeListenerList.e(SpreadsheetTabManager.$, this._be, new SpreadsheetTabManager(this), this._b0, false);
        this._be = a.p0;
        this.undoManager = new UndoManager();
        this._id(4, true);
        this._is();
        this._g1();
    }
    get _at() {
        if (this._as == null) {
            this._as = new SpreadsheetContextMenu(this);
        }
        return this._as;
    }
    get isDisabled() {
        return this._cd;
    }
    set isDisabled(a) {
        if (a != this._cd) {
            this._cd = a;
            if (this._bg != null) {
                if (this._bg.co != null) {
                    this._bg.co.ab = a;
                }
                this._bg.dp.cg.cf.u = !a;
                this._bg.u = !a;
                if (a) {
                    this._c1(false);
                }
            }
        }
    }
    get brushes() {
        return this._eb;
    }
    set brushes(a) {
        if (a != this._eb) {
            this._eb = a;
            if (this._a7 != null) {
                this._a7._al._j.al();
            }
        }
    }
    get isScrollLocked() {
        return this._cj;
    }
    set isScrollLocked(a) {
        if (a != this._cj) {
            this._cj = a;
            this._ht(1);
            this.a("IsScrollLocked");
        }
    }
    get _bj() {
        return this._bi;
    }
    get _fa() {
        return this._e9;
    }
    get height() {
        return this._height;
    }
    set height(a) {
        this._height = a;
    }
    get width() {
        return this._width;
    }
    set width(a) {
        this._width = a;
    }
    get _a0() {
        return this._az;
    }
    get _ad() {
        return this._bg != null ? this._bg.dr.cf : null;
    }
    get _bh() {
        return this._bg;
    }
    get _ay() {
        return this._bg != null ? this._bg.dr.cf.e0 : null;
    }
    get _ja() {
        return this._i9;
    }
    set _ja(a) {
        if (Rect.l_op_Inequality(this._i9, a)) {
            this._i9 = a;
            if (this._bg != null) {
                this._bg.al(a.left, a.top, a.width, a.height);
            }
            this.scheduleArrange();
        }
    }
    get _c3() {
        return this._c2(256);
    }
    get _language() {
        return this._fm;
    }
    set _language(a) {
        if (this._fm != a) {
            this._fm = a;
            this._at.n();
            if (this._bg != null) {
                let b = this._bg.dp.cg.cf.a7;
                if (b != null) {
                }
            }
        }
    }
    containerResized() {
        if (this._e9 != null) {
            let a = this._e9.rootWrapper.getNativeElement().getBoundingClientRect();
            let b = (a.width);
            let c = (a.height);
            this._ja = new Rect(0, 0, 0, b, c);
        }
    }
    destroy() {
        this.provideContainer(null);
    }
    executeCommand(a) {
        return this._cz(a, null, null);
    }
    flush() {
        if (this._cc) {
            this._fx();
        }
    }
    onInitialized() {
        this._gn();
    }
    _gq() {
        if (this._bg != null) {
            this._bg.ao((a) => {
                if (a.bx == "SpreadsheetRenderer") {
                    a.ck();
                    return false;
                }
                return a.bx != "SpreadsheetCellValueLayer" && a.bx != "TabItemArea";
            });
        }
    }
    get _ek() {
        return this._ei;
    }
    set _ek(a) {
        if (a != this._ei) {
            this._ei = a;
            this._gq();
            this.scheduleArrange();
        }
    }
    provideContainer(a) {
        let b = this._e9;
        let c = a;
        this._e9 = c;
        if (b != null) {
            window.removeEventListener("resize", this._e8, false);
            this._e8 = null;
            this._at.m();
            if (this._bg != null) {
                this._bg.ab = true;
                this._bg.b8();
                this._bg.bz();
                this._bg.dr.cf.c = null;
                this._bg = null;
            }
            if (this._az != null) {
                this._az.w();
            }
            if (this._a7 != null) {
                this._a7._al._j.al();
            }
        }
        if (c != null) {
            if (this._bi == null) {
                this._bi = new SpreadsheetVisualElementDomBuilder(this);
            }
            this._bi.ad = this.css;
            if (this._az == null) {
                this._az = new SpreadsheetMeasureHelper(this);
            }
            if (this._as == null) {
                this._as = new SpreadsheetContextMenu(this);
            }
            this._az.v(c);
            let d = c.rootWrapper;
            d.setRawStyleProperty("position", "relative");
            let e = c.createElement("div");
            e.setAttribute("style", "position:absolute;outline:0");
            e.setAttribute("tabIndex", 0);
            c.append(e);
            let f = c.getSubRenderer(e);
            e.listen("focus", (g) => {
                if (this.isRenamingWorksheet && !this._bc.j) {
                    this._bc.q();
                }
            });
            let g = new SpreadsheetVisualElement(this);
            this._bg = g;
            g.a7 = f;
            let h = new SpreadsheetDOMEventProxy(this, f.rootWrapper, f);
            g.co = h;
            h.ab = this.isDisabled;
            this._e8 = (i) => {
                let j = this._ek;
                if (window.devicePixelRatio != undefined && window.devicePixelRatio != j) {
                    this._ek = window.devicePixelRatio;
                }
            };
            window.addEventListener("resize", this._e8, false);
            this._e8(null);
            let i = new JsSpreadsheetAreaLayoutManager(g.dr);
            g.dr.cf = i;
            i.c = this;
            i.x = this._b2;
            this.containerResized();
            g.afterHasDescendantChanged = delegateCombine(g.afterHasDescendantChanged, (j, k) => this.scheduleArrange());
            this._hi();
            this._fy(true);
        }
    }
    scheduleArrange() {
        if (!this._cc) {
            this._cc = true;
            window.setTimeout(runOn(this, this._fx), 0);
        }
    }
    styleUpdated() {
        if (this._az != null) {
            this._az.u();
        }
        if (this._a7 != null) {
            this._a7._hv();
        }
        if (this._bi != null) {
            this._bi.ad = this.css;
        }
        if (this._az != null) {
            this._az.aa();
        }
        if (this._bg != null) {
            this._bg.dp.cp();
            this._bg.dr.cf.e4();
            this._gq();
        }
    }
    _ga() {
        if (this.isInEditMode) {
            let a = this._m();
            if (a != null) {
                let b = a.a7.rootWrapper.getNativeElement();
                let c = b.selectionStart;
                let d = b.selectionEnd;
                let e = b.value;
                let f = (e.substring(c, d));
                let g = ClipboardHelper.d();
                g.setData(DataFormats.d, f);
                ClipboardHelper.c(g, true);
            }
        }
    }
    _fb(a) {
        return this._fa.createElement(a);
    }
    _m() {
        let a = null;
        let b = document.activeElement;
        if (SpreadsheetUtilities.a5(this._ay, b)) {
            a = this._ay;
        }
        else if (SpreadsheetUtilities.a5(this._bh.dp.ci.cf, b)) {
            a = this._bh.dp.ci.cf;
        }
        return a;
    }
    _o(a) {
        return this._bg == null ? null : this._bg.dr.cf.ey(a);
    }
    _n(a) {
        return this._bg == null ? null : this._bg.dr.cf.ex(a);
    }
    _di() {
        if (this._v.isInNameBox) {
            let a = this._bg.dp.cg;
            if (a.cf.a7 != null) {
                let b = a.cf.cr;
                return b != null && b.e;
            }
        }
        return false;
    }
    get _c6() {
        return this._p != null && this._p.c;
    }
    _f7() {
        if (this._p != null) {
            this._p.f();
        }
    }
    _d5(a, b, c, d, e) {
        if (this._p == null) {
            this._p = new CellDropDown(this);
        }
        return this._p.d(a, b, c, d, e);
    }
    _ha(a) {
        let b = this._ay;
        if (b != null && this._m() != b) {
            b.c9 = a;
        }
        this._ai.ar();
        if (this._bg != null) {
            this._bg.dr.cf.cx();
        }
    }
    _dy(a, b, c) {
        if (this._as != null) {
            let d = this._as.k(a, b, c);
            if (d.hasValue) {
                return d.value;
            }
        }
        return this._d0(a, b);
    }
    _h8(a, b) {
        this._eg.add(new Spreadsheet_ButtonElementCommandInfo(a, b, this));
    }
    _r(a, b, c = false) {
        let d = () => this._v.focus();
        return this._q(a, b, d, c);
    }
    _q(a, b, c, d = false) {
        if (this._e9 == null) {
            throw new InvalidOperationException(0);
        }
        let e = this._fa.getWrapper(a);
        this._e9.append(e);
        let f = IgDialogWrapper.a(a, b, d);
        if (null != c) {
            f.closed = delegateCombine(f.closed, (g, h) => c());
        }
        return f;
    }
    _fx() {
        if (this._cc) {
            this._fy(true);
        }
    }
    _fy(a) {
        let b = this._cc;
        this._cc = false;
        this._hq();
        if (this._bg != null) {
            let c = this._bp(LongValue.a(), null);
            for (let d = 0; d < this._eg.count; d++) {
                let e = this._eg._inner[d];
                e.a.u = this._cq(e.c, null, c, true);
            }
            this._bg.al(this._i9.left, this._i9.top, this._i9.width, this._i9.height);
            if (this._bg.t) {
                this._bg.b6();
            }
            let f = new Size(1, this._bg.dr.a3, this._bg.dr.av);
            if (!this._bg.dr.cf.e3) {
                this._bg.dr.cf.ew(f);
            }
            if (!this._bg.dr.cf.e2) {
                this._bg.dr.cf.eu(f);
            }
            this._bg.cb();
            if (a) {
                this._bg.dl();
                this._bg.by(this._bi);
            }
            else {
                if (this._bg.l && b && !this._cc) {
                    this._cc = true;
                }
            }
        }
    }
    _g0(a, b) {
        if (this._i5 != null) {
            ClipboardHelper.b(a, this._i5);
        }
        else {
        }
    }
    _g1() {
        this._u = new SpreadsheetView(this);
        if (ClipboardHelper.e() == null) {
            let a = ClipboardHelper.d();
            a.setData(DataFormats.d, stringEmpty());
            ClipboardHelper.c(a, false);
        }
    }
    get activeCell() {
        return this._ae;
    }
    set activeCell(a) {
        if (SpreadsheetCell.l_op_Inequality(a, this._ae)) {
            let b = this.activeSelection;
            let c = this._ae;
            let d = a;
            this._ae = a;
            this._gd();
            this._c1(true);
            if (b != null) {
                b._setActiveCell(d, Nullable$1.toNullable(Number_$type, null));
            }
            this._i0();
            this.a("ActiveCell");
            this.a("ActiveCellAddress");
            this._fv("ActiveCellChanged", c);
        }
    }
    get activeCellAddress() {
        return this._ae.toString();
    }
    set activeCellAddress(a) {
        this.activeCell = new SpreadsheetCell(a);
    }
    get _am() {
        return this._al;
    }
    set _am(a) {
        if (SpreadsheetCellRange.l_op_Inequality(a, this._al)) {
            this._al = a;
            this._ht(4096 | 8192 | 16777216);
            this._i0();
            this.a("ActiveCellAsRange");
        }
    }
    get activePane() {
        return this._a4;
    }
    set activePane(a) {
        if (a != this._a4) {
            let b = this._a4;
            let c = a;
            this._a4 = a;
            this.activeSelection = c != null ? c.selection : null;
            this._c1(true);
            this._i0();
            this.a("ActivePane");
            this._fv("ActivePaneChanged", b);
        }
    }
    get activeSelection() {
        return this._a9;
    }
    set activeSelection(a) {
        if (a != this._a9) {
            let b = this._a9;
            let c = a;
            this._a9 = a;
            if (b != null) {
                b._x = 0;
            }
            this._gd();
            this._ht(4096);
            let d = b;
            let e = PropertyChangeListenerList.f(SpreadsheetSelection.$, d, c, this._b0, false);
            d = e.p0;
            this.activeCell = c != null ? c.activeCell : new SpreadsheetCell();
            this._am = c != null ? c._r : new SpreadsheetCellRange();
            if (c != null) {
                c._x = this.selectionMode;
            }
            this._i0();
            this.a("ActiveSelection");
        }
    }
    get activeSelectionCellRangeFormat() {
        return this._ao;
    }
    get activeTable() {
        return this._by;
    }
    set activeTable(a) {
        if (a != this._by) {
            let b = this._by;
            this._by = a;
            this.a("ActiveTable");
            this._fv("ActiveTableChanged", b);
        }
    }
    get activeWorksheet() {
        return this._bv;
    }
    set activeWorksheet(a) {
        if (a != this._bv) {
            let b = this._bv;
            let c = a;
            this._bv = a;
            this._eh = null;
            this._ht(4096 | 8192 | 16777216);
            if (c != null && c.workbook != null) {
                c.workbook.windowOptions._ae(c, false);
            }
            this._i0();
            this.a("ActiveWorksheet");
            this._fv("ActiveWorksheetChanged", b);
        }
    }
    get allowAddWorksheet() {
        return this._b8;
    }
    set allowAddWorksheet(a) {
        if (a != this._b8) {
            this._b8 = a;
            this._ht(1);
            this.a("AllowAddWorksheet");
        }
    }
    get allowDeleteWorksheet() {
        return this._b9;
    }
    set allowDeleteWorksheet(a) {
        if (a != this._b9) {
            this._b9 = a;
            this._ht(1);
            this.a("AllowDeleteWorksheet");
        }
    }
    get areGridlinesVisible() {
        return this._ca;
    }
    set areGridlinesVisible(a) {
        if (a != this._ca) {
            this._ca = a;
            if (!this._c2(524288)) {
                this._iy();
                if (this._a7 != null) {
                    this._a7._iq(this.areGridlinesVisible);
                }
            }
            this.a("AreGridlinesVisible");
        }
    }
    get areHeadersVisible() {
        return this._cb;
    }
    set areHeadersVisible(a) {
        if (a != this._cb) {
            this._cb = a;
            if (!this._c2(131072)) {
                this._iy();
                if (this._a7 != null) {
                    this._a7._ir(this.areHeadersVisible);
                }
            }
            this.a("AreHeadersVisible");
        }
    }
    get cellEditMode() {
        return this._aj;
    }
    set cellEditMode(a) {
        if (a != this._aj) {
            this._aj = a;
            this._ah.aq();
            this.a("CellEditMode");
        }
    }
    get chartAdapter() {
        return this._bm;
    }
    set chartAdapter(a) {
        if (a != this._bm) {
            this._bm = a;
            if (this._a7 != null) {
                this._a7._al._l = a;
            }
            this.a("ChartAdapter");
        }
    }
    get enterKeyNavigationDirection() {
        return this._av;
    }
    set enterKeyNavigationDirection(a) {
        if (a != this._av) {
            this._av = a;
            this.a("EnterKeyNavigationDirection");
        }
    }
    get fixedDecimalPlaceCount() {
        return this._fd;
    }
    set fixedDecimalPlaceCount(a) {
        if (a != this._fd) {
            this._fd = a;
            this.a("FixedDecimalPlaceCount");
        }
    }
    get isEnterKeyNavigationEnabled() {
        return this._ce;
    }
    set isEnterKeyNavigationEnabled(a) {
        if (a != this._ce) {
            this._ce = a;
            this._ht(1);
            this.a("IsEnterKeyNavigationEnabled");
        }
    }
    get isFixedDecimalEnabled() {
        return this._cf;
    }
    set isFixedDecimalEnabled(a) {
        if (a != this._cf) {
            this._cf = a;
            this.a("IsFixedDecimalEnabled");
        }
    }
    get isFormulaBarVisible() {
        return this._cg;
    }
    set isFormulaBarVisible(a) {
        if (a != this._cg) {
            this._cg = a;
            this.a("IsFormulaBarVisible");
        }
    }
    get isInEditMode() {
        return this._c2(8388608);
    }
    set isInEditMode(a) {
        if (a != this.isInEditMode) {
            let b = a;
            this._id(8388608, b);
            this._ht(1);
            if (this._a7 != null) {
                this._a7._al._s = b;
            }
            this.a("IsInEditMode");
        }
    }
    get isInEndMode() {
        return this._ch;
    }
    set isInEndMode(a) {
        if (a != this._ch) {
            this._ch = a;
            this._ht(1);
            this.a("IsInEndMode");
        }
    }
    get isRenamingWorksheet() {
        return this._ci;
    }
    set isRenamingWorksheet(a) {
        if (a != this._ci) {
            this._ci = a;
            this.a("IsRenamingWorksheet");
        }
    }
    get isUndoEnabled() {
        return this._ck;
    }
    set isUndoEnabled(a) {
        if (a != this._ck) {
            this._ck = a;
            this._f5(this.undoManager);
            this._id(4, a);
            this.a("IsUndoEnabled");
        }
    }
    get nameBoxWidth() {
        return this._ej;
    }
    set nameBoxWidth(a) {
        if (a != this._ej) {
            this._ej = a;
            this._t.onNameBoxWidthChanged();
            this.a("NameBoxWidth");
        }
    }
    get panes() {
        return this._j;
    }
    _getPanesAsArray() {
        return Enumerable.a(SpreadsheetPane.$, this.panes);
    }
    get selectionMode() {
        return this._aq;
    }
    set selectionMode(a) {
        if (a != this._aq) {
            this._aq = a;
            let b = this.activeSelection;
            if (b != null) {
                b._x = a;
            }
            this._ht(1);
            this.a("SelectionMode");
        }
    }
    get selectedWorksheets() {
        return this._g;
    }
    set selectedWorksheets(a) {
        if (a != this._g) {
            let b = this._g;
            let c = a;
            let d = b != null && b.length > 1;
            let e = c != null && c.length > 1;
            if (e != d) {
                this._ht(1);
            }
            if (c != null && c.length > 0) {
                for (let g = 0; g < c.length; g++) {
                    let f = c[g];
                    if (f == null) {
                        throw new ArgumentException(0);
                    }
                }
                for (let h = 1; h < c.length; h++) {
                    if (c[h].workbook != c[h - 1].workbook) {
                        throw new InvalidOperationException(0);
                    }
                }
                this._g = a;
                let i = c[0].workbook;
                for (let j of fromEnum(i._worksheets$i)) {
                    j._w = arrayIndexOf1(Worksheet.$, c, j) >= 0;
                }
                if (this._dn == false && (i.windowOptions.selectedWorksheet == null || arrayIndexOf1(Worksheet.$, c, i.windowOptions.selectedWorksheet) < 0)) {
                    this.activeWorksheet = Enumerable.ad(Worksheet.$, c);
                }
            }
            else {
                this._g = a;
            }
            this._i0();
            this.a("SelectedWorksheets");
        }
    }
    get undoManager() {
        return this._b4;
    }
    set undoManager(a) {
        if (a != this._b4) {
            if (a == null) {
                throw new InvalidOperationException(1, "UndoManager property can not be set to null. Set IsUndoEnabled to false instead.");
            }
            let b = this._b4;
            let c = a;
            this._b4 = a;
            if (b != null) {
                this._f5(b);
                if (this._b6 != null) {
                    this._b6.e();
                    this._b6 = null;
                }
            }
            this._b3 = c;
            if (c != null) {
                this._b6 = new WeakPropertyChangedHandler$1(Spreadsheet.$, this, c, Spreadsheet._hg);
                c.propertyChanged = delegateCombine(c.propertyChanged, runOn(this._b6, this._b6.f));
            }
            this._ht(16 | 1);
            this.a("UndoManager");
        }
    }
    get validationInputMessagePosition() {
        return this._i6;
    }
    set validationInputMessagePosition(a) {
        if (PointUtil.notEquals(a, this._i6)) {
            this._i6 = a;
            this._iy();
            if (this._a7 != null) {
                this._a7._bc._jg = this.validationInputMessagePosition;
            }
            this.a("ValidationInputMessagePosition");
        }
    }
    _hk(a, b) {
        if (a != null) {
            this._f6(this._b3, a);
            a._i6(this._bs);
            for (let c of fromEnum(a._worksheets$i)) {
                c._fd.clear();
            }
        }
        if (b != null) {
            b._iq(this._bs);
        }
        this._c1(false);
        this._id(2048, false);
        this._be._y = b;
        if (this._u != null) {
            if (!this._c2(2)) {
                this._iy();
            }
            this._i0();
        }
        else {
            this._hs();
        }
    }
    get workbook() {
        return this._bt;
    }
    set workbook(a) {
        if (a != this._bt) {
            let b = this._bt;
            let c = a;
            this._bt = c;
            this._ht(1);
            this._hk(b, c);
            this.a("Workbook");
        }
    }
    get zoomLevel() {
        return this._ff;
    }
    set zoomLevel(a) {
        if (a != this._ff) {
            this._ff = a;
            if (!this._c2(32768)) {
                this._iy();
                if (this._a7 != null) {
                    this._gi(5, () => this._a7._is(this.zoomLevel));
                }
            }
            this.a("ZoomLevel");
        }
    }
    get _a5() {
        return this._a7 != null ? this._a7._ao : null;
    }
    get _ai() {
        return this._ah;
    }
    get _de() {
        return this._bd != null || this.isInEditMode;
    }
    get _dg() {
        return this._c2(2097152);
    }
    get _dh() {
        return this._c2(33554432);
    }
    get _dn() {
        return this._fe > 0;
    }
    get _a3() {
        return this._a2;
    }
    set _a3(a) {
        if (a != this._a2) {
            this._a2 = a;
            if (a == null && this._c2(1)) {
                this._hs();
            }
        }
    }
    get _ef() {
        return this._aa;
    }
    get _ft() {
        return this._fp;
    }
    set _ft(a) {
        if (a != this._fp) {
            this._fp = a;
            this._t.onNameBoxValueChanged();
            this.a("NameBoxValue");
        }
    }
    get _dr() {
        return this._c2(1024);
    }
    set _dr(a) {
        this._ht(1024);
    }
    get _ds() {
        return this._c2(8192);
    }
    set _ds(a) {
        this._ht(8192);
    }
    get _b2() {
        return this._b1;
    }
    get _bl() {
        return this._bk;
    }
    set _bl(a) {
        if (a != this._bk) {
            this._bk = a;
            if (this._a7 != null) {
                this._a7._a6 = a;
            }
            this.a("ResourceProvider");
        }
    }
    get _a8() {
        return this._a7;
    }
    get _bc() {
        return this._bb;
    }
    get _bd() {
        return this._be != null ? this._be._p : null;
    }
    get _bf() {
        return this._be;
    }
    get _u() {
        return this._s;
    }
    set _u(a) {
        this._s = a;
        this._v = this._s;
        if (a != null) {
            if (!this._c2(2)) {
                this._iy();
            }
            this._i0();
        }
    }
    get _v() {
        return this._t;
    }
    set _v(a) {
        let b = a || new Spreadsheet_NullView(this);
        if (b != this._t || this._t == null) {
            this._c1(false);
            this._t = b;
            if (this._a7 != null) {
                this._a7._al._j = this._t.createRenderCache();
            }
            this._go();
        }
    }
    get _x() {
        if (this._w == null) {
            this._w = new SpreadsheetVisualDataManager();
        }
        return this._w;
    }
    exportVisualData() {
        return this._x.exportVisualData(this);
    }
    _hitTest(a) {
        let b = this._v.getLayoutManager();
        return b != null ? b.k(a) : null;
    }
    showFilterDialogForWorksheet(a, b = 13) {
        this._iu();
        let c = new FilterDialogViewModel(0, this.activeWorksheet, a, b);
        let d = this._v;
        d.showFilterDialog(c);
    }
    showFilterDialogForTable(a, b = 13) {
        this._iu();
        if (a == null) {
            throw new ArgumentNullException(1);
        }
        if (a._worksheet != this.activeWorksheet) {
            throw new InvalidOperationException(1, "Cannot show the filter dialog for a table column that is not in the active worksheet.");
        }
        let c = new FilterDialogViewModel(1, a, b);
        let d = this._v;
        d.showFilterDialog(c);
    }
    showTopOrBottomDialogForWorksheet(a) {
        this._iv();
        let b = new TopOrBottomDialogViewModel(0, this.activeWorksheet, a);
        let c = this._v;
        c.showTopOrBottomDialog(b);
    }
    showTopOrBottomDialogForTable(a) {
        this._iv();
        if (a == null) {
            throw new ArgumentNullException(1);
        }
        if (a._worksheet != this.activeWorksheet) {
            throw new InvalidOperationException(1, "Cannot show the Top or Bottom Dialog for a table column that is not in the active worksheet.");
        }
        let b = new TopOrBottomDialogViewModel(1, a);
        let c = this._v;
        c.showTopOrBottomDialog(b);
    }
    _ii(a) {
        this._it();
        if (a == null) {
            throw new ArgumentNullException(0, "sortTarget");
        }
        let b = this._v;
        let c = this._a7;
        let d = c._a1;
        let e = c.activePane;
        let f;
        if (e == null) {
            f = (g) => {
            };
        }
        else {
            let g = e.selection;
            let h = g.activeCell;
            let i = new SpreadsheetSelection(this, c.activePane, true);
            c._a1 = i;
            f = (j) => {
                if (j._n) {
                    let k = SpreadsheetUtilities.z(j);
                    let l = h.row;
                    let m = h.column;
                    if (!k._contains2(l, m)) {
                        m = Math.max(k.firstColumn, Math.min(k.lastColumn, m));
                        l = Math.max(k.firstRow, Math.min(k.lastRow, l));
                    }
                    i._resetSelection2(k, new SpreadsheetCell(l, m), false);
                }
            };
        }
        let j = new SortDialogViewModel(this, a, f);
        let k = () => c._a1 = d;
        b.showCustomSortDialog(j, k);
    }
    _cl(a) {
        return this._a7.activatePane(a);
    }
    _f0() {
        if (this._c2(2097152)) {
            throw new InvalidOperationException(0);
        }
        this._ir();
        this._id(2097152, true);
    }
    _f1(a, b, c, d, e, f) {
        this._iy();
        if (this._a7 != null) {
            this._a7._f4(a, b, c, d, e, f);
        }
    }
    _cw(a, b) {
        if (b) {
            this._iw();
        }
        return this._c2(a ? 32 : 64);
    }
    _cr(a, b, c = true) {
        let d = this._bo(a, b);
        return this._cq(a, b, d, c);
    }
    _cq(a, b, c, d = true) {
        if (false == this._l.c(a, c)) {
            return false;
        }
        switch (a) {
            case 96:
            case 98:
            case 95:
            case 97:
                if (this._a7 != null && !this._a7._bu()) {
                    return false;
                }
                break;
            case 164:
                if (!this._cs()) {
                    return false;
                }
                break;
            case 165:
                if (this._a7 != null && !this._a7._bv(true)) {
                    return false;
                }
                break;
            case 114:
                if (SpreadsheetUtilities.a3(this.workbook)) {
                    return false;
                }
                break;
            case 150:
                if (this._c7()) {
                    return false;
                }
                break;
            case 156:
            case 157:
                if (this._a7 != null && !this._a7._bs(a == 156)) {
                    return false;
                }
                break;
            case 176:
            case 177:
            case 179:
                if (this._a7 == null || !this._a7._bt(a != 179)) {
                    return false;
                }
                break;
            case 188:
            case 190:
                if (this._a7 == null || !this._a7._b8()) {
                    return false;
                }
                break;
            case 189:
                if (this._a7 == null || !this._a7._cx(true, this._ag(b))) {
                    return false;
                }
                break;
            case 187:
            case 186:
            case 195:
            case 196:
            case 197:
            case 203:
                if ((16 & c.i) != 0) {
                    if (SpreadsheetCell._l_op_Equality_Lifted$i(this._fk(b), Nullable$1.toNullable(SpreadsheetCell.$, null))) {
                        return false;
                    }
                }
                if (a == 203) {
                    return false;
                }
                break;
            case 198: return false;
        }
        if (this._bd != null) {
            switch (a) {
                case 86:
                case 85: return false;
            }
        }
        if (d && this.isInEditMode) {
            if (false == this._ah.ab(a)) {
                return false;
            }
        }
        return true;
    }
    _ct(a) {
        if (this._a7 == null) {
            return false;
        }
        if (nullableNotEquals(this._a7._en(), false)) {
            let b = a ? 16 : 8;
            if (nullableNotEquals(this._a7._fj(b), true)) {
                return false;
            }
        }
        return true;
    }
    _cv(a) {
        return this._a7 != null && this._a7._canSelect1(a);
    }
    _cu(a) {
        return this._a7 != null && this._a7._canSelect(a);
    }
    _f8() {
        this._t.closeMenu();
    }
    _ge() {
        this._ht(16 | 1);
    }
    _gf() {
        this._id(2097152, false);
        this._ia();
    }
    _cx(a, b = false, c = false) {
        return this._bb.g(a, b, c);
    }
    _gg(a) {
        let b = this.activePane;
        if (null != b && !b.visibleRange._contains(a)) {
            this._f1(b, a, 0.5, 0.5, 0.5, 0.5);
        }
    }
    _gh(a, b) {
        if (this._a7 != null && this._a7._dl.contains(b) && (this._a7.activePane == b || this._a7.canActivatePane(b) == false)) {
            let c = a.y / b.rowScrollRegion._bx;
            let d = a.x / b.columnScrollRegion._bx;
            let e = new WorksheetItemPosition(), f = new WorksheetItemPosition();
            let g = ((() => { let h = b.rowScrollRegion._az(c, e); e = h.p1; return h.ret; })());
            let h = ((() => { let i = b.columnScrollRegion._az(d, f); f = i.p1; return i.ret; })());
            if (g && h) {
                let i = b._ag.activeCell;
                let j = this._a7._fk(i) == null;
                if (this._ah.y(i, j)) {
                    this._ah.av(a, true);
                }
            }
        }
    }
    _cz(a, b, c) {
        let d = this._bo(a, b);
        return this._c0(a, b, c, d);
    }
    _c0(a, b, c, d) {
        let e = this._v._beforeExecuteCommand$i(a, b, c);
        if (e.hasValue) {
            return e.value;
        }
        if (!this._cq(a, b, d)) {
            return false;
        }
        this._i0();
        let f = new SpreadsheetCommandExecutingEventArgs(a, b, c);
        this._gu(f);
        if (f.cancel) {
            return true;
        }
        let g = true;
        try {
            this._ir();
            if (this._ah.ag(a, false)) {
            }
            else {
                if (!this._d8(a)) {
                    return true;
                }
                if (this._v.isInNameBox) {
                    if (!this._v.focus() || this._v.isInNameBox) {
                        return true;
                    }
                }
                switch (a) {
                    case 1:
                        this._a7._fw();
                        this._gg(this.activeCell);
                        break;
                    case 0:
                        this._a7._fx();
                        this._gg(this.activeCell);
                        break;
                    case 9:
                        this._a7._g3(3, 0, false);
                        break;
                    case 8:
                        this._a7._g3(2, 0, false);
                        break;
                    case 7:
                        this._a7._g3(0, 0, false);
                        break;
                    case 6:
                        this._a7._g3(1, 0, false);
                        break;
                    case 13:
                        this._a7._g3(3, 1, false);
                        break;
                    case 12:
                        this._a7._g3(2, 1, false);
                        break;
                    case 10:
                        this._a7._g3(0, 1, false);
                        break;
                    case 11:
                        this._a7._g3(1, 1, false);
                        break;
                    case 17:
                        this._a7._g3(3, 2, false);
                        break;
                    case 16:
                        this._a7._g3(2, 2, false);
                        break;
                    case 14:
                        this._a7._g3(0, 2, false);
                        break;
                    case 15:
                        this._a7._g3(1, 2, false);
                        break;
                    case 19:
                        this._a7._g4(2, false);
                        break;
                    case 18:
                        this._a7._g4(3, false);
                        break;
                    case 21:
                        this._a7._g4(0, false);
                        break;
                    case 20:
                        this._a7._g4(1, false);
                        break;
                    case 3:
                        this._a7._hc(0);
                        break;
                    case 2:
                        this._a7._hc(1);
                        break;
                    case 4:
                        this._a7._hc(2);
                        break;
                    case 5:
                        this._a7._hc(3);
                        break;
                    case 29:
                        this._a7._ia(3);
                        break;
                    case 28:
                        this._a7._ia(2);
                        break;
                    case 26:
                        this._a7._ia(0);
                        break;
                    case 27:
                        this._a7._ia(1);
                        break;
                    case 25:
                        this._a7._h9(3);
                        break;
                    case 24:
                        this._a7._h9(2);
                        break;
                    case 22:
                        this._a7._h9(0);
                        break;
                    case 23:
                        this._a7._h9(1);
                        break;
                    case 30:
                        this._a7._g6(false, false);
                        break;
                    case 33:
                        this._a7._g6(false, true);
                        break;
                    case 31:
                        this._a7._g5(true, false);
                        break;
                    case 35:
                        this._a7._g5(false, false);
                        break;
                    case 32:
                        this._a7._g7(false, false);
                        break;
                    case 34:
                        this._a7._g7(false, true);
                        break;
                    case 36:
                        this.isInEndMode = true;
                        break;
                    case 37:
                        this.isInEndMode = false;
                        break;
                    case 68:
                        this.selectionMode = 0;
                        break;
                    case 69:
                        this.selectionMode = 1;
                        break;
                    case 70:
                        this.selectionMode = 2;
                        break;
                    case 39:
                        this._a7._hb(false);
                        break;
                    case 38:
                        this._a7._ha(false);
                        break;
                    case 40:
                        this._a7._id();
                        break;
                    case 44:
                        this._a7._g3(3, 0, true);
                        break;
                    case 43:
                        this._a7._g3(2, 0, true);
                        break;
                    case 42:
                        this._a7._g3(0, 0, true);
                        break;
                    case 41:
                        this._a7._g3(1, 0, true);
                        break;
                    case 48:
                        this._a7._g3(3, 1, true);
                        break;
                    case 47:
                        this._a7._g3(2, 1, true);
                        break;
                    case 45:
                        this._a7._g3(0, 1, true);
                        break;
                    case 46:
                        this._a7._g3(1, 1, true);
                        break;
                    case 52:
                        this._a7._g3(3, 2, true);
                        break;
                    case 51:
                        this._a7._g3(2, 2, true);
                        break;
                    case 49:
                        this._a7._g3(0, 2, true);
                        break;
                    case 50:
                        this._a7._g3(1, 2, true);
                        break;
                    case 54:
                        this._a7._g4(2, true);
                        break;
                    case 53:
                        this._a7._g4(3, true);
                        break;
                    case 56:
                        this._a7._g4(0, true);
                        break;
                    case 55:
                        this._a7._g4(1, true);
                        break;
                    case 58:
                        this._a7._g5(true, true);
                        break;
                    case 62:
                        this._a7._g5(false, true);
                        break;
                    case 57:
                        this._a7._g6(true, false);
                        break;
                    case 60:
                        this._a7._g6(true, true);
                        break;
                    case 59:
                        this._a7._g7(true, false);
                        break;
                    case 61:
                        this._a7._g7(true, true);
                        break;
                    case 63:
                        this._a7._ha(true);
                        break;
                    case 64:
                        this._a7._hb(true);
                        break;
                    case 66:
                        this._a7._ie(false);
                        break;
                    case 65:
                        this._a7._ie(true);
                        break;
                    case 67:
                        this._a7._ic();
                        break;
                    case 71:
                        this._a7._g9(true);
                        break;
                    case 72:
                        this._a7._g9(false);
                        break;
                    case 73:
                        this._ah.y(this.activeCell, false);
                        break;
                    case 151:
                        this.cellEditMode = this.cellEditMode == 1 ? 2 : 1;
                        break;
                    case 74:
                        this._ah.y(this.activeCell, true, stringEmpty());
                        break;
                    case 75:
                        this._ah.ae(1, false);
                        break;
                    case 76:
                        this._ah.ae(2, false);
                        break;
                    case 77:
                        this._ah.ae(3, false);
                        break;
                    case 78:
                        this._ah.ae(0, false);
                        break;
                    case 79:
                        this._f3();
                        break;
                    case 158:
                        this._gi(28, () => this._a7._gc(true, true));
                        break;
                    case 80:
                        this._a7._c4();
                        break;
                    case 83:
                        this._a7._ii();
                        break;
                    case 81:
                        this._a7._f6(true);
                        break;
                    case 82:
                        this._a7._f6(false);
                        break;
                    case 84:
                        this._a7._ib();
                        break;
                    case 86:
                        this.undoManager.bf();
                        break;
                    case 85:
                        this.undoManager.a7();
                        break;
                    case 87:
                    case 88:
                        this._ho(a == 88);
                        break;
                    case 92:
                    case 91:
                        this._gl(a == 91, true);
                        break;
                    case 90:
                    case 89:
                        this._gl(a == 89, false);
                        break;
                    case 93:
                    case 94:
                        this._fz(a == 93);
                        break;
                    case 96:
                        this._gr(1);
                        break;
                    case 95:
                        this._gr(2);
                        break;
                    case 97:
                        this._gr(3);
                        break;
                    case 98:
                        this._gr(0);
                        break;
                    case 99:
                        this._gj(0);
                        break;
                    case 100:
                        this._gj(1);
                        break;
                    case 101:
                        this._gj(8);
                        break;
                    case 102:
                        this._gj(9);
                        break;
                    case 103:
                        this._gj(10);
                        break;
                    case 104:
                        this._gj(11);
                        break;
                    case 105:
                        this._gj(5);
                        break;
                    case 106:
                        this._gj(4);
                        break;
                    case 107:
                        this._gj(2);
                        break;
                    case 108:
                        this._gj(3);
                        break;
                    case 109:
                        this._gj(6);
                        break;
                    case 110:
                        this._gj(7);
                        break;
                    case 111:
                        this._gj(12);
                        break;
                    case 112:
                        this._gj(13);
                        break;
                    case 114:
                        this._gj(14);
                        break;
                    case 113:
                        this._h9();
                        break;
                    case 115:
                        this._i4(0);
                        break;
                    case 116:
                        this._i4(1);
                        break;
                    case 117:
                        this._i4(2);
                        break;
                    case 118:
                        this._i4(3);
                        break;
                    case 119:
                        this._ic(Nullable$1.$.specialize(Boolean_$type), SpreadsheetUtilities.c0(this._bx()._c2), SpreadsheetUtilities.ef, 6, 128);
                        break;
                    case 120:
                        this._ic(Nullable$1.$.specialize(Boolean_$type), SpreadsheetUtilities.c0(this._bx()._c3), SpreadsheetUtilities.eo, 7, 1024);
                        break;
                    case 121:
                        this._ic(Nullable$1.$.specialize(Boolean_$type), SpreadsheetUtilities.c0(this._bx()._c4), SpreadsheetUtilities.et, 8, 4096);
                        break;
                    case 160:
                        this._ic(FontUnderlineStyle_$type, SpreadsheetUtilities.al(this._bx()._a1, this._d3()), SpreadsheetUtilities.ew, 20, 16384);
                        break;
                    case 161:
                        this._ic(FontUnderlineStyle_$type, SpreadsheetUtilities.ak(this._bx()._a1, this._d3()), SpreadsheetUtilities.ew, 20, 16384);
                        break;
                    case 122:
                        this._ic(Nullable$1.$.specialize(Boolean_$type), Nullable$1.toNullable(Boolean_$type, this._bx()._b8 ? false : true), SpreadsheetUtilities.ey, 9, 536870912);
                        break;
                    case 162:
                        this._ic(FontSuperscriptSubscriptStyle_$type, this._bx()._a0 == 1 ? 0 : 1, SpreadsheetUtilities.ev, 19, 8192);
                        break;
                    case 163:
                        this._ic(FontSuperscriptSubscriptStyle_$type, this._bx()._a0 == 2 ? 0 : 2, SpreadsheetUtilities.ev, 19, 8192);
                        break;
                    case 123:
                        this._gm(true);
                        break;
                    case 124:
                        this._gm(false);
                        break;
                    case 125:
                        this._ic(Number_$type, SpreadsheetUtilities.cj(this._bx()._cq, true), SpreadsheetUtilities.el, 11, 512);
                        break;
                    case 126:
                        this._ic(Number_$type, SpreadsheetUtilities.cj(this._bx()._cq, false), SpreadsheetUtilities.el, 11, 512);
                        break;
                    case 127:
                        this._ic(HorizontalCellAlignment_$type, SpreadsheetUtilities.aq(this._bx()._a4, 2), SpreadsheetUtilities.ee, 15, 1);
                        break;
                    case 129:
                        this._ic(HorizontalCellAlignment_$type, SpreadsheetUtilities.aq(this._bx()._a4, 1), SpreadsheetUtilities.ee, 13, 1);
                        break;
                    case 130:
                        this._ic(HorizontalCellAlignment_$type, SpreadsheetUtilities.aq(this._bx()._a4, 3), SpreadsheetUtilities.ee, 14, 1);
                        break;
                    case 128:
                        this._ic(HorizontalCellAlignment_$type, SpreadsheetUtilities.aq(this._bx()._a4, 5), SpreadsheetUtilities.ee, 12, 1);
                        break;
                    case 131:
                        this._ic(VerticalCellAlignment_$type, 0, SpreadsheetUtilities.ex, 16, 268435456);
                        break;
                    case 133:
                        this._ic(VerticalCellAlignment_$type, 2, SpreadsheetUtilities.ex, 17, 268435456);
                        break;
                    case 132:
                        this._ic(VerticalCellAlignment_$type, 1, SpreadsheetUtilities.ex, 18, 268435456);
                        break;
                    case 134:
                        this._a7._iy(false);
                        break;
                    case 135:
                        this._a7._iy(true);
                        break;
                    case 137:
                        this._a7._gm(0, 1);
                        break;
                    case 136:
                        this._a7._gm(1, 0);
                        break;
                    case 142:
                    case 140:
                    case 138:
                        this._a7._hy(a != 138, a != 140);
                        break;
                    case 141:
                    case 139:
                    case 143:
                        this._a7._it(a != 139, a != 141);
                        break;
                    case 145:
                        this._gi(24, runOn(this._a7, this._a7._gy));
                        break;
                    case 144:
                        this._gi(22, runOn(this._a7, this._a7._gh));
                        break;
                    case 147:
                        this._gi(25, runOn(this._a7, this._a7._gx));
                        break;
                    case 146:
                        this._gi(22, runOn(this._a7, this._a7._gg));
                        break;
                    case 156:
                        this._gi(23, () => this._a7._gw(Nullable$1.toNullable(Boolean_$type, null)));
                        break;
                    case 157:
                        this._gi(22, () => this._a7._gf(Nullable$1.toNullable(Boolean_$type, null)));
                        break;
                    case 153:
                        this._gi(23, () => this._a7._gw(Nullable$1.toNullable(Boolean_$type, false)));
                        break;
                    case 154:
                        this._gi(22, () => this._a7._gf(Nullable$1.toNullable(Boolean_$type, true)));
                        break;
                    case 152:
                        this._gi(23, () => this._a7._gw(Nullable$1.toNullable(Boolean_$type, true)));
                        break;
                    case 155:
                        this._gi(22, () => this._a7._gf(Nullable$1.toNullable(Boolean_$type, false)));
                        break;
                    case 150:
                        this._hn();
                        break;
                    case 149:
                        this._gb(false);
                        break;
                    case 148:
                        this._gb(true);
                        break;
                    case 159:
                        this._a7._ix();
                        break;
                    case 164:
                        this._hm();
                        break;
                    case 165:
                        this._gi(29, () => this._a7._hw(true));
                        break;
                    case 166:
                        this._gi(30, () => this._a7._hw(false));
                        break;
                    case 167:
                    case 168:
                        this._a7._g8(a == 167);
                        break;
                    case 169:
                        this.nameBoxWidth = 102;
                        break;
                    case 171:
                        this._a7._ge();
                        break;
                    case 170:
                        this._a7._gb();
                        break;
                    case 173:
                        this._cx(false);
                        break;
                    case 172:
                        this._cx(true);
                        break;
                    case 174:
                        this._gi(35, () => this._a7._gz(true));
                        break;
                    case 175:
                        this._gi(36, () => this._a7._fy(true));
                        break;
                    case 176:
                        this._gi(37, () => this._a7._gz(false));
                        break;
                    case 177:
                        this._gi(38, () => this._a7._fy(false));
                        break;
                    case 178:
                        this._gi(39, () => this._a7._gi(true));
                        break;
                    case 179:
                        this._gi(40, () => this._a7._gi(false));
                        break;
                    case 180:
                    case 181:
                        this._a7._ig(a == 181);
                        break;
                    case 182:
                        this._a7._ih();
                        break;
                    case 183:
                        this._gi(32, () => this._a7._bh.isTotalsRowVisible = !this._a7._bh.isTotalsRowVisible);
                        break;
                    case 184:
                        this._gi(33, () => this._a7._bc._tables$i.remove_1(this._a7._bh, true));
                        break;
                    case 185:
                        if (this._a7._cg()) {
                            this._gi(41, () => this._a7._il(false));
                        }
                        else {
                            this._gi(42, () => this._a7._il(true));
                        }
                        break;
                    case 187:
                        this._gi(34, () => this._a7._iu(0, true, this._fk(b)));
                        break;
                    case 186:
                        this._gi(34, () => this._a7._iu(0, false, this._fk(b)));
                        break;
                    case 188:
                        this._gi(44, () => this._a7._gd());
                        break;
                    case 189:
                        this._gi(43, () => this._a7._cx(false, this._ag(b)));
                        break;
                    case 190:
                        this._gi(45, () => this._a7._hu());
                        break;
                    case 192:
                        this._gi(43, () => this._a7._gl(2));
                        break;
                    case 193:
                        this._gi(43, () => this._a7._gl(1));
                        break;
                    case 194:
                        this._gi(43, () => this._a7._gl(3));
                        break;
                    case 191:
                        this._gi(43, () => this._a7._gl(0));
                        break;
                    case 196:
                        this._gi(34, () => this._a7._iu(1, true, this._fk(b)));
                        break;
                    case 197:
                        this._gi(34, () => this._a7._iu(3, true, this._fk(b)));
                        break;
                    case 195:
                        this._gi(34, () => this._a7._iu(2, true, this._fk(b)));
                        break;
                    case 200:
                        this._gs(false);
                        break;
                    case 199:
                        this._gs(true);
                        break;
                    case 201:
                        this._ig();
                        break;
                    case 202:
                        this._ih();
                        break;
                    case 198:
                        this._il();
                        break;
                    case 203:
                        this._im(this._fk(b));
                        break;
                    default:
                        g = false;
                        break;
                }
            }
        }
        finally {
            this._ia();
        }
        this._gt(new SpreadsheetCommandExecutedEventArgs(a, b, c));
        return g;
    }
    _c1(a) {
        if (this.isInEditMode && !this._ah.ae(a ? 1 : 0, true)) {
            return false;
        }
        if (this._bd != null && !this._cx(a, true)) {
            return false;
        }
        return true;
    }
    static _i7(a, b = false) {
        if (a == null) {
            return PointUtil.create();
        }
        let c = a._ag;
        let d = SpreadsheetUtilities.aa(c);
        let e = a.rowScrollRegion._bx;
        let f = c.activeCell;
        let g = Math.min(Math.max(f.column, a.columnScrollRegion.startIndex), a.columnScrollRegion.endIndex);
        let h = Math.min(Math.max(f.row, a.rowScrollRegion.startIndex), a.rowScrollRegion.endIndex);
        let i = false;
        let j = false;
        if (b) {
            d = 2;
        }
        switch (d) {
            case 7:
            case 2: break;
            case 0:
                h = a.rowScrollRegion.startIndex;
                i = true;
                break;
            case 1:
                g = a.columnScrollRegion.startIndex;
                j = true;
                break;
        }
        let k = a.columnScrollRegion._bn(g, j) * e;
        let l = a.rowScrollRegion._bn(h, i) * e;
        return SpreadsheetUtilities.e3(k, l);
    }
    _an() {
        if (this._a7 == null) {
            return SpreadsheetCellRange.empty;
        }
        return this._a7._aa();
    }
    _fr(a) {
        if (a != null) {
            let b = a.chart;
            let c = b.chartTitle;
            if (c == null) {
                return "";
            }
            if (b._seriesCollection$i.count == 1) {
                let d = b._seriesCollection$i.item(0).name;
                if (d != null) {
                    return d.toString();
                }
            }
            else {
                let e = -1;
                for (let f = 0; f < b._seriesCollection$i.count; f++) {
                    let g = b._seriesCollection$i.item(f).values.getValues();
                    if (g != null && g.length > 0) {
                        if (e >= 0) {
                            e = -1;
                            break;
                        }
                        else {
                            e = f;
                        }
                    }
                }
                if (e >= 0) {
                    let h = b._seriesCollection$i.item(e).name;
                    if (h != null) {
                        return h.toString();
                    }
                }
            }
        }
        return this._fs("DefaultChartTitle");
    }
    _fs(a, ...b) {
        let c;
        if (this._e9 != null) {
            c = this._e9.getResourceString(a);
            c = Localization.c("spreadsheet", a);
        }
        else {
            c = Localization.c("spreadsheet", a);
        }
        switch (a) {
            case "NewSheetName":
                c = "Sheet{0}";
                break;
        }
        if (!stringIsNullOrEmpty(c) && b != null && b.length > 0) {
            c = stringFormat1(c, ...b);
        }
        return c;
    }
    _gn() {
        if (this._c2(2)) {
            return;
        }
        this._id(2, true);
        this._i0();
    }
    _dt(a) {
        if (!this._d7(true)) {
            return false;
        }
        return true;
    }
    _g2(a, b) {
        let c = Nullable$1.toNullable(SpreadsheetAction_$type, null);
        if ((a && this._a7._ct(true)) || (b && this._a7._ct(false))) {
            if (a && b) {
                c = Nullable$1.toNullable(SpreadsheetAction_$type, 143);
            }
            else if (a) {
                c = Nullable$1.toNullable(SpreadsheetAction_$type, 141);
            }
            else if (b) {
                c = Nullable$1.toNullable(SpreadsheetAction_$type, 139);
            }
        }
        else {
            if (a && b) {
                c = Nullable$1.toNullable(SpreadsheetAction_$type, 142);
            }
            else if (a) {
                c = Nullable$1.toNullable(SpreadsheetAction_$type, 140);
            }
            else if (b) {
                c = Nullable$1.toNullable(SpreadsheetAction_$type, 138);
            }
        }
        if (nullableNotEquals(c, null)) {
            this._cz(c.value, null, null);
        }
    }
    _g9(a) {
        if (a) {
            if (this._fc == 0) {
                this._e6 = Localization.a;
            }
            this._fc++;
        }
        else {
            this._fc--;
            if (this._fc == 0) {
                Localization.a = this._e6;
                this._e6 = null;
            }
        }
    }
    _dv(a, b) {
        if (this._d7(true)) {
            this._t.focus();
            let c = this.activePane;
            if (c != null) {
                let d = a.g();
                let e = c.rowScrollRegion._ab;
                let f = e._x;
                let g = ((d & 4) != 0) || f == 1;
                let h = ((d & 2) != 0) || f == 2;
                let i = false;
                if (h == g || !g) {
                    let j = this.panes.item(0);
                    let k = j.rowScrollRegion._o;
                    if (k.canActivatePane(j)) {
                        if (k.activatePane(j)) {
                            if (j == this.activePane) {
                                c = j;
                                e = j.selection;
                            }
                        }
                        else {
                            i = true;
                        }
                    }
                }
                if (!i) {
                    let l = this._an();
                    let m = g && !h ? e.activeCell : c.visibleRange._c;
                    if (this._cv(l)) {
                        if (h && !g) {
                            e._addActiveCellRange1(l, m);
                        }
                        else {
                            e._resetSelection2(l, m);
                        }
                    }
                    if (a.a() == 2) {
                        this._v._showSelectAllContextMenu$i(b, a.h());
                    }
                    return true;
                }
            }
        }
        return false;
    }
    _dw(a, b = false, c = false) {
        let d = stringCompare1(a, this._ft, 1) == 0;
        if (d && this._c2(8) && stringCompare1(a, this._ft, 0) == 0) {
            return true;
        }
        let e = this.activeCell;
        let f = this.workbook;
        let g = this.activeWorksheet;
        if (g == null) {
            return false;
        }
        let h = this.activeSelection;
        let i = this.activePane;
        if (h == null || i == null) {
            return false;
        }
        if (!b && this.selectionMode == 1) {
            b = true;
        }
        else if (!c && this.selectionMode == 2) {
            c = true;
        }
        if (b && c) {
            b = c = false;
        }
        let j = null;
        let k = null;
        if (stringIsNullOrWhiteSpace(a)) {
            if (this._y != null) {
                j = this._y;
            }
        }
        else {
            let l = a;
            let m;
            a = a.trim();
            if (stringStartsWith(a, "=")) {
                if (a.length == 1) {
                    return this._dz(new SpreadsheetUserPromptInfo(9, null, null, l, false));
                }
                a = a.substr(1);
            }
            let n = b ? 1 : c ? 2 : 0;
            let o = SelectionSnapshot._d(g, h);
            let p = f.getTable(a);
            if (p != null) {
                let q = SpreadsheetUtilities.z(p.dataAreaRegion._h);
                j = o._e(p.worksheet, q, n);
            }
            else if (stringCompare1(a, "c", 1) == 0) {
                let r = this._an();
                j = o._f(g, new SpreadsheetCellRange(r.firstRow, e.column, r.lastRow, e.column), new SpreadsheetCell(this.activePane.rowScrollRegion.startIndex, e.column), n);
            }
            else if (stringCompare1(a, "r", 1) == 0) {
                let s = this._an();
                j = o._f(g, new SpreadsheetCellRange(e.row, s.firstColumn, e.row, s.lastColumn), new SpreadsheetCell(e.row, this.activePane.columnScrollRegion.startIndex), n);
            }
            else {
                let t = g._rows$i.item(e.row);
                let u = e.column;
                let v = ((() => { let w = f._ar(a, f.cellReferenceMode, g, t, u, m, true); m = w.p5; return w.ret; })());
                if (v == null) {
                    let w = f.cellReferenceMode == 1 ? 0 : 1;
                    v = ((() => { let x = f._ar(a, w, g, t, u, m); m = x.p5; return x.ret; })());
                    if (v != null && w == 1) {
                        return this._dz(new SpreadsheetUserPromptInfo(9, null, null, l, false));
                    }
                }
                if (v != null) {
                    if (m) {
                        v = this._br(v, t, u);
                        if (v == null) {
                            return false;
                        }
                    }
                    if (!((() => { let x = this._d6(v, j, n); j = x.p1; return x.ret; })())) {
                        return this._dz(new SpreadsheetUserPromptInfo(9, null, null, l, false));
                    }
                }
                else {
                    if (g.isProtected) {
                        return false;
                    }
                    try {
                        f._jc(a, null);
                    }
                    catch (x) {
                        return this._dz(new SpreadsheetUserPromptInfo(9, null, x, l, false));
                    }
                    let y = NamedReferenceBase._s(a);
                    let z = y ? g : null;
                    let aa = ExcelUtils.d5(null, g.name);
                    let ab = FormulaParser.bx(f._e6);
                    let ac = new StringBuilder(0);
                    ac.l("=");
                    for (let ad = 0, ae = h.cellRanges.count; ad < ae; ad++) {
                        if (ad > 0) {
                            ac.h(ab);
                        }
                        ac.l(aa);
                        ac.l(h.cellRanges.item(ad)._af(f.cellReferenceMode, false));
                    }
                    try {
                        let af = ac.toString();
                        if (y) {
                            k = f._namedReferences$i._add3(a, af, f.cellReferenceMode, g);
                        }
                        else {
                            k = f._namedReferences$i._add2(a, af, f.cellReferenceMode);
                        }
                    }
                    catch (ag) {
                        return this._dz(new SpreadsheetUserPromptInfo(9, null, ag, l, false));
                    }
                }
            }
        }
        let ah = false;
        if (k != null) {
            ah = true;
        }
        else if (j != null) {
            this._y = SelectionSnapshot._d(g, h);
            ah = j != null && false == j._i(g, h);
            let ai = this._ft;
            this._ie(j, true);
            if (ah && ai != this._ft) {
                ah = false;
            }
        }
        if (this._t.hasKeyboardFocusWithin) {
            this._t.focus();
        }
        if (ah && k != null && this.selectionMode != 0) {
            this._cz(68, null, null);
        }
        return ah;
    }
    _du(a) {
        if (this._a7 == null) {
            return false;
        }
        if (a.b == 1 || a.b == 0) {
            let b = this._a7._bc;
            if (!b.isProtected || b.protection.allowFiltering) {
                if (!this._d7(false) || this.selectedWorksheets == null || this.selectedWorksheets.length > 1) {
                    return false;
                }
                return true;
            }
        }
        else {
            if (!this._d7(false)) {
                return false;
            }
        }
        return true;
    }
    _dz(a) {
        this._h6(a);
        if (a.e) {
            let b = a.h;
            let c = a.b ? 1 : 0;
            let d = a.b && a.c ? 2 : 1;
            let e = this._u.showMessageBox(a.i, b, c, 0, d);
            if (this.isInEditMode && this.cellEditMode == 1) {
                this._cz(151, null, null);
            }
            if (e == 2) {
                return true;
            }
            return false;
        }
        else {
            if (a.b) {
                return a.c;
            }
            return false;
        }
    }
    _hi() {
        if (this._a7 != null) {
            this._a7._hk();
        }
        this._ht(8192 | 16777216);
    }
    _ho(a) {
        let b = SpreadsheetUtilities.o(this.enterKeyNavigationDirection);
        if (a) {
            b = SpreadsheetUtilities.n(b);
        }
        this._a7._hm(b);
    }
    _d0(a, b) {
        let c = false;
        let d = this._bp(LongValue.a(), null);
        let e = this._l.e(a, b, d);
        if (null != e) {
            for (let f of fromEnum(e)) {
                c = this._c0(f, null, this, d) || c;
            }
        }
        return c;
    }
    _d1(a, b) {
        if (this._a7 == null || this._bd != null || this._a2 != null) {
            return false;
        }
        this._a7._cu(a, b);
        return true;
    }
    _hq() {
        if (this._c2(128)) {
            this._id(128, false);
            this._i0();
        }
    }
    _d2(a, b = false) {
        if (this.isInEditMode) {
            return false;
        }
        let c = false;
        if (!stringIsNullOrEmpty(a) && !b) {
            for (let d = 0; d < a.length; d++) {
                let e = a.charAt(d);
                let f = false;
                if (/\s/i.test(e) || isLetterOrDigit(e)) {
                    f = true;
                }
                else {
                    let g = CharUnicodeInfo.e(e);
                    if (SpreadsheetUtilities.bf(g) || SpreadsheetUtilities.bg(g)) {
                        f = true;
                    }
                }
                if (f) {
                    c = true;
                    break;
                }
            }
        }
        if (!c && !b) {
            return false;
        }
        let h = null;
        if (!stringIsNullOrEmpty(a) && a != Environment.newLine && (a.length > 1 || indexOfAny(a, ['\r', '\n']) < 0)) {
            h = a;
        }
        else if (b) {
            h = a;
        }
        this._ah.y(this.activeCell, true, h);
        return true;
    }
    _ia(a = true) {
        this._fe--;
        if (this._fe == 0) {
            this._g9(false);
        }
        if (this._fe == 0 && a && !this._c2(8)) {
            this._i1();
        }
    }
    _d4(a, b) {
        if (!this._du(b)) {
            return false;
        }
        if (b.b == 1 || b.b == 0) {
            return this._v.showFilterMenu(a, b);
        }
        let c = this._a7;
        let d = c._bc;
        let e = c._getCellRange1(b.d, b.c);
        let f = d._rows$i._aj(e.firstRow);
        let g = new List$1(String_$type, 0);
        let h = -1;
        let i = null;
        switch (b.b) {
            case 4:
                {
                    let j = -1;
                    let k = new HashSet$1(String_$type, 0);
                    let l = d._de(e.firstRow, e.firstColumn);
                    let m = (n, o) => {
                        if (n.index != o) {
                            return false;
                        }
                        let p = n._getCellValue1(e.firstColumn);
                        if (p == null) {
                            return false;
                        }
                        if (l == null) {
                            let q = d._de(o, e.firstColumn);
                            if (q != null) {
                                return false;
                            }
                        }
                        if (typeof p === 'string') {
                            k.add_1(p);
                        }
                        else if (typeCast(FormattedString.$, p) !== null) {
                            k.add_1(p.unformattedString);
                        }
                        return true;
                    };
                    let n = l != null ? l.dataAreaRegion.firstRow : 0;
                    let o = l != null ? l.dataAreaRegion.lastRow : d.workbook.maxRowCount - 1;
                    if (e.firstRow > n && (l == null || !l.isHeaderRowVisible || e.firstRow > l._by._ac)) {
                        j = e.firstRow - 1;
                        for (let p of fromEnum(d._rows$i._n(n, e.firstRow - 1, false))) {
                            if (m(p, j)) {
                                j--;
                            }
                            else {
                                break;
                            }
                        }
                    }
                    if (e.firstRow < o && (l == null || !l.isTotalsRowVisible || e.firstRow < l._by._ae)) {
                        j = e.firstRow + 1;
                        for (let q of fromEnum(d._rows$i._m(e.firstRow + 1, o))) {
                            if (m(q, j)) {
                                j++;
                            }
                            else {
                                break;
                            }
                        }
                    }
                    g.o(k);
                    g.y();
                    i = (r) => {
                        if (r < 0 || r >= g.count) {
                            return;
                        }
                        let s = g._inner[r];
                        let t = () => d._rows$i.item(e.firstRow).setCellValue(e.firstColumn, s);
                        this._gi(0, t, [e], void 0, s);
                    };
                }
                break;
            case 2:
                {
                    let r = typeCast(ListDataValidationRule.$, d._dataValidationRules$i._e(new WorksheetRegionAddress(1, e.firstRow, e.firstRow, e.firstColumn, e.firstColumn)));
                    if (r == null) {
                        return false;
                    }
                    let s = new Spreadsheet_CustomEditValueParser(this, d._b4(f, e.firstColumn));
                    let t = r._bj(runOn(s, s.d));
                    if (t != null) {
                        for (let u = 0; u < t.length; u++) {
                            let v = t[u];
                            if (typeCast(Spreadsheet_CustomEditValue.$, v) !== null) {
                                g.add(v.c);
                            }
                            else {
                                g.add(v != null ? v.toString() : "");
                            }
                        }
                    }
                    else {
                        let w = r._bl(new WorksheetCellAddress(1, e.firstRow, e.firstColumn));
                        if (w == null) {
                            return false;
                        }
                        let x = new List$1(Base.$, 0);
                        for (let y of fromEnum(w)) {
                            if (y.isReference) {
                                let z = y._j(false);
                                let aa = typeCast(CellCalcReference.$, z.context);
                                if (aa != null) {
                                    x.add1(aa._w._getCellValue1(aa._ao));
                                    g.add(aa._w._getCellText1(aa._ao, 1));
                                    continue;
                                }
                            }
                            let ab = CalcUtilities.m(y._bj(false, false), true);
                            x.add1(ab);
                            g.add(ab != null ? ab.toString() : "");
                        }
                        t = x.toArray();
                    }
                    let ac = f != null ? f._getCellText1(e.firstColumn, 1) : "";
                    h = g.indexOf(ac);
                    i = (ad) => {
                        if (ad < 0 || ad >= t.length) {
                            return;
                        }
                        this._gi(48, () => {
                            let ae = t[ad];
                            if (typeCast(Spreadsheet_CustomEditValue.$, ae) !== null) {
                                let af = ae;
                                ae = af.b;
                                if (af.a != -1) {
                                    let ag = d.workbook._b2.item(af.a);
                                    d._rows$i.item(e.firstRow)._cellFormatInternal.formatString = ag;
                                }
                            }
                            d._rows$i.item(e.firstRow).setCellValue(e.firstColumn, ae);
                        });
                    };
                }
                break;
            case 3:
                {
                    let ad = d._de(e.firstRow, e.firstColumn);
                    if (ad == null) {
                        return false;
                    }
                    let ae = FormulaParser.bx(d.workbook._e6);
                    let af = f == null ? null : f.getCellFormula(e.firstColumn);
                    let ag = af != null ? af._toString1(1) : null;
                    h = 0;
                    let ah = new List$1(String_$type, 0);
                    let ai = (aj, ak) => {
                        g.add(this._fs(aj));
                        let al = ad._columns$i._item(e.firstColumn - ad._by._w);
                        let am = StructuredTableReference.ad(al.name);
                        let an = "=SUBTOTAL(" + ak + ae + "[" + am + "])";
                        if (an == ag) {
                            h = ah.count;
                        }
                        ah.add(an);
                    };
                    g.add(this._fs("TotalRow_None"));
                    ah.add(null);
                    ai("TotalRow_Average", 101);
                    ai("TotalRow_Count", 103);
                    ai("TotalRow_CountNumbers", 102);
                    ai("TotalRow_Max", 104);
                    ai("TotalRow_Min", 105);
                    ai("TotalRow_Sum", 109);
                    ai("TotalRow_StdDev", 107);
                    ai("TotalRow_Var", 110);
                    i = (aj) => {
                        if (aj < 0 || aj >= ah.count) {
                            return;
                        }
                        this._gi(47, () => {
                            let ak = ah._inner[aj];
                            let al = d._rows$i.item(e.firstRow);
                            if (stringIsNullOrEmpty(ak)) {
                                al.setCellValue(e.firstColumn, null);
                            }
                            else {
                                al._applyCellFormula$i(e.firstColumn, ak, Nullable$1.toNullable(CellReferenceMode_$type, 1));
                            }
                        });
                    };
                }
                break;
        }
        let aj = a.columnScrollRegion._b7(e.firstColumn);
        let ak = e._ad == 1 ? aj : a.columnScrollRegion._b7(e.lastColumn);
        let al = a.rowScrollRegion._b7(e.firstRow);
        let am = al;
        let an = a.columnScrollRegion._bx;
        let ao = a.columnScrollRegion._bm(aj, true) * an;
        let ap = a.columnScrollRegion._bm(ak, false) * an;
        let aq = a.rowScrollRegion._bm(al, true) * an;
        let ar = a.rowScrollRegion._bm(am, false) * an;
        let as = new Rect(0, ao, aq, ap - ao, ar - aq);
        as.union(b.g);
        let at = (au) => {
            if (au >= 0 && au < g.count) {
                this._gz(e._c, g._inner[au]);
            }
            i(au);
        };
        return this._v._showCellDropDown$i(a, as, g, h, at);
    }
    _il() {
        let a = this._v;
        let b = false;
        let c = false;
        let d = false;
        let e = 63;
        let f = null;
        let g;
        let h;
        if (this.isInEditMode) {
            h = FormatCellsDialogDataBuilder.g(this);
            e = 4;
            g = (i) => SetFormatCellsDialogDataHelper.g(this.activeSelectionCellRangeFormat.font, i, h);
        }
        else {
            let i = this.activeSelection;
            let j = Enumerable.a(SpreadsheetCellRange.$, i.cellRanges);
            h = FormatCellsDialogDataBuilder.f(this.selectedWorksheets, j);
            let k = this.activeWorksheet._rows$i._g(i.activeCell.row, false);
            for (let m = 0; m < j.length; m++) {
                let l = j[m];
                if (l._ad > 1) {
                    b = true;
                }
                if (l._aa > 1) {
                    c = true;
                }
            }
            d = this._cr(96, null);
            let p = this.selectedWorksheets;
            for (let o = 0; o < p.length; o++) {
                let n = p[o];
                if (n.isProtected) {
                    e &= ~32;
                }
            }
            if (k != null) {
                f = k._getCellValue1(i.activeCell.column);
                if (typeCast(FormattedString.$, f) !== null) {
                    f = f.unformattedString;
                }
            }
            g = (q) => this._gi(10, () => {
                let r = new SetFormatCellsDialogDataHelper();
                r.e = this._a7;
                r.a = j;
                r.c = q;
                r.b = h;
                r.f();
            }, j);
        }
        h.o = this.workbook;
        let q = h.a();
        let r = ((() => {
            let $ret = new FormatCellsDialogOptions();
            $ret.i = Nullable$1.toNullable(FormatCellsDialogTab_$type, null);
            $ret.b = true;
            $ret.c = true;
            $ret.d = c;
            $ret.e = b;
            $ret.f = d;
            $ret.g = true;
            $ret.h = true;
            return $ret;
        })());
        r.a = e;
        let s = new FormatCellsDialogViewModel(r, h, a.spreadsheetDialogServicesManager, f, this._fl);
        a.showFormatCellsDialog(s, (t) => {
            if (!t.a) {
                g(q);
            }
            this._fl = s._q.b;
        });
    }
    _ir() {
        if (this._fe == 0) {
            this._g9(true);
        }
        this._fe++;
    }
    _d7(a) {
        if (this.isInEditMode && !this._ah.ae(a ? 1 : 0, false, true)) {
            return false;
        }
        if (this._bd != null) {
            if (!this._cx(false) || this._bd != null) {
                return false;
            }
        }
        return true;
    }
    _is() {
        let a = new Workbook(2);
        let b = a._worksheets$i._add1(this._fs("NewSheetName", 1));
        a.windowOptions.selectedWorksheet = b;
        this.workbook = a;
    }
    _i0() {
        if (this._dn || this._c2(8)) {
            return;
        }
        try {
            this._ir();
            this._i1();
        }
        finally {
            this._ia();
        }
    }
    _fv(a, b) {
        if (this._ec == null) {
            this._ec = new Dictionary$2(String_$type, Base.$, 0);
        }
        if (!this._ec.containsKey(a)) {
            this._ec.item(a, b);
            this._ht(134217728);
        }
    }
    _fw() {
        if (this._a7 != null && !this._a7._cj) {
            if (this._c2(134217728)) {
                this._id(134217728, false);
                this._hy();
            }
        }
    }
    _fz(a) {
        let b = a ? 2 : 3;
        this._gi(b, () => this._a7._f1(a));
    }
    _f2() {
        if (this._fu != null) {
            let a = this._fu;
            this._fu = null;
            a.c.c();
        }
    }
    _cs() {
        if (this._a7 != null) {
            let a = this._a7.activePane;
            if (a != null) {
                let b = a._ag;
                if (b.cellRanges.count == 1) {
                    let c = b.cellRanges.item(0);
                    let d = b.activeCell;
                    let e;
                    if (c.isSingleCell) {
                        e = true;
                    }
                    else {
                        let f = b._t(d);
                        e = SpreadsheetCellRange.l_op_Equality(f, c);
                    }
                    if (e) {
                        let g = this._a7._bc._rows$i._aj(d.row);
                        return this._a7._bc._ck(g, d.row, d.column) != null;
                    }
                }
            }
        }
        return false;
    }
    _f3() {
        if (this._a7._c9() == false) {
            return;
        }
        this._gi(1, () => this._a7._ak(0, false), void 0, true);
    }
    _f5(a) {
        this._f6(a, this.workbook);
    }
    _f6(a, b) {
        if (b != null) {
            a.a8((c) => c.d == b);
        }
    }
    _f4(a) {
        let b = this.undoManager;
        if (a != null) {
            b.a8((c) => {
                let d = typeCast(IWorksheetUndoUnit_$type, c);
                return d != null ? d.sheet == a : false;
            }, true);
        }
    }
    _gb(a) {
        let b = this._a7;
        if (a && b._b1(false, true)) {
            return;
        }
        if (!a) {
            let c = b.activePane;
            let d = c != null ? c.selection : null;
            if (null != d && d.cellRanges.count > 1 && b._b1(false, true)) {
                return;
            }
        }
        if (a && !b._da()) {
            return;
        }
        let e = new WorkbookDataObjectManager(this.workbook);
        e.beforeCopying = delegateCombine(e.beforeCopying, (f, g) => {
            if (b._b8(true)) {
                if (this._cz(83, null, null)) {
                    b._i2();
                }
            }
        });
        e.copying = delegateCombine(e.copying, (f, g) => {
            if (!this._t.shouldCopyToClipboard(g._dataObject, g._isDragDrop)) {
                g._cancel = true;
            }
            else if (a) {
                let h = 1;
                this._gi(27, () => {
                    h = b._ak(0, false);
                    if (h == 2) {
                        b._h1(true);
                        b._h0(true);
                        b._gc(false, false);
                    }
                }, void 0, true);
                if (h != 2) {
                    g._cancel = true;
                }
            }
            if (!g._cancel) {
                this._g0(g._dataObject, g._isDragDrop);
            }
        });
        e.settingData = delegateCombine(e.settingData, (f, g) => {
            if (!this._t.shouldIncludeClipboardFormat(g._dataObject, g._format)) {
                g._cancel = true;
            }
        });
        e.error = delegateCombine(e.error, (f, g) => {
            let h = Nullable$1.toNullable(SpreadsheetUserPromptTrigger_$type, null);
            if (typeCast(InvalidMultipleRangeSelection.$, g._exception) !== null) {
                h = Nullable$1.toNullable(SpreadsheetUserPromptTrigger_$type, 18);
            }
            let i = nullableNotEquals(h, null) ? new SpreadsheetUserPromptInfo(h.value, null, g._exception, null, false) : new SpreadsheetUserPromptInfo(14, this._fs("PasteError_General_Message", g._exception.message), g._exception, null, false);
            this._dz(i);
        });
        let f = () => {
            let g = new SpreadsheetUserPromptInfo(31, null, null, null, true);
            g.c = true;
            g.d = false;
            return !this._dz(g);
        };
        e.c(f);
    }
    _gd() {
        this._ht(1024 | 8192);
        this._ab._ai(false);
    }
    _gi(a, b, c = null, d = false, e = null, f = true, g = false) {
        let h = g && !this._c2(4);
        if (h) {
            this._id(4, true);
        }
        try {
            if (this._c2(4)) {
                let i = null;
                let j = this.activePane;
                if (j != null && f) {
                    let k = j.selection;
                    let l = Enumerable.a(SpreadsheetCellRange.$, k.cellRanges);
                    if (c == null && d) {
                        c = l;
                    }
                    let m = new SelectionSnapshot(this._a7._bc, l, k.activeCell, k.activeCellRangeIndex);
                    i = new SpreadsheetSelectionUndoTransaction(this, this._a7._bc, a, e, c, m, runOn(this, this._ie));
                }
                else {
                    if (j != null && c == null && d) {
                        c = Enumerable.a(SpreadsheetCellRange.$, j.selection.cellRanges);
                    }
                    i = new SpreadsheetUndoTransaction(this, this._a7._bc, a, e, c);
                }
                this._b3.az(i, b);
                if (h) {
                    this._b3.a8((n) => n == i, true);
                }
            }
            else {
                b();
            }
        }
        catch (n) {
            if (!(typeCast(EditModeDataValidationException.$, n) !== null)) {
                this._dz(new SpreadsheetUserPromptInfo(19, null, n, enumGetBox(SpreadsheetTransactionOperation_$type, a), false));
            }
        }
        finally {
            if (h) {
                this._id(4, this.isUndoEnabled);
            }
        }
    }
    _gj(a) {
        if (this._bd != null && !this._cx(false, false)) {
            return;
        }
        switch (a) {
            case 14:
                if (this._dz(new SpreadsheetUserPromptInfo(5, null, null, null, true))) {
                    return;
                }
                break;
        }
        this._be._a5(a);
    }
    _fk(a) {
        if (a != null) {
            if (typeof a === 'string') {
                return Nullable$1.toNullable(SpreadsheetCell.$, new SpreadsheetCell(a));
            }
            if (typeCast(SpreadsheetCell.$, a) !== null) {
                return Nullable$1.toNullable(SpreadsheetCell.$, a);
            }
        }
        return Nullable$1.toNullable(SpreadsheetCell.$, null);
    }
    _ag(a) {
        let b = this._fk(a);
        if (b.hasValue) {
            return b.value;
        }
        return this.activeCell;
    }
    _bo(a, b) {
        let c = this._l.b(a);
        let d = c == null ? LongValue.a() : LongValue.c(c.a, c.b);
        return this._bp(d, b);
    }
    _bp(a, b) {
        this._iw();
        let c = new LongValue(0);
        if ((a.j & (1 | 1048576)) != 0) {
            let d = this.workbook;
            if ((a.j & 1) != 0 && d != null) {
                c.j |= 1;
            }
            if ((a.j & 1048576) != 0 && d != null && this.workbook.protection.allowEditStructure == false) {
                c.j |= 1048576;
            }
        }
        if ((a.i & 2) != 0 && this.allowAddWorksheet) {
            c.i |= 2;
        }
        if ((a.i & 4) != 0 && this.allowDeleteWorksheet) {
            c.i |= 4;
        }
        if ((a.j & 4) != 0 && this.panes.count > 1) {
            c.j |= 4;
        }
        if (this._a7 != null) {
            if ((a.j & 2) != 0) {
                c.j |= 2;
            }
            if ((a.j & 65536) != 0 && this._a7._dh.count > 1) {
                c.j |= 65536;
            }
            if ((a.j & 32768) != 0 && this._a7._dn.count > 1) {
                c.j |= 32768;
            }
            if ((a.j & 8) != 0 && this._a7._b9) {
                c.j |= 8;
            }
            if ((a.j & -2147483648) != 0 && this._v.isInNameBox) {
                c.j |= -2147483648;
            }
            if ((a.j & (262144 | 524288)) != 0) {
                if (this._a7.activePane != null) {
                    let e = this._a7.activePane.selection;
                    if ((a.j & 262144) != 0 && e._bj.count > 0) {
                        c.j |= 262144;
                    }
                    if ((a.j & 524288) != 0 && e._bi.count > 0) {
                        c.j |= 524288;
                    }
                }
            }
            if ((a.i & (128 | 256)) != 0) {
                if (this._a7.activePane != null) {
                    let f = this._a7.activePane.selection;
                    if ((a.i & 128) != 0 && f.cellRanges.count > 1) {
                        c.i |= 128;
                    }
                    if ((a.i & 256) != 0 && f.cellRanges.count == 1 && SpreadsheetCellRange.l_op_Equality(f._r, f.cellRanges.item(0))) {
                        c.i |= 256;
                    }
                }
            }
            if (this._a7._bc.isProtected) {
                if ((a.j & 2097152) != 0) {
                    c.j |= 2097152;
                }
                let g = this._a7._bc.protection;
                if ((a.j & 4194304) != 0 && g.selectionMode == 1) {
                    c.j |= 4194304;
                }
                if ((a.j & 8388608) != 0 && g.allowFormattingCells == false) {
                    c.j |= 8388608;
                }
                if ((a.j & 16777216) != 0 && g.allowFormattingColumns == false) {
                    c.j |= 16777216;
                }
                if ((a.j & 33554432) != 0 && g.allowFormattingRows == false) {
                    c.j |= 33554432;
                }
                if ((a.j & 67108864) != 0 && g.allowInsertingColumns == false) {
                    c.j |= 67108864;
                }
                if ((a.j & 134217728) != 0 && g.allowInsertingRows == false) {
                    c.j |= 134217728;
                }
                if ((a.j & 268435456) != 0 && g.allowDeletingColumns == false) {
                    c.j |= 268435456;
                }
                if ((a.j & 536870912) != 0 && g.allowDeletingRows == false) {
                    c.j |= 536870912;
                }
                if ((a.i & 32) != 0 && g.allowSorting == false) {
                    c.i |= 32;
                }
                if ((a.i & 64) != 0 && g.allowFiltering == false) {
                    c.i |= 64;
                }
            }
            if ((a.i & 8) != 0 && this.activeTable != null) {
                c.i |= 8;
            }
            if ((a.i & 16) != 0) {
                if (this._a7._cb()) {
                    c.i |= 16;
                }
            }
        }
        if ((a.j & 16) != 0) {
            if (this._v.isScrollLockToggled) {
                c.j |= 16;
            }
        }
        if ((a.j & 32) != 0 && this.isInEndMode) {
            c.j |= 32;
        }
        let h = 64 | 128 | 256;
        if ((a.j & h) != 0) {
            switch (this.selectionMode) {
                case 0:
                    c.j |= 64;
                    break;
                case 1:
                    c.j |= 128;
                    break;
                case 2:
                    c.j |= 256;
                    break;
            }
        }
        if ((a.j & 512) != 0 && this.isInEditMode) {
            c.j |= 512;
        }
        if ((a.i & 1) != 0 && this._bd != null) {
            c.i |= 1;
        }
        if ((a.j & 1024) != 0 && this._c2(32)) {
            c.j |= 1024;
        }
        if ((a.j & 2048) != 0 && this._c2(64)) {
            c.j |= 2048;
        }
        if ((a.j & 4096) != 0 && this.isEnterKeyNavigationEnabled) {
            c.j |= 4096;
        }
        if ((a.j & 8192) != 0 && this._be._ae) {
            c.j |= 8192;
        }
        if ((a.j & 16384) != 0 && this._be._ac) {
            c.j |= 16384;
        }
        if ((a.j & 131072) != 0 && this._be._j.count > 1) {
            c.j |= 131072;
        }
        if ((a.j & 1073741824) != 0 && this.cellEditMode == 2) {
            c.j |= 1073741824;
        }
        return c;
    }
    _c2(a) {
        return (this._z & a) != 0;
    }
    _br(a, b, c) {
        let d = typeCast(NamedCalcReference.$, a);
        if (d == null) {
            return null;
        }
        let e = b._as(c);
        return d._a3._bo(true, e);
    }
    _bx() {
        let a = this._a7.activePane.selection;
        let b = a.activeCell;
        let c = this._a7._bc._rows$i._aj(b.row);
        let d = this._a7._bc._b4(c, b.column);
        return d;
    }
    _ee() {
        let a = this.activeSelection;
        return a != null ? a.cellRanges : boxArray$1(new Array(0));
    }
    _gl(a, b) {
        let c = b ? 2 : 3;
        this._gi(c, () => this._a7._gp(a, b));
    }
    _gm(a) {
        if (this._a7 == null || this._a7.activePane == null) {
            return;
        }
        let b = this._a7.activePane.selection;
        this._gi(10, () => this._a7._f7(a));
    }
    _go() {
        this._ah = this._t.createCellEditManager() || new Spreadsheet_NullCellEditManager(this);
        this._bb = this._t.createTabEditManager() || new Spreadsheet_NullTabEditManager(this);
        this.a("CellEditManager");
        this.a("TabEditManager");
    }
    _gp(a, b) {
        if (this._a7 != null) {
            let c = this._a7._bc;
            let d = this._c2(a);
            this._id(a, true);
            try {
                b(c);
            }
            finally {
                this._id(a, d);
            }
        }
    }
    static _c4(a) {
        switch (a.a) {
            case 5:
            case 24:
            case 81:
            case 82:
            case 83:
            case 89:
            case 4:
            case 27:
            case 61:
            case 85:
            case 88:
            case 87:
            case 66:
            case 68:
            case 69:
            case 67:
            case 70:
            case 71:
            case 16:
            case 47:
            case 48:
            case 49:
            case 42:
            case 43:
            case 44:
            case 45:
            case 72:
            case 73:
            case 74:
            case 75:
            case 76:
            case 84:
            case 77:
            case 78: return true;
        }
        return false;
    }
    static _c5(a) {
        switch (a.a) {
            case 4:
            case 27:
            case 61:
            case 66:
            case 68:
            case 69:
            case 67:
            case 70:
            case 71:
            case 85:
            case 88:
            case 87: return true;
        }
        return false;
    }
    _c7() {
        if (this._b7) {
            return false;
        }
        try {
            let a = ClipboardHelper.e();
            return WorkbookDataObjectManager.d(a) == false;
        }
        catch (b) {
            this._b7 = true;
            return false;
        }
    }
    static _dc(a) {
        switch (a.a) {
            case 5: return true;
        }
        return Spreadsheet._c5(a);
    }
    static _dj(a) {
        switch (a.a) {
            case 87:
            case 90:
            case 9:
            case 65:
                if (a.c == "IsProtected") {
                    return true;
                }
                break;
            case 103:
                if (a.c == "SelectionMode") {
                    return true;
                }
                break;
            case 1:
            case 23:
            case 38:
            case 2:
            case 22:
            case 80:
            case 73:
            case 84:
            case 79:
            case 75:
            case 76:
            case 77:
            case 78: return true;
        }
        return false;
    }
    static _dm(a) {
        switch (a.a) {
            case 17:
            case 53:
            case 54:
            case 25:
            case 73:
            case 84:
            case 79:
            case 92:
            case 91: return true;
            case 87:
                switch (a.c) {
                    case "":
                    case "CellReferenceMode":
                    case "CurrentFormat": return true;
                }
                break;
            case 52:
            case 72:
                switch (a.c) {
                    case "Name": return true;
                }
                break;
        }
        return false;
    }
    static _dq(a) {
        switch (a.a) {
            case 99: return false;
            case 86:
                switch (a.c) {
                    case "BoundsInTwips":
                    case "FirstVisibleTabIndex":
                    case "Minimized":
                    case "TabBarWidth":
                    case "SelectedSheet": return false;
                }
                break;
            case 65:
                switch (a.c) {
                    case "IsTabSelected": return false;
                }
                break;
        }
        return true;
    }
    _gr(a) {
        this._gi(4, () => this._a7._g2(a));
    }
    _gs(a) {
        if (this._a7 == null) {
            return;
        }
        let b = this._a7.activePane.selection;
        b._by();
        if (this._a7._bh == null) {
            return;
        }
        let c = this._a7._bh;
        let d = b.activeCell;
        let e = c._by;
        let f = c.dataAreaRegion;
        let g = f != null && f._q(d.row, d.column);
        let h = !g && c.isHeaderRowVisible && d.row == e._ac;
        let i = this._a7._bc;
        if (!g && !h) {
            this._a7._hc(a ? 1 : 0);
            return;
        }
        let j = e._ae;
        let k = e._ac;
        let l = false;
        if (a) {
            let m = i._rows$i._aj(e._ae);
            let n = (i._dv && m == null) || (m != null && m.hidden);
            l = !n;
            if (l && !c.isTotalsRowVisible) {
                j = Math.min(this._a7._aa().lastRow, e._ae + 1);
            }
        }
        else {
            if (c.isTotalsRowVisible) {
                j = e._ae - 1;
            }
        }
        if (!h) {
            k += 1;
        }
        let o = new SpreadsheetCellRange(k, e._w, j, e._x);
        let p = a ? this._a7._fa(o, Nullable$1.toNullable(SpreadsheetCell.$, d)) : this._a7._fg(o, Nullable$1.toNullable(SpreadsheetCell.$, d));
        if (SpreadsheetCell._l_op_Equality_Lifted$i(p, Nullable$1.toNullable(SpreadsheetCell.$, null))) {
            p = a ? this._a7._fa(o, Nullable$1.toNullable(SpreadsheetCell.$, null)) : this._a7._fg(o, Nullable$1.toNullable(SpreadsheetCell.$, null));
        }
        else if (a) {
            if (l && p.value.row == o.lastRow && e._ae < this._a7._aa().lastRow) {
                this._gi(38, () => {
                    let q = false;
                    let r = i._rows$i._aj(o.lastRow);
                    if (r != null) {
                        for (let s of fromEnum(r._ch(o.firstColumn, o.lastColumn, true))) {
                            if (s.o) {
                                q = true;
                                break;
                            }
                        }
                    }
                    if (q) {
                        c.insertDataRows(f._aa);
                    }
                    else {
                        let t = new WorksheetRegion(i, e._ac, e._w, e._ae + 1, e._x);
                        c._resize(t);
                    }
                });
            }
        }
        if (SpreadsheetCell._l_op_Equality_Lifted$i(p, Nullable$1.toNullable(SpreadsheetCell.$, null))) {
            return;
        }
        this._a7._ik(p.value, false, Nullable$1.toNullable(SpreadsheetCellRange.$, new SpreadsheetCellRange(p.value.row, p.value.column)));
    }
    _hm() {
        let a = this.activeSelection;
        if (a != null && a.cellRanges.count == 1) {
            let b = a.cellRanges.item(0);
            let c = a.activeCell;
            let d = a._t(c);
            if (SpreadsheetCellRange.l_op_Equality(d, b)) {
                let e = this._a7._bc;
                let f = e._rows$i._aj(c.row);
                let g = e._ck(f, c.row, c.column);
                if (g != null) {
                    this._i2(g);
                }
            }
        }
    }
    _dx(a) {
        let b = a.e(true);
        let c = new SpreadsheetEditRangePasswordNeededEventArgs(b, boxArray$1(Enumerable.a(Worksheet.$, Enumerable.o(LockedEditRangeInfoForWorksheet.$, Worksheet.$, a.c, (d) => d.b))));
        this._h4(c);
        return c.cancel == false;
    }
    _he(a, b, c) {
        switch (b != null ? b : "") {
            case "Add":
            case "Remove":
            case "Replace":
            case "Move":
            case "Reset":
                if (this._a7 != null && this._a7._ck(a)) {
                    this._ht(1);
                }
                else if (this._be._af(a)) {
                    this._ht(512);
                }
                else {
                    let d = getInstanceType(a);
                    if (d == SpreadsheetUtilities.d3 || d == SpreadsheetUtilities.d2) {
                        this._ht(4096 | 1);
                    }
                }
                break;
            case "ActivePane":
                if (a == this._a7) {
                    this.activePane = this._a7.activePane;
                }
                break;
            case "ActiveTable":
                if (a == this._a7) {
                    this.activeTable = this._a7._bh;
                }
                break;
            case "ZoomLevel":
                if (a == this._a7) {
                    this._ht(65536);
                }
                break;
            case "ActiveCellInputMessagePosition":
                if (a == this._a7) {
                    this._ht(67108864);
                }
                break;
            case "ActiveCell":
                if (a == this.activeSelection) {
                    this.activeCell = this.activeSelection.activeCell;
                }
                break;
            case "ActiveCellAsRange":
                if (a == this.activeSelection) {
                    this._am = this.activeSelection._r;
                }
                break;
            case "ActiveTab":
                if (a == this._be) {
                    this._ht(256);
                }
                break;
            case "IsNextItemOutOfView":
            case "IsPreviousItemOutOfView":
                if (a == this._be) {
                    this._ht(1);
                }
                break;
            case "TabInEdit":
                if (a == this._be) {
                    this._ht(16384);
                }
                break;
        }
    }
    static _hd(a, b, c, d) {
        a._he(b, c, d);
    }
    static _hg(a, b, c) {
        let d = c.propertyName;
        if (stringIsNullOrEmpty(d) || d == "CanUndo" || d == "CanRedo") {
            a._ht(16);
        }
    }
    _hj($tContext, $tValue, a, b) {
        let c = this._a7;
        let d = b.k(a);
        if (c != null && (c._bc == d || d == null)) {
            c._hd($tContext, $tValue, a, b);
            if (!this._c2(16777216 | 8192) && Spreadsheet._c4(b)) {
                this._ht(16777216 | 8192);
            }
        }
        if (this._be != null) {
            this._be._a6(b);
        }
        if (!this._ab._ab) {
            if (Spreadsheet._c5(b)) {
                this._gd();
            }
        }
        if (this._eh != null || !this._c2(4096)) {
            if (Spreadsheet._dm(b)) {
                this._eh = null;
                this._ht(4096);
            }
        }
        if (!this._c2(1)) {
            if (Spreadsheet._dj(b)) {
                this._ht(1);
            }
        }
        if (!this._c2(8192)) {
            if (Spreadsheet._dc(b)) {
                this._ht(8192);
            }
        }
        if (!this._c2(2048)) {
            if (Spreadsheet._dq(b)) {
                this._ht(2048);
            }
        }
        if (!this._c2(128)) {
            this._id(128, true);
            this._v.onHasPendingChangeNotification();
        }
        switch (b.a) {
            case 87:
                if (b.c == "CurrentFormat") {
                    this._ir();
                    try {
                        if (this._a7 != null) {
                            this._a7._hg();
                        }
                    }
                    finally {
                        this._ia();
                    }
                    this._f6(this._b3, this.workbook);
                }
                break;
            case 35:
                this._ht(1048576 | 262144);
                break;
            case 9:
            case 90:
            case 65:
                if (b.c == "IsProtected") {
                    if (d != null && d.isProtected) {
                        this._f4(d);
                    }
                }
                break;
        }
    }
    _hn() {
        let a = this._a7;
        let b = new WorkbookDataObjectManager(this.workbook);
        let c = null;
        b.error = delegateCombine(b.error, (d, e) => {
            if (this._a7 != null) {
                this._a7._gt();
            }
            let f = typeCast(WorkbookSerializationLoadException.$, e._exception);
            let g = Nullable$1.toNullable(SpreadsheetUserPromptTrigger_$type, null);
            if (f != null) {
                switch (f._c) {
                    case 2:
                        g = Nullable$1.toNullable(SpreadsheetUserPromptTrigger_$type, 10);
                        break;
                    case 1:
                        g = Nullable$1.toNullable(SpreadsheetUserPromptTrigger_$type, 11);
                        break;
                    case 0:
                        g = Nullable$1.toNullable(SpreadsheetUserPromptTrigger_$type, 13);
                        break;
                    case 3:
                        g = Nullable$1.toNullable(SpreadsheetUserPromptTrigger_$type, 12);
                        break;
                    case 5:
                        g = Nullable$1.toNullable(SpreadsheetUserPromptTrigger_$type, 15);
                        break;
                    case 4:
                        g = Nullable$1.toNullable(SpreadsheetUserPromptTrigger_$type, 16);
                        break;
                    case 6:
                        g = Nullable$1.toNullable(SpreadsheetUserPromptTrigger_$type, 7);
                        break;
                    default: break;
                }
            }
            else if (typeCast(InvalidMultipleRangeSelection.$, e._exception) !== null) {
                g = Nullable$1.toNullable(SpreadsheetUserPromptTrigger_$type, 12);
            }
            let h = nullableNotEquals(g, null) ? new SpreadsheetUserPromptInfo(g.value, null, e._exception, null, false) : new SpreadsheetUserPromptInfo(14, this._fs("PasteError_General_Message", e._exception.message), e._exception, null, false);
            this._dz(h);
            if (c != null) {
                this._ie(c, false);
            }
        });
        b.pasting = delegateCombine(b.pasting, (d, e) => {
            this._v.onDataObjectPasting(e);
            if (!e._cancel && e._dataObject != null) {
                if (a._b8(true)) {
                    c = SelectionSnapshot._d(this.activeWorksheet, this.activeSelection);
                    if (this._cz(83, null, null)) {
                        a._i2();
                    }
                }
            }
        });
        let d = null;
        let e = (f, g, h) => {
            let i = Enumerable.a(Worksheet.$, f);
            let j = Enumerable.a(WorksheetRegionAddress.$, g);
            let k = f.item(0).workbook.windowOptions.selectedWorksheet;
            let l = k.displayOptions._af.a(k.displayOptions._z);
            let m = this._ea(f, g, h);
            if (m) {
                TableExpansionInfo.f(i, j, l.b);
                d = TableExpansionInfo.a(i, j);
            }
            return m;
        };
        let f = ((() => {
            let $ret = new WorkbookSerializationLoadOptions();
            $ret.b = 8370167;
            $ret.g = this.fixedDecimalPlaceCount;
            $ret.c = this.isFixedDecimalEnabled;
            $ret.d = false;
            $ret.a = 0;
            $ret.e = runOn(this, this._d9);
            $ret.f = runOn(this, this._ea);
            return $ret;
        })());
        let g = false;
        this._gi(26, () => g = b.e(f));
        if (g) {
            if (this._a7 != null) {
                this._a7._gt();
            }
            if (d != null) {
                this._gi(46, runOn(d, d.g));
            }
        }
    }
    _hp(a) {
        if (this._c2(16777216)) {
            if (a) {
                this._f2();
                this._id(16777216, false);
                let b = this._c2(33554432);
                this._id(33554432, true);
                try {
                    this._ah.ao();
                }
                finally {
                    this._id(33554432, b);
                }
            }
            else {
                if (this._fu == null || SpreadsheetCell.l_op_Inequality(this._fu.d, this.activeCell)) {
                    this._f2();
                    this._fu = Tuple.a(TimedOperation.$, SpreadsheetCell.$, new TimedOperation(() => this._hp(true), 250), this.activeCell);
                }
            }
        }
    }
    _hs() {
        if (!this._c2(8)) {
            this._bq.m();
        }
    }
    _ht(a) {
        if ((this._z & a) != a) {
            this._id(a, true);
            this._hs();
        }
    }
    _hy() {
        let a = this._ec;
        this._ec = null;
        let b;
        if (a != null) {
            let c = this.activeCell;
            let d = this.activePane;
            let e = this.activeTable;
            let f = this.activeWorksheet;
            if (((() => { let g = a.tryGetValue("ActiveCellChanged", b); b = g.p1; return g.ret; })()) && a.removeItem("ActiveCellChanged")) {
                this._gv(new SpreadsheetActiveCellChangedEventArgs(b, c));
            }
            if (((() => { let g = a.tryGetValue("ActivePaneChanged", b); b = g.p1; return g.ret; })()) && a.removeItem("ActivePaneChanged")) {
                this._gw(new SpreadsheetActivePaneChangedEventArgs(b, d));
            }
            if (((() => { let g = a.tryGetValue("ActiveTableChanged", b); b = g.p1; return g.ret; })()) && a.removeItem("ActiveTableChanged")) {
                this._gx(new SpreadsheetActiveTableChangedEventArgs(b, e));
            }
            if (((() => { let g = a.tryGetValue("ActiveWorksheetChanged", b); b = g.p1; return g.ret; })()) && a.removeItem("ActiveWorksheetChanged")) {
                this._gy(new SpreadsheetActiveWorksheetChangedEventArgs(b, f));
            }
        }
    }
    _h9() {
        this._bb.e();
    }
    _ic($t, a, b, c, d) {
        if (this._a7 != null && this._a7.activePane != null) {
            let e = this._a7.activePane.selection;
            this._gi(c, () => this._a7._io($t, a, b, e.cellRanges, d));
            this._ht(1024);
        }
    }
    _id(a, b) {
        if (b) {
            this._z |= a;
        }
        else {
            this._z &= ~a;
        }
    }
    _ie(a, b) {
        if (a == null) {
            return;
        }
        let c = a._h;
        if (c == null) {
            return;
        }
        let d = this.workbook;
        if (d == null || d != c.workbook) {
            return;
        }
        let e = false;
        if (c != null && c != this.activeWorksheet) {
            d.windowOptions.selectedWorksheet = c;
            e = true;
            this._i1();
        }
        let f = this.activeSelection;
        if (f != null) {
            f._resetSelection(a._a, a._g, a._j, b);
            if (this._a7 != null && this._a7._bc == c) {
                if (e) {
                    this._v.remeasureRootPanel();
                }
                this._a7._f5(null, a._a[a._j]);
            }
        }
    }
    _d3() {
        return SpreadsheetUtilities.p(this._bx()._cs) == 3;
    }
    _ig() {
        if (this._a7 == null) {
            return;
        }
        let a = new List$1(SpreadsheetDropDownButton.$, 0);
        let b = this._a7._ao;
        let c = b._ag.activeCell;
        this._a7._b6(a, b, c.row, c.row, c.column, c.column, null);
        if (a.count > 0) {
            this._v.focus();
            let d = a._inner[0];
            SpreadsheetPaneButtonLayer._w(b, d, this._b2);
            this._d4(this._a5, d);
        }
        else {
            this._ih();
        }
    }
    _ih() {
        if (this._a7 == null) {
            return;
        }
        if (this._a7._bc.isProtected) {
            return;
        }
        let a = this._a7._ao;
        let b = a._ag.activeCell;
        this._v.focus();
        let c = new SpreadsheetDropDownButton();
        c.b = 4;
        c.d = b.row;
        c.c = b.column;
        SpreadsheetPaneButtonLayer._w(a, c, this._b2);
        this._d4(this._a5, c);
    }
    _im(a) {
        let b = this._a7;
        if (b == null) {
            return;
        }
        let c = b._q(a);
        if (c == null) {
            return;
        }
        this._ii(c);
    }
    _d6(a, b, c = 0) {
        let d = a._am();
        if (d == null || d.count == 0) {
            b = null;
            return {
                ret: false,
                p1: b
            };
        }
        let e = a._u;
        let f = -1;
        let g = new List$1(SpreadsheetCellRange.$, 0);
        let h = new SpreadsheetCell();
        switch (c) {
            default:
            case 0:
                {
                    let i = a._v();
                    for (let j = 0; j < d.count; j++) {
                        g.add(SpreadsheetPaneManager._extendRangeForMergedCells1(e, SpreadsheetUtilities.z(d.item(j)._h)));
                    }
                    f = d.indexOf(i);
                    if (f < 0) {
                        f = g.count - 1;
                    }
                    h = g._inner[f]._c;
                    break;
                }
            case 2:
                {
                    if (e != this.activeWorksheet) {
                        b = null;
                        return {
                            ret: false,
                            p1: b
                        };
                    }
                    g.o(this.activeSelection.cellRanges);
                    for (let k = 0; k < d.count; k++) {
                        g.add(SpreadsheetPaneManager._extendRangeForMergedCells1(e, SpreadsheetUtilities.z(d.item(k)._h)));
                    }
                    f = g.count - 1;
                    h = g._inner[f]._c;
                    break;
                }
            case 1:
                {
                    if (e != this.activeWorksheet) {
                        b = null;
                        return {
                            ret: false,
                            p1: b
                        };
                    }
                    g.o(this.activeSelection.cellRanges);
                    h = this.activeSelection.activeCell;
                    f = this.activeSelection.activeCellRangeIndex;
                    g._inner[f] = SpreadsheetPaneManager._getCellRange2(h.row, h.column, e);
                    for (let l = 0; l < d.count; l++) {
                        g._inner[f] = g._inner[f].union(SpreadsheetUtilities.z(d.item(l)._h));
                    }
                    g._inner[f] = SpreadsheetPaneManager._extendRangeForMergedCells1(e, g._inner[f]);
                    break;
                }
        }
        if (f < 0) {
            f = g.count - 1;
        }
        b = new SelectionSnapshot(e, g.toArray(), h, f);
        return {
            ret: true,
            p1: b
        };
    }
    _d8(a) {
        if (!this.isInEditMode) {
            return true;
        }
        switch (a) {
            default: return true;
            case 0:
            case 1:
            case 6:
            case 7:
            case 8:
            case 9:
            case 10:
            case 11:
            case 12:
            case 13:
            case 14:
            case 15:
            case 16:
            case 17:
            case 18:
            case 19:
            case 20:
            case 21:
            case 30:
            case 31:
            case 32:
            case 33:
            case 34:
            case 35:
            case 2:
            case 3:
            case 4:
            case 5:
            case 38:
            case 39:
            case 71:
            case 72:
            case 87:
            case 88:
            case 85:
            case 86:
            case 79:
            case 81:
            case 82:
            case 104:
            case 103:
            case 110:
            case 109:
            case 101:
            case 102:
            case 199:
            case 200:
            case 201: return this._d7(true);
            case 107:
            case 108:
            case 106:
            case 105:
            case 22:
            case 23:
            case 24:
            case 25:
            case 26:
            case 27:
            case 28:
            case 29: return true;
            case 36:
            case 37: return this._d7(true);
            case 68:
            case 69:
            case 70: return true;
            case 202: return false;
            case 198: return true;
            case 73:
            case 74:
            case 151:
            case 75:
            case 76:
            case 77:
            case 78:
            case 173:
            case 172: return true;
            case 41:
            case 42:
            case 43:
            case 44:
            case 45:
            case 46:
            case 47:
            case 48:
            case 40:
            case 49:
            case 50:
            case 51:
            case 52:
            case 53:
            case 54:
            case 55:
            case 56:
            case 57:
            case 58:
            case 59:
            case 60:
            case 61:
            case 62:
            case 63:
            case 64:
            case 65:
            case 66:
            case 67:
            case 83:
            case 84:
            case 80: return this._d7(true);
        }
    }
    _d9(a) {
        if (a > 16384000) {
            let b = new SpreadsheetUserPromptInfo(29, null, null, null, true);
            b.c = true;
            b.d = false;
            if (this._dz(b)) {
                return false;
            }
        }
        return true;
    }
    _ea(a, b, c) {
        if (this._a7 != null && !this._a7._c8(a, b, c)) {
            return false;
        }
        return true;
    }
    _iu() {
        if (this.workbook == null) {
            throw new InvalidOperationException(1, "The Workbook property cannot be null");
        }
        if (this.selectedWorksheets.length != 1) {
            throw new InvalidOperationException(1, "Showing the filter dialog requires one (and one only) selected worksheet.");
        }
    }
    _iv() {
        if (this.workbook == null) {
            throw new InvalidOperationException(1, "The Workbook property cannot be null");
        }
        if (this.selectedWorksheets.length != 1) {
            throw new InvalidOperationException(1, "Showing the filter dialog requires one (and one only) selected worksheet.");
        }
    }
    _it() {
        if (this.workbook == null) {
            throw new InvalidOperationException(1, "The Workbook property cannot be null");
        }
        if (this.selectedWorksheets.length != 1) {
            throw new InvalidOperationException(1, "Showing the filter dialog requires one (and one only) selected worksheet.");
        }
    }
    _iw() {
        if (this._c2(16)) {
            let a = this.undoManager;
            this._id(16, false);
            let b, c;
            if (!this.isInEditMode) {
                b = a != null && a.aa;
                c = a != null && a.z;
            }
            else {
                c = this._ai.ac;
                b = this._ai.ad;
            }
            if (b != this._c2(32) || c != this._c2(64)) {
                this._id(64, c);
                this._id(32, b);
                this._id(1, true);
            }
        }
    }
    _ix() {
        let a = this._bt;
        if (a == null) {
            return;
        }
        let b = a.windowOptions.selectedWorksheet;
        if (b == null) {
            for (let c of fromEnum(a._worksheets$i)) {
                if (c._w) {
                    b = c;
                    break;
                }
            }
            if (b == null) {
                for (let d of fromEnum(a._worksheets$i)) {
                    if (d.displayOptions.visibility == 0) {
                        b = d;
                        break;
                    }
                }
            }
            if (b == null) {
                b = Enumerable.af(Worksheet.$, a._worksheets$i);
            }
            if (b != null) {
                a.windowOptions._ae(b, true);
            }
        }
    }
    _iy() {
        let a = this._a7;
        let b = a;
        let c = this.workbook;
        if (c == null || c._worksheets$i.count == 0) {
            a = null;
        }
        else {
            this._ix();
            let d = c.windowOptions.selectedWorksheet || Enumerable.ad(Worksheet.$, c._worksheets$i);
            if (a == null || a._bc != d) {
                let e = ((() => {
                    let $ret = new SpreadsheetOwnerState();
                    $ret._o = runOn(this, this._fw);
                    $ret._l = this.chartAdapter;
                    $ret._s = this.isInEditMode;
                    $ret._p = runOn(this, this._i2);
                    $ret._x = runOn(this, this._dx);
                    $ret._j = this._v.createRenderCache();
                    $ret._w = (f) => {
                        let g = d._rows$i._aj(f.row);
                        return g == null ? null : g._getCellText1(f.column, 1);
                    };
                    $ret._h = this;
                    $ret._t = this._v.usesLogicalPixels;
                    return $ret;
                })());
                a = new SpreadsheetPaneManager(d, (f) => new SpreadsheetSelection(this, f, false), (f) => this._d7(true), runOn(this, this._dz), this._be, e);
            }
        }
        if (this._a7 != a) {
            if (this._a7 != null) {
                this._a7._hv();
                this._a7._gj();
            }
            this._y = null;
        }
        let f = PropertyChangeListenerList.e(SpreadsheetPaneManager.$, this._a7, a, this._b0, false);
        this._a7 = f.p0;
        if (this._a7 != null) {
            this._a7._a6 = this._bl;
            if (this._y != null && this._y._h == null) {
                this._y = null;
            }
        }
        if (b != this._a7) {
            this._t.onSheetManagerChanged(b, this._a7);
        }
        let g = this._a7 != null;
        this._j.m(g ? this._a7._dl : boxArray$1(new Array(0)));
        this.activePane = g ? this._a7.activePane : null;
        this.activeTable = g ? this._a7._bh : null;
        if (b != this._a7) {
            if (b != null) {
                b._al._o = null;
                b._hh();
            }
            this._ht(1 | 4096 | 65536 | 67108864 | 262144 | 16777216 | 1048576);
            this.a("SheetManager");
        }
    }
    _iz() {
        if (this._eh == null) {
            this._eh = new List$1(Spreadsheet_SimpleNamedReference.$, 0);
            let a = this.workbook;
            if (a != null) {
                let b = a.windowOptions.selectedWorksheet;
                for (let c of fromEnum(a._namedReferences$i)) {
                    if (c._p) {
                        continue;
                    }
                    let d = c._j;
                    if (d == null || d._af()) {
                        continue;
                    }
                    let e = c._bo(false);
                    if (e != null && typeCast(TableCalcReferenceBase.$, e) !== null) {
                    }
                    else {
                        let f = c._bh(e, b);
                        if (f != null && f.length == 1) {
                            this._eh.add(new Spreadsheet_SimpleNamedReference(1, c, f[0]));
                        }
                    }
                }
                this._eh.y();
            }
        }
    }
    _i1() {
        this._bq.i();
        let a = this._c2(8);
        try {
            this._id(8, true);
            this._be._bd();
            this._iy();
            if (this._a7 != null) {
                this._a7._i5();
            }
            if (this._a7 != null) {
                this._a7._i3(false);
            }
            this._iw();
            if (this._c2(256)) {
                let b = this._be._o;
                this.activeWorksheet = b != null ? b._j : null;
                this._id(256, false);
            }
            if (this._c2(512)) {
                this.selectedWorksheets = Enumerable.a(Worksheet.$, Enumerable.o(SpreadsheetTabInfo.$, Worksheet.$, this._be._j, (c) => c._j));
                this._id(512, false);
            }
            if (this._c2(65536)) {
                this._id(65536, false);
                this._gp(32768, (c) => this.zoomLevel = c.displayOptions.magnificationInNormalView);
            }
            if (this._c2(67108864)) {
                this._id(67108864, false);
                this.validationInputMessagePosition = this._a7 == null ? null : this._a7._jh;
            }
            if (this._c2(1048576)) {
                this._id(1048576, false);
                this._gp(524288, (c) => this.areGridlinesVisible = c.displayOptions.showGridlines);
            }
            if (this._c2(262144)) {
                this._id(262144, false);
                this._gp(131072, (c) => this.areHeadersVisible = c.displayOptions.showRowAndColumnHeaders);
            }
            if (this._c2(1024)) {
                this._id(1024, false);
                this._ab._aj();
                this._ah.aw();
            }
            if (this._c2(8192)) {
                this._id(8192, false);
                this._ah.az();
            }
            if (this._c2(4096)) {
                this._id(4096, false);
                let c = this.activeSelection;
                let d = null;
                if (c != null) {
                    let e = this.workbook;
                    let f = e.windowOptions.selectedWorksheet;
                    if (c.cellRanges.count == 1) {
                        let g = SpreadsheetUtilities.ay(c.cellRanges.item(0));
                        if (f != null && f._tables$i.count > 0) {
                            for (let h of fromEnum(f._tables$i)) {
                                if (h._by._h(g) && WorksheetRegionAddress._o(g, h.dataAreaRegion._h)) {
                                    d = h.name;
                                    break;
                                }
                            }
                        }
                        if (d == null && e._cv) {
                            this._iz();
                            for (let i of fromEnum(this._eh)) {
                                if (WorksheetRegionAddress._o(g, i._b)) {
                                    d = i._a.name;
                                    break;
                                }
                            }
                            if (d == null && SpreadsheetCellRange.l_op_Equality(c._r, c.cellRanges.item(0))) {
                                let j = c.activeCell;
                                for (let k of fromEnum(this._eh)) {
                                    let l = k._b;
                                    if (l._m && l._ac == j.row && l._w == j.column) {
                                        d = k._a.name;
                                        break;
                                    }
                                }
                            }
                        }
                    }
                    if (d == null) {
                        let m = c._r._c;
                        let n = e.cellReferenceMode;
                        let o = n == 1;
                        d = (((p, q, r, s, t, u) => CellAddress.u(p, q, r, t, u, void 0, void 0, void 0, s))(m.row, m.column, e.currentFormat, n, o, o));
                    }
                }
                this._ft = d;
                this._aa._q();
            }
            this._hp(this._t.updateEditorValueMode == 0);
            if (this._c2(1) && this._a3 == null) {
                this._id(1, false);
                this._v.notifyCanExecuteChanged();
            }
        }
        finally {
            this._id(8, a);
        }
        if (this._c2(16384)) {
            this._id(16384, false);
            this.isRenamingWorksheet = this._bd != null;
        }
        if (this._c2(2048)) {
            this._id(2048, false);
            this._h7();
        }
        if (this._c2(134217728)) {
            if (this._a7 == null || !this._a7._cj) {
                this._id(134217728, false);
                this._hy();
            }
        }
        this._t.onStateVerified();
    }
    _i2(v) {
        let w = new SpreadsheetHyperlinkExecutingEventArgs(v);
        let x = this.workbook != null ? this.workbook._gw : null;
        if (!stringIsNullOrEmpty(x)) {
            w.workingDirectory = IOPath.getDirectoryName(x);
        }
        this._hb(w);
        if (w.cancel == false) {
            let y = null;
            if (v.targetNamedReference != null) {
                let z = v.worksheet._rows$i.item(0);
                let aa = z._as(0);
                let ab = v.targetNamedReference._bo(true, aa);
                if (ab != null) {
                    let ac = this._d6(ab, y);
                    y = ac.p1;
                }
                else {
                    this._dz(new SpreadsheetUserPromptInfo(22, null, null, v, false));
                }
            }
            else if (v.targetRegion != null) {
                let ad = v.targetRegion;
                let ae = SpreadsheetUtilities.z(ad._h);
                if (ad.worksheet.workbook == this.workbook) {
                    y = new SelectionSnapshot(ad.worksheet, [ae], ae._c, 0);
                }
                else {
                    this._dz(new SpreadsheetUserPromptInfo(22, null, null, v, false));
                }
            }
            else if (WorksheetCell.l_op_Inequality(v.targetCell, null)) {
                let af = v.targetCell;
                if (WorksheetCell.l_op_Inequality(af, null) && af.worksheet != null && af.worksheet.workbook == this.workbook) {
                    let ag = new SpreadsheetCellRange(af.rowIndex, af.columnIndex);
                    y = new SelectionSnapshot(af.worksheet, [ag], ag._c, 0);
                }
                else {
                    this._dz(new SpreadsheetUserPromptInfo(22, null, null, v, false));
                }
            }
            else if (v._t) {
                this._dz(new SpreadsheetUserPromptInfo(22, null, null, v, false));
            }
            else {
                let ah = v.targetAddress;
                if (v.isSealed && !stringIsNullOrEmpty(ah)) {
                    let ai = this.workbook;
                    let aj = this.activeWorksheet;
                    let ak;
                    let al = ((() => { let am = ai._ar(ah, ai.cellReferenceMode, aj, null, 0, ak, true); ak = am.p5; return am.ret; })());
                    if (al != null) {
                        if (ak) {
                            al = this._br(al, aj._rows$i.item(0), 0);
                        }
                        if (al != null) {
                            if (!((() => { let am = this._d6(al, y); y = am.p1; return am.ret; })())) {
                                this._dz(new SpreadsheetUserPromptInfo(22, null, null, v, false));
                            }
                        }
                    }
                }
                if (y == null) {
                    let am = false;
                    if (!stringIsNullOrEmpty(ah)) {
                        try {
                            this._i3(ah, w.workingDirectory);
                            am = true;
                        }
                        catch (an) {
                            this._dz((((ao, ap, aq) => new SpreadsheetUserPromptInfo(ao, null, aq, ap, false))(21, ah, an)));
                        }
                    }
                    if (am) {
                        v._av();
                    }
                }
            }
            if (y != null) {
                this._ie(y, true);
                v._av();
            }
        }
    }
    _i3(v, w) {
        let x;
        if (((() => { let y = Uri.tryCreate(v, 0, x); x = y.p2; return y.ret; })())) {
            if (!x.isAbsoluteUri) {
                if (SpreadsheetUtilities.bb(v)) {
                    v = "mailto:" + v;
                }
                else if (stringStartsWith(v, "www.")) {
                    v = "http://" + v;
                }
                else if (stringStartsWith(v, "ftp.")) {
                    v = "ftp://" + v;
                }
            }
        }
        window.open(v, "_blank");
    }
    _i4(v) {
        this._gi(5, () => this._a7._je(v));
    }
    _gt(v) {
        let w = this.actionExecuted;
        if (null != w) {
            w(this, v);
        }
    }
    _gu(v) {
        let w = this.actionExecuting;
        if (null != w) {
            w(this, v);
        }
    }
    _hu(v) {
        this._gv(v);
    }
    _gv(v) {
        let w = this.activeCellChanged;
        if (null != w) {
            w(this, v);
        }
    }
    _hv(v) {
        this._gw(v);
    }
    _gw(v) {
        let w = this.activePaneChanged;
        if (null != w) {
            w(this, v);
        }
    }
    _hw(v) {
        this._gx(v);
    }
    _gx(v) {
        let w = this.activeTableChanged;
        if (null != w) {
            w(this, v);
        }
    }
    _hx(v) {
        this._gy(v);
    }
    _gy(v) {
        let w = this.activeWorksheetChanged;
        if (null != w) {
            w(this, v);
        }
    }
    _gz(v, w) {
        let x = this._cellDropDownItemSelecting;
        if (x != null) {
            x(this, new SpreadsheetCellDropDownItemSelectingEventArgs(v, w));
        }
    }
    _h2(v) {
        this._g6(v);
    }
    _g6(v) {
        let w = this.editModeExiting;
        if (null != w) {
            w(this, v);
        }
    }
    _h1(v) {
        this._g5(v);
    }
    _g5(v) {
        let w = this.editModeExited;
        if (null != w) {
            w(this, v);
        }
    }
    _h0(v) {
        this._g4(v);
    }
    _g4(v) {
        let w = this.editModeEntering;
        if (null != w) {
            w(this, v);
        }
    }
    _hz(v) {
        this._g3(v);
    }
    _g3(v) {
        let w = this.editModeEntered;
        if (null != w) {
            w(this, v);
        }
    }
    _h3(v) {
        this._g7(v);
    }
    _g7(v) {
        let w = this.editModeValidationError;
        if (null != w) {
            w(this, v);
        }
    }
    _h4(v) {
        this._g8(v);
    }
    _g8(v) {
        let w = this.editRangePasswordNeeded;
        if (null != w) {
            w(this, v);
        }
    }
    _hb(v) {
        let w = this.hyperlinkExecuting;
        if (null != w) {
            w(this, v);
        }
    }
    _h5(v) {
        this._hf(v);
    }
    _hf(v) {
        let w = this.selectionChanged;
        if (null != w) {
            w(this, v);
        }
    }
    _h6(v) {
        this._hh(new SpreadsheetUserPromptDisplayingEventArgs(v));
    }
    _hh(v) {
        let w = this.userPromptDisplaying;
        if (null != w) {
            w(this, v);
        }
    }
    _h7() {
        this._hl(new SpreadsheetWorkbookDirtiedEventArgs());
    }
    _hl(v) {
        let w = this.workbookDirtied;
        if (null != w) {
            w(this, v);
        }
    }
}
Spreadsheet.$t = markType(Spreadsheet, 'Spreadsheet', PropertyChangeNotifierExtended.$);
/**
 * @hidden
 */
export class Spreadsheet_ElementCommandInfo extends Base {
    constructor(a, b, c) {
        super();
        this.a = null;
        this.c = 0;
        this.b = null;
        this.a = a;
        this.c = b;
        this.b = c;
        a.disposed = delegateCombine(a.disposed, runOn(this, this.d));
    }
    d(a, b) {
        let c = this.a;
        c.disposed = delegateRemove(c.disposed, runOn(this, this.d));
        this.b._eg.remove(this);
    }
}
Spreadsheet_ElementCommandInfo.$t = markType(Spreadsheet_ElementCommandInfo, 'Spreadsheet_ElementCommandInfo');
/**
 * @hidden
 */
export class Spreadsheet_ButtonElementCommandInfo extends Spreadsheet_ElementCommandInfo {
    constructor(a, b, c) {
        super(a, b, c);
        let d = this.a;
        d.click = delegateCombine(d.click, runOn(this, this.e));
    }
    d(a, b) {
        let c = this.a;
        c.click = delegateRemove(c.click, runOn(this, this.e));
        super.d(a, b);
    }
    e(a, b) {
        this.b.executeCommand(this.c);
    }
}
Spreadsheet_ButtonElementCommandInfo.$t = markType(Spreadsheet_ButtonElementCommandInfo, 'Spreadsheet_ButtonElementCommandInfo', Spreadsheet_ElementCommandInfo.$);
/**
 * @hidden
 */
export class Spreadsheet_WorkbookOwner extends Base {
    constructor(a) {
        super();
        this.a = null;
        this.a = a;
    }
    get isUndoEnabled() {
        return this.a._c2(4);
    }
    onCellValueChange(a, b) {
        let c = this.a._a7;
        if (c != null) {
            c._he(a.worksheet, a.index, b);
        }
    }
    _onChange$2$i($tContext, $tValue, a, b, c, d, e) {
        if (b && e.s && this.a._c2(4)) {
            let f = new WorkbookUndoUnit$2($tContext, $tValue, a, c, e);
            this.a._b3.av(f);
        }
        this.a._hj($tContext, $tValue, a, e);
    }
    onConditionalFormatChange(a) {
        let b = this.a._a7;
        if (b != null && b._bc == a.worksheet) {
            b._hf(a);
        }
    }
    onCustomViewApplied(a) {
        this.a.isFormulaBarVisible = a.windowOptions.showFormulaBar ? true : false;
    }
    onTransactionalChangeBegin(a, b) {
        if (this.a._c2(4)) {
            if (this.a._b3.p == null) {
                let c = new WorksheetUndoTransaction(SpreadsheetUtilities.da(this.a, a, b));
                this.a._b3.bd(c);
                return c;
            }
        }
        return null;
    }
    onTransactionalChangeEnd(a) {
        let b = typeCast(UndoTransaction.$, a);
        if (b != null) {
            b.ad();
        }
    }
    onTransactionalChangeRollback(a) {
        let b = typeCast(UndoTransaction.$, a);
        if (b != null) {
            b.af();
        }
    }
    onSheetRemoving(a) {
        if (this.a._c2(4)) {
            this.a._f4(a);
        }
    }
}
Spreadsheet_WorkbookOwner.$t = markType(Spreadsheet_WorkbookOwner, 'Spreadsheet_WorkbookOwner', Base.$, [IWorkbookOwner_$type]);
/**
 * @hidden
 */
export class RangeWorksheetCellFormatBase extends PropertyChangeNotifierExtended {
    constructor() {
        super();
        this._aa = true;
        this._p = 0;
        this._t = null;
        this._i = 0;
        this._u = null;
        this._o = 0;
        this._j = 0;
        this._n = null;
        this._h = null;
        this._ah = null;
        this._ac = 0;
        this._v = null;
        this._k = 0;
        this._ae = Nullable$1.toNullable(Boolean_$type, null);
        this._w = null;
        this._l = 0;
        this._ad = 0;
        this._af = Nullable$1.toNullable(Boolean_$type, null);
        this._z = null;
        this._x = null;
        this._m = 0;
        this._r = 0;
        this._ag = Nullable$1.toNullable(Boolean_$type, null);
        this._h = new RangeWorksheetCellFormatBase_RangeWorksheetCellFormatFont(this);
    }
    get alignment() {
        return ((() => { let a = this._g(HorizontalCellAlignment_$type, this._p); this._p = a.p0; return a.ret; })());
    }
    set alignment(a) {
        this._al(HorizontalCellAlignment_$type, SpreadsheetUtilities.ee, a, 1);
    }
    get bottomBorderColorInfo() {
        return ((() => { let a = this._g(WorkbookColorInfo.$, this._t); this._t = a.p0; return a.ret; })());
    }
    set bottomBorderColorInfo(a) {
        this._al(WorkbookColorInfo.$, (b, c) => b._av(c, true, typeCast(RowColumnBase.$, b._s) !== null ? 32 : 0), a, 2);
    }
    get bottomBorderStyle() {
        return ((() => { let a = this._g(CellBorderLineStyle_$type, this._i); this._i = a.p0; return a.ret; })());
    }
    set bottomBorderStyle(a) {
        this._al(CellBorderLineStyle_$type, (b, c) => b._aw(c, true, typeCast(RowColumnBase.$, b._s) !== null ? 32 : 0), a, 4);
    }
    get diagonalBorderColorInfo() {
        return ((() => { let a = this._g(WorkbookColorInfo.$, this._u); this._u = a.p0; return a.ret; })());
    }
    set diagonalBorderColorInfo(a) {
        this._al(WorkbookColorInfo.$, (b, c) => b._ax(c, true, typeCast(RowColumnBase.$, b._s) !== null ? 32 : 0), a, 8);
    }
    get diagonalBorders() {
        return ((() => { let a = this._g(DiagonalBorders_$type, this._o); this._o = a.p0; return a.ret; })());
    }
    set diagonalBorders(a) {
        this._al(DiagonalBorders_$type, SpreadsheetUtilities.eh, a, 16);
    }
    get diagonalBorderStyle() {
        return ((() => { let a = this._g(CellBorderLineStyle_$type, this._j); this._j = a.p0; return a.ret; })());
    }
    set diagonalBorderStyle(a) {
        this._al(CellBorderLineStyle_$type, (b, c) => b._az(c, true, typeCast(RowColumnBase.$, b._s) !== null ? 32 : 0), a, 32);
    }
    get fill() {
        return ((() => { let a = this._g(CellFill.$, this._n); this._n = a.p0; return a.ret; })());
    }
    set fill(a) {
        this._al(CellFill.$, SpreadsheetUtilities.ei, a, 64);
    }
    get font() {
        return this._h;
    }
    get formatOptions() {
        return 63;
    }
    set formatOptions(a) {
        throw new NotSupportedException(0);
    }
    get formatString() {
        return ((() => { let a = this._g(String_$type, this._ah); this._ah = a.p0; return a.ret; })());
    }
    set formatString(a) {
        this._al(String_$type, SpreadsheetUtilities.em, a, 65536);
    }
    get indent() {
        return ((() => { let a = this._g(Number_$type, this._ac); this._ac = a.p0; return a.ret; })());
    }
    set indent(a) {
        this._al(Number_$type, SpreadsheetUtilities.en, a, 131072);
    }
    get _ab() {
        return this._aa;
    }
    get leftBorderColorInfo() {
        return ((() => { let a = this._g(WorkbookColorInfo.$, this._v); this._v = a.p0; return a.ret; })());
    }
    set leftBorderColorInfo(a) {
        this._al(WorkbookColorInfo.$, (b, c) => b._a9(c, true, typeCast(RowColumnBase.$, b._s) !== null ? 32 : 0), a, 262144);
    }
    get leftBorderStyle() {
        return ((() => { let a = this._g(CellBorderLineStyle_$type, this._k); this._k = a.p0; return a.ret; })());
    }
    set leftBorderStyle(a) {
        this._al(CellBorderLineStyle_$type, (b, c) => b._ba(c, true, typeCast(RowColumnBase.$, b._s) !== null ? 32 : 0), a, 524288);
    }
    get locked() {
        return unwrapNullable(this._locked$i);
    }
    set locked(a) {
        arguments[0] = wrapNullable(Boolean_$type, arguments[0]);
        this._locked$i = arguments[0];
    }
    get _locked$i() {
        return ((() => { let a = this._g(Nullable$1.$.specialize(Boolean_$type), this._ae); this._ae = a.p0; return a.ret; })());
    }
    set _locked$i(a) {
        this._al(Nullable$1.$.specialize(Boolean_$type), SpreadsheetUtilities.ep, a, 1048576);
    }
    get rightBorderColorInfo() {
        return ((() => { let a = this._g(WorkbookColorInfo.$, this._w); this._w = a.p0; return a.ret; })());
    }
    set rightBorderColorInfo(a) {
        this._al(WorkbookColorInfo.$, (b, c) => b._bd(c, true, typeCast(RowColumnBase.$, b._s) !== null ? 32 : 0), a, 2097152);
    }
    get rightBorderStyle() {
        return ((() => { let a = this._g(CellBorderLineStyle_$type, this._l); this._l = a.p0; return a.ret; })());
    }
    set rightBorderStyle(a) {
        this._al(CellBorderLineStyle_$type, (b, c) => b._be(c, true, typeCast(RowColumnBase.$, b._s) !== null ? 32 : 0), a, 4194304);
    }
    get rotation() {
        return ((() => { let a = this._g(Number_$type, this._ad); this._ad = a.p0; return a.ret; })());
    }
    set rotation(a) {
        this._al(Number_$type, SpreadsheetUtilities.er, a, 8388608);
    }
    get shrinkToFit() {
        return unwrapNullable(this._shrinkToFit$i);
    }
    set shrinkToFit(a) {
        arguments[0] = wrapNullable(Boolean_$type, arguments[0]);
        this._shrinkToFit$i = arguments[0];
    }
    get _shrinkToFit$i() {
        return ((() => { let a = this._g(Nullable$1.$.specialize(Boolean_$type), this._af); this._af = a.p0; return a.ret; })());
    }
    set _shrinkToFit$i(a) {
        this._al(Nullable$1.$.specialize(Boolean_$type), SpreadsheetUtilities.es, a, 16777216);
    }
    get style() {
        return ((() => { let a = this._g(WorkbookStyle.$, this._z); this._z = a.p0; return a.ret; })());
    }
    set style(a) {
        this._al(WorkbookStyle.$, SpreadsheetUtilities.eu, a, 33554432);
    }
    get topBorderColorInfo() {
        return ((() => { let a = this._g(WorkbookColorInfo.$, this._x); this._x = a.p0; return a.ret; })());
    }
    set topBorderColorInfo(a) {
        this._al(WorkbookColorInfo.$, (b, c) => b._bi(c, true, typeCast(RowColumnBase.$, b._s) !== null ? 32 : 0), a, 67108864);
    }
    get topBorderStyle() {
        return ((() => { let a = this._g(CellBorderLineStyle_$type, this._m); this._m = a.p0; return a.ret; })());
    }
    set topBorderStyle(a) {
        this._al(CellBorderLineStyle_$type, (b, c) => b._bj(c, true, typeCast(RowColumnBase.$, b._s) !== null ? 32 : 0), a, 134217728);
    }
    get verticalAlignment() {
        return ((() => { let a = this._g(VerticalCellAlignment_$type, this._r); this._r = a.p0; return a.ret; })());
    }
    set verticalAlignment(a) {
        this._al(VerticalCellAlignment_$type, SpreadsheetUtilities.ex, a, 268435456);
    }
    get wrapText() {
        return unwrapNullable(this._wrapText$i);
    }
    set wrapText(a) {
        arguments[0] = wrapNullable(Boolean_$type, arguments[0]);
        this._wrapText$i = arguments[0];
    }
    get _wrapText$i() {
        return ((() => { let a = this._g(Nullable$1.$.specialize(Boolean_$type), this._ag); this._ag = a.p0; return a.ret; })());
    }
    set _wrapText$i(a) {
        this._al(Nullable$1.$.specialize(Boolean_$type), SpreadsheetUtilities.ey, a, 536870912);
    }
    setFormatting(a) {
        this._al(IWorksheetCellFormat_$type, (b, c) => b.setFormatting(c), a, 0x7FFFFFFF);
    }
    _ai(a = true) {
        if (this._aa == false) {
            this._aa = true;
            if (a) {
                this._aj();
            }
        }
    }
    _aj() {
        this.a(stringEmpty());
    }
    _g($t, a) {
        if (this._aa) {
            this._aa = false;
            let b = this._q() || RangeWorksheetCellFormatBase_EmptyFormat._ao;
            this._am(b);
        }
        return {
            ret: a,
            p0: a
        };
    }
    _am(a) {
        CoreUtilities.z(a, "source");
        this._p = a.alignment;
        this._t = a.bottomBorderColorInfo;
        this._i = a.bottomBorderStyle;
        this._u = a.diagonalBorderColorInfo;
        this._o = a.diagonalBorders;
        this._j = a.diagonalBorderStyle;
        this._n = a.fill;
        this._ah = a.formatString;
        this._ac = a.indent;
        this._v = a.leftBorderColorInfo;
        this._k = a.leftBorderStyle;
        this._ae = a._locked$i;
        this._w = a.rightBorderColorInfo;
        this._l = a.rightBorderStyle;
        this._ad = a.rotation;
        this._af = a._shrinkToFit$i;
        this._z = a.style;
        this._x = a.topBorderColorInfo;
        this._m = a.topBorderStyle;
        this._r = a.verticalAlignment;
        this._ag = a._wrapText$i;
        this._h._k(a.font);
    }
    _an(a) {
        return WorkbookFontSnapshot._l(a, this._s);
    }
    static _y(a) {
        a = ExcelUtils.g0(a);
        return ExcelUtils.ag(a);
    }
}
RangeWorksheetCellFormatBase.$t = markType(RangeWorksheetCellFormatBase, 'RangeWorksheetCellFormatBase', PropertyChangeNotifierExtended.$, [IWorksheetCellFormat_$type]);
/**
 * @hidden
 */
export class Spreadsheet_SelectionWorksheetCellFormat extends RangeWorksheetCellFormatBase {
    constructor(a) {
        super();
        this._ao = null;
        CoreUtilities.y(a);
        this._ao = a;
    }
    _q() {
        let a = this._ao.activeSelection;
        if (a != null) {
            let b = a.activeCell;
            let c = this._ao._a7;
            if (c != null) {
                let d = c._bc._rows$i._aj(b.row);
                return new ReadOnlyResolvedWorksheetCellFormatData(c._bc._b4(d, b.column));
            }
        }
        return null;
    }
    _ak(a, b, c) {
        let d = this._ao._a7;
        if (d == null || d.activePane == null) {
            return;
        }
        let e = d.activePane.selection;
        this._ao._gi(21, () => d._im(e.cellRanges, a, b, c));
    }
    _al($t, a, b, c) {
        let d = 10;
        switch (c) {
            case 536870912:
                d = 9;
                break;
            case 128:
                d = 6;
                break;
            case 1024:
                d = 7;
                break;
            case 4096:
                d = 8;
                break;
            case 16384:
                d = 19;
                break;
            case 256:
            case 512:
            case 2048:
            case 8192:
            case 32640:
                d = 19;
                break;
            default:
                if (c != 0) {
                    if ((c & ~32640) == 0) {
                        d = 19;
                    }
                }
                break;
        }
        this._ao._ic($t, b, a, d, c);
    }
    get__s() {
        return this._ao.workbook;
    }
    get _s() {
        return this.get__s();
    }
}
Spreadsheet_SelectionWorksheetCellFormat.$t = markType(Spreadsheet_SelectionWorksheetCellFormat, 'Spreadsheet_SelectionWorksheetCellFormat', RangeWorksheetCellFormatBase.$);
/**
 * @hidden
 */
export class Spreadsheet_NameBoxList extends LazyReadOnlyNotifyCollection$1 {
    constructor(a) {
        super(String_$type);
        this._p = null;
        this._p = a;
    }
    _o(a) {
        a.clear();
        let b = this._p.workbook;
        if (b != null) {
            let c = this._p.activeWorksheet;
            for (let d of fromEnum(b._namedReferences$i)) {
                if (d.scope != b && d.scope != c) {
                    continue;
                }
                if (d._p) {
                    continue;
                }
                if (d._bo(false) == null) {
                    continue;
                }
                a.add(d.name);
            }
            for (let e of fromEnum(b._worksheets$i)) {
                for (let f of fromEnum(e._tables$i)) {
                    a.add(f.name);
                }
            }
            if (a.count > 1) {
                let g = typeCast(List$1.$.specialize(String_$type), a) || new List$1(String_$type, 1, a);
                g.z(StringComparer.c);
                if (g != a) {
                    a.clear();
                    for (let h of fromEnum(g)) {
                        a.add(h);
                    }
                }
            }
        }
    }
    _q() {
        this._h();
    }
}
Spreadsheet_NameBoxList.$t = markType(Spreadsheet_NameBoxList, 'Spreadsheet_NameBoxList', LazyReadOnlyNotifyCollection$1.$.specialize(String_$type));
/**
 * @hidden
 */
export class Spreadsheet_SynchronizationSuspender extends Base {
    constructor(a) {
        super();
        this._a = null;
        this._a = a;
        a._ir();
    }
    dispose() {
        if (this._a != null) {
            let a = this._a;
            this._a = null;
            a._ia();
        }
    }
}
Spreadsheet_SynchronizationSuspender.$t = markType(Spreadsheet_SynchronizationSuspender, 'Spreadsheet_SynchronizationSuspender', Base.$, [IDisposable_$type]);
/**
 * @hidden
 */
export class Spreadsheet_CustomEditValueParser extends Base {
    constructor(a, b) {
        super();
        this.a = null;
        this.b = null;
        this.c = null;
        this.e = null;
        this.b = a;
        this.c = b;
    }
    d(a) {
        if (this.a == null) {
            this.a = new ParseEditValueCache(this);
        }
        this.e = a;
        let b;
        let c = ((() => { let d = SpreadsheetEditHelper.ad(this.a, this, false, true, b); b = d.p4; return d.ret; })());
        if (c != this) {
            if (b != -1 || (c != null && !(typeof c === 'string'))) {
                let d = new Spreadsheet_CustomEditValue();
                d.c = a;
                d.b = c;
                d.a = b;
                return d;
            }
        }
        return null;
    }
    get unformattedText() {
        return this.e;
    }
    get editCellFormat() {
        return this.c;
    }
    createDocument() {
        return null;
    }
    get workbook() {
        return this.b.workbook;
    }
    get isFixedDecimalEnabled() {
        return this.b.isFixedDecimalEnabled;
    }
    get fixedDecimalPlaceCount() {
        return this.b.fixedDecimalPlaceCount;
    }
}
Spreadsheet_CustomEditValueParser.$t = markType(Spreadsheet_CustomEditValueParser, 'Spreadsheet_CustomEditValueParser', Base.$, [ISpreadsheetEditorValue_$type, ISpreadsheetEditInfo_$type]);
/**
 * @hidden
 */
export class Spreadsheet_NullView extends Base {
    constructor(a) {
        super();
        this.a = null;
        this.a = a;
    }
    beforeExecuteCommand(command, commandParameter, sourceElement) {
        return unwrapNullable(this._beforeExecuteCommand$i.apply(this, arguments));
    }
    _beforeExecuteCommand$i(a, b, c) {
        return SpreadsheetUtilities.cz;
    }
    createRenderCache() {
        return new Spreadsheet_NullRenderCache();
    }
    get isCellDropDownOpen() {
        return false;
    }
    get isInNameBox() {
        return false;
    }
    get isScrollLockToggled() {
        return false;
    }
    get updateEditorValueMode() {
        return 1;
    }
    addCellTextLocations(a, b) {
    }
    closeMenu() {
    }
    getLayoutManager() {
        return null;
    }
    onSheetManagerChanged(a, b) {
    }
    remeasureRootPanel() {
    }
    onNameBoxValueChanged() {
    }
    onNameBoxWidthChanged() {
    }
    get hasKeyboardFocusWithin() {
        return false;
    }
    focus() {
        return false;
    }
    onHasPendingChangeNotification() {
    }
    onDataObjectPasting(a) {
    }
    notifyCanExecuteChanged() {
    }
    onStateVerified() {
    }
    shouldIncludeClipboardFormat(a, b) {
        return true;
    }
    shouldCopyToClipboard(a, b) {
        return true;
    }
    showCellDropDown(pane, cellRect, dropdownItems, initialSelectedIndex, onSelected) {
        arguments[1] = rectFromLiteral(arguments[1]);
        return this._showCellDropDown$i.apply(this, arguments);
    }
    _showCellDropDown$i(a, b, c, d, e) {
        return false;
    }
    showSelectAllContextMenu(context, relativePoint) {
        arguments[1] = pointFromLiteral(arguments[1]);
        return this._showSelectAllContextMenu$i.apply(this, arguments);
    }
    _showSelectAllContextMenu$i(a, b) {
    }
    ShowPaneContextMenu(pane, area, relativePoint) {
        arguments[2] = pointFromLiteral(arguments[2]);
        return this._ShowPaneContextMenu$i.apply(this, arguments);
    }
    _ShowPaneContextMenu$i(a, b, c) {
    }
    ShowHeaderContextMenu(scrollRegion, relativePoint) {
        arguments[1] = pointFromLiteral(arguments[1]);
        return this._ShowHeaderContextMenu$i.apply(this, arguments);
    }
    _ShowHeaderContextMenu$i(a, b) {
    }
    ShowTabContextMenu(tab, relativePoint) {
        arguments[1] = pointFromLiteral(arguments[1]);
        return this._ShowTabContextMenu$i.apply(this, arguments);
    }
    _ShowTabContextMenu$i(a, b) {
    }
    showFilterMenu(a, b) {
        return false;
    }
    createCellEditManager() {
        return new Spreadsheet_NullCellEditManager(this.a);
    }
    createTabEditManager() {
        return new Spreadsheet_NullTabEditManager(this.a);
    }
    showMessageBox(a, b, c, d, e) {
        return e;
    }
    get usesLogicalPixels() {
        return true;
    }
    verifyLayout() {
    }
    showFilterDialog(a) {
        throw new NotImplementedException(0);
    }
    showTopOrBottomDialog(a) {
        throw new NotImplementedException(0);
    }
    showCustomSortDialog(a, b) {
        throw new NotImplementedException(0);
    }
    showFormatCellsDialog(a, b) {
        throw new NotImplementedException(0);
    }
    get spreadsheetDialogServicesManager() {
        throw new NotImplementedException(0);
    }
    getRect(scrollRegion) {
        return rectToLiteral(this._getRect$i.apply(this, arguments));
    }
    _getRect$i(a) {
        return Rect.empty;
    }
    getPaneRect(pane) {
        return rectToLiteral(this._getPaneRect$i.apply(this, arguments));
    }
    _getPaneRect$i(a) {
        return Rect.empty;
    }
    initializeEditFont(a, b) {
    }
    createChartTitleElement(a, b) {
        return null;
    }
}
Spreadsheet_NullView.$t = markType(Spreadsheet_NullView, 'Spreadsheet_NullView', Base.$, [ISpreadsheetView_$type]);
/**
 * @hidden
 */
export class Spreadsheet_NullCellEditManager extends SpreadsheetCellEditManager {
    constructor(a) {
        super(a);
    }
    get_ac() {
        return false;
    }
    get ac() {
        return this.get_ac();
    }
    get_ad() {
        return false;
    }
    get ad() {
        return this.get_ad();
    }
    get_ah() {
        return false;
    }
    get ah() {
        return this.get_ah();
    }
    as(a, b, c, d) {
    }
    ap() {
    }
    aa(a) {
        return false;
    }
    ak() {
        return 0;
    }
    b() {
        return null;
    }
    ab(a) {
        return false;
    }
    at() {
    }
    e() {
        return null;
    }
    ag(a, b = true) {
        return false;
    }
    ao() {
    }
    aq() {
    }
    av(a, b) {
    }
    az() {
    }
}
Spreadsheet_NullCellEditManager.$t = markType(Spreadsheet_NullCellEditManager, 'Spreadsheet_NullCellEditManager', SpreadsheetCellEditManager.$);
/**
 * @hidden
 */
export class Spreadsheet_NullTabEditManager extends SpreadsheetTabEditManager {
    constructor(a) {
        super(a);
    }
    get_i() {
        return false;
    }
    get i() {
        return this.get_i();
    }
    f(a) {
        return false;
    }
    l() {
        return null;
    }
    m(a, b, c) {
    }
    n(a, b) {
    }
    k(a) {
        return true;
    }
    o() {
    }
}
Spreadsheet_NullTabEditManager.$t = markType(Spreadsheet_NullTabEditManager, 'Spreadsheet_NullTabEditManager', SpreadsheetTabEditManager.$);
/**
 * @hidden
 */
export class SpreadsheetRenderCache extends Base {
    constructor(a) {
        super();
        this.af = 0;
        this.r = null;
        this.q = null;
        this.f = null;
        this.e = null;
        this.p = false;
        this.m = null;
        this.i = 0;
        this.v = 0;
        this.s = 0;
        this.t = 0;
        this.ae = 0;
        this.u = 0;
        this.p = a;
        this.r = new Dictionary$2(Base.$, Base.$, 0);
        this.q = new Dictionary$2(Base.$, Base.$, 0);
    }
    get n() {
        return this.af > 0;
    }
    ak() {
        this.af++;
    }
    a($t, a, b, c = null) {
        return this.b($t, a ? this.r : this.q, b, c != null ? c : $t);
    }
    b($t, a, b, c) {
        a.item(c, b);
        return b;
    }
    x(a, b) {
        if (a == null) {
            return 0;
        }
        return this.w(a.workbook, a.displayOptions.magnificationInNormalView, b);
    }
    w(a, b, c) {
        if (a == null) {
            return 0;
        }
        let d = b / 100;
        let e = a.cellReferenceMode;
        let f = a._styles$i.normalStyle._i;
        let g = this.m == null ? new WorkbookFontSnapshot(f) : this.m._d(f);
        if (this.m != g || this.i != e || this.v != d || this.t != c) {
            this.m = g;
            this.i = e;
            this.v = d;
            this.ae = -1;
            this.t = c;
            let h = e == 1 ? SpreadsheetPaneManager._fn(0) : SpreadsheetPaneManager._fo(0);
            let i = this.y(this.m, this.v, h) * this.v;
            i += 3 * c;
            i += c;
            this.s = i;
        }
        return this.s;
    }
    ab(a, b, c) {
        if (a < 100) {
            a = 100;
        }
        if (this.ae != a) {
            this.ae = a;
            let d = SpreadsheetPaneManager._fo(a);
            let e = this.aa(this.m, this.v, d) * this.v;
            e += 3 * c;
            e += c;
            this.u = e;
        }
        return this.u;
    }
    al() {
        this.m = null;
        this.v = 0;
        this.ae = -1;
        this.t = -2147483648;
        this.q.clear();
        this.aq();
        this.am();
    }
    an() {
        this.af--;
        if (this.af == 0) {
            this.ao();
        }
    }
    ag() {
        return new MemoryStream(2, Convert.fromBase64String(SpreadsheetRenderCache.ai));
    }
    k() {
        if (this.n) {
            if (this.f == null) {
                this.f = new SpreadsheetRenderCache_MeasureTextMetricsProvider(this.j(), this.l);
            }
            return this.f;
        }
        else {
            return this.j();
        }
    }
    ad() {
        return this.e || (this.e = new SpreadsheetRenderCache_DisposableCache(this));
    }
    c($t, a, b = null) {
        return this.d($t, a ? this.r : this.q, b != null ? b : $t);
    }
    d($t, a, b) {
        let c;
        let d = a.tryGetValue(b, c);
        c = d.p1;
        return typeCastObjTo$t($t, c);
    }
    ah() {
        return new MemoryStream(2, Convert.fromBase64String(SpreadsheetRenderCache.aj));
    }
    ao() {
        this.aq();
        if (this.f != null) {
            let a = this.f;
            this.f = null;
            a._h.dispose();
        }
    }
    ap(a) {
        let b;
        if (((() => { let c = this.r.tryGetValue(a, b); b = c.p1; return c.ret; })())) {
            if (typeCast(IDisposable_$type, b) !== null) {
                b.dispose();
            }
            this.r.removeItem(a);
        }
    }
    aq() {
        let a = Enumerable.a(Base.$, this.r.values);
        this.r.clear();
        for (let c = 0; c < a.length; c++) {
            let b = a[c];
            let d = typeCast(IDisposable_$type, b);
            if (d != null) {
                d.dispose();
            }
        }
    }
}
SpreadsheetRenderCache.$t = markType(SpreadsheetRenderCache, 'SpreadsheetRenderCache');
SpreadsheetRenderCache.ar = Color.u(255, 243, 243, 243);
SpreadsheetRenderCache.ai = "iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAJkSURBVFhH7ZdbbuMwDEXtPGYnCdBk9r+SSQoEyEby8ugoPi7r2pZbDOYrFxBEXVK8FJ3Kbt00TTUXxNZ1Xd3v92q5XFaPxyPzi8Wi44yZi0U7T8IiTYwgYD3EgbkHm9WBGIONGHMUw6YjciDaYygWYNJ+MlouRw7aHwHHsDNjKD4CEiBEIbfbLScV/cLwEWPRJXFQjCBZPA2JEdFWCE7bePaW8K2/AkDS0+nUXJJgUnmSSfjXalVtt9t6zqkjZkd7GgQQp/F2ABtO8TknF58KsBv8wACJhpJ9/jk+sWxbD3wMPJb4u2GO+VjnAgzgNMCTuAbRLuFyueT4VXosDGw5hgfLa8QtAOSq2hMQIOcM9+dw+NjQgj373a6+Xq/V+Xxu7knATrKHDm02m3q9XmfOXAtbkquBaE9vlbFafDFmCAgg7h4GuKV1FGcQk3KV/85Ngo+YMVjsIFpBBnnQzUNCEjFEtB1w2mMw6RDYp98caH+5ByAPx2OPTQnS2L291Vy5+ImLIDF+7OP7+xc/+L3fd3oW2pXrBhyEkCkOODeNYapD8rEDoMs4tjFiTswYOPnQ/ukj/Qe8CngV8CqgK6B/I/5rxOxRqyvAWy7fz2kmJI7MpY0MXq3Ex+EHSfRz8WQu7eWTLd62ovbzOgunGScvHu581v7HA8fHBdD2fT/lx0cR2HDosEannT/eejpjoFWbHGjjK/nNAaetXta2A4wIeYKiDUzM6cCUvx8r4BjFTzKS50qTbZw2ycGU30cAx5pZYHcFRIfrPv8TjOVynXumAxJ4MtbagLUxAF/J7zrmBE/NqvoLHktNAmgD4tsAAAAASUVORK5CYIIbbIIH6cxJOwAAAABJRU5ErkJggg==";
SpreadsheetRenderCache.aj = "iVBORw0KGgoAAAANSUhEUgAAA0AAAAAQCAMAAAAI2+8aAAACOlBMVEUAAADLOC1DQ0NDQ0PUfwDWOy84gjvQOi7ghgBGRkbcPTHjiADliQBISEhqampycnJzc3M7iT5ISEhERETNOS09jUDXgADWOy/SfQDbggDdhABGRkY8iz/bPDCoqKjPOS7ZgQC2trZycnI8jEA5gzzihwCjo6M5hTw6hj2dnZ2Wlpb1YldtbW2cnJxwcHD2a2DZPDDkiACfn5/2b2Q6hz7VOi+8vLxwcHDBwcHYPDDDw8PbPDDHx8fmiQA7ij+Xl5fVjiSYmJj1Zlo8ij88jEBISEj1ZFivr6+0tLS+vr48i0DGxsbVihnWlTXWnEbWoE7hhgDXpl31ZFnWmD47iD7XpFjMzMz/mABQUFAunKb0Qzb///8lfYWZmZlDnEdAQECAgIDMegBmZmatra33g3k2fTlERETNegDENitOTk7DNivZgQA3fzrPfABMTExoaGhCQkL5lADGNyt9fX05hj2RkZHvQTXtQTQ4gjvPOS5wcHBtbW31XVFCmkZBmEXTOi7VgAJISEjpPzPHNyypqan229jSfgH7lgDFxcXfPTHqjAA9kEHyQjXbgwBKSkpAlkQ/k0PhPjHujgDLOC32kgCkpKSTk5P2ZlvykABqamrbPDDJNyzXOy/URDrlPzL3fnQ7ij7ehgTliQD09vSXl5d3d3f3e3DVRjve3t5Gi0lDkUdDcEacQz3fQziibiLojgjq7erV1dX2dWr6+vp0dHTutrHd5t23t7eoxqnN3851pne0z7WbvpxclV48RNjqAAAAVnRSTlMA9vbv9pv23JybHVYfHvZWHpsf5u8d75z72sCcVh/v5ubAVR/vb/bn3P729tybm5tWOx4ewrScnG9vVjseHYbv7+bmbzod79vOhjw7+Nmuj4Y578avaLVyPOgAAA0MSURBVGje1ZuJXxNHFMcnJRwCPWgBgVJarVjUWm+tVVt733crNjGEhS4bkg2YmJCAIUTAIAQaCJcKIir1vlrt3f5vfTM7k5lMoBEsfNrfxzb8Pv2s+/qY7763bybIUKVeif5BTiwk6PHWx9E/qAELLVlFL6igF4qYz3tOAz2Xx3z2sw7Qs9nMr3rKDnpqFQI9mmUXlPVoJo+oCpGo1U7n6qXGs/KS77/ljRDojS3Mb37dD3p9s5yvh/eibKCH8UdA6H+qSj0oE2Q+IAJksVicKfy0tq5FKXrsCRGg+vr6JED19ShI1h73ZXmpvme14J/P0X3D4fCwT895nixts3so4fEkhtxmssqfMfV0zQQCM11e0zPYP/mIvem75ubvmuyPPIlQ1tGWw0m1HM3K5BFRgdtdIK5Ix9kuR/YS4+F6S2f/3woIUeWa8hFRvimXfJYrikalED4hFlEvNnBh/5L49Eq//45Nockfz5//cTK0aQf22zdO2MZ7e8dtExu3y/kyfMcpq9X+IP7RpAed6gAvAnHokO1h/JFvvuEA5eWhFH28O9XvBr8kHUlV0tsMIZuozJ7x4+v0SQQp5kIJIJGfjmMdUg1qEAmSAVLVnDdFYBTNXC16p8O0l9kS3ReuIwoH9RJYr26Xp5bIE3FDTPne9jYLUWDUmw8l52hTs4FD89GjjyJ7C/xwogl0ohkIsWfyiKhsyFUm1B/HiGXwLBC0YDwuEI+nO0DCmcHxiMoJ6jU0m7W1DKDinikgiPDT01NsEKQlag1p4PK0aBpB39eDaFL3NAhPr/R87AhNnv+W6PxkaAfwMzHX20jUOzGxXc4X9o1WkD2zb+HeUCP4ZQLIbEYpiq5P9evBL0VwFyL2kfSHiAAQ+sMDerZEOutkgpQoJ0gC6InW48fqjx1PrUENrZygdIDCs+q6SgEgzwWttEAAqK3LUbyVrjoIxhDElAOpdPXVUnlckFZT+6CFqq3dhNAjsB6ompseQXb8ceN6Xd31G/g/2Im/fae29s5t7m/eslhu3SQeYVW4+zxahVB/LKB+x+qUeMKdPB6X1eri8Ux3AUGBri4SD9dOPR7MSQMot6ff4KZ4dKQnFxkEuQcYQMDPxb4hRlAeJ4gB9FJDB+SePr32pOdj0ySwwwjahNBGG/BDCZrbKOcLvMGDfVGeEQSe92MciMz+CEjyIkDVmlaNBH2iTLws+pf94EXV1KD5ZXI6BDlNywBQCSwRY7WWiAB5XJQgGaAnHjsOv0ogKLVrE3w6QHV1cZ9a8wHzsJ5Ou7TybczD39/d7sjdB65IDdclFVeL8jRPbVJjWt5qR5slqYBj9dP2ZqElsz9th1/zNePqa7BU7NhfMK6+wPw54+pz2CPQNrx+B9zbKD/efgsR1CAhnrAe7KTxUIBYPP0/nbwSCFw5+dN0N2aO6VV9eFZ/SwCIEzSVCx/efsIP7eIGGEDuqIfWNuBH4TWIAdR6Bp5eZ1oh1xgmJOdjSwjqD9Pl0JbNfswPI8i/Wc7X0x1WA5AF/KpUvwq8oI5VvJwIgGT2mBbJiwCVuyLlSNBHSu+7on+3MdUXqWoRmlf7vNMWpsEu775/HSBo8X1h2qGIBCnwfHUXiABxfo7VE4LOpHZt+Lm4IECg4aC6s4QBBEpElIpCBhBoZtS5Kx+t89UJ8q0rHaoV5Cot7rIIai/OajosqCnLfvjEDXb1jRMYmBO32dW3DX+TXX0TPAI9F6kFRZ6j/Rvhx6hB2cl4OoM//6HHSTwUIBZPW9dJ68krV+Bf7W3txcIL0GxMfRUJAHGCRqZyc0cFflABB6jAjUtcxFyIi5HCmuaG+xQg6J9x/knu98A7kZyPdya/FTT5zmu2RkFzr8n5yjpFAVmE5zqVtSwAFSqJhCa8QnyuKVf9+7nf77+a4ivVWEytNDItCe3lv8+zjr3/fgtXkqMDP5wghUqrre0DgmSAgJ9Wwg8jqIEKM8MISgeIdmRqDgMIyzOkmRlAWNDHmZA6LAIUU5XTIkADirPbImjECe80gr4DQJqus6uvNx3G/g67+o7hb7Grb4HH/YKb3OO0Vi3UH1aDcDwx+Cf4q/VnNU7iYQCxeAIYHvhzrhvi4S9AvmF9JxIB4gSNjngBIoEf91AfBYgSNAb1H5o57BGDhiZ1LRhS/19quN+A5HyELosA/Rjyj4sAjfvT8mWlgCzGc9l5f8YBkf0RkOQpQNwzgCoqyktLzZG+voi5tLS8ouLgwY8ikahLu9e7vqrqvTWg96qq1o/fY56MefTZzjqfXkIzzUWyvssxYyGa8e5ahnegHBWkw2rTVVBOSgAe6MVlgB5jtJDPx4AVLjxZWBigWFBPqUADUXfFAQGgkSkvVCC1UwQorCp9tWJEinPQIqjNCR2JoGYMCL/cAIZfbnh+uQFQGW3xhsrAOAV+YJLghHjCujo7+7v10rWYEQ8DiMVDCCL8QDyoSCdlZ6ca19chGSBGkMMy6EjhB/6qiwMYIIMg6OKiZdBYaowfnNzvIanUAkGtZ1q/By/nI/StqPMho4PjPZyULw5IJk8lA8TLCwdE9hgN2cMfyRsA5SnRCxcTkGTPwMULUSXvY+I9mvXSD6d+sfl37/bbfjl19Z6VeWNYYzz+5wcInlfGkAcq/jIAhEUWuIpQWgCeqNvkBHnh/l78gwnJgIgAwW+1VQaMAQQNXE2J+A4UUcoLxXegUWduPkISQJ0rAFCFm0358BzBeVa8wTQGyPfr3b+uXbL+PsvikQHqNgCawfG8qUKnitCbaswXLFkYoME2AIjzQ4DRGDBAEAYqAUCJwDTcp0lfS4C6j4HKDFBjBoCoMgDEtMwAsQJMNEY6oE/drjFIBNzrbu/cKwi9Ymu8BIZ5UE0wbryk1swPUL5pFKdm1JS/0Biba5Fj7gwA4WkQDFvJWyoLQQZIrkBSi0cBivv0dR8IU7ixIa10G/fO7i5v8T5sMrRwiX+9hSMTBKqL7m1kBMc0OI1buLD+s/XSXeufQRYPA4jF031OaOFg1BDTX/hAn2VNOevMU1s4h6N/NFfo3zwR3rLRGoSlUVxoy9bRILV0D9/CZWjpMgNkA4nAHAHJngMk9mvciwChAnPEQ/iJmoEfICgKXgNextcTXl5ZPw4EcV/ElsywXpQOEB0kDFpggLDwGDuzf+AKxN+B6BThGVN7m8iPDBBTPZlsy0MGCpAu7QO5pX0gL9sHWuQQoevhhwgwQSBic4Rs/tI5bQwR4td+s1p/0zuFeFygZDzTeIiAIYJ5QjHsSYeHddUXSx8LCWO4UTxE8OYm+YGO/wAZGshDBVZ/2NAgbagg5UMeInyROkSwpQ0RJJ9xaCB7Wm44MJwW7kWAOC2yZ0OEwrIEafHLCukIIZrAAP2wYb/h92+4agWBpwOEOqpZtTJ9iADCg4R+5160IgClT+HyjZ2GtnbgRwZInsJJY+4HPomQLQwk45yfYTw2HuML/DQeGwcsSXU7sp9mj1A6Zl3sGLtaE0pcQqtm20B8jB2HCdyvd6/FeTy0ArF4BvEYG8rQTwGIB6aaweHO+DDuJ6QKxPnxFiNU7B0hNcgd6YNUS2PrciVhAETH1sfZ2DptrC3nY4tYguQx9rh/s5wv2fMxNvdcHWl+GQBCmjHUUZLZG8MAXfUz7weAmC/RZ3nD79OfR/Nql8OxC60wQNBUFAh73YPt3q3onwCCh+RaeaOVAcKU2fONS/ZeaIZuhgpCQggK4oIbqUfljdRmaSO1WdxIJZ5NENgcgQ+yof6weGB+GBPiMQDi8QSmA7B4+wdJPKikRo9Jm2ryRqopHz+XpmCQbWycuqSN03I38EMBgsaN53IP5aeVb6zK+dg0eT51I3VO3EiV8yV7vnEqeqbGdL8MAFW7+wbc0YE+tpf6ieYZUDb8cIntnb5su3fIxnyOmqKchap+LlppgCJ8H3WrF5oTg5+FAYImQz7qsySASvQgrUFxenQmSmvQWNR9AOM8Rdv+7injKA873QZHTd5e9FEeTRqT06MIg6T+8HhiqfG4QAvEA/pKDcIOKpd0lKdHOMojH92Rj/bIR3fkoz3p998RCl1m9cc4yjMhHOWR8yV7fnTH8PLRHdkvB0AVEdghrNBcUXo25CBMsQ+u8ffa1hh+zfi4f43hF6EVBwjzwwmaovwsDBDwIx02XTRA/PBmLB6O8cObmmtgbGzApbHDm972kUBgpF04THqipWWew6TNLfasTN6spMiMDIKmof4sJR52CIHtoGY+TCofHpUPl8qHR+XDpfz+4mHSy5eFw6T+OXyYdM6/cbucL9nLh0mlw6PpfjkAKiUDpm2lSikiiiiRrxH6sMpfZfiqiaoPDf/fAQgr/TS2SNDWDF9XAH6krzssCqDMX2dQpK8POB/o6wxPZvJoXmU7ndlLiGflJd9/5b/OYBPEpmqyB8keJHuQcbL3M0T0GT3fG/3S+Hx/g/G54X3uF6dlGGP/DSf/N2tvm8O4AAAAAElFTkSuQmCC";
/**
 * @hidden
 */
export class Spreadsheet_NullRenderCache extends SpreadsheetRenderCache {
    constructor() {
        super(false);
        this.as = null;
        this.as = new Workbook();
    }
    z(a, b) {
        return 0;
    }
    y(a, b, c) {
        return 0;
    }
    aa(a, b, c) {
        return 0;
    }
    am() {
    }
    o(a) {
        return false;
    }
    j() {
        return Workbook._br(this.as);
    }
    g(a, b, c, d, e, f, g, h) {
        return new Spreadsheet_NullSpreadsheetText();
    }
    h(a, b, c, d, e, f, g, h) {
        return new Spreadsheet_NullSpreadsheetText();
    }
    ac(a, b) {
        return 0;
    }
    get_l() {
        return this.as;
    }
    get l() {
        return this.get_l();
    }
}
Spreadsheet_NullRenderCache.$t = markType(Spreadsheet_NullRenderCache, 'Spreadsheet_NullRenderCache', SpreadsheetRenderCache.$);
/**
 * @hidden
 */
export class SpreadsheetDOMEventProxy extends CustomDOMEventProxy {
    constructor(a, b, c) {
        super(b, c, false);
        this._d0 = null;
        this._d0 = a;
        this._dz = (d) => {
            this._d5(d);
            return true;
        };
        this.ai = (d) => {
            let e = SpreadsheetUtilities.c1(this.am);
            if (this._d1(e)) {
                return false;
            }
            if (this._d0._di()) {
                return false;
            }
            let f = (e.target);
            if (f != null && this._d0._at.g(f)) {
                return false;
            }
            if (f != null && SpreadsheetUtilities.a5(this._d0._bh.dp.cg, f)) {
                return false;
            }
            return true;
        };
    }
    dl(a, b, c) {
        if (a == this.bv) {
            c.add(this.bv.listen("contextmenu", runOn(this, this._d4)));
        }
        super.dl(a, b, c);
    }
    _d1(a) {
        let b = (a.target);
        if (b != null) {
            let c = b.nodeName;
            switch (c) {
                case "TEXTAREA":
                    if (!this._d0.isInEditMode && this._d0._ay != null && this._d0._ay.a7 != null && this._d0._ay.a7.rootWrapper.getNativeElement() == b) {
                        break;
                    }
                    return true;
                case "INPUT":
                case "SELECT":
                case "OPTION":
                case "LI":
                case "UL": return true;
            }
        }
        return false;
    }
    static _d2(a) {
        let b = a.type;
        return typeof b === 'string' && startsWith1(b, "key", 3);
    }
    _d4(a) {
        if (this.ab) {
            return;
        }
        let b = (a.originalEvent.target);
        if (this._d0.isInEditMode) {
            if (SpreadsheetUtilities.a5(this._d0._ay, b) || SpreadsheetUtilities.a5(this._d0._bh.dp.ci.cf, b)) {
                return;
            }
        }
        if (this._d0.isRenamingWorksheet) {
            let c = this._d0._bf._p;
            let d = c != null ? typeCast(SpreadsheetTabItemElement.$, c._ac) : null;
            if (d != null && d.cm != null) {
                let e = d.cm.getNativeElement();
                if (e != null && e.contains(b)) {
                    return;
                }
            }
        }
        let f;
        if ((a.originalEvent.pointerType === undefined)) {
            f = a.button == 0;
        }
        else if ((a.originalEvent.pointerType == "")) {
            f = true;
        }
        else {
            f = false;
        }
        if (f) {
            let g = this._d0.activePane;
            let h = Spreadsheet._i7(g, this._d0.isInEditMode);
            if (this._d0.isInEditMode) {
                let i = this._d0._bh.dp.ci.cf;
                if (SpreadsheetUtilities.a5(i, document.activeElement)) {
                    this._d0._at.j(5, i, { $type: Point_$type, x: 0, y: i.av });
                }
                else {
                    this._d0._at.j(4, this._d0._n(g), h);
                }
            }
            else {
                this._d0._v._ShowPaneContextMenu$i(this._d0.activePane, SpreadsheetUtilities.aa(this._d0.activeSelection), h);
            }
        }
        else if (this._d0._at.h()) {
        }
        else {
            if (this.bj(a)) {
                this.cp(a);
            }
            else {
                this.co(a);
            }
            let j = a.offsetX;
            let k = a.offsetY;
            this._d0._bh.c9(this.cu);
        }
        a.preventDefault();
        a.stopPropagation();
    }
    _d5(a) {
        if (a.originalEvent != null && this._d1(a.originalEvent)) {
            return;
        }
        if (this._d0._di()) {
            return;
        }
        if (this._d0._at.h()) {
            return;
        }
        if (this.ab) {
            return;
        }
        if (this._d0._v.hasKeyboardFocusWithin) {
            SpreadsheetUtilities.d7(document.activeElement);
        }
        else {
            this._d0._v.focus();
        }
    }
}
SpreadsheetDOMEventProxy.$t = markType(SpreadsheetDOMEventProxy, 'SpreadsheetDOMEventProxy', CustomDOMEventProxy.$);
SpreadsheetDOMEventProxy._d3 = 0;
/**
 * @hidden
 */
export class SpreadsheetLayerContainerElement$1 extends VisualElement {
    constructor($t, a, b) {
        super(a, b);
        this.$t = null;
        this.cf = null;
        this.$t = $t;
        this.$type = this.$type.specialize(this.$t);
    }
    get cg() {
        return this.cf;
    }
    set cg(a) {
        if (a != this.cf) {
            this.cf = a;
        }
    }
    b7(a, b, c, d) {
        super.b7(a, b, c, d);
        for (let e = 0, f = this.a9; e < f; e++) {
            let g = this.b(e);
            g.al(a, b, c, d);
        }
    }
    ae(a) {
        this.cf.q(a);
        return true;
    }
    af(a) {
        this.cf.r(a);
        return true;
    }
    ag(a) {
        this.cf.s(a);
        return true;
    }
    ad(a) {
        return this.cf.l(a);
    }
    ah(a) {
        this.cf.t(a);
        return true;
    }
}
SpreadsheetLayerContainerElement$1.$t = markType(SpreadsheetLayerContainerElement$1, 'SpreadsheetLayerContainerElement$1', VisualElement.$);
/**
 * @hidden
 */
export class CanvasSpreadsheetGraphics extends Base {
    constructor(ctx_, a) {
        super();
        this.e = null;
        this.a = null;
        this.b = false;
        this.h = Nullable$1.toNullable(Color.$, null);
        this.j = null;
        this.d = null;
        this.b = ((ctx_.setLineDash != null && ctx_.getLineDash != null));
        this.e = ctx_;
        this.a = a;
    }
    c(a, b, c, d, e, f, g, h, i) {
        let j = false;
        if (b != f || c != g || d != h || e != i) {
            let k = this.e;
            j = true;
            if (a) {
                k.save();
            }
            k.beginPath();
            k.moveTo(f, g);
            k.lineTo(f + h, g);
            k.lineTo(f + h, g + i);
            k.lineTo(f, g + i);
            k.lineTo(f, g);
            k.lineTo(b, c);
            k.lineTo(b, c + e);
            k.lineTo(b + d, c + e);
            k.lineTo(b + d, c);
            k.lineTo(b, c);
            k.clip();
        }
        return j;
    }
    drawIcon(a, b, c, d, e, f, g, h, i) {
        let j = this.c(true, b, c, d, e, f, g, h, i);
        let k = this.a.a2();
        this.e.drawImage(k, (a - 1) * 16, 0, 16, 16, b, c, d, e);
        if (j) {
            this.e.restore();
        }
    }
    getFarPixelAdjustment(a) {
        return a.d / 2;
    }
    fillRectangle3(a, b, c, d, e) {
        if (a != CellFill.noColor) {
            let f = a._c(this.a.l);
            let g = typeCast(CellFillPattern.$, f);
            if (g != null) {
                let h = g.patternStyle;
                let i = g.patternColorInfo._getResolvedColor();
                let j = g.backgroundColorInfo._getResolvedColor();
                switch (g.patternStyle) {
                    case 0: break;
                    case 1:
                        this.fillRectangle7(j.colorString, b, c, d, e);
                        break;
                    default:
                        let k = this.i(g.patternStyle, i, j);
                        if (k != null) {
                            this.fillRectangle7(k, b, c, d, e);
                        }
                        break;
                }
            }
            else {
                let l = typeCast(CellFillLinearGradient.$, f);
                if (l != null) {
                    let m = this.f(b, c, d, e, l);
                    this.fillRectangle7(m, b, c, d, e);
                }
                else {
                    let n = typeCast(CellFillRectangularGradient.$, f);
                    if (n != null) {
                        this.fillRectangle6(n, b, c, d, e);
                    }
                }
            }
        }
    }
    fillRectangle1(a, b, c, d, e) {
        let f = this.a.ba(a);
        this.fillRectangle7(f, b, c, d, e);
    }
    drawLine(a, b, c, d, e, f, g) {
        this.drawLine5(a, this.a.ba(b), c, d, e, f, g);
    }
    drawLine2(pen, color, dpiFactor, x1, y1, x2, y2) {
        arguments[1] = Color.create(arguments[1]);
        return this._drawLine2$i.apply(this, arguments);
    }
    _drawLine2$i(a, b, c, d, e, f, g) {
        this.drawLine5(a, b.colorString, c, d, e, f, g);
    }
    drawLine1(a, b, c, d, e, f, g) {
        this.drawLine5(a, b._getResolvedColor1(this.a.l).colorString, c, d, e, f, g);
    }
    drawLine4(penWidth, color, dpiFactor, x1, y1, x2, y2) {
        arguments[1] = Color.create(arguments[1]);
        return this._drawLine4$i.apply(this, arguments);
    }
    _drawLine4$i(a, b, c, d, e, f, g) {
        this.drawLine5(6, b.colorString, c * a, d, e, f, g);
    }
    drawLine3(a, b, c, d, e, f) {
        if (this.j == null || Color.e(this.h, a.b)) {
            this.h = a.b;
            this.j = Color.c(a.b, Nullable$1.toNullable(Color.$, null)) ? this.a.ba(38) : a.b.value.colorString;
        }
        let g = Color.c(a.b, Nullable$1.toNullable(Color.$, null)) ? 6 : 1;
        this.drawLine5(g, this.j, b, c, d, e, f);
    }
    drawRectangle(a, b, c, d, e, f, g) {
        this.drawRectangle2(a, this.a.ba(b), c, d, e, f, g);
    }
    drawRectangle1(a, b, c, d, e, f, g) {
        this.drawRectangle2(a, b._getResolvedColor1(this.a.l).colorString, c, d, e, f, g);
    }
    drawRectangle2(a, b, c, d, e, f, g) {
        let h = null;
        let i = 0;
        if (this.b) {
            h = this.e.getLineDash();
            let j = SpreadsheetUtilities.c(a) || new Array(0);
            this.e.setLineDash(j);
            i = this.e.lineDashOffset;
            this.e.lineDashOffset = a == 8 ? 1 : 0;
        }
        this.e.lineWidth = SpreadsheetUtilities.b8(a, c);
        this.e.strokeStyle = b;
        this.e.strokeRect(d, e, f, g);
        if (this.b) {
            this.e.setLineDash(h);
            this.e.lineDashOffset = i;
        }
    }
    fillRectangle2(a, b, c, d, e, f, g, h, i) {
        let j = b + d;
        let k = f + h;
        let l = c + e;
        let m = g + i;
        let n = this.a.ba(a);
        if (b < f) {
            this.fillRectangle7(n, b, c, f - b, e);
        }
        if (j > k) {
            this.fillRectangle7(n, k, c, j - k, e);
        }
        if (c < g) {
            this.fillRectangle7(n, f, c, h, g - c);
        }
        if (l > m) {
            this.fillRectangle7(n, f, m, h, l - m);
        }
    }
    fillRectangle5(a, b, c, d, e) {
        let f = a._getResolvedColor1(this.a.l).colorString;
        this.fillRectangle7(f, b, c, d, e);
    }
    drawEllipse(a, b, c, d, e, f, g) {
        this.e.beginPath();
        this.e.lineWidth = (a * c);
        this.e.strokeStyle = this.a.ba(b);
        let h = 0.5522848;
        let i = (d + f / 2);
        let j = (e + g / 2);
        let k = (f / 2 * h);
        let l = (g / 2 * h);
        let m = (d + f);
        let n = (e + g);
        this.e.moveTo(d, j);
        this.e.bezierCurveTo(d, j - l, i - k, e, i, e);
        this.e.bezierCurveTo(i + k, e, m, j - l, m, j);
        this.e.bezierCurveTo(m, j + l, i + k, n, i, n);
        this.e.bezierCurveTo(i - k, n, d, j + l, d, j);
        this.e.closePath();
        this.e.stroke();
    }
    fillRectangle(a, b, c, d, e, f, g) {
    }
    drawHeaderText(a, b, c, d, e, f = 1) {
        let g = this.a.ba(e);
        this.e.font = this.a.a5(a, f);
        this.e.textAlign = "center";
        this.e.textBaseline = "middle";
        this.e.fillStyle = g;
        this.e.fillText(b, c, d);
    }
    drawDropDownGlyph(a, b, c, d, e) {
        let f = ((a & 2) == 0) ? 67 : 70;
        let g = this.a.ba(f);
        let h = this.e;
        h.save();
        h.translate(b, c);
        h.scale(Math.min(1, d / 15), Math.min(1, e / 15));
        h.fillStyle = g;
        h.strokeStyle = g;
        h.beginPath();
        let i = (a & 16) != 0;
        let j = (a & 4) != 0;
        let k = (a & 8) != 0;
        let l = j || k;
        if (i) {
            h.moveTo(5, 3);
            h.lineTo(14, 3);
            h.lineTo(11, 6);
            h.lineTo(11, 11);
            h.lineTo(8, 11);
            h.lineTo(8, 6);
            if (l) {
                h.fill();
                h.beginPath();
                h.moveTo(3.5, 4);
                h.lineTo(3.5, 12);
                h.stroke();
                h.beginPath();
                h.moveTo(2, j ? 5.5 : 10.5);
                h.lineTo(5, j ? 5.5 : 10.5);
                h.stroke();
            }
            else {
                h.moveTo(2, 9);
                h.lineTo(7, 9);
                h.lineTo(4.5, 12);
                h.fill();
            }
        }
        else if (l) {
            h.moveTo(3, 9);
            h.lineTo(8, 9);
            h.lineTo(5.5, 12);
            h.fill();
            h.beginPath();
            h.moveTo(10.5, 3);
            h.lineTo(10.5, 11);
            h.stroke();
            h.beginPath();
            h.moveTo(9, j ? 4.5 : 9.5);
            h.lineTo(12, j ? 4.5 : 9.5);
            h.stroke();
        }
        else {
            h.moveTo(4, 6);
            h.lineTo(11, 6);
            h.lineTo(7.5, 10);
            h.fill();
        }
        h.restore();
    }
    i(a, b, c) {
        let d = SpreadsheetUtilities.bq.item(a);
        if (d == null) {
            return null;
        }
        let e = arrayGetLength(d, 0);
        let f = arrayGetLength(d, 1);
        if (this.d == null) {
            this.d = document.createElement("canvas");
        }
        let g = this.d.getContext("2d");
        this.d.width = f;
        this.d.height = e;
        let h = g.createImageData(f, e);
        ;
        let i = h.data;
        let j = 0;
        for (let k = 0; k < e; k++) {
            for (let l = 0; l < f; l++) {
                let m = d[k][l] == 1 ? b : c;
                i[j++] = m.o;
                i[j++] = m.n;
                i[j++] = m.m;
                i[j++] = m.l;
            }
        }
        g.putImageData(h, 0, 0);
        ;
        return this.e.createPattern(this.d, "repeat");
        ;
    }
    f(a, b, c, d, e) {
        let f = SpreadsheetUtilities.cc(e.angle);
        let g = SpreadsheetUtilities.cb(f, c, d);
        let h = SpreadsheetUtilities.b7(g, c, d);
        let i = c / 2 + Math.sin(g) * h;
        let j = d / 2 + Math.cos(g) * h;
        let k = c / 2 + Math.sin(g + Math.PI) * h;
        let l = d / 2 + Math.cos(g + Math.PI) * h;
        let m = e.stops;
        return this.g(a, b, 1, 1, i, j, k, l, m);
    }
    g(a, b, c, d, e, f, g, h, i) {
        let j = a + (g * c);
        let k = b + (h * d);
        let l = a + (e * c);
        let m = b + (f * d);
        let n = this.e.createLinearGradient(j, k, l, m);
        for (let o = 0; o < i.count; o++) {
            let p = i.item(o);
            n.addColorStop(p.offset, p.colorInfo._color$i.value.colorString);
        }
        return n;
    }
    drawLine5(a, b, c, d, e, f, g) {
        this.e.beginPath();
        let h = null;
        let i = 0;
        if (this.b) {
            h = this.e.getLineDash();
            let j = SpreadsheetUtilities.c(a) || new Array(0);
            this.e.setLineDash(j);
            i = this.e.lineDashOffset;
            this.e.lineDashOffset = a == 8 ? 1 : 0;
        }
        this.e.lineWidth = SpreadsheetUtilities.b8(a, c);
        this.e.strokeStyle = b;
        this.e.moveTo(d, e);
        this.e.lineTo(f, g);
        this.e.stroke();
        if (this.b) {
            this.e.setLineDash(h);
            this.e.lineDashOffset = i;
        }
    }
    fillRectangle7(a, b, c, d, e) {
        this.e.fillStyle = a;
        this.e.fillRect(b, c, d, e);
    }
    fillRectangle4(a, b, c, d, e, f, g) {
        let h = a._getResolvedColor1(this.a.l).colorString;
        let i;
        if (WorkbookColorInfo.l_op_Equality(a, b)) {
            i = h;
        }
        else {
            let j, k, l, m;
            if (c) {
                j = d;
                l = d + f;
                k = m = e + g / 2;
            }
            else {
                k = e;
                m = e + g;
                j = l = d + f / 2;
            }
            let n = this.e.createLinearGradient(j, k, l, m);
            n.addColorStop(0, h);
            n.addColorStop(1, b._getResolvedColor1(this.a.l).colorString);
            i = n;
        }
        this.fillRectangle7(i, d, e, f, g);
    }
    fillRectangle6(a, b, c, d, e) {
        let f = Math.abs(a.bottom - a.top);
        let g = Math.abs(a.right - a.left);
        let h = a.top;
        let i = Math.max(h, a.bottom);
        let j = a.left;
        let k = Math.max(j, a.right);
        let l = 0.01;
        if (g > 0 && f > 0) {
            let m = Enumerable.a(CellFillGradientStop.$, Enumerable.x(CellFillGradientStop.$, Number_$type, a.stops, (n) => n.offset));
            let n = m[0];
            let o = new Color();
            if (m[1].offset != n.offset) {
                o = Enumerable.ad(CellFillGradientStop.$, Enumerable.x(CellFillGradientStop.$, Number_$type, a.stops, (p) => p.offset)).colorInfo._getResolvedColor();
            }
            else {
                let p = new List$1(Color.$, 0);
                for (let q = 0, r = m.length; q < r; q++) {
                    let s = m[q];
                    if (s.offset != n.offset) {
                        break;
                    }
                    p.add(s.colorInfo._getResolvedColor());
                }
                let t = truncate((Enumerable.ab(Color.$, p, (u) => u.o) / p.count));
                let u = truncate((Enumerable.ab(Color.$, p, (v) => v.n) / p.count));
                let v = truncate((Enumerable.ab(Color.$, p, (w) => w.m) / p.count));
                o = Color.u(255, t, u, v);
            }
            this.fillRectangle7(o.colorString, b + (j * d), c + (h * e), g * d, f * e);
        }
        if (j > 0) {
            this.e.beginPath();
            this.e.moveTo((b), (c));
            this.e.lineTo((b + (j + l) * d), (c + h * e));
            this.e.lineTo((b + (j + l) * d), (c + i * e));
            this.e.lineTo((b), (c + e));
            this.e.closePath();
            this.e.fillStyle = this.g(b, c, d, e, 0, 0.5, j, 0.5, a.stops);
            this.e.fill();
        }
        if (h > 0) {
            this.e.beginPath();
            this.e.moveTo((b), (c));
            this.e.lineTo((b + j * d), (c + (h + l) * e));
            this.e.lineTo((b + k * d), (c + (h + l) * e));
            this.e.lineTo((b + d), (c));
            this.e.closePath();
            this.e.fillStyle = this.g(b, c, d, e, 0.5, 0, 0.5, h, a.stops);
            this.e.fill();
        }
        if (k < 1) {
            this.e.beginPath();
            this.e.moveTo((b + d), (c));
            this.e.lineTo((b + (k - l) * d), (c + h * e));
            this.e.lineTo((b + (k - l) * d), (c + i * e));
            this.e.lineTo((b + d), (c + e));
            this.e.closePath();
            this.e.fillStyle = this.g(b, c, d, e, 1, 0.5, k, 0.5, a.stops);
            this.e.fill();
        }
        if (i < 1) {
            this.e.beginPath();
            this.e.moveTo((b), (c + e));
            this.e.lineTo((b + j * d), (c + (i - l) * e));
            this.e.lineTo((b + k * d), (c + (i - l) * e));
            this.e.lineTo((b + d), (c + e));
            this.e.closePath();
            this.e.fillStyle = this.g(b, c, d, e, 0.5, 1, 0.5, i, a.stops);
            this.e.fill();
        }
    }
}
CanvasSpreadsheetGraphics.$t = markType(CanvasSpreadsheetGraphics, 'CanvasSpreadsheetGraphics', Base.$, [ISpreadsheetGraphics_$type]);
/**
 * @hidden
 */
export class SpreadsheetVisualElementDomBuilder extends VisualElementDomBuilder {
    constructor(a) {
        super();
        this.ab = null;
        this.ac = null;
        this.ak = new Stack$1(String_$type);
        this.aj = null;
        this.ab = a;
    }
    r(a) {
        switch (a.bx) {
            case "TextBox":
                if (a._parent != null && a._parent.bx == "FormulaBarTextAreaContainer") {
                    super.r(a);
                    this.bc(a, "ToolTip_FormulaBarTextEditor");
                    SpreadsheetVisualElementDomBuilder.a5(a.a7.rootWrapper);
                    this.at(a.a7.rootWrapper);
                    a.a7.rootWrapper.listen("focus", (b) => this.ab._ai.au());
                }
                break;
            case "ToggleButton":
                if (a._parent != null && a._parent.bx == "FormulaBarTextAreaContainer") {
                    VisualElementDomBuilder.p(a, this.ac.formulaBarExpandButton);
                }
                break;
            case "ComboBox":
                if (this.ag(a)) {
                    this.aq(a);
                }
                break;
            case "FormulaBarButtonContainer":
                VisualElementDomBuilder.p(a, this.ac.formulaBarButtonContainer);
                break;
            case "FormulaBarNameBoxContainer":
                this.ar(a);
                break;
            case "FormulaBarTextAreaContainer":
                VisualElementDomBuilder.p(a, this.ac.formulaBarTextAreaContainer);
                break;
            case "FormulaBarTextBoxSplitter":
                VisualElementDomBuilder.p(a, this.ac.formulaBarTextAreaSplitter);
                break;
            case "FormulaBarNameBoxSplitter":
                VisualElementDomBuilder.p(a, this.ac.nameBoxSplitter);
                break;
            case "FormulaBarEnterButton":
                VisualElementDomBuilder.p(a, this.ac.formulaBarEnterButton);
                this.bc(a, "ToolTip_FormulaBarEnterButton");
                break;
            case "FormulaBarCancelButton":
                VisualElementDomBuilder.p(a, this.ac.formulaBarCancelButton);
                this.bc(a, "ToolTip_FormulaBarCancelButton");
                break;
            case "FormulaBar":
                VisualElementDomBuilder.q(a, "div", this.ac.formulaBar, true, false);
                break;
            case "InputMessage":
                VisualElementDomBuilder.p(a, this.ac.inputMessage);
                break;
            case "InputMessageBody":
                VisualElementDomBuilder.q(a, "div", this.ac.inputMessageContent, false, false);
                break;
            case "InputMessageTitle":
                VisualElementDomBuilder.q(a, "div", this.ac.inputMessageTitle, false, false);
                break;
            case "SelectAllButton":
                VisualElementDomBuilder.p(a, this.ac.selectAll);
                break;
            case "PaneSplitter":
                {
                    let b = a.cf;
                    let c = b == 2 ? this.ac.splitterIntersection : b == 0 ? this.ac.rowSplitter : this.ac.columnSplitter;
                    VisualElementDomBuilder.p(a, c);
                    break;
                }
            case "ColSplitterPreview":
                VisualElementDomBuilder.p(a, this.ac.columnSplitterPreview);
                break;
            case "RowSplitterPreview":
                VisualElementDomBuilder.p(a, this.ac.rowSplitterPreview);
                break;
            case "TabItemArea":
                VisualElementDomBuilder.p(a, this.ac.tabItemArea);
                break;
            case "TabScrollFirst":
                VisualElementDomBuilder.p(a, this.ac.scrollFirstTabButton);
                break;
            case "TabScrollPrev":
                VisualElementDomBuilder.p(a, this.ac.scrollPreviousTabButton);
                break;
            case "TabScrollNext":
                VisualElementDomBuilder.p(a, this.ac.scrollNextTabButton);
                break;
            case "TabScrollLast":
                VisualElementDomBuilder.p(a, this.ac.scrollLastTabButton);
                break;
            case "TabActivatePrev":
                VisualElementDomBuilder.p(a, this.ac.activatePreviousHiddenTabButton);
                break;
            case "TabItemPanel":
                VisualElementDomBuilder.p(a, null);
                break;
            case "TabActivateNext":
                VisualElementDomBuilder.p(a, this.ac.activateNextHiddenTabButton);
                break;
            case "AddWorksheetButton":
                VisualElementDomBuilder.p(a, this.ac.addNewWorksheetButton);
                break;
            case "TabAreaSplitter":
                VisualElementDomBuilder.p(a, this.ac.tabAreaSplitter);
                break;
            case "TabAreaBackground":
                VisualElementDomBuilder.p(a, this.ac.tabAreaBackground);
                break;
            case "TabAreaBorder":
                VisualElementDomBuilder.p(a, this.ac.tabAreaBorder);
                break;
            case "TabDropIndicator":
                VisualElementDomBuilder.q(a, "div", this.ac.tabDropIndicator, true, false);
                break;
            case "SheetTabItem":
                VisualElementDomBuilder.p(a, this.ac.tabItem);
                a.cm = SpreadsheetVisualElementDomBuilder.al(a.a7, this.ac);
                break;
            case "SpreadsheetColumnHeaderContainer":
                VisualElementDomBuilder.p(a, this.ac.columnHeaderArea);
                break;
            case "SpreadsheetRowHeaderContainer":
                VisualElementDomBuilder.p(a, this.ac.rowHeaderArea);
                break;
            case "SpreadsheetPaneContainer":
                VisualElementDomBuilder.p(a, this.ac.paneArea);
                break;
            case "SpreadsheetArea":
                VisualElementDomBuilder.p(a);
                break;
            case "Icon":
            case "SpreadsheetRenderer":
                {
                    VisualElementDomBuilder.q(a, "canvas", null, true, false);
                    let d = new SpreadsheetVisualElementDomBuilder_CanvasCache();
                    d.d = a.a7.get2DCanvasContext(a.a7.rootWrapper);
                    if (a.bx == "Icon") {
                        a.cj = d;
                    }
                    else {
                        a.ci = d;
                    }
                    break;
                }
            case "SpreadsheetCellValue":
                VisualElementDomBuilder.q(a, "div", null, true, false);
                break;
            case "SpreadsheetCellValueLayer":
                VisualElementDomBuilder.q(a, "div", null, true, true);
                break;
            case "CellContainer":
                VisualElementDomBuilder.q(a, "div", null, true, false);
                break;
            case "InplaceEditor":
                VisualElementDomBuilder.q(a, "textarea", null, true, true);
                this.a6(a);
                break;
            case "InplaceBackground":
                VisualElementDomBuilder.q(a, "div", null, true, true);
                break;
            case "InvalidData":
                VisualElementDomBuilder.q(a, "img", null, true, false);
                break;
            case "SpreadsheetDrawingLayer":
            case "Layer":
                VisualElementDomBuilder.q(a, "div", null, true, true);
                break;
            case "ShapeContainer":
            case "Shape":
            case "Chart":
                VisualElementDomBuilder.q(a, "div", null, true, false);
                break;
        }
        super.r(a);
    }
    g(a) {
        let b;
        if (a.bx == "ScrollBar") {
            b = a.cn;
        }
        else {
            b = a.g(ScrollBarVisualElement.$).cn;
        }
        switch (a.bx) {
            case "ScrollBar": return b ? this.ac.scrollBarVertical : this.ac.scrollBarHorizontal;
            case "ScrollBarFarButton": return b ? this.ac.scrollBarArrowDown : this.ac.scrollBarArrowRight;
            case "ScrollBarFarTrack": return b ? this.ac.scrollBarTrackDown : this.ac.scrollBarTrackRight;
            case "ScrollBarNearButton": return b ? this.ac.scrollBarArrowUp : this.ac.scrollBarArrowLeft;
            case "ScrollBarNearTrack": return b ? this.ac.scrollBarTrackUp : this.ac.scrollBarTrackLeft;
            case "ScrollBarThumb": return b ? this.ac.scrollBarThumbVertical : this.ac.scrollBarThumbHorizontal;
        }
        return super.g(a);
    }
    s(a) {
        if (this.ag(a)) {
            let b = a;
            let c = b.cr;
            let d = false;
            if (a.ch) {
                a.ch = false;
                let e = null;
                if (a.ck != null) {
                    e = new Array(a.ck.count);
                    a.ck.copyTo(e, 0);
                }
                if (e.length != c.g.count) {
                    d = true;
                }
                else {
                    for (let f = 0; f < e.length; f++) {
                        if (e[f] != c.g.item(f).p) {
                            d = true;
                            break;
                        }
                    }
                }
                if (d) {
                    c.g.clear();
                    for (let g = 0; g < e.length; g++) {
                        let h = new DropDownItem();
                        h.m = h.p = e[g];
                        c.g.add(h);
                    }
                }
            }
            if (a.ci || d) {
                a.ci = false;
                c.z = a.co;
            }
            c.p.setRawSize(a.a3, a.av);
        }
        super.s(a);
    }
    v(a) {
        if (a._parent != null && a._parent.bx == "FormulaBarTextAreaContainer") {
            if (a.ck) {
                if (a.cl) {
                    a.a7.rootWrapper.addClass(this.ac.formulaBarExpandButtonOpen);
                }
                else {
                    a.a7.rootWrapper.removeClass(this.ac.formulaBarExpandButtonOpen);
                }
            }
        }
        super.v(a);
    }
    bb(a, b) {
        let c = a;
        if (c.cr != null) {
            let d = c.cr;
            c.cr = null;
            SpreadsheetVisualElementDomBuilder.as(d);
        }
        c.disposed = delegateRemove(c.disposed, runOn(this, this.bb));
    }
    x(a) {
        if (this.ag(a)) {
            let b = a;
            let c = b.cr;
            c.f = a.u;
        }
        else if (a.bx == "Spreadsheet") {
            return;
        }
        super.x(a);
    }
    z(a) {
        if (this.ag(a)) {
            let b = a;
            let c = b.cr;
            b.cr = null;
            SpreadsheetVisualElementDomBuilder.as(c);
            a.disposed = delegateRemove(a.disposed, runOn(this, this.bb));
        }
        super.z(a);
    }
    get_n() {
        return this.ac.tooltip;
    }
    get_m() {
        return this.ac.tooltipBody;
    }
    get_o() {
        return this.ac.tooltipTitle;
    }
    visitElement(a) {
        let b = a.j;
        let c = super.visitElement(a);
        if (b && a.a7 != null) {
            switch (a.bx) {
                case "InputMessage":
                    this.a0(a);
                    break;
                case "SheetTabItem":
                    this.a4(a);
                    break;
                case "SpreadsheetRenderer":
                    this.au(a);
                    break;
                case "SpreadsheetCellValue":
                    this.av(a);
                    break;
                case "InplaceEditor":
                    this.az(a);
                    break;
                case "InplaceBackground":
                    this.ay(a);
                    break;
                case "Icon":
                    this.ax(a);
                    break;
                case "InvalidData":
                    this.a1(a);
                    break;
                case "ShapeContainer":
                    this.a2(a);
                    break;
                case "Shape":
                    this.a3(a);
                    break;
                case "Chart":
                    this.aw(a);
                    break;
            }
        }
        return c;
    }
    get ad() {
        return this.ac;
    }
    set ad(a) {
        this.ac = a;
    }
    ap(a) {
        try {
            let b = JSDataObject._a(a);
            if (b != null && b.getDataPresent(DataFormats.d)) {
                let c = ClipboardHelper.e();
                if (c == null || !c.getDataPresent(DataFormats.d) || c.getData(DataFormats.d) != b.getData(DataFormats.d)) {
                    let d = ClipboardHelper.d();
                    ClipboardHelper.b(b, d);
                    ClipboardHelper.c(d, false);
                }
            }
        }
        catch (e) {
        }
    }
    static am(a) {
        let b = new EditableComboBox();
        b.ak(a);
        return b;
    }
    aq(a) {
        VisualElementDomBuilder.q(a, "div", null, true, false);
        a.cr = SpreadsheetVisualElementDomBuilder.am(a.a7);
        let b = a.cr;
        b.itemClick = delegateCombine(b.itemClick, (c, d) => {
            a.co = d.p;
            a.cq();
        });
        b.j = (c, d, e) => {
            if (c == 3) {
                a.co = b.z;
                a.cq();
                e.stopPropagation();
                e.preventDefault();
                return true;
            }
            else if (c == 8) {
                this.ab._v.focus();
                e.stopPropagation();
                e.preventDefault();
                return true;
            }
            return false;
        };
        a.disposed = delegateCombine(a.disposed, runOn(this, this.bb));
    }
    ar(a) {
        VisualElementDomBuilder.q(a, "div", this.ac.nameBoxContainer, true, false);
        let b = a.a7.rootWrapper;
        this.bc(a, "ToolTip_FormulaBarNameBox");
        b.listen("focusout", (c) => {
            let d = a.g(SpreadsheetVisualElement.$);
            let e = (c.originalEvent.relatedTarget);
            if (d != null && !b.getNativeElement().contains(e)) {
                a.cf.co = d.dq._ft;
                a.cf.ci = true;
            }
        });
        b.listen("focusin", (c) => {
            let d = (c.originalEvent.relatedTarget);
            if (!b.getNativeElement().contains(d)) {
                let e = a.cf;
                let f = e.cr;
                f.al();
            }
        });
    }
    static al(a, b) {
        let c = a.createElement("div");
        c.addClass(b.tabItemContent);
        a.append(c);
        let d = a.createElement("span");
        c.append(d);
        return d;
    }
    static as(a) {
        let b = a;
        if (b != null) {
            b.ak(null);
        }
    }
    at(a) {
        a.listen("keydown", (b) => {
            let c = false;
            let d = BaseDOMEventProxy.cr(b);
            if (this.ab.isInEditMode && d == 3 && b.altKey) {
                let e = (b.originalEvent.target);
                this.ah(e, "\n");
                let f = this.ab._ay;
                if (f != null) {
                    f.c9 = e.value;
                    f.cv = true;
                    f.da();
                }
                c = true;
            }
            else if (!this.ab.isInEditMode) {
                switch (d) {
                    case 55:
                    case 54:
                        if (b.ctrlKey) {
                            if (!this.ab._cw(d == 55, true)) {
                                c = true;
                            }
                        }
                        break;
                    case 1:
                        if (!b.ctrlKey && !b.altKey && !b.shiftKey) {
                            let g = b.originalEvent.target;
                            let h = (g && g.value);
                            if (stringIsNullOrEmpty(h)) {
                                this.ab._cz(74, null, null);
                                c = true;
                            }
                        }
                        break;
                }
            }
            if (c) {
                b.preventDefault();
                b.stopPropagation();
            }
        });
        let b = (c) => {
            let d = (c.originalEvent.type);
            this.ak.h(d);
            if (this.aj != null) {
                this.aj.add(d);
            }
            try {
                if (this.ab.isInEditMode) {
                    switch (d) {
                        case "cut":
                        case "copy":
                            this.ab._ga();
                            break;
                        case "paste":
                            this.ap(c);
                            break;
                    }
                }
                else {
                    switch (d) {
                        case "cut":
                        case "copy":
                            let e = this.ab._i5;
                            this.ab._i5 = JSDataObject._a(c);
                            try {
                                this.ab._cz(d == "cut" ? 148 : 149, c, null);
                                c.preventDefault();
                            }
                            finally {
                                this.ab._i5 = e;
                            }
                            break;
                        case "paste":
                            this.ap(c);
                            this.ab._cz(150, c, null);
                            c.preventDefault();
                            break;
                    }
                }
            }
            finally {
                this.ak.e();
            }
        };
        a.listen("copy", b);
        a.listen("cut", b);
        a.listen("paste", b);
    }
    au(a) {
        if (a.ch) {
            let b = a.ci;
            let c = this.ab._ek;
            let d = truncate(Math.ceil(a.a3 * c));
            let e = truncate(Math.ceil(a.av * c));
            if (d != b.c) {
                a.a7.rootWrapper.setAttribute("width", d);
            }
            if (e != b.a) {
                a.a7.rootWrapper.setAttribute("height", e);
            }
            if (c != b.b) {
                b.b = c;
                b.d = a.a7.get2DCanvasContext(a.a7.rootWrapper);
            }
            if (c != 1) {
                b.d.save();
                b.d.scale(c, c);
            }
            let f = a.co;
            b.d.clearRect(f.x, f.y, f.width, f.height);
            let g = new CanvasSpreadsheetGraphics(b.d, this.ab._a8._al._j);
            a.cl(g, SpreadsheetVisualElementDomBuilder.ae, PointUtil.create());
            if (c != 1) {
                b.d.restore();
            }
            b.a = e;
            b.c = d;
            b.b = c;
        }
    }
    a1(a) {
        if (a.ch || a.ci) {
            a.ch = false;
            a.ci = false;
            let b = a.ck;
            let c = b / 2;
            let d = b / 2;
            let e = a.a3 - b;
            let f = a.av - b;
            let g = 0.5522848;
            let h = (c + e / 2);
            let i = (d + f / 2);
            let j = (e / 2 * g);
            let k = (f / 2 * g);
            let l = (c + e);
            let m = (d + f);
            let n = new StringBuilder(0);
            n.l("<svg xmlns=\"http://www.w3.org/2000/svg\">");
            n.l("<path");
            n.l(" fill=\"none\"");
            n.l(" stroke=\"");
            n.l(a.cm);
            n.l("\"");
            n.l(" stroke-width=\"");
            n.k(b);
            n.l("\"");
            n.l(" d=\"");
            n.l(" M " + c + " " + i);
            n.l(" C " + c + " " + (i - k) + ", " + (h - j) + " " + d + ", " + h + " " + d);
            n.l(" C " + (h + j) + " " + d + ", " + l + " " + (i - k) + ", " + l + " " + i);
            n.l(" C " + l + " " + (i + k) + ", " + (h + j) + " " + m + ", " + h + " " + m);
            n.l(" C " + (h - j) + " " + m + ", " + c + " " + (i + k) + ", " + c + " " + i);
            n.l("\" />");
            n.l("</svg>");
            a.a7.rootWrapper.setAttribute("src", SpreadsheetUtilities.c6("image/svg+xml", n.toString(), true));
        }
    }
    a4(a) {
        let b = a.a7.rootWrapper;
        if (a.ch) {
            a.ch = false;
            a.cm.setText(a.cf._ae != null ? a.cf._ae : "");
        }
        if (a.ck) {
            a.ck = false;
            if (a.cf._u) {
                b.addClass(this.ac.tabItemSelected);
            }
            else {
                b.removeClass(this.ac.tabItemSelected);
            }
        }
        if (a.ci) {
            a.ci = false;
            if (a.cf._r) {
                b.addClass(this.ac.tabItemActive);
            }
            else {
                b.removeClass(this.ac.tabItemActive);
            }
        }
        if (a.cj) {
            a.cj = false;
            if (a.cf._t) {
                b.addClass(this.ac.tabItemProtected);
            }
            else {
                b.removeClass(this.ac.tabItemProtected);
            }
        }
        if (a.cg) {
            a.cg = false;
            let c = "";
            if (WorkbookColorInfo.l_op_Equality(a.cf._h, null)) {
                b.removeClass(this.ac.tabItemLight);
                b.removeClass(this.ac.tabItemDark);
            }
            else {
                let d = a.cf._ak;
                c = d.colorString;
                let e = SpreadsheetUtilities.b2(d);
                let f = 1.05 / (e + 0.05);
                let g = (e + 0.05) / 0.05;
                let h = g > f ? this.ac.tabItemLight : this.ac.tabItemDark;
                b.addClass(h);
            }
            b.setRawStyleProperty("color", c);
        }
    }
    a0(a) {
        if (a.ch) {
            a.ch = false;
            a.cg.a7.rootWrapper.setText(a.cl != null ? a.cl : "");
            a.cf.a7.rootWrapper.setText(a.ck != null ? a.ck : "");
            let b = a.cj;
            let c = a.ci;
            let d = a.a7.rootWrapper;
            d.setRawStyleProperty("width", "auto");
            d.setRawStyleProperty("height", "auto");
            a.cj = d.getProperty("clientWidth");
            a.ci = d.getProperty("clientHeight");
            if ((b != a.cj || c != a.ci)) {
                a.a3 = a.cj;
                a.av = a.ci;
                if (PointUtil.equals(this.ab.validationInputMessagePosition, null)) {
                    this.ab.scheduleArrange();
                }
            }
        }
    }
    av(a) {
        if (a.cj) {
            a.cj = false;
            let b = a.cg;
            let c = a.ch.columnScrollRegion;
            let d = c._bx;
            let e = b.c;
            let f = a.a3;
            let g = a.av;
            let h = e.b * d;
            let i = e.a * d;
            let j = 1;
            let k;
            let l = "0% 0%";
            if (b.s && (h > f || i > g)) {
                let m = f / h;
                let n = g / i;
                j = Math.min(m, n);
                k = "scale(" + j + "," + j + ")";
            }
            else {
                k = "none";
            }
            if (j < 1) {
                h *= j;
                i *= j;
            }
            let o, p;
            let q = 0;
            switch (b.f) {
                default:
                case 0:
                    o = 0;
                    p = g;
                    break;
                case 2:
                    q = (g - i);
                    o = Math.max(0, i - g);
                    p = Math.max(g, i);
                    break;
                case 3:
                case 4:
                case 1:
                    q = (g / 2 - i / 2);
                    let r = Math.max(0, i / 2 - g / 2);
                    o = r;
                    p = Math.max(g, i - r);
                    break;
            }
            let s = 0;
            let t = h;
            let u = false;
            switch (b.e) {
                case 0:
                case 1: break;
                case 5:
                case 7:
                    t = f;
                    break;
                case 3:
                    s = f - h;
                    break;
                case 2:
                case 6:
                    s = (f / 2 - h / 2);
                    break;
                case 4:
                    u = true;
                    break;
            }
            let v;
            if (b.i || nullableNotEquals(b.al, null) || nullableNotEquals(b.am, null) || h > f) {
                let w = !nullableIsNull(b.am) ? b.am.value : b.ae;
                let x = !nullableIsNull(b.al) ? b.al.value : b.ad;
                if (w == x && o == 0 && p == g && s == 0) {
                    v = "rect(auto, auto, auto, auto)";
                }
                else {
                    let y = w == b.ab ? 0 : c._bn(w, true) - c._bn(b.ab, true);
                    let z = c._bn(x, false) - c._bn(b.ab, true);
                    let aa = a.ch.rowScrollRegion;
                    p = aa._bn(b.ag, false) - aa._bn(b.ak, true);
                    v = "rect(" + 0 + "px, " + (z * d) + "px, " + ((p * d) - b.v) + "px, " + y * d + "px)";
                }
            }
            else {
                v = "auto";
            }
            let ab = f - h;
            let ac = e.e != a.cv || u != a.ck || (u && (ab != a.cr || q != a.cp));
            a.ck = u;
            a.cr = ab;
            let ad = a.a7.rootWrapper;
            if (ac) {
                ad.setProperty("innerHTML", e.e);
                a.cv = e.e;
            }
            let ae = b.ar.colorString;
            let af = t;
            let ag = i;
            let ah = ac || a.cu != k || a.cp != q || a.co != s || a.ct != ae || a.cq != af || a.cn != ag;
            if (ah) {
                let ai = ad.getChildAt(0);
                if (ac || a.cu != k) {
                    ai.setRawStyleProperty("transform", k);
                    a.cu = k;
                    ai.setRawStyleProperty("transformOrigin", l);
                }
                if (ac || q != a.cp) {
                    a.cp = q;
                    ai.setRawStyleProperty("top", a.cp + "px");
                }
                if (ac || s != a.co) {
                    a.co = s;
                    ai.setRawStyleProperty("left", s + "px");
                }
                if (u && ac) {
                    let aj = h;
                    let ak = f - h;
                    while (ak > h) {
                        let al = ai.clone();
                        al.setRawStyleProperty("left", aj + "px");
                        al.setRawStyleProperty("top", q + "px");
                        ad.append(al);
                        aj += h;
                        ak -= h;
                    }
                }
                if (ac || ae != a.ct) {
                    a.ct = ae;
                    ai.setRawStyleProperty("color", ae);
                }
                if (ac || af != a.cq) {
                    a.cq = af;
                    ai.setRawStyleProperty("width", af + "px");
                }
                if (ac || ag != a.cn) {
                    a.cn = ag;
                    ai.setRawStyleProperty("height", ag + "px");
                }
            }
            if (v != a.cs) {
                a.cs = v;
                ad.setRawStyleProperty("clip", v);
            }
            if (f != a.cm) {
                a.cm = f;
                ad.setRawStyleProperty("width", f + "px");
            }
            if (g != a.cl) {
                a.cl = g;
                ad.setRawStyleProperty("height", g + "px");
            }
        }
    }
    ax(a) {
        if (a.ci) {
            a.ci = false;
            let b = a.cj;
            let c = truncate(Math.ceil(a.a3));
            let d = truncate(Math.ceil(a.av));
            if (c != b.c) {
                a.a7.rootWrapper.setAttribute("width", c);
            }
            if (d != b.a) {
                a.a7.rootWrapper.setAttribute("height", d);
            }
            b.d.clearRect(0, 0, b.c, b.a);
            let e = this.ab._a0.t();
            b.d.drawImage(e, (a.cg - 1) * 16, 0, 16, 16, 0, 0, c, d);
            b.a = d;
            b.c = c;
        }
    }
    ay(a) {
        let b = a.a7.rootWrapper;
        if (a.ck) {
            a.ck = false;
            let c;
            if (Rect.l_op_Equality(a.cn, null)) {
                c = "auto";
            }
            else if (a.cn.isEmpty) {
                c = "rect(0px, 0px, 0px, 0px)";
            }
            else {
                let d = a.cn;
                c = "rect(" + (d.top - a.a2) + "px, " + (d.right - a.ax) + "px, " + (d.bottom - a.a2) + "px, " + (d.left - a.ax) + "px)";
            }
            b.setRawStyleProperty("clip", c);
        }
        if (a.cj) {
            a.cj = false;
            let e = "transparent";
            let f = a.cg;
            let g = true;
            if (SpreadsheetUtilities.bc(f)) {
            }
            else if (typeCast(CellFillPattern.$, f) !== null && f.patternStyle == 1) {
                e = f.backgroundColorInfo._getResolvedColor().colorString;
            }
            else if (typeCast(CellFillLinearGradient.$, f) !== null) {
                let h = f;
                let i = SpreadsheetUtilities.cc(h.angle);
                let j = SpreadsheetUtilities.cb(i, a.a3, a.av);
                e = "linear-gradient(" + (180 - MathUtilities.g(j * 180 / Math.PI, 2)) + "deg";
                for (let k of fromEnum(h.stops)) {
                    e += ", " + k.colorInfo._color$i.value.colorString + " " + (k.offset * 100) + "%";
                }
                e += ")";
            }
            else {
                if (a.cl == null) {
                    let l = a.a7;
                    let m = a.cl = l.createElement("canvas");
                    m.setRawStyleProperty("position", "absolute");
                    l.append(m);
                }
                let n = this.ab._ek;
                let o = truncate(Math.ceil(a.a3 * n));
                let p = truncate(Math.ceil(a.av * n));
                a.cl.setAttribute("width", o);
                a.cl.setAttribute("height", p);
                a.cl.setRawStyleProperty("width", a.a3 + "px");
                a.cl.setRawStyleProperty("height", a.av + "px");
                let q = a.a7.get2DCanvasContext(a.cl);
                if (n != 1) {
                    q.save();
                    q.scale(n, n);
                }
                q.clearRect(0, 0, a.a3, a.av);
                let r = new CanvasSpreadsheetGraphics(q, this.ab._a8._al._j);
                r.fillRectangle3(f, 0, 0, a.a3, a.av);
                if (n != 1) {
                    q.restore();
                }
                g = false;
            }
            if (g && a.cl != null) {
                let s = a.cl;
                a.cl = null;
                s.remove();
            }
            b.setRawStyleProperty("background", e);
        }
    }
    az(a) {
        let b = a.a7.rootWrapper;
        if (a.cw) {
            a.cw = false;
            let c;
            if (!a.c3) {
                c = "rect(0px, 0px, 0px, 0px)";
            }
            else if (Rect.l_op_Equality(a.de, null)) {
                c = "auto";
            }
            else if (a.de.isEmpty) {
                c = "rect(0px, 0px, 0px, 0px)";
            }
            else {
                let d = a.de;
                c = "rect(" + (d.top - a.a2) + "px, " + (d.right - a.ax) + "px, " + (d.bottom - a.a2) + "px, " + (d.left - a.ax) + "px)";
            }
            b.setRawStyleProperty("clip", c);
        }
        if (a.cv) {
            a.cv = false;
            let e = a.c9 != null ? a.c9 : "";
            if (b.getProperty("value") != e) {
                if (a.c3) {
                    b.setProperty(VisualElementDomBuilder.l, e);
                }
                else {
                    b.setProperty("value", e);
                }
            }
            if (!a.c3) {
                let f = b.getNativeElement();
                let g = f.selectionStart;
                let h = f.selectionEnd;
                if (g != 0 || h != e.length) {
                    SpreadsheetUtilities.bk(f, 0, e.length);
                }
            }
        }
        if (a.c4) {
            a.c4 = false;
            b.setRawStyleProperty("opacity", (a.c3 ? 1 : 0));
            if (!a.c3) {
                b.setRawStyleProperty("clip", "rect(0px, 0px, 0px, 0px)");
                SpreadsheetUtilities.bk(b.getNativeElement(), 0, a.c9 == null ? 0 : a.c9.length);
            }
        }
        if (a.cy) {
            a.cy = false;
            b.setRawStyleProperty("color", a.dc.colorString);
        }
        if (a.cx || a.c2) {
            a.cx = false;
            a.c2 = false;
            SpreadsheetVisualElementDomBuilder.a8(b, a.ci, a.c6);
        }
        if (a.cz) {
            a.cz = false;
            let i;
            switch (a.cg) {
                case 3:
                    i = "right";
                    break;
                default:
                case 1:
                case 4:
                case 5:
                    i = "left";
                    break;
                case 2:
                case 6:
                case 7:
                    i = "center";
                    break;
            }
            b.setRawStyleProperty("text-align", i);
        }
        if (a.c0) {
            a.c0 = false;
            SpreadsheetVisualElementDomBuilder.a9(b, a.dg);
        }
    }
    static a9(a, b) {
        if (b != null) {
            a.setRawStyleProperty("padding-left", b.c + "px");
            a.setRawStyleProperty("padding-top", b.e + "px");
            a.setRawStyleProperty("padding-right", b.d + "px");
            a.setRawStyleProperty("padding-bottom", b.b + "px");
        }
    }
    static a8(a, b, c) {
        if (b != null) {
            let d = (b.height / 20) * c;
            switch (b.superscriptSubscriptStyle) {
                case 2:
                case 1:
                    d *= 0.66;
                    break;
            }
            a.setRawStyleProperty("font-family", "\"" + b.name + "\", sans-serif");
            a.setRawStyleProperty("font-size", d + "pt");
            a.setRawStyleProperty("font-weight", nullableEquals(b._bold$i, true) ? "bold" : "normal");
            a.setRawStyleProperty("font-style", nullableEquals(b._italic$i, true) ? "italic" : "normal");
            let e = nullableEquals(b._strikeout$i, true);
            let f = "none";
            switch (b.underlineStyle) {
                case 2:
                case 1:
                    if (e) {
                        f = "line-through underline";
                    }
                    else {
                        f = "underline";
                    }
                    break;
                default:
                    if (e) {
                        f = "line-through";
                    }
                    break;
            }
            a.setRawStyleProperty("text-decoration", f);
        }
    }
    aw(a, b = true) {
        let c = a.cg;
        let d = false;
        if (a.ci) {
            a.ci = false;
        }
        if (c.m == null) {
            if (c.a == null || c.g || c.h) {
                if (b) {
                    c.m = a.cn.queueExpensiveOperation(() => {
                        c.m = null;
                        if (!a.ab) {
                            this.aw(a, false);
                        }
                    });
                }
                else {
                    d = true;
                    if (c.a == null) {
                        a.cs();
                        let e = a.cn.spreadsheetOwnerState._h;
                        c.a = a.cp._a(c.d, e);
                        c.g = c.h = false;
                    }
                    else {
                        c.q();
                    }
                }
            }
            if (!b && c.a != null && c.a.g != null && a.cq == null) {
                a.cq = VisualElementDomBuilder.d(a.a7, "div", null, true, true);
                let f = a.cq.rootWrapper;
                f.setRawStyleProperty("height", "100%");
                f.setRawStyleProperty("width", "100%");
                let g = a.cq.getWrapper(c.a.g);
                SpreadsheetUtilities.eg(g);
                f.append(g);
                let h = a.cq.createElement("div");
                SpreadsheetUtilities.eg(h);
                f.append(h);
                d = true;
            }
            if (d && a.cq != null) {
                let i = c.d;
                let j = i.chartArea != null && i.chartArea.roundedCorners;
                let k = j ? 12 : 0;
                let l = a.ck;
                let m = SpreadsheetUtilities.aj(i);
                let n = SpreadsheetUtilities.ai(i);
                let o = a.cq.rootWrapper;
                let p = this.ab.workbook;
                let q = o.getChildAt(0);
                q.setRawStyleProperty("margin", l + "px");
                q.setRawStyleProperty("border-radius", k + "px");
                q.setRawStyleProperty("background", SpreadsheetUtilities.c5(m, p));
                let r = o.getChildAt(1);
                SpreadsheetUtilities.d8(r, l, n, k, p);
            }
        }
        let s = c.a == null;
        let t = a.cr != null;
        if (s != t) {
            if (s) {
                a.cr = VisualElementDomBuilder.d(a.a7, "div", null, false, true);
                let u = a.cr.rootWrapper;
                u.setRawStyleProperty("background-color", SpreadsheetRenderCache.ar.colorString);
                u.setRawStyleProperty("background-image", "url('data:image/png;base64," + SpreadsheetRenderCache.ai + "')");
                u.setRawStyleProperty("background-size", "contain");
                u.setRawStyleProperty("background-position", "center");
                u.setRawStyleProperty("background-repeat", "no-repeat");
                u.setRawStyleProperty("-ms-interpolation-mode", "nearest-neighbor");
                u.setRawStyleProperty("image-rendering", "pixelated");
                u.setRawStyleProperty("height", "100%");
                u.setRawStyleProperty("width", "100%");
            }
            else {
                let v = a.cr;
                a.cr = null;
                v.rootWrapper.remove();
            }
        }
    }
    a2(a) {
        if (a.ci) {
            let b = a.a7.rootWrapper;
            b.setRawStyleProperty("transform", "scale(" + a.ck + ", " + a.ck + ")");
            b.setRawStyleProperty("transform-origin", "0 0");
        }
    }
    a3(a) {
        if (a.ci) {
            a.ci = false;
            if (a.cn == null) {
                let b = a.a7;
                a.cn = VisualElementDomBuilder.d(a.a7, "div", null, true, false);
            }
            let c = a.cg;
            let d = c.t;
            let e = c.u;
            let f = a.ck;
            let g = new StringBuilder(0);
            g.l("<svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" style=\"overflow:visible;width:100%;height:100%;\">");
            let h = ShapeGeometry.t(g, Math.max(e.width, f * 2 + 1), Math.max(e.height, f * 2 + 1), f, f, 1, c.d);
            g.l("</svg>");
            a.cn.rootWrapper.setProperty("innerHTML", g.toString());
            let i = (d.width - e.width) / 2;
            let j = (d.height - e.height) / 2;
            a.cn.rootWrapper.setRawStyleProperty("left", (i - 0) + "px");
            a.cn.rootWrapper.setRawStyleProperty("top", (j - 0) + "px");
            a.cn.rootWrapper.setRawStyleProperty("width", (e.width + f * 2) + "px");
            a.cn.rootWrapper.setRawStyleProperty("height", (e.height + f * 2) + "px");
            let k = "";
            if (c.k % 360 != 0) {
                k += "rotate(" + c.k + "deg) ";
            }
            if (c.f || c.e) {
                k += "scale(" + (c.e ? -1 : 1) + ", " + (c.f ? -1 : 1) + ") ";
            }
            if (k.length == 0) {
                k = "none";
            }
            a.a7.rootWrapper.setRawStyleProperty("transform", c.k % 360 != 0 ? "rotate(" + c.k + "deg)" : "none");
            a.cn.rootWrapper.setRawStyleProperty("transform", c.f || c.e ? "scale(" + (c.e ? -1 : 1) + ", " + (c.f ? -1 : 1) + ")" : "none");
            let l = null;
            if (h.width > 0 && h.height > 0) {
                let m = typeCast(WorksheetShapeWithText.$, c.d);
                if (m != null && m._d0) {
                    let n = "position:absolute;";
                    n += "width:" + h.width + "px;";
                    switch (m.text.verticalAlignment) {
                        default:
                        case 2:
                            n += "top:0;";
                            break;
                        case 0:
                            n += "bottom:0;";
                            break;
                        case 1:
                            n += "top:50%;transform:translateY(-50%);";
                            break;
                    }
                    let o = SpreadsheetUtilities.s(m.text, false);
                    l = JsSpreadsheetRenderCache.a6(o, this.ab.workbook, 1, true, h.width, n);
                }
            }
            if (stringIsNullOrEmpty(l)) {
                if (a.co != null) {
                    a.co.rootWrapper.remove();
                    a.co = null;
                }
            }
            else {
                if (a.co == null) {
                    a.co = VisualElementDomBuilder.d(a.a7, "div", null, true, false);
                }
                if (c.f || c.e) {
                    h = ShapeVisualManager.q(h, new Rect(0, 0, 0, e.width, e.height), c.e, c.f);
                }
                let p = "";
                if (c.f) {
                    p += "scale(-1, -1) ";
                }
                if (p.length == 0) {
                    p = "none";
                }
                let q = a.co.rootWrapper;
                q.setProperty("innerHTML", l);
                q.setRawStyleProperty("transform", p);
                q.setRawStyleProperty("left", (i + h.left) + "px");
                q.setRawStyleProperty("top", (j + h.top) + "px");
                q.setRawStyleProperty("width", h.width + "px");
                q.setRawStyleProperty("height", h.height + "px");
                let r = !SpreadsheetUtilities.a1(c.d.text);
                q.setRawStyleProperty("clip", r ? "rect(auto, auto, auto, auto)" : "auto");
                q.setRawStyleProperty("clip-path", r ? "inset(0 0 0 0)" : "none");
            }
        }
    }
    static a5(a) {
        a.setAttribute("spellcheck", false);
    }
    static a7(a) {
        a.setAttribute("spellcheck", false);
        a.setRawStyleProperty("resize", "none");
        a.setRawStyleProperty("border", "none");
        a.setRawStyleProperty("outline", "none");
        a.setRawStyleProperty("max-width", "none");
        a.setRawStyleProperty("max-height", "none");
        a.setRawStyleProperty("background-color", "transparent");
        a.setRawStyleProperty("box-sizing", "border-box");
        a.setRawStyleProperty("margin", 0);
        a.setRawStyleProperty("padding", 0);
    }
    a6(a) {
        let b = a.a7.rootWrapper;
        SpreadsheetVisualElementDomBuilder.a7(b);
        b.setAttribute("id", "SpreadsheetInplaceEditor");
        this.at(b);
        b.listen("input", (c) => {
            let d = c.originalEvent;
            let e = d.inputType;
            if (e != null && !this.ab.isInEditMode && (e == "historyUndo" || e == "historyRedo")) {
                a.cv = true;
                return;
            }
            let f = (c.originalEvent.target);
            let g = f.value;
            a.c9 = g;
            if (!SpreadsheetUtilities.a5(a, document.activeElement)) {
                return;
            }
            this.ab._ds = true;
            if (!a.c3) {
                if (!this.ab._d2(g, stringIsNullOrEmpty(g)) || !this.ab.isInEditMode) {
                    a.cv = true;
                }
            }
            a.da();
        });
    }
    static ba(a, b) {
        if (a != null) {
            a.setText(b != null ? b : "");
        }
    }
    af(a) {
        let b = SpreadsheetUtilities.de(a);
        return b != null && this.ak.b(b);
    }
    ag(a) {
        return a != null && a.bx == "ComboBox" && a._parent != null && a._parent.bx == "FormulaBarNameBoxContainer";
    }
    bc(a, b) {
        let c = a.a7.rootWrapper;
        c.setAttribute("title", this.ab._fs(b));
        c.setAttribute("data-localeid", b);
        c.setAttribute("data-localeattr", "title");
    }
    ai(a) {
        let b = this.ab._m();
        return b != null && this.ah(b.a7.rootWrapper.getNativeElement(), a);
    }
    ah(a, b) {
        if (a != null) {
            let c = b == null ? "" : b;
            let d = !VisualElementDomBuilder.b && a == document.activeElement && (document.queryCommandSupported('insertText'));
            if (d && c.length > 0 && c.charAt(c.length - 1) == '\n') {
                d = false;
            }
            if (d) {
                document.execCommand('insertText', false, c);
            }
            else {
                let e = a.value;
                let f = a.selectionStart;
                let g = a.selectionEnd;
                let h = (e.substring(0, f)) + c + e.substr(g);
                a[VisualElementDomBuilder.l] = h;
                SpreadsheetUtilities.bk(a, g + c.length, g + c.length);
            }
            return true;
        }
        return false;
    }
}
SpreadsheetVisualElementDomBuilder.$t = markType(SpreadsheetVisualElementDomBuilder, 'SpreadsheetVisualElementDomBuilder', VisualElementDomBuilder.$);
SpreadsheetVisualElementDomBuilder.ae = new PixelConverter();
/**
 * @hidden
 */
export class JsSpreadsheetRenderCache extends SpreadsheetRenderCache {
    constructor(a) {
        super(true);
        this.au = null;
        this.a1 = null;
        this.a3 = null;
        this.as = null;
        this.ay = null;
        this.ax = null;
        this.aw = null;
        this.az = null;
        this.au = a;
        this.ay = new WorksheetCellFormatData(null, 0);
        this.ay._dk();
        this.ax = new ResolvedWorksheetCellFormatDataFont(this.ay);
        this.aw = new FormattedStringFontResolved(null, this.ay);
        this.az = new LRUCache$2(String_$type, JsSpreadsheetText.$, 0, 250);
    }
    get_l() {
        return this.au.workbook;
    }
    get l() {
        return this.get_l();
    }
    y(a, b, c) {
        let d = this.a5(a, b);
        return this.au._a0.h("font:" + d, d) / b;
    }
    aa(a, b, c) {
        let d = b;
        let e = this.a4();
        e.font = this.a5(a, d);
        let f = e.measureText(c);
        return Math.ceil(f.width / d);
    }
    z(a, b) {
        return this.aa(a._af, a._bx, b);
    }
    am() {
        this.as = null;
        this.az.i();
    }
    o(a) {
        if (this.au._a0 == null) {
            return false;
        }
        if (this.as == null) {
            this.as = this.at();
        }
        return BrushUtilCore.a(this.as[a]);
    }
    j() {
        return Workbook._br(this.au.workbook);
    }
    ac(a, b) {
        let c = this.c(TextMetricsProviderBase.$, true) || this.a(TextMetricsProviderBase.$, true, this.j());
        return c._e(a);
    }
    g(a, b, c, d, e, f, g, h) {
        let i = a.unformattedString;
        let j = "";
        for (let k of fromEnum(a.getFormattingRuns())) {
            this.aw._c(k, b);
            let l = i.substr(k.startIndex, k.length);
            if (!e) {
                l = stringReplace(l, "\r\n", " ");
            }
            j += JsSpreadsheetRenderCache.bb(this.aw, l, g, true, this.l);
        }
        this.aw._c(null, this.ay);
        this.ax._b(b);
        let m = JsSpreadsheetRenderCache.a7(this.ax, g);
        this.ax._b(this.ay);
        return this.av(c, d, e, j, g, null, i, m);
    }
    h(a, b, c, d, e, f, g, h) {
        if (a != null && a.length > 0 && a.charCodeAt(a.length - 1) == 10) {
            a += " ";
        }
        this.ax._b(b);
        let i = JsSpreadsheetRenderCache.a7(this.ax, g);
        let j = JsSpreadsheetRenderCache.bb(this.ax, a, g, false, this.l);
        let k = this.av(c, d, e, j, g, this.ax, a, i);
        this.ax._b(this.ay);
        return k;
    }
    static a9(a, b, c, d, e) {
        if (!stringIsNullOrEmpty(e)) {
            a += "font:" + e + ";";
        }
        switch (b) {
            case 0:
            case 5:
                a += "text-align: left;";
                break;
            case 1:
                a += "text-align: right;";
                break;
            case 2:
                a += "text-align: center;";
                break;
            case 3:
                a += "text-align: justify;";
                break;
            case 4:
                a += "text-align: justify;";
                break;
        }
        if (c) {
            if (!isNaN_(d)) {
                a += "max-width:" + d + "px;";
            }
            a += "overflow-wrap:break-word;word-wrap:break-word;";
            if (b == 3 || b == 4) {
                a += "white-space:pre-line;";
            }
            else {
                a += "white-space:pre-wrap;";
            }
        }
        else {
            a += "white-space:pre;";
        }
        return a;
    }
    av(a, b, c, d, e, f, g, h) {
        a *= e;
        let i = JsSpreadsheetRenderCache.a9("position:absolute;", b, c, a, h);
        let j = "<div style='" + i + "'>" + d + "</div>";
        let k = this.az.item(j);
        if (k != null) {
            return k;
        }
        let l, m;
        if (f != null && !c && g.indexOf('\n') < 0) {
            let n = this.a4();
            let o = JsSpreadsheetRenderCache.a7(f, e);
            n.font = o;
            let p = n.measureText(g);
            l = p.width;
            m = this.au._a0.h(JsSpreadsheetRenderCache.a8(f, e), o);
        }
        else {
            let q = this.au._a0.s;
            let r = q.getStyleProperty("width");
            q.setRawStyleProperty("width", Math.ceil(a) + "px");
            q.setProperty("innerHTML", j);
            let s = q.getChildAt(0);
            let t = s.getNativeElement().getBoundingClientRect();
            l = Math.ceil((t.width));
            m = Math.ceil((t.height));
            q.setProperty("innerHTML", "");
            q.setRawStyleProperty("width", r);
        }
        let u = new JsSpreadsheetText();
        u.e = j;
        u.d = l / e;
        u.c = m / e;
        this.az.item(j, u);
        return u;
    }
    a5(a, b = 1) {
        return "" + (a.height / 20) * b + "pt \"" + a.name + "\", sans-serif";
    }
    static a7(a, b) {
        let c = "";
        let d = (a.height / 20) * b;
        switch (a.superscriptSubscriptStyle) {
            case 2:
            case 1:
                d *= 0.66;
                break;
        }
        if (nullableEquals(a._italic$i, true)) {
            c += "italic ";
        }
        if (nullableEquals(a._bold$i, true)) {
            c += "bold ";
        }
        c += d + "pt \"" + a.name + "\", sans-serif";
        return c;
    }
    static a8(a, b) {
        let c = "";
        let d = (a.height / 20) * b;
        switch (a.superscriptSubscriptStyle) {
            case 2:
                d *= 0.66;
                c += "vertical-align: sub;";
                break;
            case 1:
                d *= 0.66;
                c += "vertical-align: super;";
                break;
        }
        c += "font-family:\"" + a.name + "\", sans-serif;";
        c += "font-size:" + d + "pt;";
        if (nullableEquals(a._bold$i, true)) {
            c += "font-weight:bold;";
        }
        if (nullableEquals(a._italic$i, true)) {
            c += "font-style:italic;";
        }
        let e = nullableEquals(a._strikeout$i, true);
        switch (a.underlineStyle) {
            case 2:
                if (e) {
                    c += "text-decoration:line-through underline;";
                }
                else {
                    c += "text-decoration:underline;";
                }
                c += "border-bottom: solid " + Math.max(1, MathUtilities.f(b)) + "px;";
                break;
            case 1:
                if (e) {
                    c += "text-decoration:line-through underline;";
                }
                else {
                    c += "text-decoration:underline;";
                }
                break;
            default:
                if (e) {
                    c += "text-decoration:line-through;";
                }
                break;
        }
        return c;
    }
    a4() {
        if (this.a3 == null) {
            let a = this.au._fa;
            this.a1 = a.getSubRenderer(a.createElement("canvas"));
            this.a3 = this.a1.get2DCanvasContext(this.a1.rootWrapper);
        }
        return this.a3;
    }
    at() {
        let a = this.au._a0.a;
        let b = this.au.brushes;
        let c = new Array(a.length);
        arrayCopyTo(a, c, 0);
        if (b != null) {
            for (let d of fromEnum(b)) {
                let e = d.value;
                if (e == null) {
                    e = JsSpreadsheetRenderCache.bc;
                }
                let f = d.key;
                c[f] = e;
            }
        }
        return c;
    }
    static a6(a, b, c, d, e, f) {
        a.p();
        let g = new StringBuilder(0);
        let h = new IGFormattedTextFont();
        h._a = a.a;
        g.l("<div style='");
        if (!stringIsNullOrEmpty(f)) {
            g.l(f);
        }
        g.l("font:");
        g.l(JsSpreadsheetRenderCache.a7(h, c));
        g.l(";");
        g.l("'>");
        for (let i = 0; i < a.h.count; i++) {
            let j = a.h._inner[i];
            h._a = j.a;
            let k = JsSpreadsheetRenderCache.a7(h, c);
            let l = SpreadsheetUtilities.ad(!nullableIsNull(j.k) ? j.k.value : 4);
            let m = JsSpreadsheetRenderCache.a9("", l, d, e, k);
            g.l("<p style='margin:0;padding:0;");
            g.l(m);
            g.l("'>");
            a.j(j.f, j.e, (n) => {
                let o = a.i.f(n.f, n.e);
                h._a = n.a;
                g.l(JsSpreadsheetRenderCache.bb(h, o, c, true, b));
            });
            if (j.e == 0) {
                g.l(" ");
            }
            g.l("</p>");
        }
        g.l("</div>");
        return g.toString();
    }
    a2() {
        return this.au._a0.t();
    }
    ba(a) {
        if (this.as == null) {
            this.as = this.at();
        }
        return this.as[a]._fill;
    }
    static bb(a, b, c, d, e) {
        b = stringReplace(stringReplace(stringReplace(b, "&", "&amp;"), "'", "&apos;"), "\"", "&quot;");
        let f = JsSpreadsheetRenderCache.a8(a, c);
        if (d) {
            let g = a.colorInfo._g(e, false)._color$i.value;
            f += "color:" + g.colorString + ";";
        }
        return "<span style='" + f + "'>" + b + "</span>";
    }
}
JsSpreadsheetRenderCache.$t = markType(JsSpreadsheetRenderCache, 'JsSpreadsheetRenderCache', SpreadsheetRenderCache.$);
JsSpreadsheetRenderCache.bc = Brush.create("rgba(0,0,0,0)");
/**
 * @hidden
 */
export class SpreadsheetUtilities extends Base {
    static b2(a) {
        let b = 2.2;
        let c = (Math.pow(a.o / 255, b) * 0.2126) + (Math.pow(a.n / 255, b) * 0.7152) + (Math.pow(a.m / 255, b) * 0.0722);
        return c;
    }
    static b3(a, b) {
        if (!stringIsNullOrEmpty(a) && a != "auto") {
            if (stringContains(a, "px")) {
                a = stringReplace(a, "px", "");
            }
            let c = parseFloat(a);
            if (!isNaN(c)) {
                return c;
            }
        }
        return b;
    }
    static a5(a, b) {
        if (b == null || a == null || a.a7 == null) {
            return false;
        }
        let c = a.a7.rootWrapper.getNativeElement();
        return c.contains(b);
    }
    static ch(a, b, c, d) {
        let e = a._fa.createElement("canvas");
        e.setProperty("width", c);
        e.setProperty("height", d);
        let f = a._a8._al._j;
        let g = a._fa.get2DCanvasContext(e);
        let h = new CanvasSpreadsheetGraphics(g, f);
        b(h);
        return e;
    }
    static cf(a, b, c, d) {
        return b == -1 ? null : SpreadsheetUtilities.ch(a, (e) => e.drawIcon(b, 0, 0, c, d, 0, 0, c, d), c, d);
    }
    static ce(a, b, c, d, e = null) {
        return SpreadsheetUtilities.bc(b) ? null : SpreadsheetUtilities.ch(a, (f) => {
            if (WorkbookColorInfo.l_op_Inequality(e, null)) {
                f.drawRectangle1(6, e, 1, 0.5, 0.5, c - 1, d - 1);
                f.fillRectangle3(b, 1, 1, c - 2, d - 2);
            }
            else {
                f.fillRectangle3(b, 0, 0, c, d);
            }
        }, c, d);
    }
    static cg(a, b, c, d, e = null) {
        return WorkbookColorInfo.l_op_Equality(b, null) ? null : SpreadsheetUtilities.ch(a, (f) => {
            if (WorkbookColorInfo.l_op_Inequality(e, null)) {
                f.drawRectangle1(6, e, 1, 0.5, 0.5, c - 1, d - 1);
                f.fillRectangle5(b, 1, 1, c - 2, d - 2);
            }
            else {
                f.fillRectangle5(b, 0, 0, c, d);
            }
        }, c, d);
    }
    static c6(a, b, c) {
        let d = "data:" + a + ";";
        if (c) {
            d += "charset=utf-8;base64,";
            let e = Encoding.uTF8.getBytes1(b);
            d += Convert.toBase64String(e);
        }
        else {
            d += "utf8," + b;
        }
        return d;
    }
    static c5(a, b) {
        if (a == null || typeCast(ChartEmptyFill.$, a) !== null) {
            return "";
        }
        if (typeCast(ChartSolidFill.$, a) !== null) {
            let c = a;
            return SpreadsheetUtilities.e2(c.color, b, false).colorString;
        }
        else if (typeCast(ChartGradientFill.$, a) !== null) {
            let d = a;
            let e = "linear-gradient(" + ((d.angle + 90) % 360) + "deg";
            for (let f of fromEnum(d.getStops())) {
                e += ", " + SpreadsheetUtilities.e2(f.color, b, false).colorString + " " + (f.position * 100) + "%";
            }
            e += ")";
            return e;
        }
        return "";
    }
    static c4(a, b) {
        if (a == null) {
            return "";
        }
        let c = a.lineStyle;
        if (c == 7) {
            return "";
        }
        let d = SpreadsheetUtilities.c5(a._ap, b);
        if (stringIsNullOrEmpty(d)) {
            return "";
        }
        let e = Workbook._eq(a.widthInPoints);
        e = Math.max(Workbook._er(b, e, false, true), 1);
        return d + " " + e + "px solid";
    }
    static c9(a) {
        let b = "";
        let c = a;
        while (c != null) {
            if (b.length > 0) {
                b = "->" + b;
            }
            let d = c;
            let e = (d.className);
            if (!stringIsNullOrEmpty(e)) {
                b = "{" + e + "}" + b;
            }
            let f = (d.id);
            if (!stringIsNullOrEmpty(f)) {
                b = "(" + f + ")" + b;
            }
            b = c.nodeName + b;
            c = (d.parentNode);
        }
        return b;
    }
    static bv(a) {
        let b = new List$1(DomWrapper_$type, 0);
        let c = a.getChildCount();
        for (let d = 0; d < c; d++) {
            b.add(a.getChildAt(d));
        }
        return b;
    }
    static dd(a) {
        switch (a) {
            case 148: return "cut";
            case 149: return "copy";
            case 150: return "paste";
            case 86: return "undo";
            case 85: return "redo";
            default: return null;
        }
    }
    static de(a) {
        switch (a) {
            case 149: return "copy";
            case 148: return "cut";
            case 150: return "paste";
            default: return null;
        }
    }
    static d7(a) {
        if (a != null) {
            let b = a;
            if ((b.focus != null)) {
                b.focus();
            }
        }
    }
    static c1(a) {
        if (a != null && a.originalEvent != null) {
            a = a.originalEvent;
        }
        return a;
    }
    static d8(a, b, c, d, e) {
        let f = b == 0 || c == null ? 7 : c.lineStyle;
        let g = SpreadsheetUtilities.d(f);
        let h = f == 0 ? SpreadsheetUtilities.c4(c, e) : "";
        let i = f == 0 ? d + "px" : "";
        a.setRawStyleProperty("border", h);
        a.setRawStyleProperty("border-radius", i);
        if (a.getChildCount() > 0) {
            a.removeChildren();
        }
        if (g == null) {
            a.setRawStyleProperty("margin", "0px");
        }
        else {
            a.setRawStyleProperty("margin", b + "px");
            let j = Workbook._eq(c.widthInPoints);
            j = Math.max(Workbook._er(e, j, false, true), 1);
            let k = new StringBuilder(0);
            let l = "<svg xmlns=\"http://www.w3.org/2000/svg\" style=\"overflow:visible\" width='100%' height='100%'>" + "<rect width='100%' height='100%' fill='none' stroke='" + SpreadsheetUtilities.c5(c._ap, e) + "' stroke-width='" + j + "px' stroke-dasharray='";
            for (let m = 0; m < g.length; m++) {
                l += (j * g[m]) + " ";
            }
            l += "' rx='" + d + "' ry='" + d + "'></path></svg>";
            a.setProperty("innerHTML", l);
        }
    }
    static eg(a) {
        a.setRawStyleProperty("left", "0");
        a.setRawStyleProperty("top", "0");
        a.setRawStyleProperty("right", "0");
        a.setRawStyleProperty("bottom", "0");
        a.setRawStyleProperty("position", "absolute");
    }
    static bf(a) {
        switch (a) {
            case 21:
            case 18:
            case 19:
            case 23:
            case 22:
            case 20:
            case 24: return true;
            default: return false;
        }
    }
    static bg(a) {
        switch (a) {
            case 26:
            case 25:
            case 27:
            case 28: return true;
            default: return false;
        }
    }
    static bi(a) {
        if (a == null) {
            return false;
        }
        return SpreadsheetUtilities.bh(a.getNativeElement());
    }
    static bh(a) {
        if (a == null) {
            return false;
        }
        if (a.offsetWidth > 0 || a.offsetHeight > 0) {
            return true;
        }
        return (a.getClientRects().length > 0);
    }
    static bj(a, b) {
        return SpreadsheetUtilities.cd != null && (SpreadsheetUtilities.cd.call(a, b));
    }
    static ez(a) {
        let b = a.originalEvent;
        if ((b.stopPropagation)) {
            b.stopPropagation();
        }
    }
    static b7(a, b, c) {
        return Math.abs(b / 2 * Math.sin(a)) + Math.abs(c / 2 * Math.cos(a));
    }
    static bk(a, b, c) {
        let d = document.activeElement;
        let e;
        try {
            let f = a;
            f.setSelectionRange(b, c);
            e = true;
        }
        catch (g) {
            e = false;
        }
        if (d != document.activeElement && d != null) {
            try {
                SpreadsheetUtilities.d7(d);
            }
            catch (h) {
            }
        }
        return e;
    }
    static cb(a, b, c) {
        let d = Math.max(b, c);
        let e = Math.sin(a) * d;
        let f = Math.cos(a) * d;
        let g = b / d;
        let h = c / d;
        return Math.atan2(f * h, e * g);
    }
    static d6(a, b, c) {
        a.addListener(b, c);
    }
    static ci(a, b, c, d, e) {
        if (d > b) {
            let f = new IGFormattedTextRun();
            f.f = b;
            f.e = d - b;
            a.h.add(f);
        }
        let g = new IGFormattedTextRun();
        g.f = d;
        g.e = e;
        SpreadsheetUtilities.d9(g.a, c);
        a.h.add(g);
        b = d + e;
        return b;
    }
    static c2(a) {
        a = SpreadsheetUtilities.du.g(a, "");
        a = stringReplace(stringReplace(stringReplace(a, "__", "ZZQQQ"), "_", ""), "ZZQQQ", "_");
        return a;
    }
    static c3(a, b) {
        b = stringEmpty();
        a = SpreadsheetUtilities.du.g(a, "");
        let c = "";
        a = stringReplace(a, "__", "ZZQQQ");
        let d = a.indexOf("_");
        let e = d + 1;
        if (e < a.length) {
            b = a.charAt(e).toString();
        }
        a = stringReplace(stringReplace(a, "_", c), "ZZQQQ", "_");
        return {
            ret: a,
            p1: b
        };
    }
    static a1(a) {
        let b = false;
        if (a != null && typeCast(CT_TextBodyProperties.$, a._o) !== null) {
            let c = a._o.q;
            if (nullableEquals(c, null) || c.value == 0) {
                b = true;
            }
        }
        return b;
    }
    static a2(a) {
        if (stringIsNullOrEmpty(a)) {
            return false;
        }
        for (let b = 0, c = a.length; b < c; b++) {
            if ('#' != a.charAt(b)) {
                return false;
            }
        }
        return true;
    }
    static a3(a) {
        if (a != null) {
            for (let b of fromEnum(a._worksheets$i)) {
                let c = b.displayOptions;
                if (!b._w && c.visibility == 0) {
                    return false;
                }
            }
        }
        return true;
    }
    static j(a) {
        let b = 1;
        let c = new List$1(CellContentType_$type, 1, a.keys);
        c.aa((d, e) => Base.compareSimple(a.item(e), a.item(d)));
        let d = a.item(c._inner[0]);
        if (d == 0) {
            b = 1;
        }
        else {
            let e = new List$1(CellContentType_$type, 0);
            for (let f = 0; f < c.count; f++) {
                let g = c._inner[f];
                if (a.item(g) == d) {
                    e.add(g);
                }
            }
            e.aa((h, i) => Base.compareSimple((SpreadsheetUtilities.co(h)), SpreadsheetUtilities.co(i)));
            b = e._inner[0];
        }
        return b;
    }
    static a4(a, b = false) {
        if (typeCast(WorksheetChart.$, a) !== null) {
            return b;
        }
        if (typeCast(WorksheetImage.$, a) !== null) {
            return true;
        }
        if (typeCast(WorksheetShapeGroup.$, a) !== null) {
            return true;
        }
        if (nullableNotEquals(a._b1, null)) {
            return PredefinedShapes.b.d(EnumUtil.getName(ST_ShapeType_$type, a._b1.value)) != null;
        }
        if (typeCast(UnknownShape.$, a) !== null) {
            return a._en != null;
        }
        return false;
    }
    static cj(a, b) {
        let c = SpreadsheetUtilities.bw;
        let d = c.f(a);
        let e = a;
        if (d < 0) {
            d = ~d;
            if (d == 0) {
                e = b ? c._inner[0] : a;
            }
            else if (d == c.count) {
                e = b ? a : c._inner[d - 1];
            }
            else if (b) {
                e = c._inner[d];
            }
            else {
                e = c._inner[d - 1];
            }
        }
        else if (!b && d > 0) {
            e = c._inner[d - 1];
        }
        else if (b && d < c.count - 1) {
            e = c._inner[d + 1];
        }
        return e;
    }
    static a6(a, b) {
        for (let c = 0; c < a.count; c++) {
            if (a.item(c)._c(b)) {
                return true;
            }
        }
        return false;
    }
    static a7(a, b, c) {
        return !stringIsNullOrEmpty(c) && b.toLowerCase().indexOf(c.toLowerCase()) >= 0;
    }
    static ck(a) {
        return truncate(MathUtilities.f(a)) * 15;
    }
    static b5(a) {
        return a / 15;
    }
    static b4(a) {
        return a / 15;
    }
    static e4(a) {
        return new Rect(0, a.x, a.y, a.width, a.height);
    }
    static br() {
        let a = new Dictionary$2(Number_$type, ExcelCellFormatCategory_$type, 0);
        a.item(0, 0);
        a.item(49, 9);
        let d = [1, 2, 3, 4, 37, 38, 39, 40];
        for (let c = 0; c < d.length; c++) {
            let b = d[c];
            a.item(b, 1);
        }
        let g = [5, 6, 7, 8];
        for (let f = 0; f < g.length; f++) {
            let e = g[f];
            a.item(e, 2);
        }
        let j = [41, 42, 43, 44];
        for (let i = 0; i < j.length; i++) {
            let h = j[i];
            a.item(h, 3);
        }
        let m = [9, 10];
        for (let l = 0; l < m.length; l++) {
            let k = m[l];
            a.item(k, 6);
        }
        let p = [11, 48];
        for (let o = 0; o < p.length; o++) {
            let n = p[o];
            a.item(n, 8);
        }
        let s = [12, 13];
        for (let r = 0; r < s.length; r++) {
            let q = s[r];
            a.item(q, 7);
        }
        let v = [18, 19, 20, 21, 45, 46, 47];
        for (let u = 0; u < v.length; u++) {
            let t = v[u];
            a.item(t, 5);
        }
        let y = [14, 15, 16, 17, 22];
        for (let x = 0; x < y.length; x++) {
            let w = y[x];
            a.item(w, 4);
        }
        return a;
    }
    static b() {
        let a = new Array(14);
        a[0] = 0;
        a[7] = 1;
        a[11] = 2;
        a[9] = 3;
        a[4] = 4;
        a[3] = 5;
        a[1] = 6;
        a[12] = 7;
        a[13] = 8;
        a[10] = 9;
        a[8] = 10;
        a[2] = 11;
        a[5] = 12;
        a[6] = 13;
        return a;
    }
    static bs() {
        let a = new Dictionary$2(FillPatternStyle_$type, Array_$type, 0);
        for (let b of EnumUtil.getValues(FillPatternStyle_$type)) {
            let c = null;
            switch (b) {
                case 3:
                    c = ((() => {
                        let $ret = new Array();
                        $ret.push([1, 1, 1, 0]);
                        $ret.push([1, 0, 1, 1]);
                        return $ret;
                    })());
                    break;
                case 2:
                    c = ((() => {
                        let $ret = new Array();
                        $ret.push([1, 0]);
                        $ret.push([0, 1]);
                        return $ret;
                    })());
                    break;
                case 4:
                    c = ((() => {
                        let $ret = new Array();
                        $ret.push([1, 0, 0, 0]);
                        $ret.push([0, 0, 1, 0]);
                        return $ret;
                    })());
                    break;
                case 17:
                    c = ((() => {
                        let $ret = new Array();
                        $ret.push([1, 0, 0, 0]);
                        $ret.push([0, 0, 0, 0]);
                        $ret.push([0, 0, 1, 0]);
                        $ret.push([0, 0, 0, 0]);
                        return $ret;
                    })());
                    break;
                case 18:
                    c = ((() => {
                        let $ret = new Array();
                        $ret.push([1, 0, 0, 0, 0, 0, 0, 0]);
                        $ret.push([0, 0, 0, 0, 0, 0, 0, 0]);
                        $ret.push([0, 0, 0, 0, 1, 0, 0, 0]);
                        $ret.push([0, 0, 0, 0, 0, 0, 0, 0]);
                        return $ret;
                    })());
                    break;
                case 6:
                    c = ((() => {
                        let $ret = new Array();
                        $ret.push([0, 1, 1, 0]);
                        return $ret;
                    })());
                    break;
                case 5:
                    c = ((() => {
                        let $ret = new Array();
                        $ret.push([1]);
                        $ret.push([0]);
                        $ret.push([0]);
                        $ret.push([1]);
                        return $ret;
                    })());
                    break;
                case 7:
                    c = ((() => {
                        let $ret = new Array();
                        $ret.push([0, 0, 1, 1]);
                        $ret.push([1, 0, 0, 1]);
                        $ret.push([1, 1, 0, 0]);
                        $ret.push([0, 1, 1, 0]);
                        return $ret;
                    })());
                    break;
                case 8:
                    c = ((() => {
                        let $ret = new Array();
                        $ret.push([0, 0, 1, 1]);
                        $ret.push([0, 1, 1, 0]);
                        $ret.push([1, 1, 0, 0]);
                        $ret.push([1, 0, 0, 1]);
                        return $ret;
                    })());
                    break;
                case 9:
                    c = ((() => {
                        let $ret = new Array();
                        $ret.push([0, 0, 1, 1]);
                        $ret.push([0, 0, 1, 1]);
                        $ret.push([1, 1, 0, 0]);
                        $ret.push([1, 1, 0, 0]);
                        return $ret;
                    })());
                    break;
                case 10:
                    c = ((() => {
                        let $ret = new Array();
                        $ret.push([0, 0, 1, 1]);
                        $ret.push([1, 1, 1, 1]);
                        $ret.push([1, 1, 0, 0]);
                        $ret.push([1, 1, 1, 1]);
                        return $ret;
                    })());
                    break;
                case 11:
                    c = ((() => {
                        let $ret = new Array();
                        $ret.push([0]);
                        $ret.push([0]);
                        $ret.push([0]);
                        $ret.push([1]);
                        return $ret;
                    })());
                    break;
                case 12:
                    c = ((() => {
                        let $ret = new Array();
                        $ret.push([0, 1, 0, 0]);
                        return $ret;
                    })());
                    break;
                case 13:
                    c = ((() => {
                        let $ret = new Array();
                        $ret.push([0, 0, 1, 0]);
                        $ret.push([0, 0, 0, 1]);
                        $ret.push([1, 0, 0, 0]);
                        $ret.push([0, 1, 0, 0]);
                        return $ret;
                    })());
                    break;
                case 14:
                    c = ((() => {
                        let $ret = new Array();
                        $ret.push([0, 0, 0, 1]);
                        $ret.push([0, 0, 1, 0]);
                        $ret.push([0, 1, 0, 0]);
                        $ret.push([1, 0, 0, 0]);
                        return $ret;
                    })());
                    break;
                case 15:
                    c = ((() => {
                        let $ret = new Array();
                        $ret.push([0, 1, 0, 0]);
                        $ret.push([0, 1, 0, 0]);
                        $ret.push([0, 1, 0, 0]);
                        $ret.push([1, 1, 1, 1]);
                        return $ret;
                    })());
                    break;
                case 16:
                    c = ((() => {
                        let $ret = new Array();
                        $ret.push([1, 0, 1, 0]);
                        $ret.push([0, 0, 0, 1]);
                        $ret.push([1, 0, 1, 0]);
                        $ret.push([0, 1, 0, 0]);
                        return $ret;
                    })());
                    break;
                case -1:
                case 1:
                case 0: break;
                default: break;
            }
            a.item(b, c);
        }
        return a;
    }
    static c(a) {
        switch (a) {
            case 1: return [1, 1];
            case 2: return [9, 3, 3, 3, 3, 3];
            case 3: return [9, 3, 3, 3];
            case 4: return [2, 2];
            case 5: return [3, 1];
            case 7: return [3, 3, 9, 3, 3, 3];
            case 9: return [5, 1, 11, 1];
            case 8: return [4, 2, 10, 2];
            case 10: return [5, 1, 2, 1];
            case 11: return [3, 3, 9, 3];
            case 12: return [9, 3];
            case 13:
            case 14:
            case 6:
            case 0: return null;
            default: return null;
        }
    }
    static d(a) {
        switch (a) {
            case 1: return [4, 3];
            case 2: return [4, 3, 1, 3];
            case 3: return [1, 3];
            case 4: return [8, 3];
            case 5: return [8, 3, 1, 3];
            case 6: return [8, 3, 1, 3, 1, 3];
            case 8: return [3, 1];
            case 9: return [3, 1, 1, 1];
            case 10: return [3, 1, 1, 1, 1, 1];
            case 11: return [1, 1];
            case 7:
            case 0: return null;
            default: return null;
        }
    }
    static bt() {
        let a = new Dictionary$2(String_$type, Color.$, 2, StringComparer.e);
        a.item("black", Colors.a);
        a.item("green", Color.u(255, 0, 255, 0));
        a.item("white", Colors.t);
        a.item("blue", Colors.b);
        a.item("magenta", Colors.k);
        a.item("yellow", Colors.u);
        a.item("cyan", Colors.d);
        a.item("red", Colors.o);
        return a;
    }
    static bu() {
        let a = new Dictionary$2(Color.$, String_$type, 0);
        a.item(Color.u(255, 0, 0, 0), "Black");
        a.item(Color.u(255, 255, 255, 255), "White");
        a.item(Color.u(255, 255, 0, 0), "Red");
        a.item(Color.u(255, 0, 255, 0), "Bright Green");
        a.item(Color.u(255, 0, 0, 255), "Blue");
        a.item(Color.u(255, 255, 255, 0), "Yellow");
        a.item(Color.u(255, 255, 0, 255), "Pink");
        a.item(Color.u(255, 0, 255, 255), "Turquoise");
        a.item(Color.u(255, 128, 0, 0), "Dark Red");
        a.item(Color.u(255, 0, 128, 0), "Green");
        a.item(Color.u(255, 0, 0, 128), "Dark Blue");
        a.item(Color.u(255, 128, 128, 0), "Dark Yellow");
        a.item(Color.u(255, 128, 0, 128), "Violet");
        a.item(Color.u(255, 0, 128, 128), "Teal");
        a.item(Color.u(255, 192, 192, 192), "Gray-25%");
        a.item(Color.u(255, 128, 128, 128), "Gray-50%");
        a.item(Color.u(255, 153, 153, 255), "Periwinkle");
        a.item(Color.u(255, 153, 51, 102), "Plum");
        a.item(Color.u(255, 255, 255, 204), "Ivory");
        a.item(Color.u(255, 204, 255, 255), "Light Turquoise");
        a.item(Color.u(255, 102, 0, 102), "Dark Purple");
        a.item(Color.u(255, 255, 128, 128), "Coral");
        a.item(Color.u(255, 0, 102, 204), "Ocean Blue");
        a.item(Color.u(255, 204, 204, 255), "Ice Blue");
        a.item(Color.u(255, 0, 204, 255), "Sky Blue");
        a.item(Color.u(255, 204, 255, 204), "Light Green");
        a.item(Color.u(255, 255, 255, 153), "Light Yellow");
        a.item(Color.u(255, 153, 204, 255), "Pale Blue");
        a.item(Color.u(255, 255, 153, 204), "Rose");
        a.item(Color.u(255, 204, 153, 255), "Lavender");
        a.item(Color.u(255, 255, 204, 153), "Tan");
        a.item(Color.u(255, 51, 102, 255), "Light Blue");
        a.item(Color.u(255, 51, 204, 204), "Aqua");
        a.item(Color.u(255, 153, 204, 0), "Lime");
        a.item(Color.u(255, 255, 204, 0), "Gold");
        a.item(Color.u(255, 255, 153, 0), "Light Orange");
        a.item(Color.u(255, 255, 102, 0), "Orange");
        a.item(Color.u(255, 102, 102, 153), "Blue-Gray");
        a.item(Color.u(255, 150, 150, 150), "Gray-40%");
        a.item(Color.u(255, 0, 51, 102), "Dark Teal");
        a.item(Color.u(255, 51, 153, 102), "Sea Green");
        a.item(Color.u(255, 0, 51, 0), "Dark Green");
        a.item(Color.u(255, 51, 51, 0), "Olive Green");
        a.item(Color.u(255, 153, 51, 0), "Brown");
        a.item(Color.u(255, 51, 51, 153), "Indigo");
        a.item(Color.u(255, 51, 51, 51), "Gray-80%");
        return a;
    }
    static dc(a) {
        if (SpreadsheetUtilities.bp == null) {
            SpreadsheetUtilities.bp = SpreadsheetUtilities.bu();
        }
        let b;
        if (!((() => { let c = SpreadsheetUtilities.bp.tryGetValue(a, b); b = c.p1; return c.ret; })())) {
            return null;
        }
        return b;
    }
    static s(a, b) {
        let c = a._getFont(0);
        let d = a._workbook;
        let e = d._styles$i.normalStyle.styleFormat.font;
        let f = SpreadsheetUtilities.v(null, new ResolvedWorkbookFont(c, e, d), d, b);
        let g = 0;
        let h = 0;
        for (let i of fromEnum(a._paragraphs$i)) {
            let j = new IGFormattedTextParagraph();
            j.k = Nullable$1.toNullable(HorizontalTextAlignment_$type, i.alignment);
            j.f = f.i.c;
            f.i.l(i.unformattedString);
            j.e = f.i.c - j.f;
            f.h.add(j);
            let k = i._getFormattingRuns(d);
            for (let l = 0; l < k.count; l++) {
                let m = k._inner[l];
                let n = l == k.count - 1 ? (j.f + j.e) : k._inner[l + 1].i - h;
                g = SpreadsheetUtilities.ci(j, g, m.d(d), m.i - h, n - (m.i - h));
            }
            h += i._n - j.e;
            g = SpreadsheetUtilities.cx(j, g);
        }
        f.e = f.i.c;
        return f;
    }
    static r(a, b, c, d) {
        let e = new FormattedStringFontResolved(a._getFont(0), c);
        return SpreadsheetUtilities.q(a, b, e, d);
    }
    static q(a, b, c, d) {
        let e = c;
        let f = SpreadsheetUtilities.v(a.unformattedString, e, a._workbook, d);
        let g = new IGFormattedTextParagraph();
        g.k = Nullable$1.toNullable(HorizontalTextAlignment_$type, SpreadsheetUtilities.ar(b));
        g.e = a._t;
        f.h.add(g);
        let h = 0;
        let i = a._owner != null && a._owner.allowDefaultValues ? new ResolvedWorkbookFont(null, c, a._workbook) : null;
        for (let j of fromEnum(a.getFormattingRuns())) {
            let k = j;
            if (i != null) {
                i._d(k);
                k = i;
            }
            h = SpreadsheetUtilities.ci(g, h, k, j.startIndex, j.length);
        }
        h = SpreadsheetUtilities.cx(g, h);
        return f;
    }
    static u(a, b, c, d, e) {
        let f = new ResolvedWorksheetCellFormatDataFont(d);
        return SpreadsheetUtilities.t(a, b, c, f, e);
    }
    static t(a, b, c, d, e) {
        if (a == null) {
            a = stringEmpty();
        }
        let f = SpreadsheetUtilities.v(a, d, b, e);
        let g = new IGFormattedTextParagraph();
        g.k = Nullable$1.toNullable(HorizontalTextAlignment_$type, SpreadsheetUtilities.ar(c));
        g.e = f.e;
        f.h.add(g);
        let h = new IGFormattedTextRun();
        h.e = f.e;
        h.a._aa(f.a);
        g.h.add(h);
        return f;
    }
    static v(a, b, c, d) {
        if (a == null) {
            a = stringEmpty();
        }
        let e = new IGFormattedTextDocument();
        e.i.l(a);
        e.e = a.length;
        SpreadsheetUtilities.d9(e.a, b);
        if (d && c != null) {
            SpreadsheetUtilities.ed(c, e, 8, 9);
        }
        return e;
    }
    static e3(a, b) {
        return { $type: Point_$type, x: a, y: b };
    }
    static get cl() {
        return 500;
    }
    static n(a) {
        switch (a) {
            case 1: return 0;
            case 0: return 1;
            case 2: return 3;
            case 3: return 2;
            default: return a;
        }
    }
    static c7(a, b, c) {
        let d = ExcelCalcValue._dateTimeToExcelDate(c, b);
        let e = null;
        if (d.hasValue) {
            let f = a.v(d.value, "", e);
            e = f.p2;
        }
        return e;
    }
    static c8(a, b) {
        let c = dateFromValues(2000, 1, 1, b ? 0 : 12, 0, 0, 0);
        return dateToStringFormat(c, "tt", a);
    }
    static bm(a, b) {
        if (a == -1) {
            a = 0;
        }
        else if (a >= SpreadsheetUtilities.a.length) {
            a = 1;
        }
        if (b == -1) {
            b = 0;
        }
        else if (b >= SpreadsheetUtilities.a.length) {
            b = 1;
        }
        let c = SpreadsheetUtilities.a[a];
        let d = SpreadsheetUtilities.a[b];
        return d > c;
    }
    static cm(a) {
        switch (a) {
            case 6:
            case 5: return 3;
            case 2:
            case 10:
            case 12:
            case 8:
            case 13: return 2;
            case 0: return 0;
            default: return 1;
        }
    }
    static cn(a) {
        if (a == -1) {
            a = 0;
        }
        else if (a >= SpreadsheetUtilities.a.length) {
            a = 1;
        }
        return SpreadsheetUtilities.a[a];
    }
    static p(a) {
        let b;
        if (!((() => { let c = SpreadsheetUtilities.bn.tryGetValue(a, b); b = c.p1; return c.ret; })())) {
            b = 10;
        }
        return b;
    }
    static aa(a) {
        let b;
        if (a.cellRanges.count > 1) {
            b = 2;
        }
        if (a._bj.count > 0) {
            b = 1;
        }
        else if (a._bi.count > 0) {
            b = 0;
        }
        else {
            b = 2;
        }
        if (b == 2) {
            let c = a._m.activeTable;
            if (c != null) {
                b = 7;
            }
        }
        return b;
    }
    static k(a, b, c) {
        let d = a._getCellValue1(b);
        let e = new GetCellTextParameters(b);
        e.b = 1;
        let f = a._av(e);
        c = f.g;
        if (typeCast(Boolean_$type, d) !== null || typeCast(ErrorValue.$, d) !== null || d == null) {
            return {
                ret: 0,
                p2: c
            };
        }
        if (ExcelUtils.ba(d) || typeCast(Date_$type, d) !== null) {
            if (f.c && (f.b & 1) != 0) {
                return {
                    ret: 2,
                    p2: c
                };
            }
            else {
                return {
                    ret: 3,
                    p2: c
                };
            }
        }
        else {
            return {
                ret: 1,
                p2: c
            };
        }
    }
    static co(a) {
        switch (a) {
            case 1: return 3;
            case 3: return 2;
            case 2: return 1;
            case 0: return 0;
            default: return 0;
        }
    }
    static da(a, b, c) {
        let d = null;
        switch (b) {
            case 93:
                d = "Undo_InsertCells";
                break;
            case 95:
                d = "Undo_InsertColumns";
                break;
            case 97:
                d = "Undo_InsertRows";
                break;
            case 94:
            case 96:
            case 98:
                d = "Undo_Delete";
                break;
            case 28:
                d = "Undo_ConditionalFormat";
                break;
            case 4:
            case 61:
            case 85:
                d = "Undo_FormatCells";
                break;
            case 18:
            case 50:
            case 51:
                d = "Undo_MergeCells";
                break;
            case 16:
            case 47:
            case 48:
            case 49:
                d = "Undo_Hyperlink";
                break;
            case 99:
                d = "Undo_Zoom";
                break;
            case 53:
            case 54:
            case 17:
                d = "Undo_CreateNamedReference";
                break;
            case 62:
                d = "Undo_Shape";
                break;
            case 63:
                d = "Undo_ShapeAdd";
                break;
            case 64:
                d = "Undo_ShapeRemove";
                break;
            case 21:
                d = "Undo_ClearShapes";
                break;
            case 6:
                d = "Undo_ChartAdd";
                break;
            case 7:
                d = "Undo_ChartModify";
                break;
            case 8:
                d = "Undo_ChartRemove";
                break;
            case 66:
                d = "Undo_SparklineAdd";
                break;
            case 68:
                d = "Undo_SparklineColorChange";
                break;
            case 69:
                d = "Undo_SparklineDataChange";
                break;
            case 67:
                d = "Undo_SparklineRemove";
                break;
            case 70:
                d = "Undo_SparklineStyleChange";
                break;
            case 71:
                d = "Undo_SparklineTypeChange";
                break;
            case 73:
                d = "Undo_CreateTable";
                break;
            case 84:
                d = "Undo_RemoveTable";
                break;
            case 25:
                d = "Undo_ClearTables";
                break;
            case 35:
                {
                    switch (c) {
                        case "Reset":
                            d = "Undo_ResetOptions";
                            break;
                        case "TabColorInfo":
                            d = "Undo_TabColor";
                            break;
                        case "View":
                            d = "Undo_View";
                            break;
                    }
                    break;
                }
            case 1:
            case 38:
            case 39:
            case 40:
            case 15:
                d = "Undo_Filter";
                break;
            case 80:
            case 2:
            case 22:
                d = "Undo_Sort";
                break;
            case 24:
            case 81:
            case 82:
            case 83:
                d = "Undo_Style";
                break;
            case 26:
                {
                    switch (c) {
                        case "Width":
                        case "Hidden":
                            d = "Undo_ResizeColumn";
                            break;
                        case "OutlineLevel":
                            d = "Undo_Group";
                            break;
                    }
                    break;
                }
            case 60:
                {
                    switch (c) {
                        case "Height":
                        case "Hidden":
                            d = "Undo_ResizeRow";
                            break;
                        case "OutlineLevel":
                            d = "Undo_Group";
                            break;
                    }
                    break;
                }
            case 65:
                {
                    switch (c) {
                        case "TabColorInfo":
                            d = "Undo_TabColor";
                            break;
                    }
                    break;
                }
            case 90:
                {
                    switch (c) {
                        case "ResizeColumns":
                            d = "Undo_ResizeColumn";
                            break;
                        case "ResizeRows":
                            d = "Undo_ResizeRow";
                            break;
                    }
                    break;
                }
        }
        if (d == null) {
            return EnumUtil.getName(ExcelChangeAction_$type, b);
        }
        return SpreadsheetUtilities.di(a, d);
    }
    static db(a, b) {
        let c = a._fs("MenuItem_ClearFilterEmpty");
        if (a._a8 != null) {
            let d = a._a8._fp(b);
            if (!stringIsNullOrEmpty(d)) {
                c = a._fs("MenuItem_ClearFilterForColumn", d);
            }
        }
        return c;
    }
    static cp(a) {
        let b = a.numberFormat.currencySymbol;
        if (stringIsNullOrEmpty(b)) {
            return 0;
        }
        let c = (111.11.toLocaleString(a.name, { style: 'currency', currency: 'USD', currencyDisplay: 'symbol' }));
        let d = c.indexOf(b);
        let e = c.indexOf("1");
        if (d < 0 || e < 0) {
            return 0;
        }
        if (d < e) {
            return /\s/i.test(c.charAt(d + b.length)) ? 2 : 0;
        }
        else {
            return /\s/i.test(c.charAt(d - 1)) ? 3 : 1;
        }
    }
    static df(a, b, c) {
        let d = stringEmpty();
        let e = b.workbook;
        if (a == null) {
        }
        else if (typeof a === 'string') {
            d = a;
        }
        else if (typeCast(Formula.$, a) !== null) {
            d = a._toString1(e.cellReferenceMode);
        }
        else if (typeCast(ErrorValue.$, a) !== null) {
            d = a.toString();
        }
        else if (typeCast(Boolean_$type, a) !== null) {
            d = a ? "TRUE" : "FALSE";
        }
        else if (typeCast(FormattedString.$, a) !== null) {
            d = a.unformattedString;
        }
        else if (a != null) {
            let f;
            if (((() => { let g = ExcelUtils.b0(e, a, f); f = g.p2; return g.ret; })())) {
                let g = e._b2.a(c._cs);
                if (g.o) {
                    let h = -1;
                    h = g.aa(f);
                    if (h >= 0) {
                        let i = g.c(h);
                        let j = Nullable$1.toNullable(Date_$type, null);
                        let k = Nullable$1.toNullable(Number_$type, null);
                        if (i.isDateSection && f >= 0) {
                            if (i.hasAnyDateParts) {
                                j = ExcelCalcValue._be(e, f, true, true);
                            }
                            else if (i.hasAnyTimeParts) {
                                let l = ExcelCalcValue._be(e, f, true, true);
                                if (nullableNotEquals(l, null)) {
                                    k = Nullable$1.toNullable(Number_$type, ExcelCalcValue._bq(f, true));
                                    if (nullableNotEquals(k, null) && timeSpanTotalDays(k.value) >= 1) {
                                        j = l;
                                    }
                                }
                            }
                        }
                        if (nullableNotEquals(j, null)) {
                            if (i.hasAnyTimeParts || dateGetTimeOfDay(j.value) != (0)) {
                                d = SpreadsheetUtilities.dn(j.value, b);
                            }
                            else {
                                d = SpreadsheetUtilities.dt(j.value, b);
                            }
                        }
                        else if (nullableNotEquals(k, null)) {
                            d = SpreadsheetUtilities.dq(k.value, b);
                        }
                        else if (i.isNumberSection) {
                            let m = i.percentCount;
                            if (m == 1) {
                                d = SpreadsheetUtilities.dr(f, b._y);
                            }
                        }
                    }
                }
                if (stringIsNullOrEmpty(d)) {
                    d = numberToString2(f, "r", b._y);
                }
            }
            else {
            }
        }
        return d;
    }
    static au(a) {
        return a._styles$i._i(9)._i._bh;
    }
    static av(a, b) {
        if (stringIsNullOrEmpty(a)) {
            return null;
        }
        if (SpreadsheetUtilities.bo == null) {
            SpreadsheetUtilities.bo = SpreadsheetUtilities.bt();
        }
        let c = new Color();
        if (!((() => { let d = SpreadsheetUtilities.bo.tryGetValue(a, c); c = d.p1; return d.ret; })())) {
            if (startsWith1(a, "Color", 3) && a.length > 5) {
                a = a.substr(5);
            }
            if (isDigit(a.charAt(0))) {
                let d;
                if (((() => { let e = tryParseInt32_1(a, d); d = e.p1; return e.ret; })()) && d >= 1 && d <= 56) {
                    c = b._item$i(d - 1);
                }
            }
            else {
                if (!((() => { let e = SpreadsheetUtilities.bo.tryGetValue(a, c); c = e.p1; return e.ret; })())) {
                    return null;
                }
            }
        }
        return new WorkbookColorInfo(c);
    }
    static ap(a, b, c, d, e) {
        if (a != null) {
            if (typeCast(Boolean_$type, a) !== null || typeCast(ErrorValue.$, a) !== null) {
                return 2;
            }
            if (ExcelUtils.ba(a) || typeCast(Date_$type, a) !== null) {
                let f = c != null ? c.workbook : null;
                if (f != null) {
                    let g = SpreadsheetUtilities.ag(b, c, d, e, true);
                    if (g != null && g.o && g.n(0) && !g.l(0)) {
                        return 1;
                    }
                }
                return 3;
            }
        }
        return 1;
    }
    static dg(a, b) {
        let c = a._getCellText(b);
        c = stringReplace(stringReplace(c.trim(), Environment.newLine, " "), '\n', ' ');
        return c;
    }
    static am(a, b) {
        if (nullableEquals(b, null) || a == -1) {
            return -1;
        }
        return SpreadsheetUtilities.an(ExcelUtils.ak(a), Nullable$1.toNullable(Number_$type, intSToU(b.value)));
    }
    static ao(a) {
        if (a == null || a.c == -1 || !a.d.hasValue) {
            return -1;
        }
        return SpreadsheetUtilities.an(ExcelUtils.ak(a.c), Nullable$1.toNullable(Number_$type, intSToU(a.d.value)));
    }
    static an(a, b) {
        if (!b.hasValue) {
            return -1;
        }
        let c = b.value;
        switch (a) {
            default:
            case 0: switch (c) {
                case 2: return 1;
                case 1: return 2;
                default:
                case 0: return 3;
            }
            case 1: switch (c) {
                case 2: return 4;
                case 1: return 5;
                default:
                case 0: return 6;
            }
            case 18: switch (c) {
                case 2: return 45;
                case 1: return 46;
                default:
                case 0: return 47;
            }
            case 9: switch (c) {
                case 3: return 4;
                case 2: return 27;
                case 1: return 28;
                default:
                case 0: return 6;
            }
            case 8: switch (c) {
                case 3: return 1;
                case 2: return 25;
                case 1: return 26;
                default:
                case 0: return 3;
            }
            case 14: switch (c) {
                case 4: return 4;
                case 3: return 27;
                case 2: return 5;
                case 1: return 28;
                default:
                case 0: return 6;
            }
            case 13: switch (c) {
                case 4: return 1;
                case 3: return 25;
                case 2: return 2;
                case 1: return 26;
                default:
                case 0: return 3;
            }
            case 3: switch (c) {
                case 2: return 10;
                case 1: return 11;
                default:
                case 0: return 29;
            }
            case 4: switch (c) {
                case 2: return 14;
                case 1: return 15;
                default:
                case 0: return 16;
            }
            case 5: switch (c) {
                case 2: return 10;
                case 1: return 17;
                default:
                case 0: return 18;
            }
            case 12: switch (c) {
                case 3: return 10;
                case 2: return 17;
                case 1: return 12;
                default:
                case 0: return 13;
            }
            case 10: switch (c) {
                case 3: return 29;
                case 2: return 30;
                case 1: return 31;
                default:
                case 0: return 32;
            }
            case 6: switch (c) {
                case 2: return 19;
                case 1: return 20;
                default:
                case 0: return 21;
            }
            case 7: switch (c) {
                case 2: return 22;
                case 1: return 23;
                default:
                case 0: return 24;
            }
            case 2: switch (c) {
                case 2: return 7;
                case 1: return 8;
                default:
                case 0: return 9;
            }
            case 17: switch (c) {
                case 2: return 42;
                case 1: return 43;
                default:
                case 0: return 44;
            }
            case 11: switch (c) {
                default:
                case 0: return 38;
                case 1: return 39;
                case 2: return 40;
                case 3: return 41;
            }
            case 16: switch (c) {
                case 4: return 32;
                case 3: return 33;
                case 2: return 34;
                case 1: return 35;
                default:
                case 0: return 36;
            }
            case 15: switch (c) {
                default:
                case 0: return 37;
                case 1: return 38;
                case 2: return 39;
                case 3: return 40;
                case 4: return 41;
            }
            case 19: switch (c) {
                case 4: return 48;
                case 3: return 49;
                case 2: return 50;
                case 1: return 51;
                default:
                case 0: return 52;
            }
        }
    }
    static dx(a) {
        if (a == null) {
            return null;
        }
        if (a.iconSet == -1 || a.iconIndex < 0) {
            return SpreadsheetUtilities.d1;
        }
        return Tuple.a(FormatConditionIconSet_$type, Nullable$1.$.specialize(Number_$type), a.iconSet, Nullable$1.toNullable(Number_$type, a.iconIndex));
    }
    static dy(a) {
        if (a == null) {
            return null;
        }
        if (a.iconSet == -1 || nullableEquals(a._iconIndex$i, null)) {
            return SpreadsheetUtilities.d1;
        }
        return Tuple.a(FormatConditionIconSet_$type, Nullable$1.$.specialize(Number_$type), a.iconSet, a._iconIndex$i);
    }
    static dz(a) {
        if (a == null) {
            return null;
        }
        if (a.iconSet == -1 || nullableEquals(a._iconIndex$i, null)) {
            return SpreadsheetUtilities.d1;
        }
        return Tuple.a(FormatConditionIconSet_$type, Nullable$1.$.specialize(Number_$type), a.iconSet, a._iconIndex$i);
    }
    static dh(a, b) {
        return dateToStringFormat(dateFromValues(2017, a, 1, 0, 0, 0, 0), "MMMM", b);
    }
    static l(a, b, c, d) {
        let e = new Dictionary$2(CellContentType_$type, Number_$type, 0);
        e.item(2, 0);
        e.item(3, 0);
        e.item(1, 0);
        let f;
        let g;
        let h;
        let i;
        if (d) {
            f = b._ac;
            g = b._ae;
            h = b._w + c;
            i = h;
        }
        else {
            f = b._ac + c;
            g = f;
            h = b._w;
            i = b._x;
        }
        for (let j of fromEnum(a._rows$i._m(f, g))) {
            for (let k of fromEnum(j._ch(h, i))) {
                let l = k.r;
                let m;
                let n = ((() => { let o = SpreadsheetUtilities.k(j, l, m); m = o.p2; return o.ret; })());
                if (n != 0) {
                    e.item(n, e.item(n) + 1);
                }
            }
        }
        let o = SpreadsheetUtilities.j(e);
        return o;
    }
    static by(a) {
        let b = a.table;
        let c = b.wholeTableRegion;
        let d = a.index + c.firstColumn;
        let e = c.firstColumn;
        let f = c.lastColumn;
        let g = new List$1(IFilterable_$type, 0);
        for (let h = e; h <= f; h++) {
            if (h == d) {
                continue;
            }
            let i = b._columns$i._item(h - e);
            if (null != i.filter) {
                g.add(i);
            }
        }
        return g;
    }
    static bx(a, b) {
        let c = new List$1(IFilterable_$type, 0);
        let d = a.filterSettings;
        let e = d.sortAndFilterAreaRegion;
        if (e != null) {
            let f = e.firstColumn + b;
            let g = e.firstColumn;
            let h = e.lastColumn;
            for (let i = g; i <= h; i++) {
                if (i == f) {
                    continue;
                }
                let j = d.getFilter(i - g);
                if (null != j) {
                    c.add(j._b);
                }
            }
        }
        return c;
    }
    static b8(a, b) {
        switch (a) {
            case 7:
            case 10:
            case 11:
            case 12:
            case 13:
                b *= 2;
                break;
            case 14:
                b *= 3;
                break;
        }
        return b;
    }
    static cq(a) {
        let b = numberToString2(a, "r", CultureInfo.invariantCulture);
        let c = b.indexOf(".");
        return c < 0 ? 0 : b.length - (c + 1);
    }
    static cy(a, b) {
        for (let c = 0; c < a.count; c++) {
            if (a.item(c)._c(b)) {
                return Nullable$1.toNullable(IntRange.$, a.item(c));
            }
        }
        return Nullable$1.toNullable(IntRange.$, null);
    }
    static e2(a, b, c = true) {
        if (WorkbookColorInfo.l_op_Equality(a, null)) {
            return ExcelUtils.gv;
        }
        return ExcelUtils.g1(a._aj(b, c, true));
    }
    static di(a, b, ...c) {
        if (a != null) {
            return a._fs(b, ...c);
        }
        return Localization.c("spreadsheet", b, ...c);
    }
    static e(a) {
        let b = null;
        let c = null;
        for (let d of fromEnum(a._worksheets$i)) {
            if (d._w) {
                if (b == null) {
                    b = d;
                }
                else {
                    if (c == null) {
                        c = new List$1(Worksheet.$, 0);
                        c.add(b);
                    }
                    c.add(d);
                }
            }
        }
        if (c != null) {
            return c.toArray();
        }
        else if (b != null) {
            return [b];
        }
        else {
            return new Array(0);
        }
    }
    static a0(a) {
        let b = null;
        if (a != null) {
            let c = typeCast(ICT_ShapePropertiesOwner_$type, a._b3);
            if (c != null && c.spPr != null) {
                let d = typeCast(CT_PresetGeometry2D.$, c.spPr.e);
                if (d != null && d.a != null) {
                    b = d.a;
                }
            }
        }
        return b;
    }
    static as(a) {
        let b = null;
        if (a._ar) {
            b = a._k;
            if (b == ShapeFillNoFill._e) {
                b = null;
            }
        }
        return b;
    }
    static aj(a) {
        let b = null;
        if (a != null && a.chartArea != null) {
            b = a.chartArea._ap;
            if (typeCast(ChartEmptyFill.$, b) !== null) {
                b = null;
            }
        }
        return b;
    }
    static at(a) {
        let b = null;
        if (a._as) {
            b = a._n;
            if (b == ShapeOutlineNoOutline._i) {
                b = null;
            }
        }
        return b;
    }
    static ai(a) {
        let b = null;
        if (a != null && a.chartArea != null) {
            b = a.chartArea.border;
            if (b != null && b.lineStyle == 7) {
                b = null;
            }
        }
        return b;
    }
    static b9(a) {
        if (typeCast(WorksheetChart.$, a) !== null) {
            let b = SpreadsheetUtilities.ai(a);
            if (b == null || b.lineStyle == 7 || b.widthInPoints <= 0) {
                return 0;
            }
            return Workbook._eq(b.widthInPoints) / 2;
        }
        if (a == null || !a._as) {
            return 0;
        }
        let c = a.outline;
        if (c == null || c == ShapeOutlineNoOutline._i) {
            return 0;
        }
        let d = ExcelUtils.c1(c._d);
        if (typeCast(WorksheetImage.$, a) !== null == false) {
            d /= 2;
        }
        return d;
    }
    static w(a, b, c) {
        let d = a._de(b, c);
        if (d != null) {
            return new TableSortFilterArea(d._columns$i._item(c - d._by._w));
        }
        else if (a.filterSettings.region != null && a.filterSettings.region._q(b, c)) {
            return new WorksheetSortFilterArea(a, c - a.filterSettings.region._v);
        }
        else {
            return null;
        }
    }
    static cr(a, b, c) {
        if (b._aa > 1) {
            let d = new Array(b._ad);
            let e = a ? new Array(b._ad) : null;
            for (let f = 0; f < d.length; f++) {
                d[f] = 0;
            }
            let g;
            let h = c._rows$i._aj(b.firstRow);
            if (h != null) {
                for (let i of fromEnum(h._ch(b.firstColumn, b.lastColumn, true))) {
                    d[i.r - b.firstColumn] = ((() => { let j = SpreadsheetUtilities.k(h, i.r, g); g = j.p2; return j.ret; })());
                    if (e != null) {
                        e[i.r - b.firstColumn] = c._b4(h, i.r).fill;
                    }
                }
            }
            let j = a ? b.firstRow + 1 : Math.min(b.lastRow, b.firstRow + 2);
            for (let k of fromEnum(c._rows$i._m(b.firstRow + 1, j))) {
                let l;
                let m = b.firstColumn;
                for (let n of fromEnum(k._ch(b.firstColumn, b.lastColumn, true))) {
                    for (; m <= n.r; m++) {
                        l = ((() => { let o = SpreadsheetUtilities.k(k, m, g); g = o.p2; return o.ret; })());
                        if (d[m - b.firstColumn] == 0) {
                            d[m - b.firstColumn] = l;
                        }
                        else if (d[m - b.firstColumn] != l) {
                            return k.index - b.firstRow;
                        }
                        else if (e != null && e[m - b.firstColumn] != c._b4(k, m).fill) {
                            return k.index - b.firstRow;
                        }
                    }
                }
                for (; m <= b.lastColumn; m++) {
                    l = ((() => { let o = SpreadsheetUtilities.k(k, m, g); g = o.p2; return o.ret; })());
                    if (d[m - b.firstColumn] == 0) {
                        d[m - b.firstColumn] = l;
                    }
                    else if (d[m - b.firstColumn] != l) {
                        return k.index - b.firstRow;
                    }
                    else if (e != null && e[m - b.firstColumn] != c._b4(k, m).fill) {
                        return k.index - b.firstRow;
                    }
                }
            }
        }
        return 0;
    }
    static dk(a, b, c) {
        let d = 1;
        if (b._a8 != null) {
            let e = b._a8._bc._rows$i._aj(c.row);
            if (e != null) {
                let f = new GetCellTextParameters(c.column);
                f.b = 1;
                let g = e._av(f);
                if (!isNaN_(g.e)) {
                    if (g.c && (g.b & 1) != 0) {
                        d = 2;
                    }
                    else {
                        d = 3;
                    }
                }
            }
        }
        return SpreadsheetUtilities.dj(a, b, d);
    }
    static dj(a, b, c) {
        let d;
        switch (c) {
            case 2:
                d = a ? "MenuItem_SortAscending_Date" : "MenuItem_SortDescending_Date";
                break;
            case 3:
                d = a ? "MenuItem_SortAscending_Number" : "MenuItem_SortDescending_Number";
                break;
            default:
            case 1:
                d = a ? "MenuItem_SortAscending_Text" : "MenuItem_SortDescending_Text";
                break;
        }
        return SpreadsheetUtilities.di(b, d);
    }
    static x(a) {
        if (a != null && a._cx) {
            let b = a._a0;
            if (typeCast(WeakWorkbookOwner.$, b) !== null) {
                b = b.a;
            }
            return typeCast(Spreadsheet.$, b);
        }
        return null;
    }
    static ah(a) {
        return typeCast(RowColumnBase.$, a._s) !== null ? 32 : 0;
    }
    static ag(a, b, c, d, e) {
        let f = c != null && b != null ? b._be(c.index, d, true) : null;
        let g;
        if (f != null && f._h != null && f._h.formatString != null) {
            g = f._h._cs;
        }
        else {
            g = a._cs;
        }
        if (!e || g != 0) {
            let h = b.workbook;
            if (h != null) {
                return h._b2.a(g);
            }
        }
        return null;
    }
    static bz(a, b, c) {
        let d = a.filterSettings;
        let e = d != null ? d.sortAndFilterAreaRegion : null;
        if (null == d || null == e) {
            c = 0;
            return {
                ret: null,
                p2: c
            };
        }
        let f = e.firstRow;
        let g = e.lastRow;
        let h = e.firstColumn + b;
        let i = SpreadsheetUtilities.bx(a, b);
        return {
            ret: ((() => { let j = SpreadsheetUtilities.b0(a, f, g, h, i, c); c = j.p5; return j.ret; })()),
            p2: c
        };
    }
    static b1(a, b) {
        let c = a._worksheet;
        let d = a.table;
        let e = a.table.dataAreaRegion;
        let f = e.firstRow;
        let g = e.lastRow;
        let h = SpreadsheetUtilities.by(a);
        return {
            ret: ((() => { let i = SpreadsheetUtilities.b0(c, f, g, a._at, h, b); b = i.p5; return i.ret; })()),
            p1: b
        };
    }
    static b0(a, b, c, d, e, f) {
        let g = new HashSet$1(String_$type, 0);
        let h = new Dictionary$2(CellContentType_$type, Number_$type, 0);
        h.item(2, 0);
        h.item(3, 0);
        h.item(1, 0);
        for (let i of fromEnum(a._rows$i._m(b, c))) {
            let j = false;
            for (let k of fromEnum(e)) {
                if (false == k.filter._e(k.worksheet, i, i.index, k.columnIndex)) {
                    j = true;
                    break;
                }
            }
            if (j) {
                continue;
            }
            let l;
            let m = ((() => { let n = SpreadsheetUtilities.k(i, d, l); l = n.p2; return n.ret; })());
            if (m != 0) {
                g.add_1(l);
                h.item(m, h.item(m) + 1);
            }
        }
        f = SpreadsheetUtilities.j(h);
        let n = new List$1(Base.$, 1, g);
        n.y();
        return {
            ret: n,
            p5: f
        };
    }
    static f(a, b) {
        let c = new Array(b.count);
        for (let d = 0; d < c.length; d++) {
            let e = b.item(d);
            c[d] = a._cx(e.firstRow, e.firstColumn, e.lastRow, e.lastColumn);
        }
        return c;
    }
    static a8(a, b, c) {
        if (a != null) {
            for (let d = b, e = Math.min(a.length, b + c); d < e; d++) {
                if (/\s/i.test(a.charAt(d))) {
                    return true;
                }
            }
        }
        return false;
    }
    static cs(a, b) {
        let c = a.indexOf('\r', b);
        if (c < 0) {
            c = a.indexOf('\n', b);
        }
        return c;
    }
    static ct(a, b, c) {
        let d = a.indexOf('\r', b);
        if (d < 0 || d >= b + c - 1) {
            d = a.indexOf('\n', b);
            if (d >= b + c - 1) {
                d = -1;
            }
        }
        return d;
    }
    static d9(a, b) {
        let c = b._bold$i;
        if (nullableNotEquals(c, null)) {
            a._o = Nullable$1.toNullable(Boolean_$type, nullableEquals(c, true));
        }
        let d = b.colorInfo;
        if (WorkbookColorInfo.l_op_Inequality(d, null)) {
            a._d = d;
        }
        let e = b.height;
        if (e >= 0) {
            a._p = Nullable$1.toNullable(Number_$type, e);
        }
        let f = b._italic$i;
        if (nullableNotEquals(f, null)) {
            a._q = Nullable$1.toNullable(Boolean_$type, nullableEquals(f, true));
        }
        let g = b.name;
        if (!stringIsNullOrEmpty(g)) {
            a._v = g;
        }
        let h = b._strikeout$i;
        if (nullableNotEquals(h, null)) {
            a._r = Nullable$1.toNullable(Boolean_$type, nullableEquals(h, true));
        }
        let i = b.superscriptSubscriptStyle;
        if (i != -1) {
            a._s = Nullable$1.toNullable(FontSuperscriptSubscriptStyle_$type, i);
        }
        let j = b.underlineStyle;
        if (j != -1) {
            a._t = Nullable$1.toNullable(FontUnderlineStyle_$type, j);
        }
    }
    static a9(a, b) {
        return b._ac <= a.lastRow && b._ae >= a.firstRow && b._w <= a.lastColumn && b._x >= a.firstColumn;
    }
    static ba(a) {
        return a == 2 || a == 34;
    }
    static bc(a) {
        if (a == null || Base.referenceEquals(a, CellFill.noColor)) {
            return true;
        }
        return typeCast(CellFillPattern.$, a) !== null && a.patternStyle == 0;
    }
    static bb(a) {
        if (stringStartsWith(a, "\\\\")) {
            return false;
        }
        let b;
        if (a.length > 1 && (b = a.indexOf('@', 1)) > 0 && (b == a.length - 1 || a.charAt(b + 1) != '@') && !SpreadsheetUtilities.a8(a, 0, b)) {
            return true;
        }
        return false;
    }
    static bd(a) {
        if (stringIsNullOrEmpty(a) || /\s/i.test(a.charAt(0))) {
            return false;
        }
        let b = false;
        let c;
        if (stringStartsWith(a, "\\\\")) {
            let d = a.length == 2 ? stringEmpty() : a.substr(2);
            b = stringIsNullOrWhiteSpace(d) || Uri.isWellFormedUriString(d, 0);
        }
        else if (SpreadsheetUtilities.bb(a)) {
            b = true;
        }
        else if (((() => { let e = Uri.tryCreate(a, 0, c); c = e.p2; return e.ret; })())) {
            if (c.isAbsoluteUri) {
                if (a.length > c.scheme.length + 1) {
                    try {
                        if (!stringIsNullOrEmpty(c.localPath) && /\s/i.test(c.localPath.charAt(0))) {
                        }
                        else if (UriParser.a(c.scheme)) {
                            b = true;
                        }
                    }
                    catch (e) {
                        b = false;
                    }
                }
            }
            else {
                let f = trimEnd(a);
                if (f != a) {
                    let g = Uri.tryCreate(f, 0, c);
                    c = g.p2;
                }
                if (f.length > 4) {
                    if (c.isWellFormedOriginalString()) {
                        if (startsWith1(a, "www.", 3) || startsWith1(a, "ftp", 3)) {
                            b = true;
                        }
                    }
                    else if (stringStartsWith(f, "ftp.")) {
                        let h = f.substr(4);
                        if (!/\s/i.test(h.charAt(0))) {
                            b = true;
                        }
                    }
                }
                else if (f.length == 0) {
                    b = false;
                }
            }
        }
        else {
            let i = a.indexOf(Uri.schemeDelimiter);
            if (i > 0) {
                let j = a.substr(0, i);
                if (UriParser.a(j)) {
                    let k = stringEmpty();
                    if (i + Uri.schemeDelimiter.length < a.length) {
                        k = a.substr(i + Uri.schemeDelimiter.length).trim();
                    }
                    if (k.length == 0 || stringEquals1("ftp", j, 1)) {
                        b = true;
                    }
                }
            }
            else if (startsWith1(a, "mailto:", 3)) {
                if (a.length > 7 && !/\s/i.test(a.charAt(7))) {
                    b = true;
                }
            }
        }
        return b;
    }
    static be(a) {
        return a == 3 || a == 2;
    }
    static ea(a, b = null, c = null) {
        if (performance !== undefined && performance.measure !== undefined)
            performance.measure(a, b, c);
        ;
    }
    static cx(a, b) {
        if (b < (a.f + a.e)) {
            let c = new IGFormattedTextRun();
            c.f = b;
            c.e = (a.f + a.e) - b;
            a.h.add(c);
            b = c.f + c.e;
        }
        return b;
    }
    static eb(a, b) {
        let c = a._conditionalFormats$i;
        let d = new WorksheetReferenceCollection(a);
        let e = FormulaParser.bx(a._y).toString();
        for (let f = c.count - 1; f >= 0; f--) {
            let g = c.item(f);
            if (g._ab(b)) {
                d.clear();
                for (let h of fromEnum(g.regions)) {
                    d._add(h);
                }
                let i = false;
                for (let k = 0; k < b.length; k++) {
                    let j = b[k];
                    i = d._remove2(j) || i;
                }
                if (i) {
                    if (d._t.count == 0) {
                        a._conditionalFormats$i.removeAt(f);
                    }
                    else {
                        let l = WorksheetReferenceCollection._ab(1, a, d._t, e);
                        g._setRegions$i(l, Nullable$1.toNullable(CellReferenceMode_$type, 1));
                    }
                }
            }
        }
    }
    static ec(a, b) {
        a.removeListener(b);
    }
    static ed(a, b, c, d) {
        let e = a._styles$i._i(c)._i._bh._getResolvedColor1(a);
        let f = null;
        b.l((g) => {
            let h = g._d;
            if (WorkbookColorInfo.l_op_Inequality(h, null)) {
                if (Color.b(h._getResolvedColor1(a), e)) {
                    if (WorkbookColorInfo.l_op_Equality(f, null)) {
                        f = a._styles$i._i(d)._i._bh;
                    }
                    g._d = f;
                }
            }
        });
    }
    static ee(a, b) {
        a._au(b, true, SpreadsheetUtilities.ah(a));
    }
    static ef(a, b) {
        a._u._b(b, true, SpreadsheetUtilities.ah(a));
    }
    static eh(a, b) {
        a._ay(b, true, SpreadsheetUtilities.ah(a));
    }
    static ei(a, b) {
        a._a0(b, true, SpreadsheetUtilities.ah(a));
    }
    static ej(a, b) {
        a._u._c(b, true, SpreadsheetUtilities.ah(a));
    }
    static ek(a, b) {
        a._u._h(b, true, SpreadsheetUtilities.ah(a));
    }
    static el(a, b) {
        a._u._f(b, true, SpreadsheetUtilities.ah(a));
    }
    static em(a, b) {
        a._a5(b, true, SpreadsheetUtilities.ah(a));
    }
    static en(a, b) {
        a._a8(b, true, SpreadsheetUtilities.ah(a));
    }
    static eo(a, b) {
        a._u._g(b, true, SpreadsheetUtilities.ah(a));
    }
    static ep(a, b) {
        a._bb(b, true, SpreadsheetUtilities.ah(a));
    }
    static eq(a) {
        if (performance !== undefined && performance.mark !== undefined)
            performance.mark(a);
        ;
    }
    static er(a, b) {
        a._bf(b, true, SpreadsheetUtilities.ah(a));
    }
    static es(a, b) {
        a._bg(b, true, SpreadsheetUtilities.ah(a));
    }
    static et(a, b) {
        a._u._i(b, true, SpreadsheetUtilities.ah(a));
    }
    static eu(a, b) {
        a._bh(b, true, SpreadsheetUtilities.ah(a));
    }
    static ev(a, b) {
        a._u._j(b, true, SpreadsheetUtilities.ah(a));
    }
    static ew(a, b) {
        a._u._k(b, true, SpreadsheetUtilities.ah(a));
    }
    static ex(a, b) {
        a._bm(b, true, SpreadsheetUtilities.ah(a));
    }
    static ey(a, b) {
        a._bn(b, true, SpreadsheetUtilities.ah(a));
    }
    static bl(a) {
        let b = a._ao;
        if (typeCast(WorksheetShapeGroup.$, b._f) !== null) {
            return false;
        }
        return ExcelUtils.bd(a._b6);
    }
    static dl(a) {
        if (!stringIsNullOrEmpty(a)) {
            let b = 0;
            let c = a.length;
            let d;
            let e = null;
            while (b < c && (d = SpreadsheetUtilities.cs(a, b)) >= 0) {
                if (e == null) {
                    e = new StringBuilder(0);
                }
                if (d > b) {
                    e.m(a, b, d - b);
                }
                if (a.charAt(d) == '\r' && d < c - 1 && a.charAt(d + 1) == '\n') {
                    d++;
                }
                b = d + 1;
            }
            if (e != null) {
                if (b < c) {
                    e.m(a, b, c - b);
                }
                a = e.toString();
            }
        }
        return a;
    }
    static i(a) {
        switch (a) {
            case 0: return 0;
            case 7: return 1;
            case 9: return 3;
            case 11: return 2;
            case 3: return 5;
            case 4: return 4;
            case 2: return 13;
            case 10: return 11;
            case 12: return 7;
            case 8: return 12;
            case 5: return 14;
            case 1: return 6;
            default:
            case 6:
            case 13:
            case -1: return 0;
        }
    }
    static m(a) {
        switch (a) {
            case 7: return 3;
            case 3: return 1;
            case 5: return 2;
            default:
            case 1: return 0;
        }
    }
    static dn(a, b) {
        return SpreadsheetUtilities.dt(a, b) + " " + SpreadsheetUtilities.dp(a, b);
    }
    static dq(a, b) {
        let c = dateToday();
        c = dateAddHours(c, timeSpanTotalHours(a));
        return SpreadsheetUtilities.dp(c, b);
    }
    static dp(a, b) {
        let c = (a.toLocaleTimeString(b._y.name));
        if (VisualElementDomBuilder.c) {
            c = SpreadsheetUtilities.dv.g(c, "");
        }
        return c;
    }
    static dr(a, b) {
        let c = a * 100;
        return (c.toLocaleString(b.name, { maximumFractionDigits: 20, maximumSignificantDigits: 15 })) + b.numberFormat.percentSymbol;
    }
    static d0(a) {
        if (SpreadsheetUtilities.dw == null || SpreadsheetUtilities.dw.d != a) {
            let b = WorkbookFormatCollection.af(a);
            SpreadsheetUtilities.dw = new Tuple$2(ValueFormatter.$, CultureInfo.$, new ValueFormatter(1, b, a, null), a);
        }
        return SpreadsheetUtilities.dw;
    }
    static dt(a, b) {
        return SpreadsheetUtilities.c7(SpreadsheetUtilities.d0(b._y).c, a, b.workbook);
    }
    static ds(a, b) {
        return SpreadsheetUtilities.c7(SpreadsheetUtilities.d0(b._e6).c, a, b);
    }
    static c0(a) {
        return Nullable$1.toNullable(Boolean_$type, nullableEquals(a, true) ? false : true);
    }
    static aq(a, b) {
        return a == b ? 0 : b;
    }
    static al(a, b) {
        return a == 1 || a == 33 ? 0 : b ? 33 : 1;
    }
    static ak(a, b) {
        return a == 2 || a == 34 ? 0 : b ? 34 : 2;
    }
    static o(a) {
        switch (a) {
            case 3: return 0;
            case 1: return 1;
            default:
            case 0: return 3;
            case 2: return 2;
        }
    }
    static ac(a) {
        let b;
        switch (a) {
            default:
            case 1:
                b = 0;
                break;
            case 4:
                b = 5;
                break;
            case 2:
            case 6:
                b = 2;
                break;
            case 3:
                b = 1;
                break;
            case 5:
                b = 3;
                break;
            case 7:
                b = 4;
                break;
        }
        return b;
    }
    static af(a) {
        switch (a) {
            case 0: return 0;
            case 1: return 1;
            default:
            case 2: return 2;
            case 4: return 4;
            case 3: return 3;
        }
    }
    static cc(a) {
        return a * Math.PI / 180;
    }
    static y(a) {
        return new SpreadsheetCell(a.o, a.m);
    }
    static z(a) {
        return new SpreadsheetCellRange(a._ac, a._w, a._ae, a._x);
    }
    static g(a) {
        let b = new Array(a.count);
        for (let c = 0; c < b.length; c++) {
            b[c] = SpreadsheetUtilities.z(a.item(c));
        }
        return b;
    }
    static ar(a) {
        switch (a) {
            case 3: return 2;
            case 4: return 1;
            case 0:
            case 5: return 4;
            case 1: return 5;
            case 2: return 0;
            default: return 4;
        }
    }
    static ab(a) {
        switch (a) {
            case -4130: return 3;
            case -4117: return 4;
            case -4131: return 0;
            case -4152: return 1;
            default:
            case -4108: return 2;
        }
    }
    static ad(a) {
        switch (a) {
            case 2:
            case 3: return 3;
            case 1:
            case 6: return 4;
            case 4: return 0;
            case 5: return 1;
            default:
            case 0: return 2;
        }
    }
    static ae(a) {
        switch (a) {
            case -4130: return 3;
            case -4117: return 4;
            case -4160: return 0;
            case -4107: return 2;
            default:
            case -4108: return 1;
        }
    }
    static aw(a) {
        return new WorksheetCellAddress(1, a.row, a.column);
    }
    static ay(a) {
        return new WorksheetRegionAddress(1, a.firstRow, a.lastRow, a.firstColumn, a.lastColumn);
    }
    static ax(a) {
        return SpreadsheetUtilities.az(a.row, a.column);
    }
    static az(a, b) {
        return new WorksheetRegionAddress(1, a, a, b, b);
    }
    static h(a) {
        let b = new Array(a.count);
        for (let c = 0; c < b.length; c++) {
            b[c] = SpreadsheetUtilities.ay(a.item(c));
        }
        return b;
    }
    static e1(a, b = null) {
        for (let c of fromEnum(a)) {
            let d = c.key;
            let e = new Array(c.value.length);
            for (let f = 0; f < e.length; f++) {
                e[f] = c.value[f]._h;
            }
            SpreadsheetUtilities.e0(c.key, e, b);
        }
    }
    static e0(a, b, c = null) {
        let d = null;
        for (let e of fromEnum(a._tables$i)) {
            if (c != null && c.contains(e.name)) {
                continue;
            }
            let f = e.dataAreaRegion._h;
            for (let g = 0; g < b.length; g++) {
                let h = b[g];
                if (h._j(f)) {
                    for (let i of fromEnum(e._columns$i)) {
                        if (h._h(i.dataAreaRegion._h)) {
                            if (d == null) {
                                d = new HashSet$1(WorksheetTableColumn.$, 0);
                            }
                            d.add_1(i);
                        }
                    }
                }
            }
        }
        if (d != null) {
            for (let j of fromEnum(d)) {
                let k = null;
                let l = j.dataAreaRegion;
                let m = l.firstRow;
                for (let n = m; n <= l.lastRow; n++) {
                    let o = a._rows$i._aj(n);
                    if (o == null) {
                        k = null;
                        break;
                    }
                    else {
                        let p = o._ar(j._at);
                        if (n == m && p != null) {
                            k = p;
                        }
                        else if (p == null || !p._ao(k)) {
                            k = null;
                            break;
                        }
                    }
                }
                if (k != null) {
                    k = k._g();
                }
                j._setColumnFormula1(k, false);
            }
        }
    }
}
SpreadsheetUtilities.$t = markType(SpreadsheetUtilities, 'SpreadsheetUtilities');
SpreadsheetUtilities.cd = (Element.prototype.matches || Element.prototype.matchesSelector || Element.prototype.mozMatchesSelector || Element.prototype.msMatchesSelector || Element.prototype.oMatchesSelector || Element.prototype.webkitMatchesSelector);
SpreadsheetUtilities.a = SpreadsheetUtilities.b();
SpreadsheetUtilities.bq = SpreadsheetUtilities.bs();
SpreadsheetUtilities.d3 = ObservableCollectionExtended$1.$.specialize(SpreadsheetCellRange.$);
SpreadsheetUtilities.d2 = AdapterIntRangeSet$1.$.specialize(SpreadsheetCellRange.$);
SpreadsheetUtilities.d5 = ObservableCollectionExtended$1.$.specialize(WorksheetItemPosition.$);
SpreadsheetUtilities.d4 = ObservableCollectionExtended$1.$.specialize(SpreadsheetDropDownButton.$);
SpreadsheetUtilities.cz = Nullable$1.toNullable(Boolean_$type, null);
SpreadsheetUtilities.du = new Regex(0, "\\(_\\w\\)");
SpreadsheetUtilities.bw = new List$1(Number_$type, 1, [160, 180, 200, 220, 240, 280, 320, 360, 400, 440, 480, 520, 560, 720, 960, 1440]);
SpreadsheetUtilities.bo = null;
SpreadsheetUtilities.bp = null;
SpreadsheetUtilities.bn = SpreadsheetUtilities.br();
SpreadsheetUtilities.d1 = Tuple.a(FormatConditionIconSet_$type, Nullable$1.$.specialize(Number_$type), -1, Nullable$1.toNullable(Number_$type, null));
SpreadsheetUtilities.dv = new Regex(0, "");
SpreadsheetUtilities.dw = null;
/**
 * @hidden
 */
export class SpreadsheetCellEditInfo extends Base {
    constructor(a, b, c) {
        super();
        this.a = null;
        this.b = null;
        this.c = false;
        this.a = a;
        this.b = b;
        this.c = c;
    }
}
SpreadsheetCellEditInfo.$t = markType(SpreadsheetCellEditInfo, 'SpreadsheetCellEditInfo');
/**
 * @hidden
 */
export class AccountingUnderlineInfo extends Base {
    constructor() {
        super(...arguments);
        this.b = false;
        this.c = 0;
        this.a = false;
    }
    static d(a, b, c, d, e) {
        let f = d.a;
        if (f == null) {
            d.a = f = new AccountingUnderlineInfo();
        }
        f.c = a;
        f.b = b;
        let g = false;
        if (c != null && !c.displayOptions.showFormulasInCells) {
            if (d.l) {
                g = true;
            }
            else {
                let h = d.ap;
                if (h != null && ExcelUtils.ba(h)) {
                    let i = c.workbook;
                    if (d.p) {
                        g = true;
                    }
                    else if (i != null) {
                        g = true;
                        let j = SpreadsheetUtilities.ag(e, c, d.h, d.ab, true);
                        if (j != null && j.o && j.k(0)) {
                            g = false;
                        }
                    }
                }
            }
        }
        f.a = g;
    }
}
AccountingUnderlineInfo.$t = markType(AccountingUnderlineInfo, 'AccountingUnderlineInfo');
/**
 * An object that represents the selected items within a [[Spreadsheet]]
 */
export class SpreadsheetSelection extends PropertyChangeNotifierExtended {
    constructor(a, b, c) {
        super();
        this._l = null;
        this._y = null;
        this._k = null;
        this._be = null;
        this._g = null;
        this._h = null;
        this._i = null;
        this._j = null;
        this._n = new SpreadsheetCell();
        this._p = new SpreadsheetCellRange();
        this._bl = 0;
        this._aa = new IntRange(1, 0, 0);
        this._ab = new IntRange(1, 0, 0);
        this._w = 0;
        this._bo = Nullable$1.toNullable(Boolean_$type, null);
        this._bn = Nullable$1.toNullable(Boolean_$type, null);
        this._bp = null;
        this._q = SpreadsheetCellRange.empty;
        this._ag = false;
        /**
         * @hidden
         */
        this._av = false;
        CoreUtilities.y(a);
        CoreUtilities.y(b);
        let d = PropertyChangeListenerList.e(ObservableCollectionExtended$1.$.specialize(SpreadsheetCellRange.$), this._k, new ObservableCollectionExtended$1(SpreadsheetCellRange.$, 0), this, false);
        this._k = d.p0;
        let e = PropertyChangeListenerList.e(AdapterIntRangeSet$1.$.specialize(SpreadsheetCellRange.$), this._g, new AdapterIntRangeSet$1(SpreadsheetCellRange.$, this._k, runOn(this, this._ae), null, runOn(this, this._ar)), this, false);
        this._g = e.p0;
        let f = PropertyChangeListenerList.e(AdapterIntRangeSet$1.$.specialize(SpreadsheetCellRange.$), this._h, new AdapterIntRangeSet$1(SpreadsheetCellRange.$, this._k, runOn(this, this._af), null, runOn(this, this._ar)), this, false);
        this._h = f.p0;
        let g = PropertyChangeListenerList.e(AdapterIntRangeSet$1.$.specialize(SpreadsheetCellRange.$), this._i, new AdapterIntRangeSet$1(SpreadsheetCellRange.$, this._k, runOn(this, this._ae), runOn(this, this._az), runOn(this, this._ar)), this, false);
        this._i = g.p0;
        let h = PropertyChangeListenerList.e(AdapterIntRangeSet$1.$.specialize(SpreadsheetCellRange.$), this._j, new AdapterIntRangeSet$1(SpreadsheetCellRange.$, this._k, runOn(this, this._af), runOn(this, this._a0), runOn(this, this._ar)), this, false);
        this._j = h.p0;
        this._ag = c;
        this._l = a;
        this._y = b;
        this._be = new ReadOnlyNotifyCollection$1(SpreadsheetCellRange.$, this._k);
        this._k.add(new SpreadsheetCellRange(this._n.row, this._n.column));
    }
    /**
     * @hidden
     */
    e(sender, property, extraInfo) {
        if (sender == this) {
            switch (property) {
                case "AvailableColumnRange":
                    this._i._t();
                    break;
                case "AvailableRowRange":
                    this._j._t();
                    break;
            }
        }
        else if (sender == this._k) {
            this._bp = null;
        }
        super.e(sender, property, extraInfo);
    }
    /**
     * Returns the cell that represents the active cell.
     */
    get activeCell() {
        return this._n;
    }
    /**
     * @hidden
     */
    get _r() {
        return this._p;
    }
    /**
     * Returns the index of the selection group that contains the active cell.
     */
    get activeCellRangeIndex() {
        return this._bl;
    }
    /**
     * Returns a read-only collection of the ranges of cells that are selected.
     */
    get cellRanges() {
        return this._be;
    }
    /**
     * Returns or sets a string containing the cell ranges in A1 cell reference mode.
     * <p class="note">
     * If there are multiple ranges then they are separated by the default union operator (',').
     * </p>
     */
    get cellRangesAddress() {
        if (this._bp == null) {
            this._bp = SpreadsheetCellRange._ag(this._be, 1);
        }
        return this._bp;
    }
    /**
     * Returns or sets a string containing the cell ranges in A1 cell reference mode.
     * <p class="note">
     * If there are multiple ranges then they are separated by the default union operator (',').
     * </p>
     */
    set cellRangesAddress(a) {
        if (stringIsNullOrEmpty(a)) {
            throw new ArgumentNullException(1);
        }
        let b = SpreadsheetCellRange._a(a);
        this._resetSelection(b, b[0]._c, 0, true);
    }
    /**
     * @hidden
     */
    get _bf() {
        return this._g;
    }
    /**
     * @hidden
     */
    get _bg() {
        return this._h;
    }
    /**
     * @hidden
     */
    get _al() {
        let a = this._bf;
        return a.count == 1 && a.item(0)._i <= this._ac._i && a.item(0)._h >= this._ac._h;
    }
    /**
     * @hidden
     */
    get _am() {
        let a = this._bg;
        return a.count == 1 && a.item(0)._i <= this._ad._i && a.item(0)._h >= this._ad._h;
    }
    /**
     * @hidden
     */
    get _ac() {
        return this._aa;
    }
    /**
     * @hidden
     */
    set _ac(a) {
        if (!this._aa.equals(a)) {
            this._aa = a;
            this.a("AvailableColumnRange");
        }
    }
    /**
     * @hidden
     */
    get _ad() {
        return this._ab;
    }
    /**
     * @hidden
     */
    set _ad(a) {
        if (!this._ab.equals(a)) {
            this._ab = a;
            this.a("AvailableRowRange");
        }
    }
    /**
     * @hidden
     */
    get _x() {
        return this._w;
    }
    /**
     * @hidden
     */
    set _x(a) {
        if (this._w != a) {
            this._w = a;
            this.a("CellSelectionMode");
            if (a == 2) {
                this._av = false;
            }
        }
    }
    /**
     * @hidden
     */
    get _ax() {
        if (nullableEquals(this._bo, null)) {
            this._bo = Nullable$1.toNullable(Boolean_$type, SpreadsheetCellRange._j(this._be));
        }
        return this._bo.value;
    }
    /**
     * @hidden
     */
    get _aw() {
        if (nullableEquals(this._bn, null)) {
            this._bn = Nullable$1.toNullable(Boolean_$type, this._au());
        }
        return this._bn.value;
    }
    /**
     * @hidden
     */
    get _z() {
        return this._y;
    }
    /**
     * @hidden
     */
    get _v() {
        return this._q;
    }
    /**
     * @hidden
     */
    set _v(a) {
        if (SpreadsheetCellRange.l_op_Inequality(this._q, a)) {
            this._q = a;
            this.a("RangeToUnselect");
        }
    }
    /**
     * @hidden
     */
    get _bi() {
        return this._i;
    }
    /**
     * @hidden
     */
    get _bj() {
        return this._j;
    }
    /**
     * @hidden
     */
    get _m() {
        return this._l;
    }
    addActiveCellRange() {
        let n;
        if (arguments.length === 2) {
            if (typeCast(SpreadsheetCellRange.$, arguments[0]) !== null) {
                n = 0;
            }
            else if (typeof arguments[0] === 'string') {
                n = 1;
            }
            else if (arguments[0] == null) {
                n = 1;
            }
        }
        else if (arguments.length === 3) {
            if (typeCast(SpreadsheetCellRange.$, arguments[0]) !== null) {
                n = 0;
            }
            else if (typeof arguments[0] === 'string') {
                n = 1;
            }
            else if (arguments[0] == null) {
                n = 1;
            }
        }
        switch (n) {
            case 0: return this._addActiveCellRange1.apply(this, arguments);
            case 1: return this._addActiveCellRange2.apply(this, arguments);
            default: throw new Error('Invalid arguments');
        }
    }
    /**
     * @hidden
     */
    _addActiveCellRange2(a, b, c = true) {
        return this._addActiveCellRange1(new SpreadsheetCellRange(a), new SpreadsheetCell(b), c);
    }
    /**
     * @hidden
     */
    _addActiveCellRange1(a, b, c = true) {
        if (!a._contains(b)) {
            throw new ArgumentException(0);
        }
        if (c) {
            let d = this._bt(a);
            a = d.p0;
        }
        return this._ak(a, b, this._t(b));
    }
    addCellRange() {
        let n;
        if (arguments.length === 1) {
            if (typeCast(SpreadsheetCellRange.$, arguments[0]) !== null) {
                n = 0;
            }
            else if (typeof arguments[0] === 'string') {
                n = 1;
            }
            else if (arguments[0] == null) {
                n = 1;
            }
        }
        else if (arguments.length === 2) {
            if (typeCast(SpreadsheetCellRange.$, arguments[0]) !== null) {
                n = 0;
            }
            else if (typeof arguments[0] === 'string') {
                n = 1;
            }
            else if (arguments[0] == null) {
                n = 1;
            }
        }
        switch (n) {
            case 0: return this._addCellRange.apply(this, arguments);
            case 1: return this._addCellRange1.apply(this, arguments);
            default: throw new Error('Invalid arguments');
        }
    }
    /**
     * @hidden
     */
    _addCellRange1(a, b = true) {
        this._addCellRange(new SpreadsheetCellRange(a), b);
    }
    /**
     * @hidden
     */
    _addCellRange(a, b = true) {
        if (b) {
            let c = this._bt(a);
            a = c.p0;
        }
        {
            let d = this._bk();
            try {
                try {
                    this._k.beginUpdate();
                    this._k.add(a);
                }
                finally {
                    this._k.endUpdate();
                }
            }
            finally {
                if (d != null) {
                    d.dispose();
                }
            }
        }
        this._bu();
    }
    /**
     * Resets the [[cellRanges]] to a single range containing only the [[activeCell]]
     */
    clearCellRanges() {
        return this._a9(this.activeCell);
    }
    replaceActiveCellRange() {
        let n;
        if (arguments.length === 2) {
            if (typeCast(SpreadsheetCellRange.$, arguments[0]) !== null) {
                n = 0;
            }
            else if (typeof arguments[0] === 'string') {
                n = 1;
            }
            else if (arguments[0] == null) {
                n = 1;
            }
        }
        else if (arguments.length === 3) {
            if (typeCast(SpreadsheetCellRange.$, arguments[0]) !== null) {
                n = 0;
            }
            else if (typeof arguments[0] === 'string') {
                n = 1;
            }
            else if (arguments[0] == null) {
                n = 1;
            }
        }
        switch (n) {
            case 0: return this._replaceActiveCellRange1.apply(this, arguments);
            case 1: return this._replaceActiveCellRange2.apply(this, arguments);
            default: throw new Error('Invalid arguments');
        }
    }
    /**
     * @hidden
     */
    _replaceActiveCellRange2(a, b, c = true) {
        return this._replaceActiveCellRange1(new SpreadsheetCellRange(a), new SpreadsheetCell(b), c);
    }
    /**
     * @hidden
     */
    _replaceActiveCellRange1(a, b, c = true) {
        if (c) {
            let d = this._bt(a);
            a = d.p0;
        }
        if (!a._contains(b)) {
            throw new ArgumentException(0);
        }
        return this._a7(a, b);
    }
    resetSelection() {
        let n;
        if (arguments.length === 2) {
            n = 1;
        }
        else if (arguments.length === 3) {
            if (arguments[0] instanceof Array) {
                n = 0;
            }
            else if (typeCast(SpreadsheetCellRange.$, arguments[0]) !== null) {
                n = 1;
            }
            else if (typeof arguments[0] === 'string') {
                n = 2;
            }
            else if (arguments[0] == null) {
                if (typeCast(SpreadsheetCell.$, arguments[1]) !== null) {
                    n = 0;
                }
                else if (typeof arguments[1] === 'string') {
                    n = 2;
                }
                else if (arguments[1] == null) {
                    n = 2;
                }
            }
        }
        else if (arguments.length === 4) {
            if (arguments[0] instanceof Array) {
                n = 0;
            }
            else if (typeof arguments[0] === 'string') {
                n = 2;
            }
            else if (arguments[0] == null) {
                if (typeCast(SpreadsheetCell.$, arguments[1]) !== null) {
                    n = 0;
                }
                else if (typeof arguments[1] === 'string') {
                    n = 2;
                }
                else if (arguments[1] == null) {
                    n = 2;
                }
            }
        }
        switch (n) {
            case 0: return this._resetSelection.apply(this, arguments);
            case 1: return this._resetSelection2.apply(this, arguments);
            case 2: return this._resetSelection3.apply(this, arguments);
            default: throw new Error('Invalid arguments');
        }
    }
    /**
     * @hidden
     */
    _resetSelection2(a, b, c = true) {
        if (!a._contains(b)) {
            throw new ArgumentException(0);
        }
        return this._resetSelection([a], b, 0, c);
    }
    /**
     * @hidden
     */
    _resetSelection3(a, b, c, d = true) {
        return this._resetSelection(SpreadsheetCellRange._a(a), new SpreadsheetCell(b), c, d);
    }
    /**
     * @hidden
     */
    _resetSelection(a, b, c, d = true) {
        CoreUtilities.z(a, "ranges");
        if (a.length == 0) {
            throw new ArgumentException(0);
        }
        if (c < 0 || c >= a.length) {
            throw new ArgumentOutOfRangeException(0);
        }
        if (!a[c]._contains(b)) {
            throw new ArgumentException(0);
        }
        let e = SpreadsheetCell.l_op_Inequality(b, this.activeCell);
        let f = this.cellRanges.count != a.length;
        if (!f) {
            for (let g = 0; g < a.length; g++) {
                if (!a[g]._equals(this._be.item(g))) {
                    f = true;
                    break;
                }
            }
        }
        if (e && !this._a2(b)) {
            return false;
        }
        let h = d ? this._t(b) : new SpreadsheetCellRange(b.row, b.column);
        if (d) {
            if (a.length != 1 || SpreadsheetCellRange.l_op_Inequality(a[c], h)) {
                for (let i = 0; i < a.length; i++) {
                    let j = this._bt(a[i]);
                    a[i] = j.p0;
                }
            }
        }
        {
            let k = this._bk();
            try {
                try {
                    if (f) {
                        this._k.beginUpdate();
                        this._k.clear();
                        this._k._a3(a);
                    }
                    this._bv(b, c, h);
                }
                finally {
                    if (f) {
                        this._k.endUpdate();
                    }
                }
            }
            finally {
                if (k != null) {
                    k.dispose();
                }
            }
        }
        if (f) {
            this._bu();
        }
        return true;
    }
    setActiveCell() {
        let n;
        if (arguments.length === 1) {
            if (typeCast(SpreadsheetCell.$, arguments[0]) !== null) {
                n = 0;
            }
            else if (typeof arguments[0] === 'string') {
                n = 1;
            }
            else if (arguments[0] == null) {
                n = 1;
            }
        }
        else if (arguments.length === 2) {
            if (typeCast(SpreadsheetCell.$, arguments[0]) !== null) {
                n = 0;
            }
            else if (typeof arguments[0] === 'string') {
                n = 1;
            }
            else if (arguments[0] == null) {
                n = 1;
            }
        }
        switch (n) {
            case 0:
                if (arguments[1] !== void 0) {
                    arguments[1] = wrapNullable(Number_$type, arguments[1]);
                }
                return this._setActiveCell.apply(this, arguments);
            case 1:
                if (arguments[1] !== void 0) {
                    arguments[1] = wrapNullable(Number_$type, arguments[1]);
                }
                return this._setActiveCell1.apply(this, arguments);
            default: throw new Error('Invalid arguments');
        }
    }
    /**
     * @hidden
     */
    _setActiveCell1(a, b = Nullable$1.toNullable(Number_$type, null)) {
        return this._setActiveCell(new SpreadsheetCell(a), b);
    }
    /**
     * @hidden
     */
    _setActiveCell(a, b = Nullable$1.toNullable(Number_$type, null)) {
        let c = !nullableIsNull(b) ? b.value : this.activeCellRangeIndex;
        let d = this._be.count;
        let e = d;
        for (let f = c, g = c + this._be.count; f < g; f++) {
            if (this._be.item(f % d)._contains(a)) {
                e = f % d;
                break;
            }
        }
        if (e == d) {
            return this._a9(a);
        }
        else {
            if (SpreadsheetCell.l_op_Inequality(a, this.activeCell) && !this._a2(a)) {
                return false;
            }
            this._bv(a, e, this._t(a));
            return true;
        }
    }
    /**
     * Deselect the cells in the specified range.
     * <p class="note"><b>Note:</b> if the specified range encompasses all the cells in the selection, the selection will be changed to only include the current [[activeCell]].</p>
     * @param range The range whose cells should be removed from the selection.
     */
    unselectRange(range) {
        let a = null;
        let b = -1;
        let c = this._n;
        for (let d = 0; d < this._be.count; d++) {
            let e = this._be.item(d);
            if (e.intersectsWith(range)) {
                if (a == null) {
                    a = new List$1(SpreadsheetCellRange.$, 0);
                    for (let f = 0; f < d; f++) {
                        a.add(this._be.item(f));
                    }
                }
                if (range._contains1(e)) {
                    continue;
                }
                let g = a.count;
                if (range.firstRow > e.firstRow) {
                    a.add(new SpreadsheetCellRange(e.firstRow, e.firstColumn, range.firstRow - 1, e.lastColumn));
                }
                if (range.firstColumn > e.firstColumn) {
                    a.add(new SpreadsheetCellRange(Math.max(range.firstRow, e.firstRow), e.firstColumn, Math.min(range.lastRow, e.lastRow), range.firstColumn - 1));
                }
                if (range.lastColumn < e.lastColumn) {
                    a.add(new SpreadsheetCellRange(Math.max(range.firstRow, e.firstRow), range.lastColumn + 1, Math.min(range.lastRow, e.lastRow), e.lastColumn));
                }
                if (range.lastRow < e.lastRow) {
                    a.add(new SpreadsheetCellRange(range.lastRow + 1, e.firstColumn, e.lastRow, e.lastColumn));
                }
                if (b < 0 && d >= this._bl) {
                    if (d > this._bl || range._contains(this._n)) {
                        b = g;
                        c = a._inner[b]._c;
                    }
                    else {
                        for (let h = g; h < a.count; h++) {
                            if (a._inner[h]._contains(this._n)) {
                                b = h;
                                break;
                            }
                        }
                    }
                }
            }
            else {
                if (b < 0 && d >= this._bl) {
                    b = a == null ? d : a.count;
                    c = d == this._bl ? this._n : e._c;
                }
                if (a != null) {
                    a.add(e);
                }
            }
        }
        if (a != null) {
            if (a.count == 0) {
                a.add(new SpreadsheetCellRange(c.row, c.column));
            }
            if (b < 0) {
                b = 0;
                c = a._inner[0]._c;
            }
            this._resetSelection(a.toArray(), c, b, false);
        }
    }
    /**
     * @hidden
     */
    _ah(a) {
        let b = this._t(a);
        return this._ak(b, a, b);
    }
    /**
     * @hidden
     */
    _ao(a) {
        for (let b = 0; b < this._be.count; b++) {
            if (this._be.item(b)._contains(a)) {
                return true;
            }
        }
        return false;
    }
    /**
     * @hidden
     */
    _ap(a) {
        for (let b = 0; b < this._be.count; b++) {
            if (this._be.item(b)._contains1(a)) {
                return true;
            }
        }
        return false;
    }
    /**
     * @hidden
     */
    _bk() {
        return new Spreadsheet_SynchronizationSuspender(this._l);
    }
    /**
     * @hidden
     */
    _as(a, b = true) {
        let c = b ? this._t(a) : new SpreadsheetCellRange(a.row, a.column);
        return this._at(c, b);
    }
    /**
     * @hidden
     */
    _at(a, b = true) {
        a = a.union(this._r);
        if (b) {
            let c = this._bt(a);
            a = c.p0;
        }
        return this._a7(a, this.activeCell);
    }
    /**
     * @hidden
     */
    _bt(a) {
        a = this._y._s.extendRangeForMergedCells(a);
        return {
            p0: a
        };
    }
    /**
     * @hidden
     */
    _s() {
        this._by();
        return this.cellRanges.item(this.activeCellRangeIndex);
    }
    /**
     * @hidden
     */
    _t(a) {
        return this._y._s.getCellRange(a);
    }
    /**
     * @hidden
     */
    _u(a) {
        let b = SpreadsheetCellRange.empty;
        let c = this.activeCell;
        for (let d of fromEnum(this.cellRanges)) {
            let e = this._a0(d);
            let f = this._az(d);
            if (e == f || a == false) {
                b = b.union(d);
            }
            else if (f) {
                if (this._bj.count > 0) {
                    for (let g of fromEnum(this._bj)) {
                        b = b.union(new SpreadsheetCellRange(g._i, d.firstColumn, g._h, d.lastColumn));
                    }
                }
                else {
                    b = b.union(new SpreadsheetCellRange(c.row, d.firstColumn, c.row, d.lastColumn));
                }
            }
            else {
                if (this._bi.count > 0) {
                    for (let h of fromEnum(this._bi)) {
                        b = b.union(new SpreadsheetCellRange(d.firstRow, h._i, d.lastRow, h._h));
                    }
                }
                else {
                    b = b.union(new SpreadsheetCellRange(d.firstRow, c.column, d.lastRow, c.column));
                }
            }
        }
        return b;
    }
    /**
     * @hidden
     */
    _ay(a) {
        for (let b = 0; b < this._be.count; b++) {
            if (this._be.item(b).intersectsWith(a)) {
                return true;
            }
        }
        return false;
    }
    /**
     * @hidden
     */
    _az(a) {
        return a.firstRow <= this._ab._i && a.lastRow >= this._ab._h;
    }
    /**
     * @hidden
     */
    _a0(a) {
        return a.firstColumn <= this._aa._i && a.lastColumn >= this._aa._h;
    }
    /**
     * @hidden
     */
    _a1(a) {
        return a == this._k || a == this._be;
    }
    /**
     * @hidden
     */
    _a2(a) {
        if (this._ag) {
            return true;
        }
        return this._l._dt(a);
    }
    /**
     * @hidden
     */
    _a3() {
        return this._l._d7(true);
    }
    /**
     * @hidden
     */
    _bu() {
        this._bn = Nullable$1.toNullable(Boolean_$type, null);
        this._bo = Nullable$1.toNullable(Boolean_$type, null);
        if (!this._y._am && !this._ag) {
            this._l._h5(new SpreadsheetSelectionChangedEventArgs(this._y));
        }
    }
    /**
     * @hidden
     */
    _a4(a) {
        return this._a7(this._t(a), a);
    }
    /**
     * @hidden
     */
    _a9(a) {
        let b = this._t(a);
        return this._resetSelection2(b, a, true);
    }
    /**
     * @hidden
     */
    _bw(a, b) {
        let c = new Array(this.cellRanges.count);
        for (let d = 0; d < c.length; d++) {
            let e = this.cellRanges.item(d);
            c[d] = new SpreadsheetCellRange(e.firstRow + a, e.firstColumn + b, e.lastRow + a, e.lastColumn + b);
        }
        let f = new SpreadsheetCell(this.activeCell.row + a, this.activeCell.column + b);
        this._resetSelection(c, f, this.activeCellRangeIndex, false);
    }
    /**
     * @hidden
     */
    _by() {
        for (let a = this._bl; a < this._k.count; a++) {
            if (this._k._inner[a]._contains(this._n)) {
                this._bl = a;
                return;
            }
        }
        if (this._bl > 0) {
            for (let b = this._bl - 1; b >= 0; b--) {
                if (this._k._inner[b]._contains(this._n)) {
                    this._bl = b;
                    return;
                }
            }
        }
        this._a9(this._n);
    }
    /**
     * @hidden
     */
    _bz() {
        this._bv(this.activeCell, this.activeCellRangeIndex, this._t(this.activeCell));
    }
    /**
     * @hidden
     */
    _ak(a, b, c) {
        if (SpreadsheetCell.l_op_Inequality(b, this.activeCell) && !this._a2(b)) {
            return false;
        }
        {
            let d = this._bk();
            try {
                try {
                    this._k.beginUpdate();
                    this._k.add(a);
                    this._bv(b, this._k.count - 1, c);
                }
                finally {
                    this._k.endUpdate();
                }
            }
            finally {
                if (d != null) {
                    d.dispose();
                }
            }
        }
        this._bu();
        return true;
    }
    /**
     * @hidden
     */
    _ar(a, b) {
        return a + 1 >= b;
    }
    /**
     * @hidden
     */
    _ae(a) {
        return new IntRange(1, a.firstColumn, a.lastColumn);
    }
    /**
     * @hidden
     */
    _au() {
        if (this._be.count < 2) {
            return false;
        }
        let a = false;
        let b = false;
        let c = false;
        for (let d of fromEnum(this._be)) {
            let e = true;
            if (this._az(d)) {
                a = true;
                e = false;
            }
            if (this._a0(d)) {
                b = true;
                e = false;
            }
            if (e) {
                c = true;
            }
        }
        return c && (b || a);
    }
    /**
     * @hidden
     */
    _af(a) {
        return new IntRange(1, a.firstRow, a.lastRow);
    }
    /**
     * @hidden
     */
    _aq(a) {
        return this._be.count == 1 && a._equals(this._be.item(0));
    }
    /**
     * @hidden
     */
    _a7(a, b) {
        let c = !this._k._inner[this.activeCellRangeIndex]._equals(a);
        let d = SpreadsheetCell.l_op_Inequality(b, this.activeCell);
        if (d && !this._a2(b)) {
            return false;
        }
        {
            let e = this._bk();
            try {
                try {
                    if (c) {
                        this._k.beginUpdate();
                        this._k.item(this.activeCellRangeIndex, a);
                    }
                    if (d) {
                        this._bv(b, this.activeCellRangeIndex, this._t(b));
                    }
                }
                finally {
                    if (c) {
                        this._k.endUpdate();
                    }
                }
            }
            finally {
                if (e != null) {
                    e.dispose();
                }
            }
        }
        if (c) {
            this._bu();
        }
        return true;
    }
    /**
     * @hidden
     */
    _bv(a, b, c) {
        let d = this.activeCellRangeIndex;
        let e = this._r;
        let f = this.activeCell;
        this._bl = b;
        this._p = c;
        this._n = a;
        if (d != b) {
            this.a("ActiveCellRangeIndex");
        }
        if (SpreadsheetCellRange.l_op_Inequality(e, c)) {
            this.a("ActiveCellAsRange");
        }
        if (SpreadsheetCell.l_op_Inequality(f, a)) {
            this.a("ActiveCell");
        }
    }
}
SpreadsheetSelection.$t = markType(SpreadsheetSelection, 'SpreadsheetSelection', PropertyChangeNotifierExtended.$);
/**
 * @hidden
 */
export class SelectionSnapshot extends Base {
    constructor(a, b, c, d) {
        super();
        this._a = null;
        this._j = 0;
        this._g = new SpreadsheetCell();
        this._k = null;
        this._k = new WeakReference(a);
        this._g = c;
        this._a = b;
        this._j = d;
    }
    get _h() {
        return typeCast(Worksheet.$, CoreUtilities.p(this._k));
    }
    static _d(a, b) {
        return new SelectionSnapshot(a, Enumerable.a(SpreadsheetCellRange.$, b.cellRanges), b.activeCell, b.activeCellRangeIndex);
    }
    static _b(a, b) {
        return SelectionSnapshot._c(a, b, b._c);
    }
    static _c(a, b, c) {
        return new SelectionSnapshot(a, [b], c, 0);
    }
    equals(a) {
        return a != null && this._g._equals(a._g) && this._j == a._j && CoreUtilities.d(SpreadsheetCellRange.$, boxArray$1(this._a), boxArray$1(a._a)) && a._h == this._h;
    }
    _i(a, b) {
        return this._g._equals(b.activeCell) && this._j == b.activeCellRangeIndex && CoreUtilities.d(SpreadsheetCellRange.$, boxArray$1(this._a), b.cellRanges) && a == this._h;
    }
    _f(a, b, c, d) {
        if (d != 0 && a != this._h) {
            return this;
        }
        switch (d) {
            default:
            case 0: return SelectionSnapshot._c(a, b, c);
            case 1:
                let e = SpreadsheetPaneManager._getCellRange2(c.row, c.column, a);
                let f = Enumerable.z(SpreadsheetCellRange.$, this._a);
                let g = b.union(e);
                g = SpreadsheetPaneManager._extendRangeForMergedCells1(a, g, null);
                f._inner[this._j] = g;
                return new SelectionSnapshot(a, f.toArray(), this._g, this._j);
            case 2:
                let h = Enumerable.z(SpreadsheetCellRange.$, this._a);
                h.add(SpreadsheetPaneManager._extendRangeForMergedCells1(a, b, null));
                return new SelectionSnapshot(a, h.toArray(), c, h.count - 1);
        }
    }
    _e(a, b, c) {
        return this._f(a, b, b._c, c);
    }
}
SelectionSnapshot.$t = markType(SelectionSnapshot, 'SelectionSnapshot', Base.$, [IEquatable$1_$type.specialize(-1)]).initSelfReferences();
/**
 * @hidden
 */
export class EditModeWorkbookFont extends PropertyChangeNotifierExtended {
    constructor(a) {
        super();
        this._k = true;
        this._g = null;
        this._h = null;
        this._i = null;
        CoreUtilities.y(a);
        this._i = a;
        this._g = new EditModeWorkbookFontInfo();
        this._h = new EditModeWorkbookFontInfo();
    }
    get bold() {
        return unwrapNullable(this._bold$i);
    }
    set bold(a) {
        arguments[0] = wrapNullable(Boolean_$type, arguments[0]);
        this._bold$i = arguments[0];
    }
    get _bold$i() {
        this._x();
        return this._g.e;
    }
    set _bold$i(a) {
        this._p(nullableEquals(a, true));
    }
    get _j() {
        return this._i;
    }
    get colorInfo() {
        this._x();
        return this._g.c;
    }
    set colorInfo(a) {
        this._q(a);
    }
    get _l() {
        return WorksheetCellFormatData._c8(2048);
    }
    get height() {
        this._x();
        return this._g.d;
    }
    set height(a) {
        this._r(a);
    }
    get italic() {
        return unwrapNullable(this._italic$i);
    }
    set italic(a) {
        arguments[0] = wrapNullable(Boolean_$type, arguments[0]);
        this._italic$i = arguments[0];
    }
    get _italic$i() {
        this._x();
        return this._g.f;
    }
    set _italic$i(a) {
        this._s(nullableEquals(a, true));
    }
    get name() {
        this._x();
        return this._g.i;
    }
    set name(a) {
        this._t(a);
    }
    get strikeout() {
        return unwrapNullable(this._strikeout$i);
    }
    set strikeout(a) {
        arguments[0] = wrapNullable(Boolean_$type, arguments[0]);
        this._strikeout$i = arguments[0];
    }
    get _strikeout$i() {
        this._x();
        return this._g.g;
    }
    set _strikeout$i(a) {
        this._u(nullableEquals(a, true));
    }
    get superscriptSubscriptStyle() {
        this._x();
        return this._g.a;
    }
    set superscriptSubscriptStyle(a) {
        if (a == -1) {
            a = 0;
        }
        this._v(a);
    }
    get underlineStyle() {
        this._x();
        return this._g.b;
    }
    set underlineStyle(a) {
        if (a == -1) {
            a = 0;
        }
        this._w(a);
    }
    _m(a = true) {
        if (this._k == false) {
            this._k = true;
            if (a) {
                this._o();
            }
        }
    }
    _o() {
        this.a(stringEmpty());
    }
    _x() {
        if (this._k) {
            this._k = false;
            this._y();
        }
    }
    _y() {
        this._n(this._h);
        let a = this._g.h(this._h);
    }
}
EditModeWorkbookFont.$t = markType(EditModeWorkbookFont, 'EditModeWorkbookFont', PropertyChangeNotifierExtended.$, [IWorkbookFont_$type]);
/**
 * @hidden
 */
export class LockedEditRangeInfoForCellRange extends Base {
    f(a, b) {
    }
    b(a, b, c) {
        let d = a.index;
        for (let e = b; e <= c; e++) {
            if (!this.c(d, e)) {
                return false;
            }
        }
        return true;
    }
    static a(a, b, c, d, e) {
        if (a != null && a.b.protection._allowedEditRanges$i.count > 0) {
            let f = new SpreadsheetCellRange(b, c, d, e);
            let g = new List$1(WorksheetProtectedRange.$, 0);
            let h = new List$1(WorksheetProtectedRange.$, 0);
            let i = SpreadsheetUtilities.ay(f);
            for (let j of fromEnum(a.b.protection._allowedEditRanges$i)) {
                for (let k of fromEnum(j.ranges)) {
                    if (k._h._j(i)) {
                        let l = j.isProtected && j.hasPassword ? g : h;
                        l.add(j);
                        break;
                    }
                }
            }
            if (h.count > 0 || g.count > 0) {
                let m = new LockedEditRangeInfoForCellRange_WithRanges(a, g, h);
                return m;
            }
        }
        return a == null ? LockedEditRangeInfoForCellRange_WithoutRanges.g : new LockedEditRangeInfoForCellRange_WithoutRanges(a);
    }
    e(a, b) {
        return false;
    }
}
LockedEditRangeInfoForCellRange.$t = markType(LockedEditRangeInfoForCellRange, 'LockedEditRangeInfoForCellRange');
/**
 * @hidden
 */
export class LockedEditRangeInfoForCellRange_WithRanges extends LockedEditRangeInfoForCellRange {
    constructor(a, b, c) {
        super();
        this.h = null;
        this.j = null;
        this.g = null;
        this.i = null;
        a.j(b);
        a.j(c);
        this.g = a;
        this.j = LockedEditRangeInfoForCellRange_WithRanges.k(c);
        this.h = LockedEditRangeInfoForCellRange_WithRanges.k(b);
    }
    f(a, b) {
        if (this.i == null) {
            this.i = new List$1(IntRange.$, 0);
        }
        this.i.add(new IntRange(1, a, b));
    }
    c(a, b) {
        if (this.j != null) {
            for (let c of fromEnum(this.j)) {
                if (c._contains2(a, b)) {
                    return true;
                }
            }
        }
        if (this.h != null) {
            for (let d of fromEnum(this.h)) {
                if (d._contains2(a, b)) {
                    return this.g.e(a, b);
                }
            }
        }
        this.g.k();
        return false;
    }
    d(a, b) {
        if (this.i != null) {
            for (let c of fromEnum(this.i)) {
                for (let d = c._i; d <= c._h; d++) {
                    for (let e = a; e <= b; e++) {
                        if (!this.c(d, e)) {
                            return false;
                        }
                    }
                }
            }
        }
        return true;
    }
    static k(a) {
        if (a != null && a.count != 0) {
            let b = new List$1(SpreadsheetCellRange.$, 0);
            for (let c of fromEnum(a)) {
                for (let d of fromEnum(c.ranges)) {
                    b.add(SpreadsheetUtilities.z(d._h));
                }
            }
            for (let e = b.count - 1; e >= 1; e--) {
                let f = b._inner[e];
                for (let g = e - 1; g >= 0; g--) {
                    let h = b._inner[g];
                    if (h._contains1(f) || SpreadsheetCellRange.l_op_Equality(h, f)) {
                        b.removeAt(e);
                        break;
                    }
                    else if (f._contains1(h)) {
                        b.removeAt(g);
                        e--;
                    }
                }
            }
            if (b.count > 0) {
                return b;
            }
        }
        return null;
    }
    e(a, b) {
        if (this.j != null) {
            for (let c of fromEnum(this.j)) {
                if (c._contains2(a, b)) {
                    return true;
                }
            }
        }
        return false;
    }
}
LockedEditRangeInfoForCellRange_WithRanges.$t = markType(LockedEditRangeInfoForCellRange_WithRanges, 'LockedEditRangeInfoForCellRange_WithRanges', LockedEditRangeInfoForCellRange.$);
/**
 * @hidden
 */
export class LockedEditRangeInfoForCellRange_WithoutRanges extends LockedEditRangeInfoForCellRange {
    constructor(a) {
        super();
        this.h = null;
        this.h = a;
    }
    c(a, b) {
        if (this.h != null) {
            this.h.k();
        }
        return false;
    }
    d(a, b) {
        if (this.h != null) {
            this.h.k();
        }
        return false;
    }
    b(a, b, c) {
        if (this.h != null) {
            this.h.k();
        }
        return false;
    }
}
LockedEditRangeInfoForCellRange_WithoutRanges.$t = markType(LockedEditRangeInfoForCellRange_WithoutRanges, 'LockedEditRangeInfoForCellRange_WithoutRanges', LockedEditRangeInfoForCellRange.$);
LockedEditRangeInfoForCellRange_WithoutRanges.g = new LockedEditRangeInfoForCellRange_WithoutRanges(null);
/**
 * @hidden
 */
export class SpreadsheetEditHelper extends Base {
    constructor(a, b, c, d, e, f, g) {
        super();
        this.m = false;
        this.z = 0;
        this.j = null;
        this.i = null;
        this.k = null;
        this.a = null;
        this.c = new SpreadsheetCell();
        this.y = null;
        this.x = null;
        CoreUtilities.z(a, "sheetManager");
        CoreUtilities.z(b, "editPane");
        CoreUtilities.z(f, "promptCallback");
        CoreUtilities.z(g, "executeInUndo");
        this.j = a;
        this.i = b;
        this.a = Enumerable.a(Worksheet.$, Enumerable.o(SpreadsheetTabInfo.$, Worksheet.$, this.j._a3._j, (h) => h._j));
        this.c = c;
        this.k = a._bc.workbook;
        this.y = f;
        this.m = d;
        this.z = e;
        this.x = g;
    }
    static ad(a, b, c, d, e) {
        e = -1;
        let f = b.unformattedText;
        let g = a.g;
        let h = b.editCellFormat._dg;
        let i = new ValueFormatter(1, h, g, null);
        let j = false;
        let k = false;
        if (i.o) {
            k = i.k(0);
            for (let l = 0; l < 4; l++) {
                if (i.m(l)) {
                    j = true;
                    break;
                }
            }
        }
        let m = WorksheetCellBlock.q(h);
        if (stringIsNullOrEmpty(f)) {
            return {
                ret: null,
                p4: e
            };
        }
        else if (stringIsNullOrWhiteSpace(f) || (j == false && m == false && i.j())) {
        }
        else if (f.length > 1 && stringStartsWith(f, "=")) {
            let n = SpreadsheetEditHelper.ac(a, c, f);
            if (typeCast(Formula.$, n) !== null || d == false) {
                return {
                    ret: n,
                    p4: e
                };
            }
        }
        else if (f.indexOf('\r') >= 0 || f.indexOf('\n') >= 0) {
        }
        else if (stringCompare1("true", f, 3) == 0) {
            return {
                ret: SpreadsheetEditHelper.ae,
                p4: e
            };
        }
        else if (stringCompare1("false", f, 3) == 0) {
            return {
                ret: SpreadsheetEditHelper.ab,
                p4: e
            };
        }
        else {
            if (stringStartsWith(f, "#")) {
                let o = FormulaParser.b(f, g);
                if (o != null) {
                    if (ErrorValue.circularity != o) {
                        return {
                            ret: o,
                            p4: e
                        };
                    }
                    return {
                        ret: b,
                        p4: e
                    };
                }
            }
            let p;
            let q;
            let r = false;
            if (m || k) {
                if (!r && ((() => { let s = SpreadsheetEditHelper.t(f, true, a, p, e, r); p = s.p3; e = s.p4; r = s.p5; return s.ret; })())) {
                    return {
                        ret: p,
                        p4: e
                    };
                }
                if (!r && ((() => { let s = SpreadsheetEditHelper.r(f, a, q, e); q = s.p2; e = s.p3; return s.ret; })())) {
                    return {
                        ret: q,
                        p4: e
                    };
                }
            }
            else {
                if (!r && ((() => { let s = SpreadsheetEditHelper.t(f, false, a, p, e, r); p = s.p3; e = s.p4; r = s.p5; return s.ret; })())) {
                    return {
                        ret: p,
                        p4: e
                    };
                }
                if (!r && ((() => { let s = SpreadsheetEditHelper.r(f, a, q, e); q = s.p2; e = s.p3; return s.ret; })())) {
                    return {
                        ret: q,
                        p4: e
                    };
                }
            }
            let s = 0;
            if (!r && ((() => { let t = SpreadsheetEditHelper.w(f, a, s, e); s = t.p2; e = t.p3; return t.ret; })())) {
                return {
                    ret: ExcelCalcValue._ay(s, true),
                    p4: e
                };
            }
            if (!r) {
                if (((() => { let t = SpreadsheetEditHelper.v(f, a, p, e); p = t.p2; e = t.p3; return t.ret; })())) {
                    return {
                        ret: p,
                        p4: e
                    };
                }
                if (((() => { let t = SpreadsheetEditHelper.s(f, a, p, e); p = t.p2; e = t.p3; return t.ret; })())) {
                    return {
                        ret: p,
                        p4: e
                    };
                }
                if (((() => { let t = SpreadsheetEditHelper.q(f, a, p, e, r); p = t.p2; e = t.p3; r = t.p4; return t.ret; })())) {
                    return {
                        ret: p,
                        p4: e
                    };
                }
                let t = a.f ? a.j : 0;
                if (!r && ((() => { let u = SpreadsheetEditHelper.u(f, a, t, p, e); p = u.p3; e = u.p4; return u.ret; })())) {
                    return {
                        ret: p,
                        p4: e
                    };
                }
            }
            if (f.length > 1 && (stringStartsWith(f, "-") || stringStartsWith(f, "+"))) {
                let u = SpreadsheetEditHelper.ac(a, c, "=" + f);
                if (typeCast(Formula.$, u) !== null || d == false) {
                    return {
                        ret: u,
                        p4: e
                    };
                }
            }
        }
        return {
            ret: b,
            p4: e
        };
    }
    e(a, b, c, d, e) {
        if (a == 0) {
            return 0;
        }
        let f;
        let g = ((() => { let h = SpreadsheetEditHelper.ad(new ParseEditValueCache(this), b, a == 3, false, f); f = h.p4; return h.ret; })());
        let h = false;
        if (g == b) {
            let i = SpreadsheetEditHelper.d(b, this.k, e);
            if (i != null && stringContains(i.c, "\n")) {
                h = true;
            }
            g = i;
        }
        let j = b.editCellFormat;
        let k = this.c;
        if (typeCast(SpreadsheetUserPromptInfo.$, g) !== null) {
            let l = typeCast(SpreadsheetUserPromptInfo.$, g);
            this.y(l);
            return 1;
        }
        let m = this.i._ag;
        let n = this.j;
        let o = Enumerable.a(SpreadsheetCellRange.$, m.cellRanges);
        let p = o;
        let q;
        let r = nullableNotEquals(n._en(), false);
        let s = r ? new LockedEditRangeInfoForOperation() : null;
        let t = new HashSet$1(IRegionBlockingValue_$type, 0);
        if (typeCast(ArrayFormula.$, g) !== null) {
            let u = m._s();
            let v = typeCast(ArrayFormula.$, g);
            let w = new List$1(WorksheetRegion.$, 0);
            if (n._bq(u) == false) {
                q = 1;
            }
            else {
                if (s != null && !((() => { let x = n._c7(s, boxArray$1([u]), c, q); q = x.p3; return x.ret; })())) {
                    return q;
                }
                for (let x of fromEnum(n._a3._j)) {
                    w.add(x._j._cx(u.firstRow, u.firstColumn, u.lastRow, u.lastColumn));
                }
                q = this.g(w.toArray(), c, t);
            }
            if (q == 2) {
                q = this.h([u]);
            }
            if (q != 2) {
                return q;
            }
            let y = false;
            let z = this.aj(s, t, y);
            y = z.p2;
            return this.f(p, d, () => {
                for (let aa = 0; aa < w.count; aa++) {
                    let ab = aa == 0 ? v : v._g();
                    ab._applyTo3(w._inner[aa]);
                }
                return 2;
            });
        }
        let aa = a == 1;
        let ab;
        switch (a) {
            case 3:
                ab = [m._s()];
                break;
            case 1:
                ab = [new SpreadsheetCellRange(k.row, k.column)];
                break;
            default:
                ab = o;
                break;
        }
        if (s != null && !((() => { let ac = n._c7(s, boxArray$1(ab), c, q); q = ac.p3; return ac.ret; })())) {
            return q;
        }
        q = this.h(ab);
        if (q != 2) {
            return q;
        }
        if (g == null) {
            let ac = () => n._ak(2, c, ab, s);
            return this.x(0, ac, stringEmpty(), p);
        }
        let ad = new List$1(WorksheetRegion.$, 0);
        let ae = new Dictionary$2(Worksheet.$, Array_$type, 0);
        for (let af of fromEnum(n._a3._j)) {
            ad.o(ae.item(af._j, SpreadsheetUtilities.f(af._j, boxArray$1(ab))));
        }
        let ag = ad.toArray();
        q = this.g(Enumerable.a(WorksheetRegion.$, ag), c, t);
        if (q != 2) {
            return q;
        }
        let ah = false;
        let ai = Enumerable.a(Worksheet.$, Enumerable.o(SpreadsheetTabInfo.$, Worksheet.$, n._a3._j, (aj) => aj._j));
        let aj;
        if (a == 1) {
            aj = [new WorksheetRegionAddress(1, k.row, k.row, k.column, k.column)];
        }
        else {
            aj = SpreadsheetUtilities.h(boxArray$1(p));
        }
        let ak = null;
        if (typeCast(Formula.$, g) !== null) {
            let al = this.aj(s, t, ah);
            ah = al.p2;
            let am = typeCast(Formula.$, g);
            let an = k.column;
            if (f == -1) {
                f = SpreadsheetEditHelper.aa(am, this.j._bc, k.row, k.column);
            }
            q = this.f(p, d, () => {
                TableExpansionInfo.f(ai, aj, SpreadsheetUtilities.aw(k));
                ak = TableExpansionInfo.a(ai, aj);
                for (let ao of fromEnum(ae)) {
                    let ap = ao.key;
                    let aq = ap._rows$i.item(k.row);
                    let ar = a == 2;
                    if (s != null && ap.isProtected && ap == n._bc) {
                        let au = ao.value;
                        for (let at = 0; at < au.length; at++) {
                            let as = au[at];
                            let av = s.a(ap);
                            let aw = as._h;
                            if (SpreadsheetPaneManager._cp(ap, aw._ac, aw._w, aw._ae, aw._x, av)) {
                                SpreadsheetEditHelper.ag(am, ar ? [as] : null, aq, an, f);
                            }
                            else {
                                ah = true;
                                let ax = LockedEditRangeInfoForCellRange.a(av, aw._ac, aw._w, aw._ae, aw._x);
                                for (let ay of fromEnum(SpreadsheetPaneManager._dd(ao.key, [SpreadsheetUtilities.z(aw)]))) {
                                    let az = ap._rows$i.item(ay.row);
                                    let a0 = ap._b4(az, ay.column);
                                    if (nullableEquals(a0._c5, false) || ax.e(ay.row, ay.column)) {
                                        SpreadsheetEditHelper.ah(am, az, ay.column, aq, an, f);
                                    }
                                }
                            }
                        }
                    }
                    else {
                        SpreadsheetEditHelper.ag(am, ar ? ao.value : null, aq, an, f);
                    }
                }
                SpreadsheetUtilities.e1(ae);
                return 2;
            });
            if (q == 2) {
                if (ak != null) {
                    this.x(46, () => {
                        ak.g();
                        return 2;
                    }, null, null);
                }
                if (a == 1) {
                }
                if (ah) {
                    this.y(new SpreadsheetUserPromptInfo(23, null, null, null, false));
                }
            }
            return q;
        }
        try {
            WorksheetCellBlock.ax(g);
            WorksheetCellBlock.a0(g);
        }
        catch (ao) {
            let ap = new SpreadsheetUserPromptInfo(2, null, ao, null, c);
            if (this.y(ap) == false) {
                return 1;
            }
            return 0;
        }
        let aq = this.aj(s, t, ah);
        ah = aq.p2;
        let ar = null;
        if (n._a3._j.count == 1) {
            let as = n._a3._j.item(0)._j;
            if (as.isProtected == false || as.protection.allowInsertingHyperlinks) {
                ar = as;
            }
        }
        q = this.f(p, d, () => {
            TableExpansionInfo.f(ai, aj, SpreadsheetUtilities.aw(k));
            ak = TableExpansionInfo.a(ai, aj);
            for (let at of fromEnum(n._a3._j)) {
                let au = at._j;
                if (a == 1) {
                    let av = au._rows$i.item(k.row);
                    let aw = av._getCellValue1(k.column);
                    SpreadsheetEditHelper.ak(av, k.column, j, g, f, h);
                    if (aw == null && n._a3._j.count == 1 && f == -1 && WorksheetCellBlock.q(j._dg)) {
                        let ax = ExcelUtils.ba(g);
                        if (ax || typeof g === 'string') {
                            let ay = new List$1(ConditionBase.$, 0);
                            au._conditionalFormats$i._ad(ay, k.row, k.column, ax);
                        }
                    }
                }
                else {
                    let az = s != null && au.isProtected && au == n._bc ? s.a(au) : null;
                    let a0 = -1;
                    let a1 = null;
                    let a2 = null;
                    let a3 = az != null ? (a4) => a2 = LockedEditRangeInfoForCellRange.a(az, a4.firstRow, a4.firstColumn, a4.lastRow, a4.lastColumn) : null;
                    let a4 = SpreadsheetPaneManager._dd(au, ab, a3);
                    let a5 = null;
                    let a6 = typeCast(SpreadsheetEditHelper_TextChangeWithOptions.$, g);
                    let a7 = null;
                    let a8 = null;
                    let a9 = null;
                    let ba = false;
                    let bb = null;
                    let bc = null;
                    SpreadsheetEditHelper.ak(au._rows$i.item(k.row), k.column, j, g, f, h);
                    if (a6 != null) {
                        a1 = au._rows$i.item(k.row);
                        let bd = a1._getResolvedCellFormat1(k.column);
                        a8 = au._b4(a1, k.column);
                        ba = (a8.formatOptions & 4) != 0;
                        bb = bd.style;
                        bc = new ResolvedWorksheetCellFormatDataFont(a8);
                        a7 = new WorkbookFontData(0, au.workbook);
                        a7.setFontFormatting(bd.font);
                        a9 = typeCast(FormattedString.$, a1._getCellValue1(k.column));
                    }
                    let be = SpreadsheetUtilities.p(f);
                    let bf = f != -1 ? au.workbook._b2.item(f) : null;
                    let bg = SpreadsheetEditHelper.p(be);
                    for (let bh of fromEnum(a4)) {
                        if (bh.row != a0) {
                            a0 = bh.row;
                            a1 = au._rows$i.item(a0);
                        }
                        if (bg || a2 != null) {
                            a5 = au._b4(a1, bh.column);
                            if (a2 != null && nullableEquals(a5._c5, true) && a2.e(a0, bh.column) == false) {
                                ah = true;
                                continue;
                            }
                            let bi = SpreadsheetUtilities.p(a5._cs);
                            if (bi != be && !SpreadsheetEditHelper.o(bi)) {
                                a1.getCellFormat(bh.column).formatString = bf;
                            }
                        }
                        if (a7 != null) {
                            if (bg == false) {
                                a5 = au._b4(a1, bh.column);
                            }
                            if (Base.referenceEquals(a5, a8) == false) {
                                let bj;
                                if (ba == false && (a5.formatOptions & 4) == 0) {
                                    bj = bb != a5.style && Base.referenceEquals(bb._i._bp.d, a5.style._i._bp.d) == false;
                                }
                                else {
                                    if (ba == false && (bb == a5.style || Base.referenceEquals(bb._i._bp.d, a5.style._i._bp.d))) {
                                        a1._bc(bh.column).formatOptions &= ~4;
                                        bj = false;
                                    }
                                    else {
                                        bc._b(a5);
                                        bj = WorkbookFontProxy._l(a7, bc) != 0;
                                    }
                                }
                                if (bj) {
                                    a1._bc(bh.column).font.setFontFormatting(a7);
                                }
                            }
                        }
                        let bk;
                        if (a6 == null) {
                            bk = g;
                        }
                        else if (a9 == null) {
                            bk = a6.c;
                        }
                        else {
                            bk = a9.clone();
                        }
                        a1.setCellValue(bh.column, bk);
                        if (h) {
                            a1.getCellFormat(bh.column)._wrapText$i = Nullable$1.toNullable(Boolean_$type, true);
                        }
                    }
                }
            }
            SpreadsheetUtilities.e1(ae);
            return 2;
        });
        if (q == 2) {
            if (ak != null) {
                this.x(46, () => {
                    ak.g();
                    return 2;
                }, null, null);
            }
            if (ah) {
                this.y(new SpreadsheetUserPromptInfo(23, null, null, null, false));
            }
            else if (ar != null) {
                let at = ar._rows$i.item(k.row);
                let au = at._c6(k.column);
                if (typeCast(StringElement.$, au) !== null || typeCast(FormattedString.$, au) !== null) {
                    let av = typeCast(FormattedString.$, au) !== null ? au.unformattedString : au._y;
                    let aw = null;
                    let ax = null;
                    if (SpreadsheetUtilities.bd(av)) {
                        let ay = SpreadsheetEditHelper.l(at, k.column);
                        if (ay == null || ay.isSealed) {
                            let az = at.getCellAssociatedMergedCellsRegion(k.column);
                            if (az != null) {
                                aw = new WorksheetHyperlink(ar._cw(az._h), av, null, null);
                            }
                            else {
                                aw = new WorksheetHyperlink(at._cells$i.item(k.column), av, null, null);
                            }
                        }
                        else {
                            ax = ay;
                        }
                        this.x(31, () => {
                            if (aw != null) {
                                ar._hyperlinks$i.add(aw);
                            }
                            else if (ax != null) {
                                ax.targetAddress = av;
                            }
                            if (typeCast(FormattedStringElement.$, au) !== null || typeCast(FormattedString.$, au) !== null) {
                                at.setCellValue(k.column, av);
                            }
                            return 2;
                        }, null, null);
                    }
                }
            }
        }
        return q;
    }
    static ak(a, b, c, d, e, f) {
        let g = typeCast(SpreadsheetEditHelper_TextChangeWithOptions.$, d);
        if (g != null) {
            g.e(a, b);
        }
        if (e != -1) {
            SpreadsheetEditHelper.ai(a, b, e, c);
        }
        if (g != null) {
            if (g.a == null) {
                d = g.c;
            }
            else {
                d = new FormattedString(g.c);
            }
        }
        a.setCellValue(b, d);
        if (g != null && g.a != null) {
            g.f(typeCast(FormattedString.$, d));
        }
        if (f) {
            a.getCellFormat(b)._wrapText$i = Nullable$1.toNullable(Boolean_$type, true);
        }
    }
    static ag(a, b, c, d, e) {
        let f = a._ab == null ? a : a._g();
        if (b != null) {
            f._bm(b, c, d, 1);
            if (e != -1) {
                for (let g = 0; g < b.length; g++) {
                    let h = b[g]._h;
                    let i = b[g].worksheet;
                    for (let j = h._ac; j <= h._ae; j++) {
                        let k = i._rows$i.item(j);
                        for (let l = h._w; l <= h._x; l++) {
                            SpreadsheetEditHelper.ai(k, l, e, i._b4(k, l));
                        }
                    }
                }
            }
        }
        else {
            f._bp(c, d, 1);
            if (e != -1) {
                SpreadsheetEditHelper.ai(c, d, e, c.worksheet._b4(c, d));
            }
        }
    }
    static ah(a, b, c, d, e, f) {
        let g = a._ab == null ? a : a._g();
        g._bq(d, e, b, c, 1);
        if (f != -1) {
            SpreadsheetEditHelper.ai(b, c, f, d.worksheet._b4(b, c));
        }
    }
    static ai(a, b, c, d) {
        let e = WorksheetCellBlock.q(d._dg);
        let f = a.worksheet.workbook._b2.item(c);
        if (!e) {
            let g = SpreadsheetUtilities.p(c);
            let h = SpreadsheetUtilities.p(d._cs);
            if (SpreadsheetEditHelper.p(g) && !SpreadsheetEditHelper.o(h) && g != h) {
                e = true;
            }
        }
        if (e) {
            let i = a.getCellFormat(b);
            i.formatString = f;
        }
    }
    static n(a, b, c) {
        let d = c == 0 || c == 2;
        let e = a.indexOf(b);
        let f = indexOfAny(a, SpreadsheetEditHelper.b);
        if (f >= 0 && e >= 0) {
            if (d && e > f) {
                return false;
            }
            else if (!d && e < f) {
                return false;
            }
        }
        return true;
    }
    static l(a, b) {
        let c = a._bi(b);
        if (c == null) {
            let d = a.worksheet;
            let e = d._cr(a.index, b);
            let f = e != null;
            let g = e != null ? e._h : new WorksheetRegionAddress(1, a.index, a.index, b, b);
            for (let h of fromEnum(d._hyperlinks$i)) {
                let i = h.sourceRegion._h;
                if (WorksheetRegionAddress._o(g, i) || (f && g._h(i))) {
                    c = h;
                    break;
                }
            }
        }
        return c;
    }
    static ac(a, b, c, d = true) {
        let e = a.a;
        let f = a.g;
        let g;
        if (b) {
            let h;
            if (((() => { let i = ArrayFormula._cs(c, e.cellReferenceMode, e.currentFormat, f, h, g); h = i.p4; g = i.p5; return i.ret; })())) {
                return h;
            }
        }
        else {
            let i;
            if (((() => { let j = Formula._a4(c, e.cellReferenceMode, e.currentFormat, f, i, g); i = j.p4; g = j.p5; return j.ret; })())) {
                return i;
            }
        }
        if (d && c.indexOf(')') < 0) {
            let j = typeCast(Formula.$, SpreadsheetEditHelper.ac(a, b, c + ")", false));
            if (j != null) {
                return j;
            }
        }
        return new SpreadsheetUserPromptInfo(1, null, g, null, false);
    }
    static aa(a, b, c, d) {
        let e = 14;
        let f = 0;
        let g = new Stack$1(Number_$type);
        let h = new FormulaContext(4, b, c, d, b._o, a, b._y, b._c);
        let k = a._e;
        for (let j = 0; j < k.length; j++) {
            let i = k[j];
            let l = -1;
            let m = 0;
            let n = null;
            let o = typeCast(IFunctionToken_$type, i);
            if (o != null) {
                n = o.$function;
                m = o.argumentCount;
            }
            else if (typeCast(UnaryOperatorToken.$, i) !== null) {
                m = 1;
            }
            else if (typeCast(BinaryOperatorToken.$, i) !== null) {
                m = 2;
            }
            if (m > 0) {
                for (let p = 0; p < m; p++) {
                    let q = g.e();
                    if (q != -1) {
                        l = q;
                    }
                }
                if (n != null) {
                    let r = n._alx;
                    if (stringEquals1("DATE", r, 1)) {
                        f++;
                        l = e;
                    }
                    else if (stringEquals1("TIME", r, 1)) {
                        l = 18;
                    }
                    else if (n._qp) {
                        l = -1;
                    }
                }
            }
            else {
                let s = typeCast(RefToken.$, i);
                let t = -1;
                let u = -1;
                if (s != null) {
                    let v = s.y.e(h, s.v);
                    t = v.o;
                    u = v.m;
                }
                else {
                    let w = typeCast(AreaToken.$, i);
                    if (w != null) {
                        let x = w.x.k(h, w.v);
                        t = x._ac;
                        u = x._w;
                    }
                }
                if (t >= 0) {
                    let y = b._rows$i._aj(t);
                    let z = b._b4(y, u);
                    if (z._cs != 0) {
                        l = z._cs;
                        if (l == e) {
                            f++;
                        }
                    }
                }
                else if (i.h == 255) {
                    continue;
                }
            }
            g.h(l);
        }
        if (g.f > 0) {
            let aa = g.e();
            if (aa != e || f < 2) {
                return aa;
            }
        }
        return -1;
    }
    static d(a, b, c) {
        let d = a.createDocument();
        if (d != null) {
            let e = new ResolvedWorksheetCellFormatDataFont(a.editCellFormat);
            let f = new IGFormattedTextSettings();
            SpreadsheetUtilities.d9(f, e);
            d.a._aa(f);
            d.p();
        }
        if (d != null && d.c()) {
            if (c) {
                SpreadsheetUtilities.ed(b, d, 9, 8);
            }
            let g = d.a;
            let h = d.g();
            if (h == null || h.equals(g)) {
            }
            else {
                let i = g._b;
                let j = h._b;
                h._z(g);
                d.o();
                let k = d.i.toString();
                if (i != j) {
                    return new SpreadsheetEditHelper_TextChangeWithOptions(k, h, d);
                }
                return new SpreadsheetEditHelper_TextChangeWithOptions(k, h, null);
            }
        }
        return new SpreadsheetEditHelper_TextChangeWithOptions(a.unformattedText, new IGFormattedTextSettings(), null);
    }
    aj(a, b, c) {
        for (let d of fromEnum(b)) {
            if (a != null) {
                let e = d.blockedRegion.worksheet;
                if (e.isProtected) {
                    let f = a.a(e);
                    let g = d.blockedRegion._h;
                    if (SpreadsheetPaneManager._cp(e, g._ac, g._w, g._ae, g._x, f) == false) {
                        c = true;
                        continue;
                    }
                }
            }
            d.removeFromRegion();
        }
        return {
            p2: c
        };
    }
    static o(a) {
        switch (a) {
            case 3:
            case 2:
            case 4:
            case 7:
            case 6:
            case 8:
            case 5:
            case 0:
            case 9: return false;
            case 10:
            case 1: return true;
            default: return true;
        }
    }
    static p(a) {
        switch (a) {
            case 3:
            case 2:
            case 4:
            case 7:
            case 6:
            case 8:
            case 5:
            case 0: return true;
            case 10:
            case 1:
            case 9: return false;
            default: return false;
        }
    }
    static q(a, b, c, d, e) {
        let f = b.g;
        if (f == null) {
            f = CultureInfo.currentCulture;
        }
        e = false;
        let g = typeCast(NumberFormatInfo.$, f.getFormat(NumberFormatInfo.$));
        let h = g.currencySymbol;
        if (stringContains(a, h)) {
            let i = 4 | 1 | 16 | 64 | 2 | 256;
            if (((() => { let j = tryParseNumber1(a, i, f, c); c = j.p3; return j.ret; })())) {
                if (SpreadsheetEditHelper.n(a, h, b.i) && !b.e(a)) {
                    d = 6;
                    return {
                        ret: true,
                        p2: c,
                        p3: d,
                        p4: e
                    };
                }
                else {
                    e = true;
                }
            }
            else {
                let j = i | 32;
                if (SpreadsheetEditHelper.n(a, h, b.i) && !b.e(a)) {
                    if (((() => { let k = tryParseNumber1(a, j, f, c); c = k.p3; return k.ret; })())) {
                        d = 8;
                        return {
                            ret: true,
                            p2: c,
                            p3: d,
                            p4: e
                        };
                    }
                }
                else {
                    e = true;
                }
            }
        }
        c = NaN;
        d = -1;
        return {
            ret: false,
            p2: c,
            p3: d,
            p4: e
        };
    }
    static r(a, b, c, d) {
        d = -1;
        if (a != null && a.length > 0 && !/\s/i.test(a.charAt(0))) {
            let e = b.g;
            let f = b.a;
            if (e == null) {
                e = CultureInfo.currentCulture;
            }
            let g;
            let h;
            if (((() => { let i = dateTryParse(a, h); h = i.p1; return i.ret; })())) {
                g = true;
            }
            else if (a != null && a.length < 3) {
                g = false;
            }
            else {
                let i;
                let j;
                let k = b.f ? b.j : 0;
                if (((() => { let l = SpreadsheetEditHelper.u(a, b, k, i, j); i = l.p3; j = l.p4; return l.ret; })())) {
                    g = false;
                }
                else {
                    let l = SpreadsheetUtilities.ds(dateMinValue(), f) + " " + a;
                    g = ((() => { let m = dateTryParse(l, h); h = m.p1; return m.ret; })());
                }
            }
            if (g) {
                let m = typeCast(DateTimeFormat.$, e.getFormat(DateTimeFormat.$));
                let n = true;
                if (+(dateGetDate(h)) == +(dateMinValue())) {
                    c = ExcelCalcValue._ay(dateGetTimeOfDay(h));
                }
                else if (h > dateMaxValue()) {
                    c = null;
                }
                else {
                    c = unwrapNullable(ExcelCalcValue._dateTimeToExcelDate(f, h));
                }
                if (c == null) {
                    n = false;
                }
                else if (m != null) {
                    let o = m.dateSeparator;
                    let p = m.timeSeparator;
                    let q = stringIsNullOrWhiteSpace(o) || stringContains(a, o);
                    let r = stringIsNullOrWhiteSpace(p) || stringContains(a, p);
                    if ((r || q) && !b.c(a)) {
                        let s = b.n;
                        let t = b.o;
                        let u = (!stringIsNullOrWhiteSpace(s) && SpreadsheetUtilities.a7(e, a, s)) || (!stringIsNullOrWhiteSpace(t) && SpreadsheetUtilities.a7(e, a, t));
                        let v = 0;
                        let w = a.indexOf(p, 0);
                        while (w >= 0) {
                            v++;
                            w = w < a.length ? a.indexOf(p, w + 1) : -1;
                        }
                        if (+(dateGetDate(h)) == +(dateMinValue())) {
                            if (u) {
                                d = v > 1 ? 19 : 18;
                            }
                            else {
                                d = v > 1 ? 21 : 20;
                            }
                        }
                        else {
                            if (u || v > 0) {
                                d = 22;
                            }
                            else {
                                d = 14;
                            }
                        }
                    }
                    else {
                        n = false;
                    }
                }
                if (n) {
                    return {
                        ret: true,
                        p2: c,
                        p3: d
                    };
                }
            }
        }
        c = null;
        return {
            ret: false,
            p2: c,
            p3: d
        };
    }
    static s(a, b, c, d) {
        let e = b.g;
        let f;
        f = a.indexOf('E');
        if (f < 0) {
            f = a.indexOf('e');
        }
        if (f >= 0) {
            if (e == null) {
                e = CultureInfo.currentCulture;
            }
            let g = 128 | 16 | 64 | 32 | 4 | 1 | 2;
            if (((() => { let h = tryParseNumber1(a, g, e, c); c = h.p3; return h.ret; })()) && !b.e(a)) {
                d = 11;
                return {
                    ret: true,
                    p2: c,
                    p3: d
                };
            }
        }
        d = -1;
        c = NaN;
        return {
            ret: false,
            p2: c,
            p3: d
        };
    }
    static t(a, b, c, d, e, f) {
        f = false;
        if (a != null) {
            let g = 1;
            let h = 2;
            let i = 3;
            let j = 4;
            if (SpreadsheetEditHelper.af == null) {
                SpreadsheetEditHelper.af = new Regex(0, "^(\\+|-)?\\s*(\\S+\\s+)?(\\d+)/(\\d+)\\s*$");
            }
            let k = SpreadsheetEditHelper.af.i(a);
            if (k.i) {
                if (b == false || k.m.item(h).d > 0) {
                    let l = c.g;
                    if (l == null) {
                        l = CultureInfo.currentCulture;
                    }
                    let m = k.m.item(h).g != null ? k.m.item(h).g : stringEmpty();
                    let n = 0;
                    if (stringIsNullOrEmpty(m) || (((() => { let o = tryParseInt32_2(k.m.item(h).g, 64 | 2, l, n); n = o.p3; return o.ret; })()) && !c.e(k.m.item(h).g))) {
                        let o, p;
                        if (((() => { let q = tryParseInt32_2(k.m.item(i).g, 1, l, o); o = q.p3; return q.ret; })()) && ((() => { let q = tryParseInt32_2(k.m.item(j).g, 1, l, p); p = q.p3; return q.ret; })()) && o <= 32767 && p <= 32767 && p != 0) {
                            d = n + o / p;
                            if (k.m.item(g).g == "-") {
                                d = -d;
                            }
                            let q = 0;
                            for (let r = m.length - 1; r >= 0; r--) {
                                if (/\s/i.test(m.charAt(r))) {
                                    q++;
                                }
                                else {
                                    break;
                                }
                            }
                            if (q > 1) {
                                f = true;
                            }
                            else {
                                e = p < 10 ? 12 : 13;
                                return {
                                    ret: true,
                                    p3: d,
                                    p4: e,
                                    p5: f
                                };
                            }
                        }
                    }
                }
            }
        }
        e = -1;
        d = NaN;
        return {
            ret: false,
            p3: d,
            p4: e,
            p5: f
        };
    }
    static u(a, b, c, d, e) {
        let f = b.g;
        e = -1;
        if (f == null) {
            f = CultureInfo.currentCulture;
        }
        let g = 4 | 1 | 16 | 64 | 2;
        if (c != 0) {
            if (((() => { let h = tryParseNumber1(a, g, f, d); d = h.p3; return h.ret; })())) {
                if (b.e(a)) {
                    return {
                        ret: false,
                        p3: d,
                        p4: e
                    };
                }
                d *= Math.pow(10, -c);
                return {
                    ret: true,
                    p3: d,
                    p4: e
                };
            }
        }
        let h = g | 32;
        if (((() => { let i = tryParseNumber1(a, h, f, d); d = i.p3; return i.ret; })())) {
            if (b.e(a)) {
                return {
                    ret: false,
                    p3: d,
                    p4: e
                };
            }
            return {
                ret: true,
                p3: d,
                p4: e
            };
        }
        return {
            ret: false,
            p3: d,
            p4: e
        };
    }
    static v(a, b, c, d) {
        let e = b.g;
        if (e == null) {
            e = CultureInfo.currentCulture;
        }
        let f = typeCast(NumberFormatInfo.$, e.getFormat(NumberFormatInfo.$));
        let g = f.percentSymbol;
        if (!stringIsNullOrWhiteSpace(g)) {
            a = a.trim();
            let h = a.indexOf(g);
            let i;
            if (h < 0 || a.length == 1) {
                i = false;
            }
            else if (h == a.length - 1) {
                i = true;
            }
            else if (a.indexOf(g, h + 1) != -1) {
                i = false;
            }
            else if (h == 0) {
                i = true;
            }
            else {
                if (!stringIsNullOrWhiteSpace(f.currencySymbol) && a.indexOf(f.currencySymbol) >= 0) {
                    i = false;
                }
                else {
                    let j = false;
                    let k = false;
                    for (let l = 0; l < h; l++) {
                        let m = a.charAt(l);
                        if (m != '(' && !/\s/i.test(m)) {
                            j = true;
                            break;
                        }
                    }
                    for (let n = h + g.length; n < a.length; n++) {
                        let o = a.charAt(n);
                        if (o != ')' && !/\s/i.test(o)) {
                            k = true;
                            break;
                        }
                    }
                    i = j != k;
                }
            }
            if (i) {
                let p = stringReplace(a, g, "");
                let q = 16 | 64 | 4 | 1 | 2;
                if (((() => { let r = tryParseNumber1(p, q, e, c); c = r.p3; return r.ret; })()) && !b.e(p)) {
                    d = 9;
                    c = c / 100;
                    return {
                        ret: true,
                        p2: c,
                        p3: d
                    };
                }
                let r = q | 32;
                if (((() => { let s = tryParseNumber1(p, r, e, c); c = s.p3; return s.ret; })()) && !b.e(p)) {
                    d = 10;
                    c = c / 100;
                    return {
                        ret: true,
                        p2: c,
                        p3: d
                    };
                }
            }
        }
        d = -1;
        c = NaN;
        return {
            ret: false,
            p2: c,
            p3: d
        };
    }
    static w(a, b, c, d) {
        let e = b.g;
        if (e == null) {
            e = CultureInfo.currentCulture;
        }
        let f = typeCast(DateTimeFormat.$, e.getFormat(DateTimeFormat.$));
        if (f != null) {
            let g = f.timeSeparator;
            if (stringContains(a, g)) {
                let h = stringSplit(a, [g], 1);
                if (h != null && h.length > 1 && h.length <= 3) {
                    let i, j, k;
                    i = j = k = 0;
                    let l = 2;
                    let m = 1 | 2;
                    let n = 1 | 2 | 32;
                    if (((() => { let o = tryParseNumber1(h[0], l, e, i); i = o.p3; return o.ret; })()) && i >= 0 && i <= 9999) {
                        let o = h.length == 2 ? n : m;
                        if (((() => { let p = tryParseNumber1(h[1], o, e, j); j = p.p3; return p.ret; })()) && j >= 0 && j < 60) {
                            if (h.length == 2 || (((() => { let p = tryParseNumber1(h[2], n, e, k); k = p.p3; return p.ret; })()) && k >= 0 && k < 60)) {
                                d = 46;
                                c = timeSpanFromHours(i + (j / 60) + (k / 3600));
                                return {
                                    ret: true,
                                    p2: c,
                                    p3: d
                                };
                            }
                        }
                    }
                }
            }
        }
        d = -1;
        c = (-9007199254740991);
        return {
            ret: false,
            p2: c,
            p3: d
        };
    }
    f(a, b, c) {
        let d = b == null || b.length < 30 ? b : b.substr(0, 30);
        return this.x(0, c, d, a);
    }
    g(a, b, c) {
        try {
            ExcelUtils.gf(a, c);
        }
        catch (d) {
            let e = new SpreadsheetUserPromptInfo(2, null, d, null, true);
            if (this.y(e) == false) {
                return 1;
            }
            return 0;
        }
        return 2;
    }
    h(a) {
        if (this.j._a3._j.count > 1) {
            let b = SpreadsheetUtilities.h(boxArray$1(a));
            for (let c of fromEnum(this.j._a3._j)) {
                if (SpreadsheetPaneManager._cf(c._j, b)) {
                    let d = new SpreadsheetUserPromptInfo(20, null, null, null, false);
                    if (this.y(d)) {
                        return 1;
                    }
                    return 0;
                }
            }
        }
        return 2;
    }
    get workbook() {
        return this.k;
    }
    get isFixedDecimalEnabled() {
        return this.m;
    }
    get fixedDecimalPlaceCount() {
        return this.z;
    }
}
SpreadsheetEditHelper.$t = markType(SpreadsheetEditHelper, 'SpreadsheetEditHelper', Base.$, [ISpreadsheetEditInfo_$type]);
SpreadsheetEditHelper.ae = true;
SpreadsheetEditHelper.ab = false;
SpreadsheetEditHelper.b = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9'];
SpreadsheetEditHelper.af = null;
/**
 * @hidden
 */
export class ParseEditValueCache extends Base {
    constructor(a) {
        super();
        this.a = null;
        this.f = false;
        this.j = 0;
        this.g = null;
        this.h = -1;
        this.k = null;
        this.m = null;
        this.q = null;
        this.p = null;
        this.l = null;
        this.b = false;
        this.a = a.workbook;
        this.g = this.a._e6;
        this.f = a.isFixedDecimalEnabled;
        this.j = a.fixedDecimalPlaceCount;
    }
    get n() {
        if (this.k == null) {
            this.k = (((a) => a != null ? a : "")(SpreadsheetUtilities.c8(this.g, true)));
        }
        return this.k;
    }
    get i() {
        if (this.h < 0) {
            this.h = SpreadsheetUtilities.cp(this.g);
        }
        return this.h;
    }
    get o() {
        if (this.m == null) {
            this.m = (((a) => a != null ? a : "")(SpreadsheetUtilities.c8(this.g, false)));
        }
        return this.m;
    }
    c(a) {
        if (this.p == null) {
            let b = ExcelUtils.ec(this.g.dateTimeFormat);
            let c = ExcelUtils.ec(this.g.dateTimeFormat);
            let d = !stringIsNullOrEmpty(b);
            let e = !stringIsNullOrEmpty(c);
            let f = "";
            if (d || e) {
                f = d && e ? Regex.f(b) + "|" + Regex.f(c) : d ? Regex.f(b) : Regex.f(c);
                f = stringFormat("({0})\\s*({0})", f);
            }
            let g = !stringIsNullOrEmpty(f) ? "(\\+|(" + f + "))" : "(\\+)";
            this.p = new Regex(0, g);
        }
        let h = this.p.i(a);
        if (h.i) {
            return true;
        }
        return false;
    }
    e(a) {
        if (this.l != a) {
            this.l = a;
            this.b = this.d(a);
        }
        return this.b;
    }
    d(a) {
        let b = this.g;
        let c = b.numberFormat;
        if (a != null) {
            a = stringReplace(stringReplace(stringReplace(a, c.positiveSign, ""), c.negativeSign, ""), c.currencySymbol, "").trim();
            if (!stringIsNullOrEmpty(c.numberDecimalSeparator)) {
                let d = a.indexOf(c.numberDecimalSeparator);
                if (d >= 0) {
                    let e = c.numberDecimalSeparator.length;
                    if (e == a.length) {
                        return true;
                    }
                    if (d < a.length - e && /\s/i.test(a.charAt(d + e))) {
                        return true;
                    }
                    if (d > 0 && /\s/i.test(a.charAt(d = 1))) {
                        return true;
                    }
                }
            }
            if (!stringIsNullOrEmpty(c.numberGroupSeparator)) {
                let f = a.indexOf(c.numberGroupSeparator);
                if (f >= 0) {
                    let g = c.numberGroupSeparator.length;
                    if (g == a.length) {
                        return true;
                    }
                    if (f == 0 || f == a.length - g) {
                        return true;
                    }
                    if (f < a.length - g && /\s/i.test(a.charAt(f + g))) {
                        return true;
                    }
                    if (f > 0 && /\s/i.test(a.charAt(f - 1))) {
                        return true;
                    }
                    if (this.q == null) {
                        let h = Regex.f(c.numberGroupSeparator);
                        let i = Regex.f(c.numberDecimalSeparator);
                        let j = stringIsNullOrEmpty(c.currencySymbol) ? "" : "|" + Regex.f(c.currencySymbol);
                        this.q = new Regex(0, "^(?:(?:\\+|-" + j + "|\\(|\\s)*)((?:\\d+" + h + "?)+)(?:" + i + "\\d*)?(?:(?:e|E)(?:-|\\+|\\d)+)?(?:(?:\\+|-" + j + "|\\)|\\s)*)$");
                    }
                    let k = this.q.i(a);
                    let l = c.numberGroupSizes || [3];
                    if (k.i) {
                        let m = stringSplit(k.m.item(1).g, [c.numberGroupSeparator], 0);
                        for (let n = m.length - 1, o = n; o >= 0; o--) {
                            let p = l[Math.min(o, l.length - 1)];
                            if (p == 0) {
                                continue;
                            }
                            else if (m[o].length > p) {
                                return true;
                            }
                            else if (m[o].length < p && o != 0) {
                                return true;
                            }
                        }
                    }
                }
            }
        }
        return false;
    }
}
ParseEditValueCache.$t = markType(ParseEditValueCache, 'ParseEditValueCache');
/**
 * @hidden
 */
export class SpreadsheetActivePaneChangedEventArgs extends EventArgs {
    constructor(a, b) {
        super();
        this._c = null;
        this._b = null;
        this._c = a;
        this._b = b;
    }
    get newValue() {
        return this._b;
    }
    get oldValue() {
        return this._c;
    }
}
SpreadsheetActivePaneChangedEventArgs.$t = markType(SpreadsheetActivePaneChangedEventArgs, 'SpreadsheetActivePaneChangedEventArgs', EventArgs.$);
/**
 * @hidden
 */
export class SpreadsheetSelectionChangedEventArgs extends EventArgs {
    constructor(a) {
        super();
        this._b = null;
        this._b = a;
    }
    get pane() {
        return this._b;
    }
}
SpreadsheetSelectionChangedEventArgs.$t = markType(SpreadsheetSelectionChangedEventArgs, 'SpreadsheetSelectionChangedEventArgs', EventArgs.$);
/**
 * @hidden
 */
export class SpreadsheetUserPromptDisplayingEventArgs extends EventArgs {
    constructor(a) {
        super();
        this._b = null;
        CoreUtilities.y(a);
        this._b = a;
    }
    get canCancel() {
        return this._b.b;
    }
    get cancel() {
        return this._b.c;
    }
    set cancel(a) {
        this._b.c = a;
    }
    get caption() {
        return this._b.h;
    }
    set caption(a) {
        this._b.h = a;
    }
    get displayMessage() {
        return this._b.d;
    }
    set displayMessage(a) {
        this._b.d = a;
    }
    get exception() {
        return this._b.f;
    }
    get message() {
        return this._b.i;
    }
    set message(a) {
        this._b.i = a;
    }
    get trigger() {
        return this._b.a;
    }
}
SpreadsheetUserPromptDisplayingEventArgs.$t = markType(SpreadsheetUserPromptDisplayingEventArgs, 'SpreadsheetUserPromptDisplayingEventArgs', EventArgs.$);
/**
 * @hidden
 */
export class SortFilterAreaBase extends Base {
    constructor() {
        super(...arguments);
        this.r = Nullable$1.toNullable(CellContentType_$type, null);
    }
    get a() {
        if (!this.r.hasValue) {
            this.aa();
        }
        return this.r.value;
    }
    ab(a) {
        this.r = Nullable$1.toNullable(CellContentType_$type, a);
    }
    ac(a) {
        let b = new HashSet$1(CellFill.$, 0);
        this.ae((c, d) => {
            let e = d._h != null ? d._h.fill : null;
            if (e == null) {
                e = c._ar;
            }
            if (e == null || SpreadsheetUtilities.bc(e)) {
                e = CellFill.noColor;
            }
            else {
                e = e._c(this.c.workbook);
            }
            if (b.add_1(e)) {
                a(e);
            }
        });
    }
    ad(a) {
        let b = new HashSet$1(WorkbookColorInfo.$, 0);
        this.ae((c, d) => {
            let e = d._h != null && d._h.font != null ? d._h.font.colorInfo : null;
            if (WorkbookColorInfo.l_op_Equality(e, null)) {
                e = c._bh;
            }
            if (WorkbookColorInfo.l_op_Equality(e, null) || e.isAutomatic || e.equals(this.c.workbook._styles$i.normalStyle._i.font.colorInfo)) {
                e = WorkbookColorInfo.automatic;
            }
            else {
                e = WorkbookColorInfo._l_op_Implicit_WorkbookColorInfo_Color$i(e._getResolvedColor1(this.c.workbook));
            }
            if (b.add_1(e)) {
                a(e);
            }
        });
    }
    af(a) {
        let b = new HashSet$1(Tuple$2.$.specialize(FormatConditionIconSet_$type, Nullable$1.$.specialize(Number_$type)), 0);
        this.ae((c, d) => {
            let e = SpreadsheetUtilities.dx(d.iconInfo) || SpreadsheetUtilities.d1;
            if (b.add_1(e)) {
                a(e);
            }
        });
    }
    ae(a) {
        let b = this.d;
        if (b != null) {
            let c = this.c;
            let d = this.q;
            let e = b.firstRow;
            let f = b.lastRow;
            let g = false;
            for (let h of fromEnum(c._conditionalFormats$i)) {
                for (let i = 0; i < h.regions.count; i++) {
                    if (h.regions.item(i)._s(b)) {
                        g = true;
                    }
                }
                if (g) {
                    break;
                }
            }
            let j = new List$1(IFilterable_$type, 1, this.o());
            for (let k = e; k <= f; k++) {
                let l = c._rows$i._aj(k);
                let m = false;
                for (let n = 0; n < j.count; n++) {
                    if (!j._inner[n].filter._e(c, l, k, j._inner[n].columnIndex)) {
                        m = true;
                        break;
                    }
                }
                if (!m) {
                    let o = c._b4(l, d);
                    let p = g ? c._getCellConditionalFormat1(k, d) || CellConditionalFormat._a : CellConditionalFormat._a;
                    a(o, p);
                }
            }
        }
    }
    m(a) {
        for (let b of fromEnum(this.p())) {
            let c = typeCast(IconSortCondition.$, b);
            if (c != null) {
                if (c.iconSet == -1 || !c._n.hasValue) {
                    if (SpreadsheetUtilities.ao(a) == -1) {
                        return true;
                    }
                }
                else if (c.iconSet == a.c && nullableEquals(c._iconIndex$i, a.d)) {
                    return true;
                }
            }
        }
        return false;
    }
    j(a) {
        let b = typeCast(IconFilter.$, this.b);
        if (b == null) {
            return false;
        }
        if (b.iconSet == -1 || !b._p.hasValue) {
            return SpreadsheetUtilities.ao(a) == -1;
        }
        return a != null && b.iconSet == a.c && nullableEquals(b._iconIndex$i, a.d);
    }
    l(a) {
        for (let b of fromEnum(this.p())) {
            let c = typeCast(FontColorSortCondition.$, b);
            if (c != null) {
                if (this.f(a, c.fontColorInfo)) {
                    return true;
                }
            }
        }
        return false;
    }
    i(a) {
        let b = typeCast(FontColorFilter.$, this.b);
        return b != null && this.f(a, b.fontColorInfo);
    }
    f(a, b) {
        let c = WorkbookColorInfo.l_op_Equality(a, null) || a.isAutomatic;
        let d = WorkbookColorInfo.l_op_Equality(b, null) || b.isAutomatic;
        if (c != d) {
            return false;
        }
        if (c) {
            return true;
        }
        let e = a._getResolvedColor1(this.c.workbook);
        let f = b._getResolvedColor1(this.c.workbook);
        return e.equals(f);
    }
    k(a) {
        for (let b of fromEnum(this.p())) {
            let c = typeCast(FillSortCondition.$, b);
            if (c != null) {
                if (this.e(a, c.fill)) {
                    return true;
                }
            }
        }
        return false;
    }
    h(a) {
        let b = typeCast(FillFilter.$, this.b);
        return b != null && this.e(a, b.fill);
    }
    e(a, b) {
        let c = SpreadsheetUtilities.bc(a);
        let d = SpreadsheetUtilities.bc(b);
        if (c != d) {
            return false;
        }
        if (c) {
            return true;
        }
        let e = a._c(this.c.workbook);
        let f = b._c(this.c.workbook);
        return Base.equalsStatic(e, f);
    }
}
SortFilterAreaBase.$t = markType(SortFilterAreaBase, 'SortFilterAreaBase');
/**
 * @hidden
 */
export class WorksheetSortFilterArea extends SortFilterAreaBase {
    constructor(a, b) {
        super();
        this.ah = null;
        this.ai = 0;
        this.ah = a;
        this.ai = b;
    }
    t(a) {
        this.c.filterSettings.applyFillFilter(this.ai, a);
    }
    v(a) {
        this.c.filterSettings._applyFontColorFilter(this.ai, a);
    }
    w(a, b) {
        this.c.filterSettings._applyIconFilter$i(this.ai, a, b);
    }
    s(a) {
        this.c.filterSettings.applyAverageFilter(this.ai, a);
    }
    u(a, b) {
        this.c.filterSettings.applyDatePeriodFilter(this.ai, a, b);
    }
    x(a, b) {
        this.c.filterSettings.applyRelativeDateRangeFilter(this.ai, a, b);
    }
    y(a, b) {
        this.c.filterSettings._applyTopOrBottomFilter1(this.ai, a, b);
    }
    z() {
        this.c.filterSettings.applyYearToDateFilter(this.ai);
    }
    get_q() {
        return this.c.filterSettings.region.firstColumn + this.ai;
    }
    get q() {
        return this.get_q();
    }
    get_d() {
        return this.c.filterSettings._ad(new RelativeIndex(this.ai));
    }
    get d() {
        return this.get_d();
    }
    aa() {
        let a;
        let b = SpreadsheetUtilities.bz(this.c, this.ai, a);
        a = b.p2;
        this.ab(a);
    }
    get_g() {
        return this.c.filterSettings.getFilter(this.ai) != null;
    }
    get g() {
        return this.get_g();
    }
    get_b() {
        return this.c.filterSettings.getFilter(this.ai);
    }
    get b() {
        return this.get_b();
    }
    o() {
        return SpreadsheetUtilities.bx(this.c, this.ai);
    }
    *_p() {
        for (let a of fromEnum(this.c.filterSettings.sortSettings._sortConditions$i)) {
            if (a.key.index == this.ai) {
                yield a.value;
            }
        }
    }
    p() {
        return toEnum(() => this._p());
    }
    n() {
        let a = this.g;
        if (a) {
            this.c.filterSettings.clearFilter(this.ai);
        }
        return a;
    }
    ag(a) {
        let b = this.c.filterSettings.sortSettings._sortConditions$i;
        b.clear();
        b._addItem$i(new RelativeIndex(this.ai), a);
    }
    get_c() {
        return this.ah;
    }
    get c() {
        return this.get_c();
    }
}
WorksheetSortFilterArea.$t = markType(WorksheetSortFilterArea, 'WorksheetSortFilterArea', SortFilterAreaBase.$);
/**
 * @hidden
 */
export class TableSortFilterArea extends SortFilterAreaBase {
    constructor(a) {
        super();
        this.ah = null;
        this.ah = a;
    }
    t(a) {
        this.ah.applyFillFilter(a);
    }
    v(a) {
        this.ah._applyFontColorFilter(a);
    }
    w(a, b) {
        this.ah._applyIconFilter$i(a, b);
    }
    s(a) {
        this.ah.applyAverageFilter(a);
    }
    u(a, b) {
        this.ah.applyDatePeriodFilter(a, b);
    }
    x(a, b) {
        this.ah.applyRelativeDateRangeFilter(a, b);
    }
    y(a, b) {
        this.ah._applyTopOrBottomFilter1(a, b);
    }
    z() {
        this.ah.applyYearToDateFilter();
    }
    get_q() {
        return this.ah._at;
    }
    get q() {
        return this.get_q();
    }
    get_d() {
        return this.ah.dataAreaRegion;
    }
    get d() {
        return this.get_d();
    }
    aa() {
        let a;
        let b = SpreadsheetUtilities.b1(this.ah, a);
        a = b.p1;
        this.ab(a);
    }
    get_g() {
        return this.ah.filter != null;
    }
    get g() {
        return this.get_g();
    }
    get_b() {
        return this.ah.filter;
    }
    get b() {
        return this.get_b();
    }
    o() {
        return SpreadsheetUtilities.by(this.ah);
    }
    *_p() {
        for (let a of fromEnum(this.ah.table.sortSettings._sortConditions$i)) {
            if (a.key == this.ah) {
                yield a.value;
            }
        }
    }
    p() {
        return toEnum(() => this._p());
    }
    ag(a) {
        let b = this.ah.table.sortSettings._sortConditions$i;
        b.clear();
        b._addItem$i(this.ah, a);
    }
    n() {
        let a = this.g;
        if (a) {
            this.ah.clearFilter();
        }
        return a;
    }
    get_c() {
        return this.ah._worksheet;
    }
    get c() {
        return this.get_c();
    }
}
TableSortFilterArea.$t = markType(TableSortFilterArea, 'TableSortFilterArea', SortFilterAreaBase.$);
/**
 * @hidden
 */
export class PredefinedShapes extends Base {
    constructor() {
        super();
        this.f = null;
        this.f = new Dictionary$2(String_$type, ShapeGeometry.$, 0);
    }
    static get b() {
        if (PredefinedShapes.a == null) {
            {
                if (PredefinedShapes.a == null) {
                    let a = new PredefinedShapes();
                    PredefinedShapes.a = a;
                }
            }
        }
        return PredefinedShapes.a;
    }
    c(a) {
        if (a.a == null && a.c == null) {
            let b = a.g;
            let c = new StringReader(b);
            let d = new XmlTextReader(3, c);
            if (!d.i) {
                d.a6();
                this.j(a, d);
            }
        }
        return new ShapeGeometry(null, a);
    }
    d(a) {
        if (!this.f.containsKey(a)) {
            this.k(null);
        }
        let b;
        if (((() => { let c = this.f.tryGetValue(a, b); b = c.p1; return c.ret; })())) {
            return b;
        }
        return null;
    }
    static h() {
        let a = new MemoryStream(0);
        {
            let b = new MemoryStream(2, Convert.fromBase64String(PredefinedShapes.i));
            try {
                if (b == null) {
                    return null;
                }
                try {
                    {
                        let c = new GZipStream(b, 0);
                        try {
                            let d = new Array(4096);
                            while (true) {
                                let e = c.read(d, 0, d.length);
                                if (e == 0) {
                                    break;
                                }
                                a.write(d, 0, e);
                            }
                        }
                        finally {
                            if (c != null) {
                                c.dispose();
                            }
                        }
                    }
                }
                catch (f) {
                }
            }
            finally {
                if (b != null) {
                    b.dispose();
                }
            }
        }
        a.position = 0;
        return a;
    }
    j(a, b) {
        this.l(CT_CustomGeometry2D.$, a, b, (c) => {
            switch (b.ag) {
                case "avLst":
                    a.c = new CT_GeomGuideList();
                    this.o(b, a.c);
                    return true;
                case "gdLst":
                    a.d = new CT_GeomGuideList();
                    this.o(b, a.d);
                    return true;
                case "pathLst":
                    a.f = new CT_Path2DList();
                    this.n(b, a.f);
                    return true;
                default:
                case "ahLst":
                case "cxnLst": return b.i;
                case "rect":
                    a.e = ((() => {
                        let $ret = new CT_GeomRect();
                        $ret.b = ST_AdjCoordinate.a(b.ab("l"));
                        $ret.d = ST_AdjCoordinate.a(b.ab("t"));
                        $ret.c = ST_AdjCoordinate.a(b.ab("r"));
                        $ret.a = ST_AdjCoordinate.a(b.ab("b"));
                        return $ret;
                    })());
                    return b.i;
            }
        });
    }
    k(a) {
        {
            let b = PredefinedShapes.h();
            try {
                let c = new XmlTextReader(1, b);
                c.a6();
                let d = false;
                while (d || c.t()) {
                    d = false;
                    if (c.a7 == 1 && !c.i) {
                        let e = c.ai;
                        if (a != null && !a.contains(e)) {
                            d = true;
                            c.a2();
                            continue;
                        }
                        let f = new CT_CustomGeometry2D();
                        this.j(f, c);
                        this.f.item(e, new ShapeGeometry(e, f));
                    }
                }
            }
            finally {
                if (b != null) {
                    b.dispose();
                }
            }
        }
    }
    l($t, a, b, c) {
        if (b.i) {
            return;
        }
        b.q();
        let d = b.x;
        let e = false;
        while (d <= b.x && (e || b.t())) {
            e = false;
            if (b.a7 == 1) {
                if (!c(a)) {
                    e = true;
                    b.a2();
                }
            }
            if (b.a7 == 15) {
                if (b.x == d) {
                    break;
                }
            }
        }
    }
    m(a, b) {
        this.l(List$1.$.specialize(IPath2DCommand_$type), b, a, (c) => {
            switch (a.ag) {
                case "close":
                    c.add(new CT_Path2DClose());
                    return true;
                case "arcTo":
                    let d = new CT_Path2DArcTo();
                    d.d = ST_AdjCoordinate.a(a.ab("wR"));
                    d.c = ST_AdjCoordinate.a(a.ab("hR"));
                    d.a = ST_AdjAngle.a(a.ab("stAng"));
                    d.b = ST_AdjAngle.a(a.ab("swAng"));
                    c.add(d);
                    return a.i;
            }
            let e = new List$1(CT_AdjPoint2D.$, 0);
            this.p(a, e);
            switch (a.ag) {
                case "moveTo":
                    let f = new CT_Path2DMoveTo();
                    f.a = e._inner[0];
                    c.add(f);
                    return true;
                case "lnTo":
                    let g = new CT_Path2DLineTo();
                    g.a = e._inner[0];
                    c.add(g);
                    return true;
                case "quadBezTo":
                    let h = new CT_Path2DQuadBezierTo();
                    h.a = e._inner[0];
                    h.b = e._inner[1];
                    c.add(h);
                    return true;
                case "cubicBezTo":
                    let i = new CT_Path2DCubicBezierTo();
                    i.a = e._inner[0];
                    i.b = e._inner[1];
                    i.c = e._inner[2];
                    c.add(i);
                    return true;
                default: return a.i;
            }
        });
    }
    n(a, b) {
        this.l(CT_Path2DList.$, b, a, (c) => {
            if (a.ag == "path") {
                let d = new CT_Path2D();
                d.c = Nullable$1.toNullable(Boolean_$type, PredefinedShapes.e(a, "extrusionOk", true));
                d.d = Nullable$1.toNullable(ST_PathFillMode_$type, EnumUtil.getEnumValue(ST_PathFillMode_$type, EnumUtil.parse(ST_PathFillMode_$type, (((e) => e != null ? e : "norm")(a.ab("fill"))), false)));
                d.f = Nullable$1.toNullable(Boolean_$type, PredefinedShapes.e(a, "stroke", true));
                let e = a.ab("w");
                if (!stringIsNullOrEmpty(e)) {
                    d.g = Nullable$1.toNullable(ST_PositiveCoordinate.$, new ST_PositiveCoordinate(1, XmlConvert.n(e)));
                }
                let f = a.ab("h");
                if (!stringIsNullOrEmpty(f)) {
                    d.e = Nullable$1.toNullable(ST_PositiveCoordinate.$, new ST_PositiveCoordinate(1, XmlConvert.n(f)));
                }
                this.m(a, d.b);
                c.b.add(d);
                return true;
            }
            return false;
        });
    }
    p(a, b) {
        this.l(List$1.$.specialize(CT_AdjPoint2D.$), b, a, (c) => {
            if (a.ag == "pt") {
                let d = new CT_AdjPoint2D();
                d.a = ST_AdjCoordinate.a(a.ab("x"));
                d.b = ST_AdjCoordinate.a(a.ab("y"));
                c.add(d);
                return true;
            }
            else {
                return a.i;
            }
        });
    }
    o(a, b) {
        this.l(CT_GeomGuideList.$, b, a, (c) => {
            if (a.ag == "gd") {
                let d = new CT_GeomGuide();
                d.b = a.ab("name");
                d.a = a.ab("fmla");
                c.b.add(d);
                return true;
            }
            return a.i;
        });
    }
    static e(a, b, c) {
        let d = a.ab(b);
        return d != null ? XmlConvert.d(d) : c;
    }
    static g(a, b, c) {
        let d = a.ab(b);
        return d != null ? XmlConvert.o(d) : c;
    }
}
PredefinedShapes.$t = markType(PredefinedShapes, 'PredefinedShapes');
PredefinedShapes.a = null;
PredefinedShapes.i = "H4sICDIS/lMCAHByZXNldFNoYXBlRGVmaW5pdGlvbnMueG1sAOxd2W7jNhR9HyD/wPqxhWORWl0kLbqiBbqhC9A+FYotx+7IkiHJWb6tD/2k/kIpWYptyTQvRTqLewczGS+XR5eX5OXhIaX8+/c/V58+LGNyF2X5Ik2uB/TSGpAomaTTRXJ7PVgXs2Ew+PSTi3dXHwyH5OLdz9HdorQk80VepNnjxbvr1p+Ld8GI+SNmUYd8vXiIpqSYR+SRktv1YhqRWZqROJoVn2VZen9JfuU4ZJHn64jkxSKOSfTAgflHSVVsss6yKCmIU8xJNF0U5ZXzebiKcnKzLggvO0m5xaQoC6SriP+YzRaT6PLiHXn683O0TO+4H9P1Kl5MwiIi69WX6X1SuUDCZErC6TSa8k/rT3IyjWaLhH80j7LoYzIvitXHo1GeThZhfLnMp8nlcjHJ0jydFZeTdDn6Os3Wy3wUJcPffhn5tmUHY2YPXSugQ8cd0+F45lpDKwgc15mE44iHZ5WlN+FNHA1v1rfD+0UxH65XU+5TWHqwXlX/fTorYa/T/M+bBf/icbaIo4t3w2HZGqssyqPilzIUX5a+Loo0yT8pa30VTiY8ZJ+n2TTKvgjjOF0XlH9Tfld+e/ddXhDe5kl+PWgqNplHyzC/LAPIv+GXXYYFf5vdjqZZeM97wjLmDWp5o2W4SAY1WAV3OyVJuIyuB+H0Lzogs2UcXg/uwpjQwHd5VxqJjNmu8TCwbfuIsb2HTJlrHYN29qDtNvbVqIoBf1+XNBGQthuPT8H4cETmpIwOoRb/UznetX/Ytb8v7dlR+0fWxreP47M2vtOxvxpVsWjehXODgQnnv/9Bbqc/R7Pfm+ZfLhL+esio4zuB7Tk+/yh84B/tfLIp8seme1VF/ugW+WO3yOaa9VVXaU4eNsF9LNtkLzaj0iexh466h3Z/D9nGQ3bQw+bNTuNMHhKDrcPRSFjme+uQc1nl291k3zde5gDAZOocgphPKowbGAQ7BBEreGEfd6M4hPH0eifK1cwSV9cuqmJZFY2bsiZ6sd8OulVYmBxoJRyfRItsXU7TP76/HszCOI/2olFOh7+m9SdNueIpyNv4NBHqFLiKk8MA2WGAOFEpftO3eAwrPonTPNrrAmXUWjHksy1v+SRNokH/eD5QaEBrnyC1fKCAap68To9UXilBDbbpDl6FzZvN2OSf8PeHeI6QAbGzYkAcGU6AqOd5/hFrV4lceXvYTomN5ApArvbw7Ta+exzfbuN7SN7eEnk74KGn7qHb30N746GN9BLpZQ84pJdIL8+OXooBtvkSHgMQP2VCfmojP4XxU056FPipDNtvcd+xd6ySwR426oqvhPru4TttfP84vtPGD5BaI7VW8FBKrQ94GKh76Pf30Nl46CD5R/LfAw7JP5J/JP8qAE3ChQcRtHqwd1cPuLOPO/tgBo4M9hUzWGRfCl7839lXXmTp+2gzqepMtEjGTkJcAAFFMtaPCh3a4sfNfaoknlLc3D8Jvzq1won87RXzt9evQCLDVPACGSYyTGSYZ8YwteU+FYq6t8uP+/tqFBX395H94v4+suu3w65xfx/5P/J/5P/Pw5UBAUX+r9LQMP7/PNv97Y3+8nkHn6+Lgv8MJ+9/yvjDF9J1floGOt2jfHlObBIc5la348bwoyG5mxCL8LICU2rt2ZaWxBLZ0h3buQSX7dlucbfUDmc+oBc48+HM13/mOxKSakzXHbF/VKqx/lilnZ412yBsspFi7TYZ+2iHqafEaZi9jxKN7nOesTLCF84+NLAw/D8TjJBBle+EXKnLpKLbRZLwqYB/hUQKSqT2be12xRyR5a78xssRKowBddumYlRvx1deS/7PETvrd4zdwxQRSSIAwgBJfB6aiEQRWFyaiA3ncckM78tmeIBnLzrHS+rn1Z7p1Y9q149C6yeG8KAQIBp0KjaNHQri3Rl2KENLDuw/EO/ATXfSDgTtxar9BxbLej7XCeSbnNGl2vah1Vd3YRaHyXuk4TAvkIbPzYxJ6Zg4+xFZDrvuaPwynayXfEvq7FWS6QPdd2BMbKYgqFCwoEIVBBXqSRWVSs7g1eI/bammUhqPS0uUPjDnqgCi9GEwLYM2N27H/aPC0wOQAcvXGa4+hD6Tl0OAqPwRbeG7KM9FHflNtZtjrt0MQEjb7RU0vUb+KsNtYtn8nI0GCpch0eR1DAlwaOQQ0s54gv7cxFi1dj2CrBMiUDtdocKiQRwU1nPNwq27pPsqmZ79au417nlzU+n6rDb1SYB73rjw6xF9XPipFJcmYMP5G7QFo7vFBN38kCIYZyr+wARXfsYtNDGED4UAse1TLU6wQ0G8O8MOZWj5ZrT/yKsmhZA2EfYfKYRq/4HFMsYVmXBFtl13dRdj/FfG3ofZ9Ifo4cRPFDirJRnez6XghYFly3MsWnDJAiouzVCGExxIfNS7EQc6uUsRDE1+p2Lj5xgrQ0TTYGjkFZNCSKOrGhpYGP6fCQZ8P9cOVeryqG+iePVGVW0VWtRffabEh6rP3Fh+y1Vty8Sw4zas0JRZLVNHbErb9fIJC0TGdttbesS4EzEqjgPz2yeqPCHvZeOWLROfALOttq0ttqVtW0dsa3d3AsTG3T2Gsdi4s8fALKGx0269IyF2WKf/sAD3Ll5uEfA8ywBcCACLSydaw/P0kZDUCeaxSowQCSjMJr+m5P7nekaZNy/y4rO6v/PX983rJ8RuYacp7D4VtnaKOuKiDq2LOqwq2gySp9JD19k8IBD2CKUqET6W//fnn7ZnDIJJOawojNs26B9IQBwPXt450IpDagUNQO/+WaW5as5U7J4Ok3QTRj2Id8+50MSxiGMRx6LiWDQjZODQw6GHQ6//0INVI8bNxiObjVs9rKuSpcvojapkL7PRaE59ox5UfqOAw59bpc6Tnv2sbd0jtkH7/Cm3hcp6Y24L1fVoGQeosicOL2tLQ+VfDyoC+kQuATaqniNW9VwFBdBr2/rEgiqLR9RCFiioemzcMQ6AOuRGAgQKkRIJ0GYdY6YgWzK8cxVFQCVAFAENMhAQu9S62+vpyZ49K8aToiEEnZ1k2zYFoVEPynQR7BKhmsD0IZz+ENQchPT+NtCK5aT3EW+DrjGO3nrY6xCpjnGVJaCJcc7GxiCY3xvCtoxBaFTkOXOe7ijVmPjlsxykpvrzHDi7Kw6tsYqCKe1PL9sl4cMT1KGMaMTy/iOvFzyvyiE0sruBOUafYIDHgX7WiU+Y+kxMRtrMF5yV1HLKU1/TeUSBtKsAfbEH2kdNnwKt5ck2OWll2jfFH65Q/9dYfavo/1zp7+r/3yaVWlJ+8Ea3AVSkfR253man0NV5DKCyemnNwLr6mBuDxXKqIJaXfz2pXC5X1l0FZT1QUMv3z9YqaNoGz9a2FO2jDtuOirDuqgjrvoqw3u2ZNkNdHXV1OCDq6gZnds0V44FDG/UMPK9enODQxisQV05QVZBzzFXzrsq2880LJe8gInEA8UW+qJKekxJDOMYgdA58MXMQtD+Ebw5CoyKuMQjevRQzGTxZxIvbeWEkW5zTgAQHXgqh0/wGOqGBoWBgQBpICwaSk4EUCU7UoAH5TEo2TtaYGzA3gCDkA1taETmEam6A9e8Y5VihHNsVXruq7Pfp3QKPZb/IsWzHdUmVz8GHs8dWXQJ6RpvZbFNC/pTe5hoebdyCCsvUt6i1KQIWmMe2XV8FLjP7TV2gh7iZ5Y7rIlB92mVBXRWoSO36dl0CqlR7Xl1Cfry70badMatKyA95NwfjLc+vSsiPejcl3Lrd5dL4kzxvOxu35Ar5ts/X8ZUL5U0R160rD9PLK1lbSTB3FY6AU09FXfcV1HUavMAzMeygY0zFxvv7HUc1fkdhv8NR2O9wWNvWFdvabVtPbOu0bX2xrdu2DcS2Xtt2LLZt331hW2LboG1L8d4EQnAPBQ6Ieyjb99p0HParaGyQWsGvdRzG0TjzZgCC1RB2fwjbHITGsSHXHITGWUhPHyKoIbQPMhqB0FBFAn0Iv4Zg/SFccxAaFXFqCKs/BNOHaDKXGXnnNBu3mF8xv2J+BUBgfj3z/Gpka81UOoXX7aQRNtDOBnqbgT5vYOTpj38DWchALjSQkU3MCwZmJwNzpIGZ2gBfMMBa9LkTnMGpplNY6oxxN5KIdyO3G47dfcifo2KdvdUbQ972RuSRX/jpgh+L1Nl6dMWoPvzOlM6ek9iBzt0YLpFvLgKen0Thd3kwprATxVQei84chZ0o5irsRDFPYSeK+Z32wMei466DAiDuOhicdkG/2IZnsP5h4VkK+Gtp+PvjZyH7LxiYYw5CugpsTmPW2W6+eQF6tK346jXLp9Ioiq/eXLPX9T3tAFJqDkKlDWgZhc2Lvefi9nxE8HwCulUc4oP08bri5mDQWIJWKacS1TF9YPrA9HH26cOQZmwkW/zH3vX1OE4D8a9i8Y6I7STtIgFCvBwSD+gQ0t1juy2bQK8L2ew1+fbYSdzYSRyP4yTt3hmx7B2aGU/G/36eGY/BX2YW4dpDbjPVtfWJM3WGaTbDZCfxhD5o16t5Z+qca6alDjPsPHNsf9At2Ha1gK0MJ+8SNbhEG99n3yf6x/Pr+eBdojdwiWK4SzRCOF7AJ4qxVWkfs1fU6OwlgUWZHGzhbCUWJXVol/bBxiUa2bhEoSXzK+Ktz672fk4bgd7POeNeCktXIaCHhczYeXp+BQndRYBPEEYRRsBn/g4j6gRhxqUcVL7f77vfZ/IszNPN8G9b0sAz9LL7WIOPeLuFmMTGngIoB3bgmDVxKrQLru1s1oNZ2l0RBo4VIb687ZwQw+K4Lo7lte9IsOw+z4gZr2eR3eHv61Hr8+6EcEw6HqgONZGo1TNLpeCPi/oSKpeZUODf9IwCxD8AERw98H+GtT6eh7iIgevlovgNKiGMs1JBx6F4D7gAJOrpoEDHI+n20/c1k/iPxklxya+KvbCvuRzImFZJS/34/IKScepD0VLvclIJZxIQa1PDULbKcIbExHDJSVf743lEe9LVXlBrfE197QlThui0Jx3tDQwF7vqHsK5rS9xxUZVa0gLudSpJVyrRj62gpZVG4mj/77AyhJtBf9H6wAT1p12BmC10jrU0kwY5awRl6Anr1JZVYGd706wj8lduAsBXvlyoOueaH6IzChk0CtUYJZKNwnq91BllrxiFoD16inQah4pRiOkDZX8UJSHIKLFilLD5iXRGoYNGiU3O3U/peXSknBSjUHRCT9oleiN/JWCobGX6zRZklQfFKpvmZ6uzSjholQejD5mZZXSs5IpZQpQjxjxM+8jcYso0zms1mIH0DKS32VX21DO03f8dqlpElRhE+o5MAWHmdHvtkt+fTzu2jBzeH/9i6gosw+wo4qts+lV/FBv9kJOwqM8qJVa9hI10Q3PEvjlSN0d0zYm/c7Mt6/2t+szCJIxRI4UOe18tXLjVyLGw14ATt+PCTWsfblo7cdPai5vO4sa9eyeu6EDAMbkNTl8OTeXK5NBWrqx+XcPT1S9gbDp5BJ5ubT09d2YC7bmO/42Jrv+0P57zn7Ps+cL+uup5jkTXw5z5OGcipjbEoUwc0k3UECvHxaWDzzsycO6L9AdcvoQ3FmximjuCCMLa78QDp9FGiOYITXscdEyjPFGDzDuMcBCMmf5COhzEwJEnMgebbRjpgHAiowTWEgoYPdGq0tWdGjTZXyTxGbdOoiVNJNI9I2W6aWlfZJC1v6B9I1Y3AMJW70ZjtH9hX6Dp0rDXpSFqBGlVOnRME3ZMM8RC5U8+VLavyfukRD6CME7tyVOWybqecWpJQ23n9IlLWS7rGiZbe6KV5ZaUU2tJo47U/UFLGitSxYf1keky2PTDxxopfpBg6QeBEj+IcTYIv/JkKHrORQ418FECoh9FA+wP1ZKij++XIUx8rT/t6q8XX4SV/NxGfKgxz2BUf38wNMD/skb2BD9vwi1glUDRiChDBxlsXYZnYYyMlN0Fgr3fegIFDFU2vn8zphwPHpTG+/wCk9bDPWl+t1mrE3J3mzF1SIxBOb2EOQIvu4urAqXx8r1JwOQaAgUFCpA7kIgebA8V1CHrN08WiUBJRxRxYvnl+XxmE/o5Iz+uM7+Xmt3258fTG8iDGj16dvqv36d03cAiBwxrhwsL+SB34bhcHJ7WclFqYOC3BIebcEvjcCMQj/R/9C65z48A1OMnqtVELbDbTC0wYKquNtPpwEwPbzrTO6TkLSwKmtjsdzxulSFiiswywQkX3DhezPHh71COyhUjJzMvSyWGnfY6Z9Vucx+NzYlggF8F73QVLCdj+2wW/rmW0XBgGY3W9t1HgYXvPgosfPcS8R2tvHrvZMuhepDNq3VBxapqv2BbLNkaB6gg3Uukfn13WN+HfJPTv04c5v128sVtJwWdR8BtYP3AjhS1O9Kf/37poeS1osND0VuxN84QTbaN9ZZYEy815uo29Io22g24jeAxCTrR1DKIXNCebGpM0r2GtAl0U/+W7eiVcAIIUjLSKpPWmPsLDK2XpBtzLnVqBJLoIhQRdQNMYCBhryXEkUyJOeX64cx6h8fwaONpwo5OLKKN2CbaWGtP4doLQIIBCOFGwUZqE2wkFiDPSkbTzRQmYvhLAsdwpQju4GiyiKyRMDXgycd5xjWZDxQuBwttoGDpcL+sIK5QrBEw+WJlgV0FUDc4m7m2H84jYDKaXebSmwRmBbr9fDytgGuVG28kug347GHDMWjYg3odqGKETRySFRiMbATpuvCi3v9n3P7X2p6dK6lo4IeFhFlqsYyJKAlMhnM9FybCIgY6b00YCxnFBJjAefL6V1b3754b9r6BAuxeAghNNH1YANLyDWigmL4XOuMRqHMKdLVhsHjJKX1K8uP5t+PLi5O9nR15jmks7p2FgQKm25oXipnN1A65geBhtdjAhvgsnUzdDOsZ7OwwpMFDarGOmgNNA4a0k5kzVzMDB9Nigxm89IDMbC41BLKq8+B1XI8dO2XiwPWQYJppnEcLeKn7dAfb2oJrEXiAcJFWM8dah5K4hQSZg6TxlZyeH//5ubpgurzDRK0RFGwDm9SUu48DTisrlL7kU+oK2QYFO3WIWKu9QkTTShFNK0Y0YAfBJlpjLTAGSbt1SxhdctqVnY4Kp13h6U0LJPHAab8FyhiorgXaa0Ew2BYxsipjZIgCV5IpCgApUo1kiXjgMzOr6HjK7NbKr6wYoEOmIU4U4qQhBlWwSs0jjMgjLDUMMSY/VOQbZ0eoiDdW+CLK8Eqti2SlxipZhyIcaiNkHKGujbDXhuAw5mVfa2bBIvdq1awByWFXcjgiOexKlojvuybXE1EIKSpCDSGVCZ8werKo8tWsQV9zna+nWCGkqNQZeqMYOkJPMbxy2KYm/Zprhz3hQKashrTxUQhGWT8FEMALkuFm7/66a5I94VCmrAa28VmLytyYIsZsUeks0i7WUSfhOxzJye6kUJUjtEXc0lYDiYzIlWgrK1xpF6jNxpDD3MXZlgnq3q4823spz+u9aOq9iCOvXMJt2cCzvohbVGsJSobSl1+LaykxVMq0UnBSwHS9Mm7LBUxhHqXVSpQ5O6UUDdKrCqmsQ6oqkQotwJ72vrNLeLgaf9dzdjhmv+xOp+fXHM+dJATwem03Edjl9e2WUgp1e2FMIngptW8pl7365S0lNz0BXJuV6S+A27CkK58Cr+UK+eFN7/YT2DUkJY16+kUpu3tZtYahvYZ0uobGq1zrFDl1TsyaJa3KOSVqajpT9ecv4Abb5FKoziG0NxlwnRjCBtjTArS4YQ4DNuiggT5CIF8UQmCS4QABx3G8GaGOrMBHrMgOuWwPPgDgQ5FPu/Kjmt5YlVPIjz24eUvgZkDD2F7DaLqGtlfbPfzy8MvDLw+/IAJANTBt8BsZwG/U4zcYfmOgwAK/mWRvOtjwIR77yK0i2/ul7gQaKvLDrvxNTW+s8i7kbz309NDTQkMj9BzQcGuv4Wa6hqKMtAfHHhxPEOfBsQfHbuDYXKmhDGdD16IkcLZ7PP6+S7O5gbWhvgJHhTfI6R8or0AiGCrkucVwjFdRRxDA1lRhAJWusijX8PnxSmvOsS4w6Bme/YjING+/nssjD2T7YDiHpKdWOOdJc50aadaxQnoypEA2+jKZ6+U2qRWlegWlSDRaDqu433pSiUV9hBmwwwwIZhKKMiccnd5SwhGsQgNkCyXQa24iIagezUn1W3qhJpzyQg0G7p2jbQdD76qAuR3eZQFfthxSwPVxH2CBqtGm6cRuC4GYCfzdUzrO5UUdGOZC4IHHVLHJfJtcptfPVoc+X2G28n6wm6+WPednrNMXKDMW9Khvc7wSR6n2ZPXPMb/B2erqzb/10Wpy5bolatb1Dx/mA8usB5HT3RxEosAfRPxB5A0eRE7gojDgPcpifyS3Q9PQd3CmbWxmQGT054IB2WooGN8QBZ9uiiLJLVHksiMVAMFazMXHlr8Y5C8GQRMwfALDHScw+OC7hRZT4fOXEnyfF28CdlIfiwfZc7VYvAEnCFjQgAR/N8gqtxT7u0GL4I+lE0A9vrljfHP/CZoegVlo4RGYR2BfNQIzpyW4XRUSoK2BcP56kBWE89eDPDr014M8+nw76NNfD/L42ONjj489PgYIAOXBwQA2FQD7PDe2HoCG9/DsBy/2yjRp8QzXI0Bsyr4wbWCJb7UM4HP+iICQJEsjKzH/14gJm4SzEt9NwlltD4tXRO8v5Qz2zunUbW3m3XWGPX4SzgC+hF5v0CWdY4e+9R4N2lVO4E1loKZvqUmuxsHWJjk6A24qOg36mTlkSiLXwi9Azmvj+hvhvM7WMWMYkC2ymWwRTLZEx4p3M0ZPZ7vRY4eYzg1YSnZZ/vvp9WXZ9enywzc4YF9f/QIMHcDAiSozBOZxczrrBVT6TH5SL6gkRNNVwI0EeFcOGrRZqezsF7jaLwDaT/vxMwkw8ltWbW+nRDtD/sh32ZubIc49DO4hLtJukFgr4aDDOiuFn6aOHThlmjbzUkzTD36OTpgfK81RP0FcrDdxgnwQs+P4OXs+/7imV+x6pXLFaGnXI9aE9tBlLpfYTJdBR6OeBUEYaR+mbCUyQtClUf4KWcHo0OkbwKOHBReb3SYYKqJkgYiN6b1x4uoQwBl3C1dcQZ29aAV2d6MVdD032tDlz+bVqzcQ5oJtNs4xLOjNTB2/6I+p/AWBhbEco2Da5jFQf/Bex//W7G5iq3vODisEgLASAdoENg/K45hJv03MaNpT8cfzlJfi1Qdyj2fQu+/qC7YTX32Xn8ld+/n25R9Yv+Skq/3xDH29O6mowa9rWz+ubXxbe8HH25d7UZt2HmkliBhjm/UTrVrKT+mB9UIgAb9qICM8ztB7erWRgx4PGr70UMgDgPWoWK909KU8vBIj/Uk1e4B4i+biiIyUESKd1LxbIpLpBShgwkgZIQrWiyjf7p3YL+QN2GocWxhlGL9Wi5rFtw5JEZPMIvEPElL2j8DO8ggsGBQ2sLBBgpwzzR5f2cD+OcueL2uDQ0wiC2iIQ0LxAzTzngRhtIm3GJp8LyLx4PR7rvvqSe+7qIc1o36WVd/xIztndowD6e2CBzBwIwQIgTFnojIEBsPtsMPV58uTjp9JZP3rGbockZGDSBx50gKPIepMxvIVhmD8iLWqE58lCs4DMCjQn7XHbJWPiFeoEwP1hSqya2UCvXCqCO+QDyHydzJkYs2NI/J3MiBjrY0j8ncyIq+EMwmItalD5K0yFUNiYGANdHDzO71tmPAObubE+nHzqyD/VBmGq0N0sl/lCcy0qH408/GVtLRcCfajp5Xdq9mv7F8tZSh93SsfVK9UQxnJlGSMMpZafw3Ra8Qka0g3MmmMMJOsodxKzVd6bjSED4Lw5b8sR69bDRkOVC0xN76OFsu0OODEpZaYtCci/kEPiPHraK8dtcsJJ8ZER6l2FO35CfocUesj4BzNT6gjj5UGIhQ0k1Q7djcKQwzQaKtoFDc/Gx35g9LA9n/2rm43dhoI3yPxDhH3iPgvPxI3BQ5oJaSDCjxA25RmRenPdukmPD12Em/sbMYeb5JtCys4nB7O5/F47Njjz2NP5Njz/U3jA7DWBypBLG3ySMpQJcfh7SZj31vXLxIO9OrVOHekJMDmfNILp8UeKVHuefhiOA8/uXidC3sedqKL6mJkHr6IZJ3QPHwxmIc9BVQF9jx84ZiHL4bz8IXbMp9syxA34/XJtgxxM16fBpYhkZQQyTohy3waWMZTQFVgW+aTwzKfhpYxwGPa/2S0VXkozlFQ/2TY0YeWontVmvXsJ4feJrhZ0H5y6/1dkN7fhej9na13HMnaHJqb8FrBZXUu3V8sElCJlr0K8rs1McUr8CsMrqgp+SePZBOszK0kw77MZ9uXIWrggpQh+Ww65JUEf1ZlQBva+FrhnfKpLZ/65FNbPtXyHQPss2EdWV9z2vwZGl8muG7ANQjuDflYRLKeSBaHh9ez4W4oDZR4yIF7piaWSiwBsT+YKj8rJ0qWBs3xbDqRynZa7hiWm86pbJ4LKwzsM4ueuQNrupI/fFb/wtjUbJ1QrUtArPZE1LoePaeOw5bi9v6z5VHKsgD2oajNMaf6+GsCdcaLAvcOyINGgyrnhmhVWI0jB5zEppnzSDXEiSe2qYvagS6qH4nh5crC8pc0OIfFU2vsNYPPCiGypVNTeUIjYsge8biksoZrpnQHvhZiDmpVzG8XPrBLJfsJNkw9MAyXv5jTMMIyDG8Mw6BJZ2AYYRlmXH5yMKmp3oPsk46hKYTODubAooZl5yNoUDaNzTlTNiOS1TnmTEpsfBrJCl14a0DSdjaEB6TxqcqijQm1ZYCBcFCkVkVquMiLlNf3rpLerrmf4QK1VaCWBUpXAS1fu5WqRthEWrj2K1V1ppMz7gWshl7ASrEgYB02vm7xJYW9AFs+9cmntnyq5Tu8gJX1CawaL2AFfZAmuG7ANQhe2V7AKpLFoc3yq+0DrBrhBMDaPoDEEhD7g6nwK1EeIGi8VzSN9Gqt/7JhMNJc/V9Z9MpBpLX2r+S/IDI12yRUmxIAaa37r3rdH131V9aqL0uOSxxZlmFFSWy2vl2UHWhiW6CoQWxRfW+uO7Ko/BVL6wKireVYoWOFB2VTU221HHeSgcV4ZS/GK0CJ4WK88tmD2/ZQlv4aDDIZGITLX8xhEGEZhCuDwMvwwCDCaZBXewkmapJQ/QVpko6hKYC2l+AWXcOy8xE0KNtegmUzIlldFENoYqPTSFYHo60BSNuJCB6Axloqizbmc1ilqIcFlE0cTX2Rsqyl9/uWul+BvrsFryW8hOFatrHsfu9Ydr8/WHYN9CF+/bKNTRZZSW8KqSKjcJNeUKW9zK0EWSFnbSn9HwIV2pGD4J040rKAIuawUBK8PO56EA7XllKSmp9guz2Z2ik/KKoAkz1ZrIlC1hCSmd/AE4meaBQDUHMye2JwGNSTOTM98ebcr4TotyfDEE9CNav6aRxbD7CqYTWArb4byv1ekliA3CFWjt66w46dMg/H7o+NnwmdSdsBlv6Re/tAe21Uie4XgSI4Y6sCquM3MQGfLzu/Poexm3H3i8Cxm6sBx+9mslc2kw2itbN7yPGvot3W7/B2TLangKrAZrJXjqlvNWSyFRje9q9G5pebgkPHMuZ3pNAKG8UA+rsRNNVob9DhZkeCgg43JTkHHQYGHY5HAcrfoYC2izZ06+KYkEMeHnL4qa3uU0h1l0Y45aWu6rKP97GVYuFK/dgq9WO4UmKoFJw1W60NtVoK3kO05dVqVMVVq+IKEyT5BAZsqkW0bhZTjJyri4BxCYj4btzgSo9m8T1Ha7aYrfUNhkRrNodKpfqhJAHRmsAdIGuMHHuNSI+QowXsx8fxOnzfSJCeL/oFmM2OakP2Ya9r25LrOQJfB9GurYS/i6XvFq3vrbd1aZ6mjQPoXWybp3sZTagTvrGkkzTO3OKvLfEkZcyJv6OpVUHiQWeWeEpE6imQm+JVgYw6C7DYbgBlQuNNL+MUa8bYqqZaNP2GavvQmzInTggd1yQN0IR5VGHx/2TNUK8vcEbVgCq7n5CPLrA87l494CxFvL3Qz4FJKlg7CeYkj/ez4Ncq7j2nPN9PhCmnScbgp7wEY52glCZpLyhLeCK10nIkLk9SwkE5nCWilSNyLgw5Kc94Kno5ecZYRmA5mUhbOYnIDTlpJnKS8L5dMeMi5qh2payXw1NKBevblQhOEiJAOUmais7QlBqGpmmaxEz0+mRSDI9hfWQDOn0yw84sFTHplck41Vs1oNepVob0xiGMp3Ge9GJyIlVjoJg0pXErhsSCs16ZPOVCZHs5XHCaJMTV57Huc5IZgzDheSJob5wsizlhrsHDRwcP4VmcpyTeC8qJIISRkHUd/EjnenuGJ3l7pYkmJE1DPmKg2ULdRqF9o4mQ30Qao9PBJjnNGoUYz/I8TKHRDuWcJAnNjGEqB2qG1ockPO0UyuM8dJobG/AZFSk3JrmM8yxJ0ArRLKNpZ6FUBF25AhRiWUqMDzCXO+WYoPVhnHQ+AKW54CH6ANPK15ySVHDSf8pUiJhTtEqcpHnbZ0SwQJXGZ16SyYUqo/2oThIR5/hRzTJGeaORmpVCFIKWlIzyJIn7QSQnF4ZPukzzeD+qBZ1Fn1zEWZb2FopzklJ8n1FKOGk04ikN+sygxTuX028iEkOjhJAMP7AJjzsHR5A8yEaQfyMFUk56G6VMegV4hTjpPnwiP5ygqRFQSJorpwnp9SGE53FAAmu9o9Sby+/bR9hPfbnyaxpnjGFvVyZUvMmrG0X1y+OLuf3zJ/IpartI6c/loyqxqe6m3giA6wrM8wUHvNxaRyNlQVvxbSnopQrrdGSHKXM39gBFtNsCaGbVUHrQ3LbPneME407YxrljDmxiYO/UmaRqJYhOTbSQ6NqFzswz1LskuksdiuT2LdAkidtDOLgEiU1t1EUhKQQEE0O+LBqRiMFgaitDMr8yzFSGEPnL1UWEW+qwxjwZDBdDeOqEJ5YyvOlUlzaphRdR7cFntn04wj5m/yr70IiAYBpb+mSRLO5Qh1p9S2PTmIdgOgSnDrDVq5RoQwJobqFpVDvRYjDIqDYiVCCxC3i/kMpUv1VdCoEUqmz1SSLBAgYLq62sGe/eI8+PQK/+NwhWK/DkyrjwuLVWstOd+9oPJpLwvGL0+LxiTUPr1nFAvLu4LCU9CxU8Cyk9Azl+PCVtSlEDNLDjztz2mds+c9tnbhtP8s7JbeM+yIqy/ewV8jk2nl6pfzjIuKJDExfUm7ezNwki16W7qNUWb6O26Fa/IPa02e2V7Q/zqn0+AUEpdD4BOUqh8wmId30+n4B49TmfgHi94P/mCUh/7KFWs8fNw+3m1EcgIuTpcfFG744fPtBIYjNbLViEBmXzCH7W8YoelKBdCe/71d1Di/pQxvu698hTjp4Xr6+bC4mA6jeWJhWBr0zd1MR+lfoaQhbmI4+y8tLHLaqUIUri9itEbpFoE1VvluqXALl+CZzCtiYhSf4pkL4EyO6Bzl+yLI/mSPtxg3t4eYYUvjMkEgYoNPWVoPP0j2YCXs+fxGQ52gu3lk5PY0KmpTGpCCaJqTcPytTyR+cxQaZBCY3bb9wH05X4TT4YsPjKXJjny7uojMBr5+ZSHP1VRBSXtyGOrqOigqCVDd3soacNcYemoMl5nFoJRTVZBHY2HheBn4yhmbSo8LZQMvDLXtC6UlT4poBa4EWMr4/4VoyXDxgT4wICRoRDwHX4oqiU3ra/bVpLXitFzstiMzSnLYv7qWLKunJEkzHZG+A249bCJZfSoCZXZGo3b6b18ubkvYxPsr+Qv1QRXPmjHKbOSVLF/76+PWmOUypOn+P0MGMpkk/AZCyt+YB9qAkApIbYmkcEmxALpB4qs+qNo+rKrLpyVF0Nqt5E9NR5TVvq4YB5aLsA7+p9yLymoAwa4Ly4PWKGEwGoMdEJrHiAEi4vjiK8sBFioiatC8bnIyaW8r+szN5TTmyn+ysVn0gdVBy3lp3A4bHNqg/Fi6vNn7cPP9++vEwwdMUnW3oWN6nmx5bH9tPxhr5f35XbyZaePqTriWzcxI5Cf1EoS88S2PHhbXqqwT/zJLVwp6BH2sReWXRaRHWNM9+12uboDc/m9bb4/vHhQXoGjxs67ii0Bxgznl8s5ibsP/6wDx2xl5c2W998d/vPuJhdQXtB4LgpFeqbgO2xrhTfsXZ3jnYyW3yHO4guOP0Wt6JhdyUr83j7Pqooake4QaVxbi/PRPzUO8egCx7w9ub1BruTPM8ZYXOGzSMe/jXt5gwOAXQHIWYNvzJU70WBylg7Q510/mKj8xd/0/kLGRv1P5rqKt4DFaxiIFKYSBZtwNmTh11ct8KTtlHNQcHUBqJZR4dIs1HXEnh6knCmqR4brTT5HiDrNifnleUtV5aaev6eIKZzvy6+hYXrwQD8vR4ssygjDGHwrlmcdJXjo6uc+FhRwAMwQ4YML7kwssCFMRniGX4hrVhUJeCyR+0ll+FWUimS4FbSxIVMLeT/YM21gIkpUriQqY28/oDLODvtMk66yRRXXds6dnzrkm5yPnsNC3kN1O01MI/XwOb0GthEr4Gc0GvQIzPx/L2YRZlOWApVli69UR91YoTpxPzwuHto3g4/tQ9DxVI+DBVvee3J3OOLwRWmOa4kDa49+Z2lbQncSQJ12o1fekLkbFZeg/RHdhGHsLtL89ZRQVXqUURaY+XnXUZSEX9WY5UcNpX/ItMJb0v5LyqXsMqVmil9cyjJK7GTJRN//hulLCFRKfV1XYxjhxfjpBDXuGIHo4RFnSxgXNnD5NCp1v9A7rvu00tlT3isUMt17SzvycB9JccUjORmBzUDigFIYfcPR9x9eBaqRaXXtW8aXlRwwysrtSFrsP7U3xJ7tWvSngG6lqauSR8f54m5q4QUWpQgNjOxqURGjumCml21c8ToJYOoP1kUdankWmFLRFaxqy2VQMcFlL80XIuO5T/N/wM+1dpUw8wRNYKt9lg1WzWbR0RO8GYOgo1WyJAyarZPffiyOGCNrd08FZfXti+KHSXosEgcNfVCJreLtFidfwwswfoSCtmWOmUercPNm32F8wq6v5kGbdaOuSHaxQngKmh3gwy448rwd0je4AoqFCi6DrhwBIh4JgFRnoCMigfFq47LSPBqxKMCsk4JRKzol1+cZgs98yZ6mYhRbXn/9nqxqKNKIAXoNytal7iUv5dAwq2/gjJuMVzYE1S9/kaPS/eVIRsPRQfa4+IwxnW2kdJNN+vaP1S8HUVtW1GksZBhd67qb4pB3Qz75NYCcZj/PZPKzwBZ8cf46u4fwqZNdPkPMWmiSLKeDjM4sp9v/9ieObJZWghxZOXyHNkV/Qj8WGnyY2UIP1b+h/ixasCP7Y7hx6pl+TEsO1Yzs0cD2LFdtHuP7FhtsWOqRTvvyW/T8KKGG16b7FjNJPbE7FjNTQXc7Fidmdi52LE6GTJeO4p6R+Vedj8q575mx+rZ2LHKVMNMtu5k0pq5ql6KHavkjBFKXDV/gaSumv+hSzo4NWbbsS1xerILehDtiroCBUQIE0UHwp1U12ZKJMKAS2P4B1/egOpyXWdWQxzDD0kZAfEckAwG61EnOBHcpcbxqRM23Z7xXTFdH4Lr6roP8cSu2kQFBV6gt237yQK/bet2bZd626ZXqOF2H11c/cbs8gy7cd4P3/dOV3WTJvN3NmQr+4X2rwVvfFekoe6D2Q1d9zi7IX9+Q6LqP2/M+4ewhodUHR9HUWG/tPuHsNkOW/5jzHUoikqzURZFdbm+K88c1TwtPHNUZ47qzFGdOaozRzUfR7UJjeCqW6w/wummsAicmUmtTdR8pR+S1JoYjWUb/aAEPVNaZ0rLopLWNYYGWphKwvFZ8WRSzaHCM8E88nems0Y2eOXltE25HJ9Hhk1N3R9uZtqgHr1D1gLSr6ZsULcHG9QpRM1yVNi2nDZQFIOyLOkYZKiJjNb54/kYH8/9Q1j/hdR+XOCa/pqm1Ky+pamkluavbFbr96czpTVLC89XExG01vlq4vlq4vlq4vlqYtDVxG1o8NUyVxO3zUcXv+uriUcEX/2lCx0ahaKZKr5QgBe1a3k7Pgy8z/i2txm3uAr+i7cZqwR/m5HNcRWRwXci8ZoAMtYBSdg+0H3GD0GLVQn2waDlbgelSAHeyzkjjElQ+SNvhaGvJwVRNktwW7tL7P1Vl62OCw7alsFxSSM104OoqDekxd7BjUT02Lt/CJsA0OXf7eePtODuEnc58WN+EShyTNNgzf8rbm+u7h4flubEXv8weSsSC8KTEz+X/VIW1o68oNHrH+78+33Mwc3jS8PhUJK48HSI54yi3hGV0SI3yuOvvInreqj/9W4FVcAo9r462kEJBC3qnvJZP0QvJdw4XYDaBVrroV4V/Tp6bZrozyDYQ/0viyqoAkaYBIYNtLPGabNJOxPGoW55jB8mByTEn56zTk6LAe9/h8mgQTKAII6gtoxHKQQYFFQjoFdnyYmohAQ8IIvJ6qwasVWNMFMK1myeXdWse6rg5Le6i/0On+8kkH51rL9Ekf6S+nPQ46xoAXxiE/TMc2z5iiMvGqg/Bz0kjxZApwogyCYEZjHW3lvryq2v7n7dbtZPt0t7c5JgQ77yvqhHF5jOeJgvBfnGuwRXFJkpWAI3/sfQ21fWkU+sS3BNsTmSaXQdvQFjfGyqYvrmjOuoduXN9KU9LMsw4B3Mt7Bvw9d1kymt2H9uVa/phFWd4rbyE3NJTnyXKnQt6ZcPvZz89fhQLLspX2+sOZlFHDidvEYn1VtopoA+sPIm5ERkhp0EoMXEQxXtpCHmCWuW2Cn+a9slq9u0HXotf5vlVOU9zBNTvP/yZtqHPtVzLm9mninUn8x54dvisXNBl/b1KmJNFDTLuaKTkL5emsfJHu7PGERY0on3EmctPktb+Sh3rvRqb7uKXu3tjKN+7e18P4b2743tQnk+49NZALEyLiDAfwPaEERTAc4bflaHRAQ9YjzH6zBLucP3AV26qEcdEAIxv1eu2TZisW18jtX2fay3k/xyMpXrmujYYx9uvV/qfHczC1fn56nUnwOyMwUIYDiXBe7BieWnXj65R1oQ7XN1Xpd2tLTf9fD39sQ03/62wVuTfMJx6rixYrs9LNt6V9CDIP1iA4BLC1x2YO97Dvuj41Qp4g+UV6elpRd/PzwPljUC0I0FVcAIkrodnqtKvaANuQVVwFPm3vjl8f5q05KPlz35eKnJR/mDgLjHYnyr28k8Mf84B6sAyVh396hRQpajJrQaSBd0Mr0BqbEJUOMoigTVJ50WR3h+yo5bVXR+nuVf9q6t12kYBv+VinekJr2OF4SABx4QCJB4HttgiHJg4wy6f0/SNqzpSO3EaddCEUIHcF03l8+Ob5mG5YfxtLSSo7a8yY7acmTV4t8fxrZBA54O3R+162XXO5Lbo8NQflZSVToOnWyG4xGTeYCt8UAOEUIMa3tMGGDKFjt9KHbv1z/HiLtqlaUpT9CFpTcJ0P61gpMnavD7a0QfVqZbcx01MlS6h4s+t5p37SzJg+gBnGd2Zpc8M7Dp1ZnVmWao3ksfBOMzM5Imbb4xIESqEfcLsdWdqnD567ePvPtAIunhnk3rDz8uyY29mZOPHwXiNUEo/oQvVRdtwlUqpIlxrjOumRsY552qPfG0kbEW95c5lmUeiMEHMzIFpXi2b1Lia8bRAzh/s2IcK8bAxfE1W26kTduMEykxqt5TME77Ga/acycHuIcvS9rzIceijzhsi7wCRGasSx33UfPLF0pqIVnPJzJtuhmHRInbzFkEce+Wlpp3lSx4Qyf4Xk6U4vxUrY8VdJ4UJy4x2VJeA+V9B5lrtEAcKKurMe/HO05CrcAYT0yJLITix1rBqQpIZjqwymmcTMMuQ7ctmxxUo3Pew/mqTCxiFYa2XSk+FP7/HNH+5KHCBwvc/f4S4SyyPeHLvShX6huFyS7CWJVDqdfifMYlS5BeZ+BzWHxpffR3gmb0EyOBSnXFfREkD4PkCQF5Vnbi2B7i1MlNneTUdW2jHuP+aEX4FFeRjlw4dd3th4V/Olh7at1j3x1oe2bd5j3IjNrGvhAMwLKv+pTDAo7KFLau4hKEAVw+JROQmRQ3+LUFc4u1s2fXfBrWeDL1jTCnAZfMvrODVStV0DyTf/kHcgexhhfZuR7i+2fAuYMla6cY8zqVgfuwlm5rKxVoU6kYLJGBERMRqIkQ1LKlI/H5YVIflX3QMReerovi2yjxePfGgjyhNBbsEMdt4jReZdkNvMvjdCGs/7NtEaz5pT0f0vRpmFg2vtt7bXt34O1viARv1ezNJFLLu6hECoMDN4oUX4kUBw0njKWFacC4Lbn2RG2c4XzQ1ubZDYrsI8ONG6igQ23VgrGM2hkXN5zhtnRNBdotCssMJqXalH3l0BHOqHTpR9a0z8e9wL0fGfIL6hfEhhfE+FTaG/gTF8MYUXx39GgYT8M0JvQfI5bOUfNjy8gTAzA/tBiqGh5rGRfUWnYjA+6JgfMkFMjn0YcDdTzongfkP++K4vP3H7thfXRLvulcakCXbE0Mi/lla44VCJyC/rZLL/xvMzV7fUlKLbR1xJvPHz4M34uP5Eayup+C8eQ2jWFo4See/Mk7zNTYGO9L6PpH1gy8M6G6CiGUJ2oTadsRsWbVzREGtuLQp5xHKndHUivOvV6j5tnad6Tkhr0uMu9Pc7pYeVLg9Lhf2zwIUb39q/SnCJHw1pDi8t0EqZTBRLvVE05hH83HNn1cB/LgC0YEbRnJ379M7rz2qEX17SJwguxHFhx6vJebsiMAC7iRtstYPNzHmetjLMkVMTgUqLze9jo6sHaIF7h1o+TVukPculHibt1oBjqWwwF2pTwkQtBWhiB4T4b4rOqJs0mOrM09FbRGj+NGlyTTJelSH/cdb+MBd0uNFICJwUgNo9FOrzzkwXGvFh2YD31IJHWIS4eOemk3ZXzV8gt1r0618o1TvTnHbXlXgAzJ1SaJoUtpNtpXbqrPxF47XC0k8+LQFhKTv8+ZYQ5zU3rFuB7jJoPTohdZc1o5uOVw8qSVwllZC/guDEiXsVLx6lpa1uPuzKfu0j0gHbL8bzyEVrZqAkE+nYY9t3Gccdey6hkPvDoXHpruDUnt2U19nAuHOxni7iOwOD4i3L+H03prTCvcNC7ITQUxVk1PJV98WibWUam49vlbN2BGa0QTFts6Ahha3hpaCwe8nawp0gHb78Y/gvdMAt+aNN8aAzOT0L42Qd5HiltGio1ptaY0YRsuCUlYYbUAQ1s0M0gSVugD5EIyuGbGuolF4VEGI18xWB/nfxLNzAyQV/DivlaysZpYydYuPR1/Vw1qyS2q9vaLc1G1i6qF1/w/rmpRZWUJjFMFFTpqllawYCFFgpxM2Eig5I1HSK0nWVoqTgspUPgIJFNoIbG/RMn4Eiaz/UJ0uvISKkOFypYw2b8UJjtZhMmuiglPFSkxnnayiqddybCphVhCb72ht9NfQm/49PpT9X6LGN3JQ4zuZBOj21zJvKllGC2cdzKG8wyhP22AjaQnm7hf0mWbGGRtz9kpwgcTK6bVAIwXSTzZRBLP8dUyiCWxr6CjNnKb1tDBIcpaGtPqydoz0hufPGfdCclMI3cVyBS0mKBnLWo2q0jmcY8LM/4lkomp2eb2Ndsuocwtqmr7prFMSqquz1DmcY/hMVAs85y2Y5nH/X8Wy0Rcrr44WK2FRTkQAnBocQ7WDzRZ/ThYD9RvXRyseOeilbBYB+uBtkHdHaxLLNNxZqeGZsUSyySqWvrmkn+32eNWUwBDScm9oDQfB6UTLyiNjZwQFeDRB0p70vZg8S3RsCljLzZjMg7Kci8oi9UpRHO8sLAZnUKhlCAk1uCBQ6GUgCx22UzDxoBDoZSALEp124RCeR0L/ViIMvP9+nj/pLjfHe/W97vXx28bYej5DhoaY1bKWfjjxxau6xCetF7Sz0XLDSrJAr7i+aoTdzAUm7el+Vwg6sc/VITjX3Y5oD/JQ+k3OTH+SG6cXPivlx7Ol4QDkXpi5JKGUURVHyv6ffMTsmqa2swPfL1cvw7vxzZdAd8fOrxcMsDZXODrPVV/16BuBnAd359+Kwrxn0PDut+L2KcPo2YewwNpCwfHvE19OCQMfonwkdgw4k+kEymsRiiEIdG0rXnDwPEYVlv5oG3Y/3YQ0EyPh7THkcK7ApJCnC4O3d2JVfrtODgSLa2MZo+iSzOjeTczGq+d0XBKCaeIloZGA5i0F12h65Bnu81nGQEYXIX8Z8bscAhqg35OyLXYwo01SHAyMpotzHHmpPHtOGPWFUtamKFDSbE+D44jQ5uii30Z/H/A9q8bU4iaY3NvYltPJcac4khXYYHzE7ojmYCsLox9/vF9BCDrFCYlQbrgwWTw4Nc2vb4HaeJ4IK2ctLJyUisrhxDcJlo5Ce7xC7KwGlciKqrUcoOpOM6oohBEx5Vvm9PX3Z33ElLg8nWWRZwHnKXC4sHcQsJDltX0i4FyJYVFfYBnRPrL7RNs+njULKN985MVLlEiEfJlOHCBWcgNBB+lei9dZWHeYdZPxaOVkaqhkLt0kAtYr/FKh7Hn5f1xvRkcxUre9RfN8WYBY6VR7A2N3M2jkjujUe0Iks/OzEBycQNxdyAiGkjImKbrDldbWd/gL+6+n+5fne6/n4bf5JG2yXmQmO5r0+giI12i0cVGulSjWwVsQrZOGePxZVCMYiEdpMoID1KD4VxKwLmkfQ5M5gJzSQVziRXMEdKLiTCHPAeaHq/3C5hg7YqSOh7qSFmliRVvRVht/Wl3M8TwsNv9nY7c96n74ejXNm/iUnl9QJrFPoWr/4Jftc9D/IkuzCIfnoibGZkJVdxZRd6sNjOy1E2Obl6Nbo4eXeZndPMHzhUQ5NBkjhhhcDiXhemyMHu1jK5LdE3zcv3pbnf/eSM8i1+GNsq1C4/3kwxM7LcRRsss+rLPmShHse1OjP4JddlEQCxRCQGnlyhEVEchWDvPzCEIkeLM1p73hu232uSJWShI2/FMPYyn/l02H+Eg8H+5AIyKSFc1Ji10PH0dWguVvOMaiianheauP0D/L8jBXQPNMsA+jAYiHymQ7pObhdF7Xize6wphA+qwekCtikNtvgz8DAeRl0XktIgwelAoO4MefLf+PnwR6ND5rhMvvWqTCkXEFPH6nguzYL8YBZ6NAneV/g9XJO032G5XpNoe8OEJlDPJPYhE9qa4DUzeJfZlogJ8g+I6wN+d1oUM/NwcT/ZbFmI28z8JKcpPlcwoquMYfUU4IIimm/FxnBuiuLMKHvvbpZet+LdN+ur77ri+H6GAsYyQuSXxhHNLPBgpfvJCyKBSxs6o0knqiP5lWBn+REjMyjA9znCP02ClBR46tOyOnwY/2eEyXGeME/EUYIITYCLuuiglo+njhEuOKwEnvLT9GSzHVW1lbXufivvP27HKcfTymijNkt5qnLxTjZPl/A89bJas+CqvyVHWCeM8T2t6VEYty5NVMrXiIJuE2eGOSaq5aY7hMcg56czbWarnfOJIhYumdCqI0A5xVSaT5Yj0/f7qHbmnam5REituRiKWh9xEVG2fP1TI+h2FhGZmUZqBhpLx+IbmYNU5mSURV5wpicWKDcsZKKBRQYXil08uKU9gfdVfEFYtF8UMsVzSyI1q2EVltST4Kvszl4QlIdgQLQ6/1YFxtCIuBh7mBmaG9RfHaeZCZbsY7DaOr2gtDfGJeGO1/GEuLA+ptaMoxYJSUReViAQJq+29IP60EX8BZus5uy0wK/zsMZovcOoDOv8PY5mlEXkv43YpasdrIIPdywjEiuMUvJtKMXdgZrtHtG1J/UoPMEHHqlVG11NelJ1kQjZZ3I+BaEec5nTTHXKvPn4sPt/tqtqXERzv8e0d724xLYQbysZj7sVz7xpCQDve43k43pHurFo7W2rmeXvnLc5+TYgTPTz118XuwxPVDGjFkNrHiB//36k24n8X468VwHfxr6NdaNDpkRYHyfgqwBU4EQjuIZxho0cGiWbMrdUZqw9ebLQmZ4xoA7MQV4renx/CnN+PfD0BbzRI6SLO3ZgW59LrdWi4ISV6zLAWzbrZK7lCKMXBDbZC6KFsdyh/IbPJp1on9Oqux6wZ3JD538uD5oSey81MGBbLzUw30Sew+wJ7jl2ub3K9vgn0LdhNxH7j6e4HsATLx2IwyaB2M8lFgx0yvLjgKvjP1m6fhdQ9e70+7ra7j8Jq2o5+QXp1/sqCfJ4WxHDK30ZxOylduHnjrI5fsLpcWuQ5eXSQOnCevRszqgQZQgJwOJeF6bIwDQrOoM+6+u77eqQqVU3TLYGNiWm6ZH6azjm0QUklpKFFTnucIUvaja8nBkY48nkCXCk46gBVA18LQtwKIZrQ57zaXfxm79qWm6eB8Kt4uGeIVgfbDAwTknLBMAMDXMBlWhdSSFswgdo8PZJttV4rK8l2kgYI/0z/Ap9Wq5W83+qwUhdMjHIO11Di8LdJBBB/PulOKlabsrh+m+/7bV4vo4n5vCZ/nTMvnbjsu2zQZ3zoAz/HhYI4H729nybmJf5LnEpczOVY7/gkpHVI/5J9JnMwsktRGTediMhMeVvdlu3aNlqPD548iCwef7UpdN40uGLkqXkxR+1T3A+OXBVyYt89lye/TeOhHJ7dj3Je73LG/xpJBQ74bwvxH9sjn37u+/1CLoib0Zzy2PiIRf+zWzfGPMHGvIfi//5hQbKQ5RpMP38+PuoP+EvNT+dYab+evPv3sOj15F2MiOvJuwuNKmIp43p6aerppcgAJLYj7Ac94+jdQ+zt6R4tyvla7GK0+OR6+u6dxy8dKQ3DokHQ9P19qf/v5gwplw87fJPkgr1dVBme6MNCdvdgBgObdsLPFG/gcYubLBM8vbR7LcdEOKcLTsYEFpOCgv8anzv38MSuc3KRytmboxmDyD0U641sxcYdNUuMc190su1oGn8ENU6Tt4U8n3GJz7tC7808l0/3PV+4+euIw+PtIaPiF+t+/trsEqaUSvt+x9R68qXUjVXhNz0dXSRap0TS09EC7Rv98Uey0S7cB2c9uC6cMPLBBNabZ5bJwqAJJPSQFdNARs1z6z701ie07ldfgxVKksDmmA5js/3hx+Tn4tv7n37oRoUek/rXhf5lU+lfTI8czndlh9yykfc2irZX9npH9jpwjQFcOHUdeyo6Y+ZRdgImLj+2xevg+iNVvmJxmU9U+V1c8ahJ6cE7/4pN+ev901f6rNCsfqpY7MtmpKWgNfXkleLYroqyVXgC/98yyjuP393TqM8/tvg5Pv5QnIjDQRMgljpeOENkyFBoCNKGWOcNDpkTHTJfeFixQXTIUHjouYTPRn0Vs9BD8LoPv+3B3yNKY6PDtP01TLvUMM300N781b9tsBaXHanF0vtlhGEzaSRYfNQ95d0XWc3YWW9FmEEysV2VOI6AKhhfjF0dMRzX0d2f+uKs3bF55sBKASYOloDljAPg8qU/rzd77oukoCim3PbB20JYMEUyezbc0ReZj8P2gHf0RQBfbPqvV+9Zsge6qdCi7QrKJoGEHebeZpmsv4px19plQ8BfDsBBV0DZ3ZbhwypMKV9foaepdAFGndYrtz2oMaSB0pLvcEcZfGMD0j6s109GEy/88RX9+Fwkui6NJteZnhhuY6PMIyG5qJDeT6zTI7iEptXuocOraNu7pKi0zhErXlpfu+RFm5v31dadRY+tFmp1Ll9o6CPHZuaJLkyauT8+jFSjhJZAmJkjM9M6FDVS14Os+NC8pK5/3XEcqxplI1YpdblEK+Tricr1ftojUu7mruda2488YXhhM3Ld6sJ3XEbxfh3B+82WRLc9Kz6wG7Z2P8L6W7slof+KfxO94jFz074OxjkaHVqHanUoNrh+M8Cmh0TQZVNEXKTc1wusXsQ5e7P/Y/6ZuWNjAxEztu83pTr7HFzSnG7A0AdzCeoM8/X2T+S8Heh5+wYcPCSSy4x2Qvutd6o/hO++WA/wgPCHKuhvNe23JiYkZPeBuiIPsu+TdQXJDnyOttwiitRYXYiIXV6QT7ZQSnJR9tc9Xhp2IAhyU71iP/s4KUqN1CUOg7cotDRFkx2ntdgs+zEAy9vEEq3MdkOMk/XBAltv1LjfMBTw6Oaaim0FQyyg0GFLY2+XrN9aU435QROh/p84gkluKdl/aCwOYWjs42YQKupPQZeng8UNQ2GMUUTLoKIYrLQuTGtS1EhrP7haOrEirXNtwfYYsKnK2+mF2+lrqtOLYafT2Ns16nRTjf7h6/TC6fQ12enFoNNp7GMx6PTCdHpBd3pxoNMLstOx0rowrUlRI6394GrtdDqtc712Or3wdnq1RCX0CDNLtJQuNUbXDbqm0LsObS1u6kq0CFL7DRooBtmU8fjk6gtkSMMkG9LoX6Ae8mE7sdYoWg9dE210hK4NuqbR1Y1rcCOdkH3jGtxIp21Sr9i+b5P9lm5mC7UmoaFGKtJDN8/UQ7YRoRvTJaYyj9afI/k3AfkIXd2E5W/WqlfCrKmHKLBQrjdUlDdUrjdUlDdU2BsqZn74vKFyvKEivaFyvKGivKEaeEOVmPK0N1QHvKEivaHC3lDRmhQ10toPrtbK8YaK9obK8YbK7w0H0heNfE+BLxRyFFq6cSzUl4/AS9X4oIXvU1bIsaheiBqxPHhrvIU1JRVOQj86jIgmET4ymAQ3mAQqmAQ3mAQqmAQcTAIzP8gvqUZt3Vrmoh0AuA4AKAcwVNtgKQcA2AGAcQAetdeO2kuv+x/CtWv1+V0HvmKU00XzZe1vvSMR0EiEZiQyn4PGq9TYP7sG527ncKpzuNs5nOocjjuHM/MDPAbUJYajSvns7cBXymcV0YPni+afgGWEaxlBWUa4lhGUZQS2jGDmB3h8I9L9xcaVJHzlwFc++OcO/HPv8JJ9xwUqxpLStaSkLCldS0rKkhJbUjLzw2tJOWzr0mtJOcY01edylOFX1dMby3xkZJsCCXVKdwCvNbz2w4cngDsRFj5URrxJb8+jGPj5zwH/2Dth8qM9YaJ/AfKEifETdRelDA+Z0GdYwD3DwmV2sIKlv4LznmMxS0+EKeyYqu1wOXAW5IDAWHkQJy9wUdDnPE5MvvCqJcaqxUBFCoy0W+BAkeWjgZzgaRzjo/bdslPZrVXdmsF34WenI3dalt14WkZsQ5F7SJ+zbiwFj3+QIlZ2XE8XsWadWwiK6O8Z2S0ju2OkeWywldYN6BgVVtYQwe20oC1X00UsrSGCIgKGgMGeYrwh9PzRepeprbiZL+KVKIIiAobgkw3xuZjdnSsxe1CtOxHLoIiAIcTkT+NzOfsDX8nZbmYtO0MERQQMISePCDuuV8Gn44Jf1wwRr0FaUETAEGpgiHl7691+ut1az8++tb4YsbXOUsX/7VvroNL8urX+P9paz1R4MXRQIG419Lq1ft1av26tX7fWr1vr1631/8TWOtpXA7YI8+agQBxvXsYuoiY0cHgTSN4EhzeB4k0Y8CYkpjzNm3CAN4HkTcC8CbQmRY209oOrJTi8CTRvwtCFGvDl78FqQgOHN4HkzUGn09jHAga8CYY36U63eMSbZKdjpXVhWpOiRlr7wdXa6XSrc2D/uuNNCPAmIDcODW8CIR6j6wZdU+idQWPebNgQkuBcsONNaMp4eRMc3gSSN1EP+bBWrOVNMMxGGx2ha402ddG86RrcSKd40zW4ke49k+DwJlD0Bpg3LTR00sE0z9RDthGhG9MlprLYoxH1jZUfPB3R8KaVP+K0TviMxJKPPK3DJ5zW4S7PcopnucuznOJZjnmWM/PDx7Pc4VlO8ix3eJZTPMsHPMsTU57mWX6AZ8kENqy0LkxrUtRIaz+4WnKHZznNs3zoct/Al3Sc5gDPDjtdiyB5dtDpNPZRQzHPcsOzdKdbPOJZstOx0rowrUlRI6394GrtdLrVOXAQqeNZHuBZjtw+b3iWE+Ixum7QNYXeGTTmWZ4YESTPooFikE0ZL89yh2c5ybOoh3xYK9byLDdMSBsdoWuNNnXRPOsa3EineNY1uJHu41k+4Fm6mS3UmoSAWqmIZ3li6iHbiNCN6RJTWeyRuPomIB+hqxsrf8RZRN7wLPh4tn+2TECYZzE+jmeFy7OC4lnh8qygeFZgnhXM/PDxrHB4VpA8KxyeFRTPigHPisSUp3lWHOBZQblcrLQuTGtS1EhrP7haCodnBc2zYuhy38CXdDjzAM8OO12LIHl20Ok09lFDMc8Kw7N0p1s84lmy07HSujCtSVEjrRE4cFK15Vm60zV4yLMiwLMCuX3R8KwgxGN03aBrCr0zaMyzIjEiSJ5FA8UgmzJenhUOzwqSZ1EP+bBWrOVZYZiQNjpC1xpt6qJ51jW4kU7xrGtwI93Hs2LAs3QzNXTIs5Qe6AC0aZ6ph2wjQjemS0xlPp5F8m8C8hG6uunLj7poRrvYhme9O679k8cqYsMV4WPOcG+ky7KSYlnpsqykWFZilpXM/IB/51lyMe4suRh3llx4h4xAQ0Y2Q0bE5vHFJUS8TyJfIHetMz33mV45puc+0zvwFfcZMu3BGRMxlkxdS6aUJVPXkillyRRbMmXmh9eSqWNJ8FkydSwJPks68BX4LJn1LcmzGEtmriUzypKZa8mMsmSGLZkx8wN8wUlGJ+m4Zs/G5aFk4/JQsjF5KJtlPsjo9TJHPjb9N3d7KKd6KHd7KKd6KMc9lDPzwxep506knpOReo4jdRr7qKE4Us8TU56O1PMDkXpORepYaV2Y1qSokdZ+cLXOnUg9pyP13InUc/+cPHejBarTN8NOp7G3S9TpphrzA8jvzOJRGnLuS0PuF9BG8qchI/AyD6ch9wtoq4bTkCVidVNAu6b3yikz0gFJB+PR41LQjPRm58cnnSPp3DAvLR3Daw2vDTwuwU1HXyak8kkXSHoT5fukywPpc4KGqwNwTsPTA3CPMtm/Npcv746J5/Ny+cwx48O5fK8VXEIuX6Yic+8ic9KALbwCYXTWXOaVx1/lRWb1CYhMwhNx8pTfgHKsvEDWoRrbXsaEV2A6ukO4v0eysUMmmMaYT0pjNPHwvjvtWZoP26Yx8msa4/8jjXFEitLnMDvjbAWz897WcJo0xjFJa3x2DuLK+uTpItb8NGmMfIQhbA7i9BviV5ZMpouwaYzroIhxaYxihCHk7Fas5GxbvqYxBkWMS2McMyLU7HG9mp/ha9MYl0ER49IYx/iIdLanW6Wz/e06PVKGbzqdNbLZ3LfKZjPwOjtShm+GDSHjDXGTv4ZqU1vxxXwRr1O3oIiAIfKBIeZn+OZthu92s/vpi/d4xIqbf2KzfA32HGm+B3JCl60qdnmynUzqJWT9xl58hq+VE/dMFngTfH/uw7fmydMXAji8fq1xJGQrmdvKn6FtZuxbYFYQ8cLEqDzmouqbvWba5NuIF2DLZkETYt6rrZi2ykvEIwzep2LvKoZlsoRC1mhhEbRcUiZaU4SkpGViK5naL2dNy44H8n2wms1b0uq+q4t+ZG3hatf1cN30X8zzZsR6hB57nRQWJ2X2U21TX4wb8yLuf+Jlkfd+ZG32Y6MVO5KAYDB85IfeArFPP+Ax8Y8OhU4eRhSII14SkScii6G9l4QtDDTqdSdDfCyCIjsoxD5qROd2iWnPS+3NbnrhOUDysMM2SIhzMg8lwkkSd4tCJkg45shz0EDAc24LEeN/Jz6VSbtfY+p9V33ZWvRW//Wf8MHbu/gnjO7+vH24+/z+b/qFJusMyacXbU20Kq4zs9WOUob1Khvh+yPsYiue52GNS7Xe9bf95ufnp1NPLrc/4QukQKaEe/trgJTAGpd11mnlHy8FDJ8I/Mk7G/pji0qYK5L+CpT46+6tgDmh8lYg+BChmaAZpfJU5HzELK0plGYss4WCb/HZQoLzLOsKBV8+NIWMBRRwkXeFYiZ8TSEAkHaCHXwA0BbKF4s81YVi3ro+JRkbKI8lYzpXTMZTvJpG8Xr0NZNmFjG9NljdUaRc7mB1y0JEb+93Zudn+sP70O1uQdxE7bCEdpl91oTRvjHM58jgo2QQk/NRbTksA0ZY9Pjz1grazfxuL1/+h+Km194Jh00nm35u72bOf+VMBSo1c/pqv7XgrhgpgEcKGB2ftUGZDdGq5l9OGp/pxbt+2AXm8cyo+IxJkR6Iz04anbWLir0QQIaW/J2l8G4l/FixnLND0KEj4ovmpGPcY9JNpMOVERxD8SMYviFtMnD4vde6znDJh+Qq+u99wZvkd1os793m+TskgpQoMJCTQImAvrp7R1mNklJjCWTaa/zvKvldJB9S0H4Ow+88+T1tqw+un/yeJSAI5L4/Er3IcjCqHnaRMZipYxiDnXY/ot0uIHYLZm4WnD1yLEcsz1MhG4wKt8SpQrZj7DRU7AhhXzB27MV97nKZ+WyOv1r2vjGf7ZoZId/sDYO5MaP9UqaWr2BuyBe75REdsbXxWtUL154f77/Zbfb3Zw3YTAT07mFY+OjFuDisGBlWMeeYAQtSpTkRQO/eV+AcHbhSZRxVBjz7PoYdjsBSfpK6jRExifQRPxG76Q9H3E6/BHKasZlesXmrCbOZhcXtZZ9rK9z8G2ISQyzlw9/PT/vN7ru78nm3O/WWzYBhmFkTeIcTfi5n+FYn7rY+xjiE73v4O/u0BoEVQ6xosfZPYG1cF9H1JaQytRiCPViFJ3EaTEJTBwokVvawteqD7Z/AJkjp1aUSQ6gVf94DcQSrgiSy1O620aR6Wlr1L5PfbWMI7Qi0GkrAUzFC5hIrota28fv2r7IdabdGk2Ow6+n4VZ8gL59/1V/GT5vdH/cfJPfVvvzzj4fnp69/tf9NF4gi4bIbAhG7Au1h9pdvO/i2+8UeZ1/Yw+xmuGlpMQxYia764NyqX7mwlYuDlUNs5dwO/4n8rdWOlBAwXfNh2AZ8KNtE2shWdEdu05kqNGazGrBFNkaFzs/VwQfP6GEQKSDYiKAZu2AqLkK1HVxHHDWar1r0EDf9E9M2Gygi1/HTw067vWJT/nr/9NW9nnQf0Zn8y+3VtS3gqo7bNKZgQttivtYRo+Hp+Wlex3dOiB/BNjCFRuZ68opP4aGg/rFMVLbmkzMrn8LAs3333fY4BIQYfNaHyqM/1GBYMrNNEU7sKA4n2I5Rw3pkeHUcOvDEWJHnJUa4zLYRIzpyavuj3eJu1ucZOhoyXARq/vNDWd7//OduU353v9mxU6/IVBLnSihIE2CKXpYHhM9EJr14YAjPVLoAfwGBCwgJbYHggcVmT11xWHjhCsEzxaQXniM44zlPvXiWDQpA3ulz/qOR9Kq9ONKyfdzSALlsD0dZt9c2H7++UMn2QCFv1xeguxwov/AFhpdPP+gG09b+FufzmmC0MZfUv0x3fM332MhZfDAxMmGCSdmqwiEYW5FSMp61DRJCBoMcUorxR42UlLPJugBb5GkjJWN8ui6pWrRS2EKkM5RRXU8b5zO9l1TGO20gF8FAhe4mJmQrJlvkkxvFxAK6Rs3qbg6ia1SezuipheTQaZPzyY0y5KmltF02uaPSlHUGlgomN0mkqmtRqthkKVKpzrw8n2FeLjvjymyyEJ5C1yCWTv+YFu1Xrab7BhNRNULm2JWnrSIA0z+hlHd8qzhMHmwZlxCtSfQGaRsODwJfNxiGkwfDOLjN0y70DGb2NHDJUz+cKYRnTLFAgXwQCyvhD24BB59Zlo4KnTPwwgehLWRpIBYWuECeMvAXUEP9RaBAigtI7Y39BsIqKSXk5UXnxzr6WWdxIojoXHXRdVSM74vPQcyOz1nexucs/c8G6Ex0DCy4iNj1oyOlNF/MDdAldAF6mk7mLJYtunCWs3R6/KhsmK8knyzlLSbWX3yQt2hd8i5gy8Visi4sg47NGZsVn1vDMOBsuphMe3EbPk43sKEmG59zOV0bkQsbhvJ0uhhg1jZyRnzeEHQ3d8mmT4HyLD1Cm7K0G8GGRifrkkpIuxax6XNvkbN0/sRFZAs7MwQxWQqDrJOSZtNbxDm3A2ZGH9nvMZvuNXluJz966E7uZsa6IZfB9NZI3glJs+kzFyG79RWupvdOJmXnvXk22SZ5CvZjDs8q50xdoJ267O5/2i/L8vnl5LkD7GDyQPiex/fLMxh3x+OByw/bUsGn/mMvhSwqGHUrJEr63DVXOkRdpLE19zDC2XM+ce5FzRqFt0XwhkwtWAPb5Itzp0pQtxwy8vGB8uSXHEL0udF3nDjO39WJOzVKaXGcTZ2oM6N4xsj6V0SU7XwRjjFdPNVkMW5ieIRcQZiXj3GkVMHZ5SdT//xUQzhBSshbgIDjhdVmt3v+c3+GlJB/2LvW3shpKPpXIr4jxXYyDwmQum2BKUVFSEh8HTqFqRja7vQV/3vsOJ76Jrn2dZJ5LARtul10fH1949jHr2PWkImgSkSHwCIGnLngSTafTo9wNKVJTHJz++OOlwxBNJriz0ue8IQZNJH7WCOeHARCsLBsRCMbkVhLHmEIWwahbFtxZ8wl97AIsxcEf+aoS1nDpSypLFGoVpPEBQXLnuvsbFB+ZlStw6JbAX2ujMz6GgduBQxHUA11mYEEBO0TirSakdj+QoSzd2fMaaTS5MCRHPhQ0twCYa2i0xHilgwyJIMIxneE41QoMRYnQYzF4YhxQz3tvyz73Ysa95bRoIpQ7Jubdmb3PaXPtzRm3JdZo+mp25DxFziQgeDFVOTBgRkeNMcDdpTwabu83b8iCRgczIQQpzup2MLDK+oXFEFzyegyKIL2jzL/meFA4cqLKRcS8jDgs0jWcTOgQ17/UtsJYokzhYNKkZAmHvU13Fp7mE9pssNaI0+yCh5UXguKxLy4LjPD20mKaiuFlicz++mhquvbKCZZUdWI+VV7mIzA8/bJ8hB6tR2I49GUdgXmBflmAI/Q2Zegc0Y7nUrgcFXEwhTu4yjQ+6o6CiSZe6Srwym79S2x7/Znnn5FPhLrJI85joYXgMhfWz0gHu+MPbE6vnhi8pN+8cG565KGQlb6990hpq0BMT3mVYVxk8VxenmSxYkfSY6I8YdZ2X+Ikx2ClSGkrNPk3qGmxvZMmmgTY/1J08Fo07GJ09560IH6z0187xPT93QjHf/zoBHmk2wfveu0z++3t3rfWjnRdICum9VUCOkrzl8zlnHB5tRF5zA8A3Ar1oLjc6KC4h5pxzJvkIjcXV6nzDQt82EXnO8eVGV0EzGzfMxZPtf/tacqq3Mjq6yWqpnuZY1MbOEJ6inyYArupHgBMpJN9PbdnUt8X3GVQj9rzPx2DS6vIiR4B8us75opvXjMA/Q6gH4XwLZxJsWNC2DcwtHovL/86JJHlV1S1pf2SrE2aEtMt2svelV8oJcvvDSuLCQqT4zJfjhTJlgHEugM4H1cP+Kx0cbhyrwG4/Vm4U4q68hvcSXPV/cD1l7oB/keX7mLlQorcaxwsNuF+oMi3TnfV12pXgWCzF0k9yEnTu6vWfKaK8sIdOpCJwlTlhHkzMm+9HOKAOe7yvB5+5K8zhAYS6GXTAcfwzIXy1INlijYuXZcF2iuUjAMKyxWV1ymkBxDwhel2+FJtcCBpXAuWtEpqifD4BOQQZ6k9iPF6u4UJJgQPJoBjybVM8Xgc5DBTCvRrrD48LQBtv5gKRjwZp4oGzolBucWvvzjWWGxfVr3tt+01YVzRXLwr1q4ZpfoDrMlBzaFx+ay1gUbl5KlpwN4qrptG8C7MoU25O8Fzuq9gDKE9wJnsBfwolfFWUsvcJaoPLFe4KzRC3gTFGf1XuDM0wuc1XuBM39kLmFkWPLsi8wljIwXvSoua5FhibKQqDyxyFzWIhNIoDOAkbn0ROayHplLf2QuYGS4PzIXMDLcH5mLWmR4oiwkKk8sMhe1yAQSFBf1yFx4InNRj4wDbvP+B6esmjl6vw+p0TaOIXRp2rpS8owfPH674JJo/OD3+1OU359i/P4E/U4TlZvHcxcuNVxl5/P9GR6KUVj1Vi28AZYuWGrwGw4uuGv5h4BlF6zDrS3jHPMGckymP2nMdsFu3IFSocA3Og0aQ4iXGu+1z6F9HrLPoX1u7Xsq2A04uXSjwqNKhdUvFyxLsETBH4F8XCUqn0QlB9ULvWNPe1CaZ1+FN1JrnyVDsReuy58Z2D8d2I2iY6fsoh5nDnaliufD5nDfyufMg5042Isb/QfHTt3S5bp0ExQ7s1g1N1HezYd+Mqu7zQ1g+iotgn1QbxUMnm487OnZgC0xfLBo1OW5W501elX4osFSN8zzRBfEi2cw1DoHzxLQ98wZfajE6lEBz3DzHNS9svIB2QFonbvOM54wx3YzwVI569Bb7Tu2ccut1DpZOC5ZLS6Ffk/4kYBaYDL1CG9gchCYrAyMwBqdWmByEJh2+5NGo6bfHhafaRuaY+hZow1cSdz2vAWN2uap22aqYqhn5mkzOYP4qXrmPjyokNy0hniFBJeJ8jKENjJIRWgkkTqJxJM8K3tgnuZ70+fe4AkkSCBVgrUvgbIPaKXO0cNyXPSbRkuLxq9/YYs6C1hofozmAfHS4NcovuDQPg/Z59A+t/Y9LGABPoFFyQIW2AfpgmUJlih4AVnAIlHJE+xqZcgBFqVxhmAhB1BYhmIvXIffmGaAaPDeyNN7b6D/VwXDkW7v/yaStwxFgr5/of6gyKlbplyXaYIgQb//Zvv91l5/AXr9txlisaVbxh0FnfKb6ZQ9aAYjsJIodlWcu/2OSqoeFYcMMQ26Y41ONR61zV23dXdcWUY64wXsjBeIE7AzVrhQPDIYDx3pr7GAyFpAMvUIT0ByEJBMBwTvhmsByb0BeYNdMNONhIopWsppG5ojaNgFG7TEbc9b0Kht2AWrYqhnhjZYnEH0VD1zHA0qIDcNEV4Bnb5UJS3D54nKSjYSqJiAoja63nPQ9Z6bJZUFBpcALhV8jcOL80a3e+7pds8b3a6DbuLvn19Sd3ZfWy8TWWcacOZkoFMHZ9Tvy8mw1Ilpmcz+YFgqsLZZ2lCv2RrD0nDg3TsjePcOvTPJ7A/bvSGlgrHQhhJj0JcfTKeQNg068e1GQpOupEDezxOYotFIiSGF+8E9seSJJykCdVvOJ4GfLHlym8GnrFz8XWNzfU9OyJ9yXazih3asrGF1wSSCLT7V7Z6rGTPEbh2rPhVZYdu2GtQ/lO9LUottTGBgpSL8mdw9cMcblaJ6sBmA9xRkoN6eb9YZfk0qcXDpydZT65FOo6yox9OcmG+g8d2WtvBGy9Z+8E1U+eNT9Ivaso5/in4Bp+gBGmPxcFlnoWbcw0zeLuv4E+gM4BT9Ag+PNg6n6DUYn89YNOJ/u8qwarc8c79Z08pqPIL+VEcrLMddv18VIO7voQ28Kwne6ppFbPhVcUwTlWPwqm4N1cAkJWwOfjNWJWFzsIIqYJIebnPwL4+b5dbsD1bvwjlVpf9ll3nLLVToye7izOwMPIPb+Srbgcyyj8zSj3zsPqrW7C5Ndpcx2f3qnEj71Wb1q7PBDDgl4p363jj1fbxTecMp9OpX3Q9J3e205nLgTdnLRauLC+PigrKluvz+m1aqzl2WHTfFzvIsol4iJj61B1z7UXb0ffd3338ZG7xpp59232B4IzJ68PzCmLig7yfevldHgLbOJVqWRpe9vWXHxC3N7uvten7eVrLOBnZVvbsPu8YnIpTMhpLZUFruZUNZ/hV1/2Nz2zbYpQ3Vwn69/2s9SoySlbyOqjAaKzBav4W9QGdK+sqL0tSrVpJwxt+Ii8Zoi3qOhxWZCxUamKSncg4fPSWv31zMMfwvV4a0k0YR4UxajE7SABqkezzXFiPI2lW7iqaGWmSjHOpggkm95VALMYyBziWwX2nX9IXoKdokhtG86m0gWAIyWSsTA04Gedoo7bpJshnjxzus/1+Uds0PpOy64qO265et7Vpk9QEFi5CB5XQZ2HUZjYKjYAHA7t0Jh5mv/b27xNaoBvsfUINd39JZ+QCDA9QL+hCl00iLqAZbiFEOdpSDHXBs0Z/bZwMZ6PwSew+PMqK4GG6gryatGMZAcHzUd3y1+V/K+jYGhHCs+AWpsoRVVuBwMc3y6WTGqCNGxual/VGVJXasOKqyjKosoyrLqMoyqrKMqiyjKstXZgcaSZhl2dYF8sRYGHVRDqOLMmpcjBoXo8bFqHExalyMGhejxkU4LqPGxahxMWpcjBoXo8bFqHExalyMGhejxsWocXFKGhfjUXEsMhsz49OU2VgGzt5f1wO68c4dXsOI+uGrQsEbIb1OVK5YSK8bIfUm0BnAkF57QnpdD6kFI+zop9oknL+wUsNtKINwY9w2fbqB/8njuQtWFUHl5ff8Ks7zqyjPr6DnaaLy8/juwqVphnfwUSNl1EihaKQ8rhoaKWD1uAF3/Xlchf15XDn+6BTVw9AB6UtTHEUnwHpdoLZEEVt6fnE80imqp/KIqiPDqSoyQX+aKjLVw05AlCqgSdWSDNQoYwRWqmYK4NsqLLxzDyqVTqFs6L9Rp+xnB2uVsoNkAD889U+CU/DT0yZ2P6okQQ0vbWMn4UVX8Aq6VqtjH9pd5W+R9x/wiNsP+P/k7gP94shXH2jwf/Hmg+Kneq95mRQ/Ib1mHatCLhFscVXDKp+LK8RuHatcllfoPIPLXDdhbSegBBXUjUKUoBD0levKKBx14sJRjmyS+TtCoGcUjqI59cUKR123unhtXLymnCna4MpRuuGUugElKUf9FxSogJGrViNXlZGrUcaqwryAOtfjzNWuvnWXb9q1S33lmz4u141SwRpAgaq3CtYASlznxsL5VxFhHFpQbPehBYvR9eCNR01L/fjjj8eHQx+5ydMIfYY8jdBnYJPJZHoEyYVW2QGh/yOJJ7gyAksRIdpl7SDhaZwKSdVPwRWcJBtR+aQHqc9dhcEIZ/n5gGf5pWt8HRZBWEkOE4jka3+KjWQNhQP1oC5tW2QOdBrcPnfwmxLMPIdhgODCHyo6G59tZ85YAxOeeBxnDcsZblkAr7MS7rHNG7YFPhBe/9rQ6MgiJRpUvSdrNGhsQtPNUGVU/YEHDM5BSWVWwQ34SxCAMAdzt1QFiC7qblECDaYMolGGsqltNS+CJTjUKMYja7CVgsLVMc20jK6tAE3At1C2DzQjuEyEbr8oNoTyhF4fIm3YasviBy+VkNwGKsltZXbawxfFRbePf6sG58/l5vnuq+SueNm+Pt8/Ptz8bf+fSkAa4+xeY48xDuspqlBVx+6aButbqoUPcm+6iPWvur8x5N7WMUvtzYGurqm/Zums7LWoY4OqGveWhtiGo+DXhtj20BXIeiojVEUICxPgVYFqIfAyYU3IqG+Rm5rYI4RsMAvBEOCDTLyt+fN+oxrO1XL7993D9d3zc6/WZycWGW59Aq8rdV/WIT9bQf1sScE20X14fBhb9bFVH1v1sVUfoFUfqgXu3wRqm5HKYBFu0F4SdSLVTpaCGdTfno6iWsQPJ3F7qCnUlqlEM/lLmkLd6c92nT1tHEZrm52NFaz9zKptmdQ548pEJxXUFmHT2JlWVNm0Cc2buqaoHyJSmrYQTT8E4dqE0g+B+VFMIuaRm6HTdZE2z/eHEcglqN6WyIIipSszXxRkDqE6CsFtKKpkGlcw7QJhI4oO2f3mcBtG4KwiQ2YVmWfar4gSluWNHMpXTr/qIHbW0qNbu638P/qs5d5lZalTjj4vZE6x4ZmAlVn8TGG1zUEKd5uDzE97npDGveyb6UG9egvD9ha0HEgTtOg8yip4TwPr254D7rynA0U2jIEeL2EykIHOFXFL1EXFHeg5VK4KkHc2wIYxECxB1w0qdghlB1bjmGqwEp7YmKoiPNEDq8GHSrTBUk4eK20NjyfcnuFl/Ksiix2xZQ0vMvK4I9vLeK2oRiqEcWNRjVSOP/5BQnFbOIIFGlnkCUegsgaVCnr4wVKXXR6WKdFGM6c3WAqP9o49Wiqy3qOlHZuk2NB+RNzoEuXIAMO2gvXesaK+zL5Dv4oe30pSSFP6MD1+9Fhk4+hxHD0OO3ossn6jx23f/HuPPvNhBi69Dexj5AMHPXoY9KC+vU+Pm70PCgA1fk/ylPOEs0n4auYSPsumfngG4dN86sIxQmgTaLrL/BnMIJ7PJqkXP4d4MWchjxiDSSb5tEwSvma63EMuZvPUC+cAPklnBh68Jq+ETzMR8F9OQIL5NM299qcAzlTlCZQ2hQkyPg15xFgtyZwBnz448lFZmqCzNG2DfqNdFMGyzdakj4288oPoSGtZtnSWlrYXpCrJtLuJmbHA4xlWkRmGlRmGNTcMi6WnTbGS92+/qj6Mtf2NRrt0y1wGK+1OvMrWtDSiW6WvOnabjKV5ZWU6n3a2opvd0opukrqbyaYTa2Y27WymeifS/NY9NLp7M95kc9aZmDDOeWVGzGedC5WnlRXVR3T2ZTpJjZGZmHUm7Ca0qucMRjaWawFqVbGth7vv9tvDYJ1D//6lapMJzeG+Wihaa1QVtXtTtCVQb+/15OY12xe+eHg75jsndaL+d/7yhbzzP/q+85d+79y+6W9U+dYX92/3q7uDrySJnJNXkvLZjLyQxNh0coiFpNBij+rGqvUeMZlmObba426hK882M/yGQLF2ps+nIpvrNSGWZJ4U786govRDDdbWBh9ce9K3p+hME22HsuqkikxZePonW7oD5q+zcunJYINnrlWYTMm1FRWt4Q5dRx+Mln+5+PBC1Ha5chNQFtzAKLsqOHQqfL28c2l91AXzLVF1sPKvRJUnCY7fNVToN0A6K6xP/2q7KDivrdDZkuGn6OEWSUZan1NgBU1oC5sKXPp8AjfW6+pkF4NMq9PW20YtZXW4sX4bdSU+vLFeF4F0aX21YHb05az2IbkY7Dp42uINOk0S4YfwO9LjpLAU7sXyp35OmEbk1rfkIyDmdM3616oHeLe/tB2VckQ1O59Osa7lvV0b2rPdmlPYs32vOvXYrbana8ABF6+4+eXn1+XmpKn5oeg2aWdV2efhhIAvwb4tlnAP7dS9W9suLG45J5V1Ws5JYpwsToqHJ3wfDJI3GSTXcArdXEmqMIzkEdxUCsNNh6J7HKV7SEzAvSySae/xmJxzFyz0fit+AvyQTA7btwnF0MPO5PC4xI0b985Ja0J+E8QNRAjnitpBhJC/mLKgRmJKs0cKWWnN8P8QhSwYmUIGdsB0P+Ze8IG2EQUNHJwo8r5EkRN53uYIRLEihpYn/nz/8Pp8dJ54TOpniBOZZ+2FNrGYiTcOwIcjN6dAP8zLiuYfp0IPaPMpaF/Yf3/xqczr/Mve1fZGTgPhvxLxFSHWTrK7lRDS3fEqUUAFic9pszQVaUuzOdbh12PHSWsnmXhsJ9m9ZYFTKYzHEzuxHz8zntE3ZXrZlD/1TRmx87RbTbvzfMzLh7/z6lw3H/m32d3XbEMxuVrH0LpcZr1LQ8SwpyRKxaUx190+UQttkCABbuAkSv0OWKxsxfi/KdoGt8pcqcYmLBzJw6s6I9NcjpU2AkA9xGtlO+PtVkEBuCPZtdLDXRLk19BVpEqV3KuSw3jgXUe+zCDNaaXJ3o3JMrW4C7vmTyZ6AixWZavrQPQzihje67qFZtBd917Xvaq1j+n+0IUjcKk6teQobxiUSUAAWVUrb8j/jD7hN91kJe8RhZlqwXdw8fBvuyCuegdorUXbJ+MNA8KfDZJVJ+NbrpW3RpTBZO+EIDht32veUNjU6oeuIDRbP3YFP4yM/wfaHddrmBELu5qvTwmRynUbjkfLjg5IISh4Lbf6ax8oyGfSQstqVMUHrzzN160SB1D6ToLS9xKUfitB6Q9nAUrbUiAeoPS1WpEjpszukKVAQAu+8bSAfetbEOW75tjkrKCx4HtnBc0Y/OCqoJ2FH10VsPeeFrB3vmPwE3IWXA4n7Wnk9Xzy83N5+k7U9XplVcLllHyuI7ky7goeOaA2iagQrhvS9qFd3LUWSTNo4pwwA0UkWjpsw1mYRzt2cGvr+vwk3cF3ie7AvysMlTZZ26A992YpDaSWscPp7kk9ANdKRMvxIb3N1LMw1yGeRjQTjYAG6pvEf4WzZrKNPsHSJqEBfuvWG0W7bCANQuSJZBs+rEIFrD4eUC+GCZM5s1Efj6iPBtSHtXpzQsxGfTSiPhxQH42oD/vqwxH1tKceXukY7eumG/grKNhGbyDeHJih0ed1bZDWpyk2SOujHhmk9UEMDdL6sFBdenjUlUFvPz7xIcpG/Q5KfRh5e9icXJMuhKhoAFuvlA+uF5yA9yfagR30WgibRLcwhVWF+gPLNw1+5LSKOlcTuApgdKquOUI2KEHz+/IlbxGNsYxMMYbPLR8d8IMqurI5G9Ncqaul0FzBmruyeTX2kjEtZqhg3BA4ZohpMUMpl05bcUxEUlFxY9ARSTJ8CUPWtOFLI8KRZncVpMKQ0yrgFTv7GxF1mSWqVWoTc2QL9sckn2SsTOyR6+nEQ6y2NhFFkIoJqKZXwmqSICvU04BKbJ4HJvGMAV9oj+72EmalJxj19Og2n31euSoopILCQ4HvM7DtRAqMXmn4GWJvDd7ZdrcTKTBGhYHP4H2DIW3eptT9dUrzRoX7K+39GOj4uny2FGjeb5PvCz1npIegTvUww1/z/3mUoaDjamPcmDsDn4hr08vCSybmB2lfGF0XmIsGuEy8DfM4VzylsBpPUgqrUbyjEK5OLJpSvDXDh43TPghEFkGM89+TwNkxYzAl1dKchucEvf0LlJk3uHy2aMxwIgXujxBNpMAdpxz/1q33bQzv+yBYtOgAtRpgVX9Mz08LQCwtu87qSKUXegBL5EKFnMn3qw7ska5XUPqgiN+vggNvA4gqMEMoXnFxQJLqOsU/BBANNWv5P7BopGoNAxpAgqq75T4ShlJAcq1KxmOPtNbGaT02ThtVMob9j/dbtfeN6B11Med+Wzth2v6HZmqVgZCwL0wyELj1hTtTexVfbYOQbtZbsIE2cISOvmFh7xUjdKSmov7iEECSagaE4g8oqxrwQrgBL1D/USu5fynK4CU0eodEDcfaGzry/PHAvEWQ8FoXFqLwvG0OijB/m+u37QBJb/VJ2yhedOCs9beinisOhI7ggKkmKRoHX5AAWUGRD+CodJ2SgyjXAUQHcA3F3RMX/7snn6Uj8tpK2Cjg46ll/ujbdRhqKNpJi5ev7yEzCvWKb8i9pYfd5V4hTwBHPyg5pjdEnHJyi0OOW15N44HvbZztD0lyvS3btaRotN3K9eIczkoFNjOkUqy7qdSd0teMPdii7WIZk63TirSt2zWmVdB+2l/6oNvnth40r8//4/55f7fLd/vfi+Tv3b/PD+kCUHfCAmYLAWPp21X2BmHHK4RF5J7UCo1ZZ0hElgsjAUVWSq4bIIIlWWhb2kuFNQWyBvKXXJKFAUXUvjqkYZC04zjy1jy2bbikaJBAykttww8D0dag/qEouxa1E4UtSFyUx6Arx2sSOyX1QxXZkvrxxQuOsM3PzYei9ugF6FBMPmao7NNDqRYNvj2HLd47+TOjiOzPZhbOuT0m4bg9RACAgcQMvz0+/8XHfgGcoN2wEIcF8ZiL7vsDhFg8ktWksCHEHg6p6iHjv4ntsgCEM004GxXmC0HnkjpwG6RU756LLsQaAhwqS/U6u7Adln1U4+/5EsInBhiDJ2XAhE5pxCM0vKl2mi9gwivtDMETl04BWdoKt3r5ryDlJxG4MhNfkNVW3myp9UAPWoaoGZFwX1FfhsGqtmhEniryUkF9qYJCk056sy5bQV0QfeYN8o9En33CpQk4/2T4BSBGj76w/Yk0lhi5TG65Lm32yAtXuLF0lpHGHHLdE0SG7nEm9SFl6jiIcaObsaUmrdSRyIzyeddq3iMC23JRLhhAWsvuA3K7ANFbTVQIBqvleCsluvjmjbq6aSHtzUj4cloMgrVG58Ko1hUMYnQ8SOz0gFIyHwXWmoEE2BNg9GEzCgszhquyWoxFaLACh/LNGP/hjED+P3dmlK8QeSkdovKoQuVFXJ9FYzFn7q1X7k07/U6RLRwRuP1m1ENrlQSxY8yml20UHdmCs41a2WY8UTXHpvYUVfL3Pr0Rdb7qkqoLnKaIHmFgwboeKxxB8kYq5icrN95VtrPmXSnGq6jQohgQKElRfP5xytWaa7gaIWNF8ZiV6PcShbnIu7V1yqEjOBjt01oWqGtmOGaTOlGnxwaBjOJB4BTMJGgGHnw5ASdznGdzxSo8o6SZOXqjzmeL0vSkRgtkUhq4fxw3ms8V55p7tmcEOQLWWKQDPiQmeb4rk/vFQx3pFd1enTivy4gNr9vb7VGEz60UNHtAGRG0J4KMqR2NOYJfua0Fl9+0gaggkFph5ER21JFtiKFKO6zwl8Rn20shFcRGBcVfcnFQgRtMgW/wr4ulDmrhNR3kU/Jz5VOYD7YgftBgGmjBnKFN4buz+0IT4tcei0wsgcUbgqjfpyLJ813+fF8kj18vCinEDtKHFLMCCnkQBJkKHASxCvYKKAqDoBDLGolYWNwVNJICArGImwmYxF+1xhCBgWrvczNciKD92CSsZuIhIhqfYGLRXoQjl3xmjivjgllAJodsJfA0oUYhZXfgLFUdquwlDDIkVK0GSJ6joEWP2LUGLs5cYT+couoIiE8iPMYZxtTrCRic0AYyul3WRWBGIxn1CtaWc32dAlA7YnRb4decxTiYg4Yp4rc+LvmKz8Ai1Ef2pxbRtopJtB5eb//RJblovFmcJNnzbbaz6WZ/jgKJfZZ2L1D9Y2jxz53SgPslXhuYk3qI0BdhY9CEYBmdNW8NtuEaVZxMRMvsM2MXFdUbGLtgBB0WNBBBZEZdSuoPBO6yiHbaW3iZWllM6H3jZUq7zqMl6JwpomTAPclqXwM4CAugMF+ECwstzADC6d0zctBmiz4/T41FTAVcgsBzn418XT3e+TSwvhb0Vi83e2VnF3097GYnItQoC7mimuMryJprXZ6zqKNcBoIlKImvxF/wteR+K2potT/0LiS395GhBtpWciCvl56DFSIym6cxFm3kH2ADOmiRzQLfjBmU6XHTWStthilJSWvlXENwKBHByqJB9tpg0XjlQ0m7Y7J7GhkTqo1JK21GYm9jQgPepxlXNWPSNsBhpRoAIZBKWxXhEm39Fm29FL8zkMmZvGVyVnI4twuMBc5qtOMTR2O7a7crXJD3nODVKSQGAffsEKN3dLcrBjdxOoXkdMqz4XQs4KIhLrj+0YtxxaC17G7qwBTxm0BnLUz7Y5fe7+ZFP/dEW9QDEtaBB8ZEU/WSXksjj/d8tcHtzLc8e1R33T3fBUT7csGgvAnvGh/3u0Vzsf1kIsj7B0tdERa/KZ+o6CdPXj7u5mZPuxeC1+v18pzoUQLHEP44bOjYZrUhRLNiUpfkJYrMaLk35JkYeTku395byCV0CrkNCOlM/hy60vVFHNVfM3I3wLr0DP1T1/6xoVOj/Yc+A4CMnRo1YNXr3e96WL2Darvp78ntfu7N7DFVr+ofOKwFfWhqZFPwmAYUV0FyxbcFyWUYk+CvguJVdFn/D7SITrQMp8xbBdZ/NKwCv5BDW1LK8GMxRTguaAb+USYIb1555n0cbm/xTlhcXLNWgDmXafuyNLqUPwo5krfCkPPZl0vztgxW32G226pokdU/UZe8hzcU92e1I5DejMXeZ8+frM7BVqdRq8ctfKf29Yv1mVq7S/juT8uIPc/wZu6JMQ0tNmrxUIuPPu5nd+MeO578KDyDM8uQdsq7ZhAZobhn0yAPmDEouhYsAmaMIaoFGQlKiKrQBCsa3C7l4FqAqJgTHV9oiv9j0DCGooBP2J7Xq459PYxRzwc4kftl3gqMW7kvyZL7FlFc7IabRCJtTSBehDE9St4eSmN83h6TcNgRPkqSn8H0Oy3WAW/aqYAnoU26TmzNyFYFfHOsBTOkiTjTmgAmheqNr5FL+knYMyls9IdIeBdyw1AR79is7RYx5jE6xCploW2C+lBTjkwf39gRBrbXG81RYSMDUcVAxUpzccvXx0KUtoQfq1oj0bnmAxQKGeE/XFJILOvTgxLVk5HwdOaZ0KleeJxuEw7kowq7+ajalQKfP+Lilzwi4B+G/FXYQP4zqsiPT5E5G2JDF3PMZ66I6Q7bvc8N3hc5Yk8DWDSNAo9JWE+kwPlF9M471hgQ+ypwL6waTaRg7awg9lSQ3XkeIKmnASycSIH7JJCJFBhfRPQhWB6DlcOvdhb+kOT588dy6SMx2cYkxh6Ja2HskdgkHKnC0ZbQ8JM/P09xgpb/UznzSHNE28mOxFqp1SSEH6A1Jxo61b9Q8Kkj1aKECJOioFE11bHb/oCcZJ0GobELdaYPQRJpPSAyEOsNBk/t286RMckQjifDrfcN+nYbC/HkxRpNXrAIT0XEIBXRF662nVN7gkm5Y7h1v0Hf76tCPMGxxhMcEZ7giLtawyUre/gwDBIUJRmOArBnGMJFGAas/bKDqO0gIXoPET7z44XDOB0Oo0mkUFEZw7WRHMbmwmEIDUnmefZMMl/ITidS4Hz6ZdE0CpLMWUHoqcCbRVl7GsDiaRR4TMJmIgXuL+J2IgXOH6M3j7P1ZQC2yPM3PAkTKdg4K4gnUrB1VrD2VODNJIWeBrBoIgXuk0AnUuD8IibZRAqMH6Mrl/VGXkm0dAmrWwqhavhUutjKc7z77R2C7gxokHHZc4bsd0Op+Hy339rD7e38qTdb0li7PY4ljY9V/2yQeg3FX5hKZlSYLengTTxO4JFVh8E7pFuYUaQ6o0gD6hpcNCB81WfocOFCjHKrw1Z6nKRkV/UzhpgYp1rvdsSIdV/xFhSOVOG4sQJBgbJ1LWnOIyJIWzOPXNGuPBmXj7r5vykoGiqqqyggASia3XStiMatiDtWZDcI6rKiteTyHCNUlK7+gi1SgiMZxvp7b1nGTewax3QiFB0uzyiAgA5pe3jEKZkHAzGyaqxAoKBxnu5qOig0Hxjil8eK57/45/dnku93nwU7VhYf9w/PT7/81f433mAZxMQiHGRSc2SFbZKsG+iSI0VehGMhMqGqTfdfkNXWKtHBFskBGYzwsmEzzUC4TYMnbGZkNQkF5cGBXU2kwHjuHh5/1M1k+CPAnRusph7duS+Rnnu2P6RY/hJz+be7tP75kIsL+Unx1+7pp91+77XYSo6Oj7l5uZ3vNfFeIvzWSizhbleSfD3VwHok3GHbGcYXvwajwzFRn4F875+eny7wYuoptf5kLvAC9w5c4IVx/D32jQu8sFxXp4IC3lupcd+sqIcV7dbrYUU7xx5WYKPQR6y4alR4WIH6zA2OMknTq5Q9vXD2F87+wtk7c/apNWlPOvQ312AsnIHk92lPNUWE+paybIbZFfB57Qq4dXcFIK4/ZzeI6OiKXJwB/Xrxp+4M8ImGmNIXgHNKzOUMKBtfwCdR/GxyZwAipR18Wp/8qGB9Up3oyO52Up3qrO7KV0x0TPfiKzyDYM7ntG4+E6FP67ZUZIhjTKxeA0sTPt2D+7H8Apij58xvjPfK4bhuYakMO45lPdWwumVpncoh4LMYn7BXwANn4L/tuVYX7+WN0Wn2CK9Xc9INwqL3iTZYdwXeEGEikOKOkja49sa3x2m5PoWFDVsJ2eYVtjYCW8/Zxgg5D+67XuzP6WOTykyy93pvXWbPwsbDCuxCb/Ys+Pg3rjAXi1CeBdq6Fu6zsr6QM3uKd9J1FyCrdcdHKNUt79wrpG6bw+TAs4BYZD6VrTCeiMYL0XRsLHL9lvEEXxZTOBXM1bA1btwY/m7OlUHRuTJ0r0lFhLlBlmJqT8sMm8sVUTaxzP+xd6W7jtNQ+FXyHyHFdpwFISEhxAMAL3A7GWhE2drCTXh64qS9zVLX3/FxutH5MzPSsestPp+/s/W7ghcYAlnmSdoM+YBp7GlliZaKtwtUlsg33u5QbLWWAanlpYhlTLnhRW42vxMLLcNYmJnFnh2//pQ52EcA4QgYbpl+TuqYkJFdx4SM7EYYTT+XJkWW3cDfYY5M+mRv6w9gEgJpXD1p3TmEtUTeuhY0vS+YuC5G8tY1gpq3rpHEvHUMgGZEJZbMrGzgDGXtz+Np61Uk8LT124up4uQ0G1/fs7tCZitfSxNMeT+uC+5s7KjzQv8L0vILEi+DeBm3KgtuVfx0bP0PJJYfSB7S+eL/B40vJKOo5SOEYFLAMSf8IUyBJTc0ZNOsG65hcTF0zk4PzU53L8N04P3ACJ1XpH8gzB4Eg3fCt9u3T5+vSyzmSqn75RXPIvEeklCqI71JF9r9re3+L2EXHBVPMjgHfgj8paI1jQQ99uHOpNFB236azny6PU95XD0A2zaqHVAjALy66gSdHOynVt+9lzKSmRmB2+t41y5JI47iQDmgzaU0zNV+4mZrh/jVajg5I9c2uBeq9AKqXX8igc4DqiWQsQdQqwBIuCQgbJHYMgXxtwRPXINKPcrZ24jOxyvXiXnQhoR7Q3PwwRrcCK5XxfoTCNXO/jolApowfKIb2voTCNbODgEKc6Q6Or22Hu/gnrfeTXb3oHUMYn/9fA2ee4Jjb1HdpNfGNHZ5Xjq97wUEfNRQqUYAxTc6bPZEyOwa2MwCzbzYwGtxaXzo5Il7YPTlT4QtAZ5uDZ8W06KhdChaCnzw07jy8cMd/+81Q+inXkUfmac//v69FD98/nRtlf0RL39VjT1Xv73OdtIXB/UbyIOsKutBx0Y7ykLmRSRQlWp6bzu5vvLrTUmEukG4g9Wyum/BIN4AdiR2Ok+u+jxoz4BZzZdTnoFfl1wXqeNFfbgv1t0/AqkJp/3hyuaLo7YYag/5XfX2y5U0yDzlCma+iK+vac6R+5ro4KwRZYOZAgRYj/+N5jQtp9UVAdvCysghGhfSi2NH6DekxWAs7Q9eKjN40tPffBWVRtrIggq6rKF3bBzdTpGLgJoc8sXW8b2n/vZSr4FVfACg4Yt3bECh/xb25q9HemhjWKEWbLAAOp2cwMJbDxXewgAFt6/I6ZePKKUGHpQXfvgNgxjzGTPTG/ZfQc2bcPuF+fIOFljUw6AJNPqxvfBf0GhhaDRvsSeio/0Mx7Q92DpfEQPLVrPO2x4somOY1ou6QUw72Eui+xHbsIdQ1WrUZgW1qTYjsNT+bNR2A4KlagOCpdVDoKW9E8/w4FK7I3fioPvCSxa8VB2YlWcETHs+YtrTIdP+qMj3wfgVCm5aHX9+xUROKzT67fxvB8FPewqAOi38shCqh0sjCGX+u7hTLGSYWBIRkcwSRKvEFH3USGzTJYqo2lA5Gn9tX22u7Xq5oIVjSTXsq78Cq9EAytwLUAzU8FwJm7/C6+DbauDDKxiIIWe8g8OxHcefDqW4KfbzQHwHXWkffxhW2bDS/FCZA225/2lbtR/Q5vOyuqraj4IKskg4+fBW8P2S4GrUoxCt5PjWv931SfCNWu72JHlXse9fSxdbvIf4/BA8r/D3UsjFXLzu4RJnJHXcYPcw08hMu5bG99DXu9+qzefm+9ZN+Aok6BDIJ6m+hVPwCMt/aQZh8Hw3GgDOv0dJkRaRFGlRuOtfdA1SKbRpgKQA6BoIJdShhbusRN8iTZPYtECSKPRqQWd9A6D+Qn/rp7qfBprZYU1zhm5Un6wBKiLdKCMaXRiJmoxEw6WhmyQqzWCcnmFQxFxVNkO/7LVTfjOtnVJBFG0r2gpCTtxdWgwzLvcLrxVtBW29vv8wPoRCDg6Is0rHSfz6dPHYRby7BI5u4u2/L1bUSIB35G2gEOUlaeuj6hVWBXWyHKA6DgNCM8tBqmpLGIbXsxjak8Mo/CnuJYDZctAsuO/9P5/cAO5MANa6lGef4ebOMn8ob8PD1AKn2JdwnrrB9H44ZuqlTM70SMyFEXgQXy+Yu70WcHrhv/5+K7/9/O/lcD/d9zP/ncTyOx+9wtNFp3Y3X8DcpDB4ePQPkd+rP1+RDojfpdumgEc67CeBDiJy0kVfdFaF7S2yiS1I/i8L2tjoIAjKYeM1X+z5NSk68M4BCqYYrxbfcJk8Kt12ZCb7dN0Qh4GWOCqNmwU4gDnfb6RgAnvxTeU3RB++zczQ3fZgEZ262dlFt0Rnv+1sFFtr17NRbBFnv3aovSgUsWCkt5Ahv6xPunl5C/411DjBXW/jVOQ8d72t0x3wBRRuDBQW9BS4OVTge+ttUZP/ZWW/5aKFjdthz4oXuCkht6gHwGXEsmVMoV8D9yJ6gJ4e5YyAzyt84RbAJ2DwwsOHLozRTCe9IqMZfyyzn8RNiMjpwtKSF6umHeXt2AsC7HlFKcCA49lhz0OZcDDYc80gBStmQJ3t2XEK1mADLuyBoxWsqIU7BThiwQf2GIwzhj0/GMfKO4c9z8n5EJFPWUsSnJmhmbYDAEtMQhwAiqRtI29pwCBAgIWJDyfAeAGAOwEAm6ezkPDVfxjtX9bOYIXbmkgeJ9PCWD33Grt1bth+/ulttVta+/1WfhSM+KOM3qO1vUjXsFJb9FsZScBvttVJsUlrW7vrbXWi25For2KucZO2G7pkpERZs7toBLsLzn1e1vyJHPqooZnYlEJZ43sSps6WZRiUJV2yzhY0i/PtCVsa40mgyR34r0AtuFP4KDpLBxnD3FF9RyvT0TOgDLYfRlnzQMbHdePbwQZsj3igUtYM8em0TxpMe2XvIAQ2cjYPt2Z8NLvlnbMteEzs/kZgB8HXjHPQ0PRqCyF4lHuj4ughaDYgev+2FfEV+K5RgJ7UtvJz65+HgiLWIkmvz3aRXGh37+UoLq+U0frnduiw061pUWgRpxTOyzTSeZYVuL/u+lPvsAtwZAdRaRFVI1EjGNkGkExFReSuNNJO0AS05XERD4k9Z2Rg20Y52zxS1efqvZzt+tulw1itRw3WLvnd+CxW79Cyt63kqBW08LvxDldr6Ny3reSoFXTwd/OTb0ZpE5ZTYbMuNmF1RtjaczIWNqKRdcx6JizswulY2EzPKjw/82YzbMLyjLBtgtNzb0Ttw0hmwtYJNqaozngcZvNvQK1b6v70X5WNku0ncJ/s90e4kP+LMCHUTLQ97Y+1hhl90Eh4S8Fz0jDk2T4EaTksfRA2RVknQ2AbfE0KSB+18qYMutt4f7iHtodrcdVdNc9AGxBiAm1vg91hm3fuZEib34khnmgHu8MO7/y7WH/ivUt3dcIdArvg+q7W7K1IwMRW9jGk3LLvCbPo+scy+HfBLj3/cRz8u1h/wh7d7o/Cewi1ZC+DZG+FYB8HAZ5IKn3R0RUD6kJembpQmY5v4HlMIiTOFF8X+eCt5Czy2b2j+0hsyCQ5JBacSYhUlLCpAsoTfvjra/ProR/li77JzQZWHUEEPse7Bs7sQW0LNWuRaPDxbs5ItQZayFELZ46itoWatShor3yzeJRXvqS88hX+yleUV76EX/lmenfwyu+EFf7KV/Yxawp/kL74g/vhD9Yl9GZmO+A9OwPxXiakcSxGQVD8Ea3DoBwNZV+RZ+Yx9DPwGHgCoAuvhEAvlXUZ4Lnk/f5uTyubRXiRKUHJFNaBSLmncgs+ft1D8J5FQEZH+3YRkNFJfbsIx+h4D6G9HtjrINl7EYrSAc6kD6cjB5xOetWyLx2jc9dlX8Ym+o4MkCrPCd4ipk0WZ0I42qhJG5XL9PA7sNMGMLax0wY2tjGPA42NwlH5O78YUYUyWtZ3cK1xl5p0EZ7M39XFiCqUVVPWsWrcgSa9S67u6AlT5HFWkP1nciWSLBIgaXdspds/zlbJtJUodFxEZF8dYF4TXx1wXo0atQLn1SSjVti87pQx7IQTnDFMKIyhsgtnFC4yf3wushNOcC4yoXCRyi6cUVjOHGc5q7KmMf9V2dBIeUrhAEI1AEKNAbxwAIXzfVzG9/p8rya4Jp3vISWwkwsRximBZL24DBrpoecTrbR1yugjAOVcK9IwzlO9krQcFrqYsCmLs9bY8bQuB+Ej8aabkU6C8N4JzntfK63Q8/DdTgplQRqH7x0k2f5qik3z8qlmNt3NZ9w1dwg13/CQsrdCs49Dxj6SKfuzyLmfJp/0z9kkb8ommjMu2304Dv6TOB3JzLeLw2fhP4nTp5n7dsE3PCTcIdSKvQyKvRWSfRwk+0gK9mch0E8Ttn18WD7Sk+VDJi9vVsSbtcAMHyfnV8zoAdVdLOtksIKtfGKT08N+nf6VE/dKp3dl2ci5yy5mQIHqRZbNaJ5r6zwbPe23eCSbjBFNMJuMEdWoTUZbzTfZVDSxiua4/ajA7UciflwDkhFNMAOSEdWoAUlbVyCbiiZW0Rw3dhW4sUvE923tKkSSRFRrl9tKfM7alRVK6Yhq7UrjPEtdrfSwFWb7blul01ZCxVpFZMsasIZjyxpmaZ9Z1sA1nFjWwDVsRmuI2ejbVumoFbaGz2DF64Q1aMXrhFPcipdSrHjaLlxQLI8ippgehaDYHoX8nxkfO2ENGh874RQ3PqYU46O2CxcUg6mIKRZTISgmUyFfNtPlbaY3sZrudqXkG02XNZuGMMUEMW+xDYZexld3kukFzEHPZBBic1tOYsrNr3l3ESBknR82r9gWgIRtheAncuDHP+hgFiHvLviGsYw7hDplL0PO3oqMfRwK9pHM2Z+FiNnfZsG+HwRMwNsvyph9Uwq2KYJvJBSSbZIRMdsuJATbONUfCv9pDE5m4dvH4fPwn8XpExWxbx+He8J/Fqe7Snjfd4cLkzGNwa3tfePxjaYpewy15q+E5u9Hwj4UCf9kKvbnodifqGTfE5J9Vwn+hYne2rAB+WRClsnJhKxeCZGgADpnKEtZS4+guyHbjgX1lHVCtD8PWXYsBKisU3pgX50N2mBBQ2PLBhYyVDbSI4BwuM5YkFHZJET793CdsZCkllclBymWzXCdsSCm/4kR3YimmBHdiGaoET3DjegpwYiu7bICN/kLidv8BSEPu1gmu9oDG/2NaIoZ/Y1ohhr9M9zonxKM/touK3AXBSFxHwVBSGkv7jN93slJQYs8Ijsp6LRIIqqTQp6LQkZUJ4UsU7GIqE4KqUpUEVGdFJJMJLGrVTZtJYtYOtcwnwdD+1QFALZr4g8BbtfEHwLcrok/BLhdE38IcLsm/hDgdjXZqBW4XU0+agVt18v1wup6cRTOQNeLTjjHXS9ykutFRnK9SEmuF/qCtCK5jJAyZwpS6kzxBLkz78RlpBPOQJeRTjjHXUZykstIRnIZSUkuI/qCtCK5upBSoApSDlRBSIL6cnV5ubqEGfvL1eU/9q6lyXEaCJ/3X7i4zInCkp+hoCgWlhNVUMABjpk4u07hSnadLLH59ViWnMiPtlpux5kZpihgZ7bVaj0sff1Q92uoyyyhLmQrvNGEbvYETGZRcLIngJxPsPDIjmyf7E2npzQMyGEFATm2gZzpswjJMR7RXHEmk32NxyKmxtvQQ35WVBGKmDwNzCWvxYq8H9gMSZFd8pfBOPnzZDM8u/XIBxWjP0Bm5Cy0BaM/xWYB+fJiPvkGZSH1Gp8hBCokBxUwnxzZwAJ6fAXzyFEezKfHmjBOD3lhHj3yRp0YhKFoBxebfPo15ydhKNoxziaff+oyIYxEu9LY5ANQXayEgWi3++QDkB4aFpNlKCL6TET09Qjp2yKkb86A/o0E9E/Vp58YPv3g8ujnp0c/xjn5MuEzXGn0ixV7u08IlfO0PPNLJ1th/OlHyi3gm7ezRx9t7dHD/kmke7KitHMQIf1Dx2dsk54pae2rUfouRun6czip7ZurLf9Yb9FXw7S6b6iWJ7rxi1NFoCvV5CpYdIDOsCJMuPi1EPlg0fIybOWuAF94+r5F6AbMB/zx/7QpK9IgetIla459HJG+H48r6iOJfwwtxHZvGoiLUzZAPQMQ4EPIWNHHqDcA1waxF6Ii4AVcOabGLkrebmDsYpng7zqwBhf8jY0kPlqEEje0HAVTj7Y49YgBqqyPVN2A4yJIL0087uNCHyW6RbTg7RZmsZYL2JPhWMiAPXw01tEqHOtoFY8lqMUkIuH58bWkBFb0JbB5wSzS5VdikPP2Qzw8Cx7urPn2+wDfVwDfmwPg3xfeX9aXgu/J4JqO78nVXWdI9O5j0TVs5ST6ttMN2bNNLz0wv5LRqBjBVcUIFzYt8jgOcUoGC/zoqRsh7ZWHLrI3Zn0mgOgatiAgbIUU0sRHPoKyRrAYANt7z8QcjsaIosHdMWIttRV4rhUnFKq0ApUqzBqJEl+NuDbCG4ARVwW9USWi3FshPBsTLghWrcQAeNjMxlTkbWNO9l+SOfk6vf97wMnpdfR9olF6BrRHLjRFt2qTDesFI08DQ64EGvNeUa9WviRaGPV6fugyFOp1eRBxlGndDTh7efh4WeN6g2dXkb/yLJLs1I2imMWeRZadupHvmVPGsK79N+Seb5Obpm7EOQ+4RXKaoyqIsoqeV0aX+5aqt3UV1O8lEWlHJK13K6XMzq0gtDLcZ9LV5XDfSTc3Be5DWdBdYPW+Xz4MR77vF0LYFEhnGCVTzCHua+4mp8AdHN3kFLgzallXiXzHjHm7Pqtj5VVnttOZAwu3CFAs20pXBUoIWxVVBhwrVjxup3dzixm9hdrNO2p3MKeT54mo3SWnaN1owz6sbpJ9LGS1m675k8saz5hBfvpS0J/VBmRfk098RJluyE8o6UUN0NW+J6j+0VX1j5dW/Z9X1llUZleCDigQrFnxReU9JSR/fGo5/4x5ZIWaMKXsX8kmleLjE8rjLaeNWTnm8MFbVgqJlT5iTJTkvzrwnoAyktPfTyzvwPNvpUjYvCYRegQ56m2qMoLhYdSKpjgS/Zeg0cz5LmUyCC4YGcm/IFfmdAYzxM7R3+fQq5PN502drNDM502dLMJs3lTEUkzQqeJGp8rXuw/p6YfDfl+dmIecdeN+ZbI5mWtOppqbJdPcrY5N5/0uq6TeH/bbL2yO0NP0EzRH7DVDUGdvEZrF2X3cJr+Jv/s+zw/nBZRfpmm/uiI0SMwB4kWV5Qq3VphU13li34sC5+wcj6DsrKdhjyfZXvNeA+6onk2OTuGwOzqB43FIfw/apGvlv8H4RXNZ6MKokwvl1lkzhy+ukrfywgtCIa/QtBGuXDm68F7aEeupR3JdYMBdMkA56vD/U34/Nf8/G/5/Xjcz7Gw53V37EigdL+DNtBZQCrz+NUmPhHWNwq/vSqVpFGF9W76MgMWM/j7mmHhkgFzxoKLLDNleYSrc9FSCsXCOKSLnlqxYIAeY7Y1jMfKwmqTCJ88Q2WdUBDQ1kapfFQECLJrbm1cmo9aOttYp+lhVQNjP+wVAa+uJUnAfGNry2TAeuNJv44dxBKCzD1rNAYmeBbAEaHUg98F1PJdHvuPxKIyBBrzdgPHAd0cb6CbvD6wRCCD2dWJuIA4GxvmBAcThEDEHiKP2ILnHovFBxj3uHyJQ7tWQKBG0QK4uS+B4jg9RttYyHKPkrTWphhaGHBSXtVeQGaj9NrXcszC5vojMvawiSB8O03OIPhqm9yD6eJgemMpDuzKnw2LfCx3OQtcFGnRUJ4+F3ih9u4ynmb5djtIsUBG3+H9Q/jxjhUFJvZLU5iKDkpy5kt5cPFDRc0lvLiCo6D1Jby4iqOh9A33QoQ8M9GGHPjTQRx36yEAfd+hjA317udaj1Off2szH1yrVqVMTdRm3qZXcxkKDgvqyy8y1BgW5cZeVjOv0xl1WMk+nN+6ykvk6vXGXlSzQ6Y27rGShTm/cZSWLdHrjLitZa7G0Xba8vUTaMxpzhrhKLiaNGgENuxdXCk0/WZOGjfPydiYNG5fy3CaNlTRprKRJI5YmjfglmDRysuu0YI06OjkLbcUCm+rZSteu8U5Z/Z+kbTNyBuiCRdj0zVbjSzdUr03BYmoy5YL5WBZWg6uw5ByL52Fn3pyv37j+VuOjBy0UzMV+NmYWxo/XanCXxaNEmV9nfnIJjWb9EWnorcbXXEaUwcnPhpKansVYFlaDq47NORYvws68+eQ1rr/V+Aq2Qn9763zzx8E5/yYVjvQ3qUocT983YMc5nus/c3ZJhkIxIApLYW0yPB8Ox/Qu/m4eWPi7WRiG0QKGRrP/mkn/dXSVHuMlr4OzNS/5HE7vddJxOBu86gkHPN+QSMXbjnd4DfmRS53y5AjHiAOvbfZ+rUlS4XCHOcyHyJPCbahP673kLVgA2v0PmiTF29ql7cKsmc66mlCN88Aof9J4l29resjI8FNbDBFZDc/zO534JyExGNKsk5Y/GWY6KblO/q6ajRP4KJ63AgfqvFKYt/CpIISk/bG1LUQnzqVK8rDALStBEoqdAfD+lWnMBelI7d7i19bRc07CMRmCngwckoG3l6NqC4vA2yL4yxsOOoEWrAm0iAIgzkJs41Js/NsFWryVPby9u1kCsAdkeHMAGKvxA96wMWJSKH/EMIBkeCd5vLM3S9woKPHeJokMC60/fV4nb7f/DnKRJ0upjqOvuhTgDhc9Kb5IkPrDHL708sep7S/7ZzKD5ijpM7Cabq6mWxzJFsuquNLc7jpYFr85bdd5kh8+LgCd2/mMXPdpPJQcC3DMrznNP+Un6Ao9nTsvCHPuMIA01e/lUdKjzvVk8vEcU526AtLYnEgyLanDI1yOIlkLwO69KDa5joogNT8t/UpwrZhyY6xpnSGqBCl3SWH1EnaXlFZvVndZL3tpUgCkeYtUEIJvVk+9F4FJCZA+tkgFoXN3b88FU3EwOLZgTyR2dZJ7BIFldpLHDgXKZnDzQGJkVmKQHVaeQQ4UvpzD+Tb5CSOMMXcSZO4kytxJmLl7QTjT0giYcGUFTPigGXBTq4942MQvq2v1plAxtQBo+TXi0cYPqHhazYfbmQ2LpqKB1phmTNVQoMCE+frj9t/DLlm0IFVtTF24eJTU6jXoFOhGThyAlDwgKNSxV47CzYJ3qSWIQyRRFKbNwviyqCFkBrgigaznrEcHtzvpYNZMnnfE2GVL16oBcIiUevghORqH3BKFzHHjgUnILK7vGYAIUGQGH3BivnNnuXKfwoWLMOxke5vb0sLU4dHaY9642lxT4qfWtSRuqV21o7LtopdU4C5/SfXvHGTKXnGK21w5Z5sbp2C1vuw+kTNcyv0Mz/CCP4kz3MJHAA6EzCLHcxheam/iPVInfZENc8Hm9R6Z6R65zT2gHfzffP5YW7N/WGfZ4fNpATP29AgQE7FnQ+zrxKG/ipaILTFHiQQ3iBKRf6lfa2vucIdZZWu4MIF70GICmidC6dhAvF43nuoGeIX0ietj8ISOl44H4PhDr5Y+cVAkvyeS7yhORlcAMqQm6aip3SwRZoeARQJJiyICc1cGVoNTb0IwASoyhMk3NGgFtDzKasLGEgFfOSWviO+Q90/iLQYozcwi/dqcIRfKP4DrQMaMeN3kHM1XP4hErEYgO/CBDkbwVskRqPQ+uHQG20JmlZbwNqaFxpiLQISDMSMlf5lBI6SAZWpODXLmO3IGQWr6P3Ld28KbicHkRchnaW+E9tneSjWZrBlI3aCnDbxpFATx5zczaQVvKk7NLf0gbscHeU8/XExED18NkHGI7IrWxU8zYfVW7+Im0gRoA9wBYS8j6uU7GyC+sO0D+j51Ul7IO4CzT3slbYJvnQGqpGAax/MVj/ZJr5QaEh0gu/Z7xYtDQ9E7LpgQUBjFBgai91sRyUAXRXdFcuKnmXCc6F6HWHKbSoj14D5IiPWgJl7Sv5F3ppyl8tuHx2YcEpf0mP7VbGqBehqmf133WodrVjMteY+r/ON1BuZCOqKPBhw8CJjTlSjd1CKdrhJV5N2GmwQxkoF2cH+Po+16q5FDvck/afMmkYtcv5PcdLnczI+iV9qEfqV6mQ24vFG81HCviOWNHP2pP9X16Ft04npptekvq2gjqIAW+hTjWxR8apNHixZsYgtILHmbXvbRZfb1e/TN5RJVt+ePh/O+/vnmjpbhXKJmu9o9nDKQ5asxGCGtUvPmEC25VWLQ0utYIkqOMRLJGxblgbK29+AKhsjbVl62X5gDS0s+mprU10k9QXgvrxazcWspFcizMVFwwERhob4/GcfZ4gaKOXxvw2JY1ZK7qZ0EJQPgZrWYCKqppuO8a6VR5bWpZp5yDc/dUkM1c1BtBLNZiowJJcARENtTKwNkxP4LNhMD4xKgLS3ipy4sVDjx1RXr+DHj3qsrdkZXbLCQJzbhr77Y5+2LLf2uQsMs3LYc77ZVT9U4SKzPR7sO/Kv39tV7S17g5ZQjHJ6/rVaCiucze29fRk1qulIwGyif7rt8dd8+EfctQa+g1oBWDAgV03wiA6puVzCiAAWficHkRcCqp2jl8Koe9rRBoSWePuf7p5+qjd9OO/SiYIw40Imje5WmGFAL5TCnKIV0lbCtrLHRsNlPnp2W1lc3P3lz65q6yrX2xAigidztKzaBLowcLTCTgS6KaiwECtTIEUlIap3RoFatz7Zp904pb+cjgTOxpVyfnTN33IoeVqyCttYWmERPKSpkGYgFTqGSCd3Cc7DYj2fddbWCp+PxKAnrveA8nh15NxhNEhXbx6Mamtq8UywSg7InrSnsBjhDjVq+xaReVWDITVLHelAVredg3p+d0oqUj2QkjNvLI/YWSBtqtEVsII504lAs+4gUvk68ctxKaJA20GmjmhaUYlNciMUHJuj5dUGegZnhlErwhdPRISsDB9P+hTbsJ9gYVAelj+tBDsDvzxBsZHhM7M0kgRzC5Sox16FUekBwd1NGZUOwmGcrO0QRq0FieAzPkoUQkE1mU9jYZPzhj0Y9spxqEPn/pkA0xCEnfQ0IyuQiaNP6/8i8NrACi7NigF03u21K3yui6pkT2zffpDEhO8ggpEoQzcOgMGrP+gJytYKDWYC+DPz6oMYuosrSkBIFEHtoqgynFGdEsbUgaJYC8Yt/tvlpt1lnv2/yQ5YtYD1oZavkwX0U8R5eH1PDN+lY+qAheq7nMK+VNJjW79L6bbhpgOtVkw0aKNfEjouC6xW0r4hRYF2Schz+DtvE4h+jp++xboNSLSUpv4dPUCLFHtblwWil8k16d4Q4h7PLHURm6bK+LiiWMJzs7hIjOMn/5YLRjDFwt0N41fWTH/6uvoz36+y4/cLZFqf883F32P/yt/qdaICCgdWnhAWC17uwbpTWf7jehYSrcJNi7fm6DH4jgz8sA3NjOyGQJn0Dg01qdC0ZZ3ISKI5sQbHeOQSLObb3UA7eiKjIqHRQflxmSLsSPr4aEcJjTJDJYkdXq2GTrbI5LN7vsuqgS9b539v9z9vKxjnj8fEcJ8lwHqptOON4POsBeXYjGln2/WFPW+HLsWiekNeD8bkejNneEh1Y9m23ndV+tEuwaP19dtfT7guduBl87JcghmO5ofAfZOEh96QZN2LOBdphl+0tT2r7QdwZ/GJwp8Hq07XyiF+e1/9sF7D3sI7BBx8tchfL0FAQBce+Jf2SCUrRSDryMfHXqTlOoB1TXQpyxwNYt6qOMYto6lKmWcA58GUMuDmYQPD1DUKEbWIhBKYqn3gwaw6YOLzn3QYBLox//XgUMfSIFwLffe1U3Tiu+C8i4j+TAf8w46DNWPwLeu6DbqxEEcCM9bRn4iVBEchtZDQyVrRVa5SRsQrD8ARjXExAJgQe4ctcfXzy+QPKJFmEQmJUFEMlceQUzG1ERkSkwNtCOJ3R7zAEMUc/G9llejiHWL7QkBBeOKvFWhTMWPFGHUTy40DUvBEHwO60fNY8Vaawb2R1ISOr1ZOFTjhEfZ5f34xDfYh1lEDh7qZcwIgqd5qcCYoh1eZRtjcii4XXf3jGV5Mtui+4nIyKWsZUq998ftxtqqoqVkH0vQhxD/r7ABCk7hZf2JC5SAyv84Vd4iEkbnR1mVup2HW31NKBAocrRL5NPmzfZdnu43GrwruXzQ3zJXdjz8Mlhwl5sHhymKT49XDU8Zw52UtStpukDTqHm4hOOne4+BX4mlKQd14ljpAfk0ITR3JOHQYRlxqx5HuGiD9W5+UFvZ64U/VU/VsCnIViqoktGjthXUAekny7H2jiVo3QBRHPCZcasTETTV0GsKHGZcNBPXhtFggkTQrelfi/9q5muU0YCL+KpvfOVDIG59JTn6A99VgmNPEMQ2IiOShPH2TJmQV50fKTOBAu8STZ/fhY2WY/rbTKig7GosnYWRNkwHk3L0HHgY2u2EhyMPAmEuYWsVH0zQXeK/k0aQHDZ/3rcXfXxb3gLVgYJnjstg50+AH549zgy3rk5NuRk1dvp/Rd8CiJdps4Ss5JMvyL3yDJd/kLXfxU7/xtrO33LCG/fs/seoqFEpMc1TjNsZMTrLcYfwjnoP3JpICWPQJqnmU9333hBkrvKDWuLDRgVMJiIx+7XTlwZKN7Etnng3uI9CmJtpvwIHm4S9B/16N7pVY8Nj+nzp/HV1pduYQs/bYCxha3vgRGHthqa3vEbA8Xkv9nTHFpMBlt+WKWh4blAbn4CyBao5v6BmZb3XGQh1mmCROYsfCM+Q+2/UY5SK2+EuPBiXNnKlBT3SSsOwnrJmH9RphSr9GGMKVTqDHFCUs/wDmr0DGucmj+UttKjgD791bxLmTZRJaCVRj0xuN8+lEiyGUTuWRygwBHPmdLHEFOW5wjnPPW46w5wz9MuhloYyy3CHTssZZdyO1Ax0wiwInP2RJHkEufc4JA71qcHXSKILcDvWPpx0/7z0B3fH7lMeN+RAQOfTP1r7SNj7AaCs/RaavjUH9pB2U4wCQnJY50D0sUlL4DKIcCTNOPKLhCD+VPXOGH+qeW/3AAPo4A8TycvOjXFozqXzmAfChATnwDkhWu1bhAynoC90EVt+Zfc6tBdXUT4nEcJ2u5qr8QXgXrKlhXwboK1mUIVmipWm2QzSOj85tWidY6QIXc3bF9FK0KrumrKSjOxI3Y3TgOhOKi4bDPCfXC9GS4VgtnVy1cNXuwupYvrbpmB1cRVvGd62LW+v70OnY33Nz1viL6X4rd2OY/C5ksOAb9LwVv1E7C2U8zKKJ/Z+SGveuWN0VhfsOmImq7MnvK5J/7f4/Zr+z/vtjLh+Lp5yvzH4ebq4cIAA==";
/**
 * @hidden
 */
export class FormatCellsDialogDataBuilder extends Base {
    constructor(a, b) {
        super();
        this.b = null;
        this.a = null;
        this.j = true;
        this.h = 0x7FFFFFFF & ~(208404486 | 32768 | 33554432);
        this.i = null;
        this.k = false;
        this.l = false;
        this.b = a;
        this.a = b;
        this.i = new WorksheetCellFormatData(a[0].workbook, 0);
    }
    static f(a, b) {
        if (a == null || a.length == 0 || b == null || b.length == 0) {
            return new FormatCellsDialogData();
        }
        let c = new FormatCellsDialogDataBuilder(a, b);
        let d, e, f, g, h, i;
        d = e = f = g = h = i = null;
        let j = new RowCellFormatEnumerator();
        let k = new RowCellFormatEnumerator();
        let l = new ColumnCellFormatEnumerator();
        let m = new ColumnCellFormatEnumerator();
        for (let n = 0; n < a.length; n++) {
            let o = a[n];
            for (let p = 0; p < b.length; p++) {
                let q = b[p];
                let r = q.firstRow;
                let s = q.lastRow;
                let t = q.firstColumn;
                let u = q.lastColumn;
                let v = r;
                c.k = false;
                let w = false;
                for (let x of fromEnum(o._rows$i._m(r, s))) {
                    let y = x.index;
                    if (y > r) {
                        i = c.e(o, y - 1, y, t, u, j, k, 4, 2, 134217728, 67108864, true, i);
                    }
                    if (y != v) {
                        if (!c.k) {
                            c.q(o, t, u);
                            if (t < u) {
                                h = c.c(o, v, t, u, j, true, h);
                            }
                        }
                        if (!w && y - v > 1) {
                            w = true;
                            i = c.e(o, v, v + 1, t, u, j, k, 4, 2, 134217728, 67108864, true, i);
                        }
                    }
                    c.l = false;
                    let z = t;
                    for (let aa of fromEnum(x._ch(t, u, true))) {
                        if (!aa.n) {
                            continue;
                        }
                        if (z < aa.r) {
                            c.p(x, z, aa.r - 1);
                        }
                        c.o(aa.j);
                        z = aa.r + 1;
                    }
                    if (z <= u) {
                        c.p(x, z, u);
                    }
                    if (t < u) {
                        h = c.c(o, x.index, t, u, j, true, h);
                    }
                    v = x.index + 1;
                }
                if (v <= s) {
                    if (!c.k) {
                        c.q(o, t, u);
                        if (t < u) {
                            h = c.c(o, v, t, u, j, true, h);
                        }
                    }
                    if (v > 0) {
                        i = c.e(o, v - 1, v, t, u, j, k, 4, 2, 134217728, 67108864, true, i);
                    }
                    if (!w && v < s) {
                        w = true;
                        i = c.e(o, v, v + 1, t, u, j, k, 4, 2, 134217728, 67108864, true, i);
                    }
                }
                if (r == 0) {
                    d = c.d(o, r, t, u, j, 134217728, 67108864, d);
                }
                else {
                    d = c.e(o, r - 1, r, t, u, j, k, 4, 2, 134217728, 67108864, false, d);
                }
                if (s < o.workbook.maxRowCount - 1) {
                    e = c.e(o, s, s + 1, t, u, j, k, 4, 2, 134217728, 67108864, true, e);
                }
                else {
                    e = c.d(o, s, t, u, j, 4, 2, e);
                }
                if (t == 0) {
                    f = c.d(o, t, r, s, l, 524288, 262144, f);
                }
                else {
                    f = c.e(o, t - 1, t, r, s, l, m, 4194304, 2097152, 524288, 262144, false, f);
                }
                if (u < o.workbook.maxColumnCount - 1) {
                    g = c.e(o, u, u + 1, r, s, l, m, 4194304, 2097152, 524288, 262144, true, g);
                }
                else {
                    g = c.d(o, u, r, s, l, 4194304, 2097152, g);
                }
            }
        }
        let ab = new FormatCellsDialogData();
        ab.ad = FormatCellsDialogDataBuilder.m(a, b);
        if (h != null) {
            ab.t = h.b;
            ab.e = h.a;
        }
        if (i != null) {
            ab.s = i.b;
            ab.d = i.a;
        }
        let ac = c.i;
        for (let ad = 1; ad != 1073741824; ad = (ad << 1)) {
            switch (ad) {
                case 1:
                    ab.m = ac.alignment;
                    break;
                case 2:
                    ab.p = e.b;
                    break;
                case 4:
                    ab.b = e.a;
                    break;
                case 8:
                    ab.q = ac.diagonalBorderColorInfo;
                    break;
                case 16:
                    ab.j = ac.diagonalBorders;
                    break;
                case 32:
                    ab.c = ac.diagonalBorderStyle;
                    break;
                case 64:
                    ab.i = ac.fill;
                    break;
                case 128:
                    ab.z = ac.font != null ? ac.font._bold$i : Nullable$1.toNullable(Boolean_$type, null);
                    break;
                case 256:
                    ab.r = ac.font != null ? ac.font.colorInfo : null;
                    break;
                case 512:
                    ab.x = ac.font != null ? ac.font.height : -1;
                    break;
                case 1024:
                    ab.aa = ac.font != null ? ac.font._italic$i : Nullable$1.toNullable(Boolean_$type, null);
                    break;
                case 2048:
                    ab.ah = ac.font != null ? ac.font.name : null;
                    break;
                case 4096:
                    ab.ab = ac.font != null ? ac.font._strikeout$i : Nullable$1.toNullable(Boolean_$type, null);
                    break;
                case 8192:
                    ab.k = ac.font != null ? ac.font.superscriptSubscriptStyle : -1;
                    break;
                case 16384:
                    ab.l = ac.font != null ? ac.font.underlineStyle : -1;
                    break;
                case 65536:
                    ab.ai = ac.formatString;
                    break;
                case 131072:
                    ab.y = ac.indent;
                    break;
                case 262144:
                    ab.u = f.b;
                    break;
                case 524288:
                    ab.f = f.a;
                    break;
                case 1048576:
                    ab.ac = ac._locked$i;
                    break;
                case 2097152:
                    ab.v = g.b;
                    break;
                case 4194304:
                    ab.g = g.a;
                    break;
                case 8388608:
                    ab.ae = Nullable$1.toNullable(Number_$type, ac.rotation);
                    break;
                case 16777216:
                    ab.af = ac._shrinkToFit$i;
                    break;
                case 67108864:
                    ab.w = d.b;
                    break;
                case 134217728:
                    ab.h = d.a;
                    break;
                case 268435456:
                    ab.n = ac.verticalAlignment;
                    break;
                case 536870912:
                    ab.ag = ac._wrapText$i;
                    break;
            }
        }
        return ab;
    }
    static g(a) {
        let b = new EditModeWorkbookFontInfo();
        a._v.initializeEditFont(b, false);
        let c = new FormatCellsDialogData();
        c.z = b.e;
        c.r = b.c;
        c.x = b.d;
        c.aa = b.f;
        c.ah = b.i;
        c.ab = b.g;
        c.k = b.a;
        c.l = b.b;
        return c;
    }
    static m(a, b) {
        let c = 0;
        for (let d = 0; d < a.length; d++) {
            if (a[d]._mergedCellsRegions$i.count == 0) {
                continue;
            }
            for (let e = 0; e < b.length; e++) {
                let f = b[e];
                let g = a[d]._mergedCellsRegions$i;
                for (let h = 0; h < g.count; h++) {
                    if (g.item(h)._t(f.firstRow, f.firstColumn, f.lastRow, f.lastColumn)) {
                        c++;
                        if (b.length > 1) {
                            return Nullable$1.toNullable(Boolean_$type, null);
                        }
                        let i = g.item(h)._h;
                        if (i._w != f.firstColumn || i._ac != f.firstRow || i._x != f.lastColumn || i._ae != f.lastRow) {
                            return Nullable$1.toNullable(Boolean_$type, null);
                        }
                    }
                }
            }
        }
        if (c == 0) {
            return Nullable$1.toNullable(Boolean_$type, false);
        }
        if (a.length == c) {
            return Nullable$1.toNullable(Boolean_$type, true);
        }
        return Nullable$1.toNullable(Boolean_$type, null);
    }
    n(a, b, c) {
        let d = a._ff;
        let e = a._f9(b);
        let f = null;
        while (f == null || f.r < c) {
            f = d._inner[e];
            this.o(f.b);
            e++;
        }
    }
    c(a, b, c, d, e, f, g) {
        if (g != null && g.d) {
            return g;
        }
        let h = g != null ? g : new CellBorderValue();
        let i = f ? 4194304 : 4;
        let j = f ? 2097152 : 2;
        let k = f ? 524288 : 134217728;
        let l = f ? 262144 : 67108864;
        e.h(a, b, c, d);
        e.c();
        let m = c;
        let n;
        while (m < d) {
            n = e.b;
            if (m == e.f) {
                e.c();
            }
            m++;
            let o = e.b;
            let p = EnumUtil.getEnumValue(CellBorderLineStyle_$type, n._da(i, null));
            let q = SpreadsheetUtilities.cn(p);
            let r = EnumUtil.getEnumValue(CellBorderLineStyle_$type, o._da(k, null));
            let s = SpreadsheetUtilities.cn(r);
            let t;
            let u;
            if (q >= s) {
                u = p;
                t = n._da(j, null);
            }
            else {
                u = r;
                t = o._da(l, null);
            }
            if (!h.e(u, t)) {
                break;
            }
            if (Base.referenceEquals(n, o)) {
                m = e.f;
            }
        }
        return h;
    }
    o(a) {
        for (let b = 1; b != 1073741824; b = (b << 1)) {
            if ((this.h & b) != 0) {
                let c = a._da(b, null);
                if (this.j) {
                    this.i._dv(b, c);
                }
                else if (!Base.equalsStatic(c, this.i._dd(b))) {
                    this.h &= ~b;
                    this.i._ds(b);
                }
            }
        }
        this.j = false;
    }
    d(a, b, c, d, e, f, g, h) {
        if (h != null && h.d) {
            return h;
        }
        let i = h == null ? new CellBorderValue() : h;
        e.h(a, b, c, d);
        while (e.c()) {
            let j = e.b;
            if (!i.e(EnumUtil.getEnumValue(CellBorderLineStyle_$type, j._da(f, null)), j._da(g, null))) {
                break;
            }
        }
        return i;
    }
    p(a, b, c) {
        if (a._hasCellFormat) {
            if (!this.l) {
                this.l = true;
                this.o(a._cellFormatInternal.d);
            }
        }
        else if (!this.k) {
            this.n(a.worksheet, b, c);
        }
    }
    q(a, b, c) {
        this.k = true;
        this.n(a, b, c);
    }
    e(a, b, c, d, e, f, g, h, i, j, k, l, m) {
        if (m != null && m.d) {
            return m;
        }
        let n = m == null ? new CellBorderValue() : m;
        f.h(a, b, d, e);
        f.c();
        g.h(a, c, d, e);
        g.c();
        let o = d;
        while (o <= e) {
            if (o > g.f) {
                g.c();
            }
            if (o > f.f) {
                f.c();
            }
            let p = EnumUtil.getEnumValue(CellBorderLineStyle_$type, f.b._da(h, null));
            let q = SpreadsheetUtilities.cn(p);
            let r = EnumUtil.getEnumValue(CellBorderLineStyle_$type, g.b._da(j, null));
            let s = SpreadsheetUtilities.cn(r);
            let t;
            let u;
            if ((q == s && !l) || s > q) {
                u = r;
                t = g.b._da(k, null);
            }
            else {
                u = p;
                t = f.b._da(i, null);
            }
            if (!n.e(u, t)) {
                break;
            }
            o = Math.min(f.f + 1, g.f + 1);
        }
        return n;
    }
}
FormatCellsDialogDataBuilder.$t = markType(FormatCellsDialogDataBuilder, 'FormatCellsDialogDataBuilder');
/**
 * @hidden
 */
export class SetFormatCellsDialogDataHelper extends Base {
    constructor() {
        super(...arguments);
        this.e = null;
        this.c = null;
        this.b = null;
        this.a = null;
    }
    f() {
        let a = this.c;
        let b = this.b;
        if (nullableNotEquals(a.ad, b.ad)) {
            if (nullableEquals(b.ad, true)) {
                this.e._g2(1);
            }
            else {
                this.e._g2(0);
            }
        }
        this.j(a.p, a.b, b.p, b.b);
        this.j(a.w, a.h, b.w, b.h);
        this.j(a.u, a.f, b.u, b.f);
        this.j(a.v, a.g, b.v, b.g);
        this.j(a.t, a.e, b.t, b.e);
        this.j(a.s, a.d, b.s, b.d);
        if (b.j != 0 && (b.j != a.j || WorkbookColorInfo.l_op_Inequality(b.q, a.q) || b.c != a.c)) {
            this.k(DiagonalBorders_$type, a.j, b.j, 16, SpreadsheetUtilities.eh);
            this.j(a.q, a.c, b.q, b.c);
        }
        let c = 0;
        let d = (e) => c++;
        this.i(d);
        if (c == 1) {
            this.k(CellFill.$, a.i, b.i, 64, SpreadsheetUtilities.ei);
            this.k(Nullable$1.$.specialize(Boolean_$type), a.z, b.z, 128, SpreadsheetUtilities.ef);
            this.k(WorkbookColorInfo.$, a.r, b.r, 256, SpreadsheetUtilities.ej);
            this.k(Number_$type, a.x, b.x, 512, SpreadsheetUtilities.el);
            this.k(Nullable$1.$.specialize(Boolean_$type), a.aa, b.aa, 1024, SpreadsheetUtilities.eo);
            this.k(String_$type, a.ah, b.ah, 2048, SpreadsheetUtilities.ek);
            this.k(Nullable$1.$.specialize(Boolean_$type), a.ab, b.ab, 4096, SpreadsheetUtilities.et);
            this.k(FontSuperscriptSubscriptStyle_$type, a.k, b.k, 8192, SpreadsheetUtilities.ev);
            this.k(FontUnderlineStyle_$type, a.l, b.l, 16384, SpreadsheetUtilities.ew);
            this.k(String_$type, a.ai, b.ai, 65536, SpreadsheetUtilities.em);
            this.k(HorizontalCellAlignment_$type, a.m, b.m, 1, SpreadsheetUtilities.ee);
            this.k(Number_$type, a.y, b.y, 131072, SpreadsheetUtilities.en);
            this.k(Nullable$1.$.specialize(Boolean_$type), a.ac, b.ac, 1048576, SpreadsheetUtilities.ep);
            this.k(Nullable$1.$.specialize(Number_$type), a.ae, b.ae, 8388608, (e, f) => SpreadsheetUtilities.er(e, f.value));
            this.k(Nullable$1.$.specialize(Boolean_$type), a.af, b.af, 16777216, SpreadsheetUtilities.es);
            this.k(VerticalCellAlignment_$type, a.n, b.n, 268435456, SpreadsheetUtilities.ex);
            this.k(Nullable$1.$.specialize(Boolean_$type), a.ag, b.ag, 536870912, SpreadsheetUtilities.ey);
        }
        else if (c > 1) {
            let e = 0;
            let f = (g) => e |= g;
            this.i(f);
            let g = new List$1(Delegate_$type, 0);
            for (let h = 1; h != 1073741824; h = (h << 1)) {
                let i = null;
                if ((e & h) != 0) {
                    switch (h) {
                        case 64:
                            i = (j) => j._a0(this.b.i, false, SpreadsheetUtilities.ah(j));
                            break;
                        case 128:
                            i = (j) => j._a2(Nullable$1.$.specialize(Boolean_$type), this.b.z, 128, false, SpreadsheetUtilities.ah(j), (k) => k._bold$i, (k, l) => k._bold$i = l);
                            break;
                        case 256:
                            i = (j) => j._a2(WorkbookColorInfo.$, this.b.r, 256, false, SpreadsheetUtilities.ah(j), (k) => k.colorInfo, (k, l) => k.colorInfo = l);
                            break;
                        case 512:
                            i = (j) => j._a2(Number_$type, this.b.x, 512, false, SpreadsheetUtilities.ah(j), (k) => k.height, (k, l) => k.height = l);
                            break;
                        case 1024:
                            i = (j) => j._a2(Nullable$1.$.specialize(Boolean_$type), this.b.aa, 1024, false, SpreadsheetUtilities.ah(j), (k) => k._italic$i, (k, l) => k._italic$i = l);
                            break;
                        case 2048:
                            i = (j) => j._a2(String_$type, this.b.ah, 2048, false, SpreadsheetUtilities.ah(j), (k) => k.name, (k, l) => k.name = l);
                            break;
                        case 4096:
                            i = (j) => j._a2(Nullable$1.$.specialize(Boolean_$type), this.b.ab, 4096, false, SpreadsheetUtilities.ah(j), (k) => k._strikeout$i, (k, l) => k._strikeout$i = l);
                            break;
                        case 8192:
                            i = (j) => j._a2(FontSuperscriptSubscriptStyle_$type, this.b.k, 8192, false, SpreadsheetUtilities.ah(j), (k) => k.superscriptSubscriptStyle, (k, l) => k.superscriptSubscriptStyle = l);
                            break;
                        case 16384:
                            i = (j) => j._a2(FontUnderlineStyle_$type, this.b.l, 16384, false, SpreadsheetUtilities.ah(j), (k) => k.underlineStyle, (k, l) => k.underlineStyle = l);
                            break;
                        case 65536:
                            i = (j) => j._a5(this.b.ai, false, SpreadsheetUtilities.ah(j));
                            break;
                        case 1:
                            i = (j) => j._au(this.b.m, false, SpreadsheetUtilities.ah(j));
                            break;
                        case 131072:
                            i = (j) => j._a8(this.b.y, false, SpreadsheetUtilities.ah(j));
                            break;
                        case 1048576:
                            i = (j) => j._bb(this.b.ac, false, SpreadsheetUtilities.ah(j));
                            break;
                        case 8388608:
                            i = (j) => j._bf(this.b.ae.value, false, SpreadsheetUtilities.ah(j));
                            break;
                        case 16777216:
                            i = (j) => j._bg(this.b.af, false, SpreadsheetUtilities.ah(j));
                            break;
                        case 268435456:
                            i = (j) => j._bm(this.b.n, false, SpreadsheetUtilities.ah(j));
                            break;
                        case 536870912:
                            i = (j) => j._bn(this.b.ag, false, SpreadsheetUtilities.ah(j));
                            break;
                        default: break;
                    }
                    if (i != null) {
                        g.add(i);
                    }
                }
            }
            this.e._io(List$1.$.specialize(Delegate_$type), g, (j, k) => {
                let l = j.b(true);
                for (let m = 0; m < k.count; m++) {
                    k._inner[m](j);
                }
                j.g(l);
            }, this.a, e);
        }
    }
    static g(a, b, c) {
        if (nullableNotEquals(b.z, c.z)) {
            a._bold$i = c.z;
        }
        if (WorkbookColorInfo.l_op_Inequality(b.r, c.r)) {
            a.colorInfo = c.r;
        }
        if (b.x != c.x) {
            a.height = c.x;
        }
        if (nullableNotEquals(b.aa, c.aa)) {
            a._italic$i = c.aa;
        }
        if (b.ah != c.ah) {
            a.name = c.ah;
        }
        if (nullableNotEquals(b.ab, c.ab)) {
            a._strikeout$i = c.ab;
        }
        if (b.k != c.k) {
            a.superscriptSubscriptStyle = c.k;
        }
        if (b.l != c.l) {
            a.underlineStyle = c.l;
        }
    }
    h($t, a, b, c, d) {
        if (!Base.equalsStatic(getBoxIfEnum($t, b), getBoxIfEnum($t, a))) {
            d(c);
        }
    }
    i(a) {
        let b = this.c;
        let c = this.b;
        this.h(CellFill.$, b.i, c.i, 64, a);
        this.h(Nullable$1.$.specialize(Boolean_$type), b.z, c.z, 128, a);
        this.h(WorkbookColorInfo.$, b.r, c.r, 256, a);
        this.h(Number_$type, b.x, c.x, 512, a);
        this.h(Nullable$1.$.specialize(Boolean_$type), b.aa, c.aa, 1024, a);
        this.h(String_$type, b.ah, c.ah, 2048, a);
        this.h(Nullable$1.$.specialize(Boolean_$type), b.ab, c.ab, 4096, a);
        this.h(FontSuperscriptSubscriptStyle_$type, b.k, c.k, 8192, a);
        this.h(FontUnderlineStyle_$type, b.l, c.l, 16384, a);
        this.h(String_$type, b.ai, c.ai, 65536, a);
        this.h(HorizontalCellAlignment_$type, b.m, c.m, 1, a);
        this.h(Number_$type, b.y, c.y, 131072, a);
        this.h(Nullable$1.$.specialize(Boolean_$type), b.ac, c.ac, 1048576, a);
        this.h(Nullable$1.$.specialize(Number_$type), b.ae, c.ae, 8388608, a);
        this.h(Nullable$1.$.specialize(Boolean_$type), b.af, c.af, 16777216, a);
        this.h(VerticalCellAlignment_$type, b.n, c.n, 268435456, a);
        this.h(Nullable$1.$.specialize(Boolean_$type), b.ag, c.ag, 536870912, a);
    }
    d(a, b) {
        let c = this.b;
        let d = this.c;
        let e = 0;
        if (WorkbookColorInfo.l_op_Equality(c.p, a) && c.b == b) {
            d.b = c.b;
            d.p = c.p;
            e |= 8;
        }
        if (WorkbookColorInfo.l_op_Equality(c.w, a) && c.h == b) {
            d.h = c.h;
            d.w = c.w;
            e |= 2;
        }
        if (WorkbookColorInfo.l_op_Equality(c.u, a) && c.f == b) {
            d.f = c.f;
            d.u = c.u;
            e |= 1;
        }
        if (WorkbookColorInfo.l_op_Equality(c.v, a) && c.g == b) {
            d.g = c.g;
            d.v = c.v;
            e |= 4;
        }
        if (WorkbookColorInfo.l_op_Equality(c.s, a) && c.d == b) {
            d.d = c.d;
            d.s = c.s;
            e |= 16;
        }
        if (WorkbookColorInfo.l_op_Equality(c.t, a) && c.e == b) {
            d.e = c.e;
            d.t = c.t;
            e |= 32;
        }
        if (c.j != 0 && WorkbookColorInfo.l_op_Equality(c.q, a) && c.c == b) {
            d.q = c.q;
            d.c = c.c;
            if (3 == (c.j & 3)) {
                e |= 64;
            }
            if (5 == (c.j & 5)) {
                e |= 128;
            }
        }
        return e;
    }
    j(a, b, c, d) {
        if (WorkbookColorInfo.l_op_Inequality(a, c) || b != d) {
            let e = this.d(c, d);
            this.e._im(this.a, e, c, d);
        }
    }
    k($t, a, b, c, d) {
        if (!Base.equalsStatic(getBoxIfEnum($t, b), getBoxIfEnum($t, a))) {
            this.e._io($t, b, d, this.a, c);
        }
    }
}
SetFormatCellsDialogDataHelper.$t = markType(SetFormatCellsDialogDataHelper, 'SetFormatCellsDialogDataHelper');
/**
 * @hidden
 */
export class RangeWorksheetCellFormatBase_RangeWorksheetCellFormatFont extends PropertyChangeNotifier {
    constructor(a) {
        super();
        this._g = Nullable$1.toNullable(Boolean_$type, null);
        this._e = null;
        this._f = 0;
        this._h = Nullable$1.toNullable(Boolean_$type, null);
        this._j = null;
        this._i = Nullable$1.toNullable(Boolean_$type, null);
        this._c = 0;
        this._d = 0;
        this._b = null;
        CoreUtilities.y(a);
        this._b = a;
    }
    get bold() {
        return unwrapNullable(this._bold$i);
    }
    set bold(a) {
        arguments[0] = wrapNullable(Boolean_$type, arguments[0]);
        this._bold$i = arguments[0];
    }
    get _bold$i() {
        return ((() => { let a = this._b._g(Nullable$1.$.specialize(Boolean_$type), this._g); this._g = a.p0; return a.ret; })());
    }
    set _bold$i(a) {
        this._b._al(Nullable$1.$.specialize(Boolean_$type), SpreadsheetUtilities.ef, a, 128);
    }
    get colorInfo() {
        return ((() => { let a = this._b._g(WorkbookColorInfo.$, this._e); this._e = a.p0; return a.ret; })());
    }
    set colorInfo(a) {
        this._b._al(WorkbookColorInfo.$, SpreadsheetUtilities.ej, a, 256);
    }
    get height() {
        return ((() => { let a = this._b._g(Number_$type, this._f); this._f = a.p0; return a.ret; })());
    }
    set height(a) {
        this._b._al(Number_$type, SpreadsheetUtilities.el, a, 512);
    }
    get italic() {
        return unwrapNullable(this._italic$i);
    }
    set italic(a) {
        arguments[0] = wrapNullable(Boolean_$type, arguments[0]);
        this._italic$i = arguments[0];
    }
    get _italic$i() {
        return ((() => { let a = this._b._g(Nullable$1.$.specialize(Boolean_$type), this._h); this._h = a.p0; return a.ret; })());
    }
    set _italic$i(a) {
        this._b._al(Nullable$1.$.specialize(Boolean_$type), SpreadsheetUtilities.eo, a, 1024);
    }
    get name() {
        return ((() => { let a = this._b._g(String_$type, this._j); this._j = a.p0; return a.ret; })());
    }
    set name(a) {
        this._b._al(String_$type, SpreadsheetUtilities.ek, a, 2048);
    }
    get strikeout() {
        return unwrapNullable(this._strikeout$i);
    }
    set strikeout(a) {
        arguments[0] = wrapNullable(Boolean_$type, arguments[0]);
        this._strikeout$i = arguments[0];
    }
    get _strikeout$i() {
        return ((() => { let a = this._b._g(Nullable$1.$.specialize(Boolean_$type), this._i); this._i = a.p0; return a.ret; })());
    }
    set _strikeout$i(a) {
        this._b._al(Nullable$1.$.specialize(Boolean_$type), SpreadsheetUtilities.et, a, 4096);
    }
    get superscriptSubscriptStyle() {
        return ((() => { let a = this._b._g(FontSuperscriptSubscriptStyle_$type, this._c); this._c = a.p0; return a.ret; })());
    }
    set superscriptSubscriptStyle(a) {
        this._b._al(FontSuperscriptSubscriptStyle_$type, SpreadsheetUtilities.ev, a, 8192);
    }
    get underlineStyle() {
        return ((() => { let a = this._b._g(FontUnderlineStyle_$type, this._d); this._d = a.p0; return a.ret; })());
    }
    set underlineStyle(a) {
        this._b._al(FontUnderlineStyle_$type, SpreadsheetUtilities.ew, a, 16384);
    }
    setFontFormatting(a) {
        this._b._al(IWorkbookFont_$type, (b, c) => b.font.setFontFormatting(c), a, 32640);
    }
    _k(a) {
        CoreUtilities.z(a, "source");
        this._g = a._bold$i;
        this._e = a.colorInfo;
        this._f = a.height;
        this._h = a._italic$i;
        this._j = a.name;
        this._i = a._strikeout$i;
        this._c = a.superscriptSubscriptStyle;
        this._d = a.underlineStyle;
    }
}
RangeWorksheetCellFormatBase_RangeWorksheetCellFormatFont.$t = markType(RangeWorksheetCellFormatBase_RangeWorksheetCellFormatFont, 'RangeWorksheetCellFormatBase_RangeWorksheetCellFormatFont', PropertyChangeNotifier.$, [IWorkbookFont_$type]);
/**
 * @hidden
 */
export class RangeWorksheetCellFormatBase_EmptyFormat extends RangeWorksheetCellFormatBase {
    constructor() {
        super();
    }
    get__s() {
        return null;
    }
    get _s() {
        return this.get__s();
    }
    _q() {
        return this;
    }
    _ak(a, b, c) {
        throw new NotSupportedException(0);
    }
    _al($t, a, b, c) {
        throw new NotSupportedException(0);
    }
}
RangeWorksheetCellFormatBase_EmptyFormat.$t = markType(RangeWorksheetCellFormatBase_EmptyFormat, 'RangeWorksheetCellFormatBase_EmptyFormat', RangeWorksheetCellFormatBase.$);
RangeWorksheetCellFormatBase_EmptyFormat._ao = new RangeWorksheetCellFormatBase_EmptyFormat();
/**
 * Returns and sets formatting information on a range of cells.
 */
export class SpreadsheetCellRangeFormat extends PropertyChangeNotifierExtended {
    constructor(a) {
        super();
        this._g = null;
        this._j = null;
        CoreUtilities.y(a);
        let b = PropertyChangeListenerList.e(RangeWorksheetCellFormatBase.$, this._g, a, this, true);
        this._g = b.p0;
    }
    /**
     * @hidden
     */
    e(sender, property, extraInfo) {
        if (sender == this._g) {
            this.a(property);
        }
        super.e(sender, property, extraInfo);
    }
    /**
     * Gets or sets the horizontal alignment of the content in a cell.
     * The horizontal alignment of the content in a cell.
     * @throws [[InvalidEnumArgumentException]] The value assigned is not defined in the [[HorizontalCellAlignment]] enumeration.
     * @see [[verticalAlignment]]
     */
    get alignment() {
        return this._g.alignment;
    }
    /**
     * Gets or sets the horizontal alignment of the content in a cell.
     * The horizontal alignment of the content in a cell.
     * @throws [[InvalidEnumArgumentException]] The value assigned is not defined in the [[HorizontalCellAlignment]] enumeration.
     * @see [[verticalAlignment]]
     */
    set alignment(a) {
        this._g.alignment = a;
    }
    /**
     * Gets or sets the fill of the cell.
     * The fill of the cell.
     * @see [[CellFill]]
     * @see [[CellFillPattern]]
     * @see [[CellFillLinearGradient]]
     * @see [[CellFillRectangularGradient]]
     */
    get fill() {
        return this._g.fill;
    }
    /**
     * Gets or sets the fill of the cell.
     * The fill of the cell.
     * @see [[CellFill]]
     * @see [[CellFillPattern]]
     * @see [[CellFillLinearGradient]]
     * @see [[CellFillRectangularGradient]]
     */
    set fill(a) {
        this._g.fill = a;
    }
    /**
     * Gets or sets the default font formatting.
     * <p class="body">
     * This font formatting is just the default font used in the cell. This can be overridden by strings on a character by character basis by
     * using the [[FormattedString]] class.
     * </p>
     * The default font formatting.
     */
    get font() {
        return this._j || this._g.font;
    }
    /**
     * Gets or sets the number format string.
     * <p class="body">For more information on excel format strings, consult Microsoft Excel help.</p>
     * The number format string.
     * @throws [[ArgumentException]] The assigned value is an invalid format string and [[Workbook.validateFormatStrings]] is True.
     * @see [[Workbook.validateFormatStrings]]
     */
    get formatString() {
        return this._g.formatString;
    }
    /**
     * Gets or sets the number format string.
     * <p class="body">For more information on excel format strings, consult Microsoft Excel help.</p>
     * The number format string.
     * @throws [[ArgumentException]] The assigned value is an invalid format string and [[Workbook.validateFormatStrings]] is True.
     * @see [[Workbook.validateFormatStrings]]
     */
    set formatString(a) {
        this._g.formatString = a;
    }
    /**
     * Gets or sets the indent in units of average character widths.
     * <p class="body">
     * A value of -1 indicates that the default value should be used.
     * </p>
     * The indent in units of average character widths or -1 to use the default indent.
     * @throws [[ArgumentOutOfRangeException]] The assigned value is not -1 and is outside the valid indent level range of 0 and 250.
     */
    get indent() {
        return this._g.indent;
    }
    /**
     * Gets or sets the indent in units of average character widths.
     * <p class="body">
     * A value of -1 indicates that the default value should be used.
     * </p>
     * The indent in units of average character widths or -1 to use the default indent.
     * @throws [[ArgumentOutOfRangeException]] The assigned value is not -1 and is outside the valid indent level range of 0 and 250.
     */
    set indent(a) {
        this._g.indent = a;
    }
    /**
     * Gets or sets the valid which indicates whether the cell is locked in protected mode.
     * <p class="body">The Locked valid is used in Excel file only if the associated [[Worksheet]] or [[Workbook]]
     * is protected. Otherwise the value is ignored.
     * </p>
     * The valid which indicates whether the cell is locked in protected mode.
     * @see */
    get locked() {
        return unwrapNullable(this._locked$i);
    }
    /**
     * Gets or sets the valid which indicates whether the cell is locked in protected mode.
     * <p class="body">The Locked valid is used in Excel file only if the associated [[Worksheet]] or [[Workbook]]
     * is protected. Otherwise the value is ignored.
     * </p>
     * The valid which indicates whether the cell is locked in protected mode.
     * @see */
    set locked(a) {
        arguments[0] = wrapNullable(Boolean_$type, arguments[0]);
        this._locked$i = arguments[0];
    }
    /**
     * @hidden
     */
    get _locked$i() {
        return this._g._locked$i;
    }
    /**
     * @hidden
     */
    set _locked$i(a) {
        this._g._locked$i = a;
    }
    /**
     * Gets or sets the rotation of the cell content in degrees.
     * <p class="body">
     * Cell text rotation, in degrees; 0  90 is up 0  90 degrees, 91  180 is down 1  90 degrees, and 255 is vertical.
     * </p>
     * The rotation of the cell content in degrees.
     */
    get rotation() {
        return this._g.rotation;
    }
    /**
     * Gets or sets the rotation of the cell content in degrees.
     * <p class="body">
     * Cell text rotation, in degrees; 0  90 is up 0  90 degrees, 91  180 is down 1  90 degrees, and 255 is vertical.
     * </p>
     * The rotation of the cell content in degrees.
     */
    set rotation(a) {
        this._g.rotation = a;
    }
    /**
     * Gets or sets the value indicating whether the cell content will shrink to fit the cell.
     * <p class="body">
     * If True, the size of the cell font will shrink so all data fits within the cell.
     * </p>
     * The value indicating whether the cell content will shrink to fit the cell.
     * @throws [[InvalidEnumArgumentException]] The value assigned is not defined in the ExcelDefaultableBoolean enumeration.
     */
    get shrinkToFit() {
        return unwrapNullable(this._shrinkToFit$i);
    }
    /**
     * Gets or sets the value indicating whether the cell content will shrink to fit the cell.
     * <p class="body">
     * If True, the size of the cell font will shrink so all data fits within the cell.
     * </p>
     * The value indicating whether the cell content will shrink to fit the cell.
     * @throws [[InvalidEnumArgumentException]] The value assigned is not defined in the ExcelDefaultableBoolean enumeration.
     */
    set shrinkToFit(a) {
        arguments[0] = wrapNullable(Boolean_$type, arguments[0]);
        this._shrinkToFit$i = arguments[0];
    }
    /**
     * @hidden
     */
    get _shrinkToFit$i() {
        return this._g._shrinkToFit$i;
    }
    /**
     * @hidden
     */
    set _shrinkToFit$i(a) {
        this._g._shrinkToFit$i = a;
    }
    /**
     * Gets or sets the parent [[WorkbookStyle]] of the format.
     * <p class="body">
     * The parent style of a cell or differential format provides default format values. Depending on which FormatOptions
     * flags are present, only certain groups of format properties will be resolved from parent style. When any of the properties in a
     * group is set to a non-default value, the FormatOptions will automatically have that flag included so the format provides values
     * in that group rather than the style providing values in that group.
     * </p>
     * <p class="body">
     * By default, all cell and differential formats will have a parent style of the normal style, which is exposed by the
     * [[WorkbookStyleCollection.normalStyle]] property. If a value of null is assigned as the Style for a cell or differential
     * format, then NormalStyle will actually be set.
     * </p>
     * A [[WorkbookStyle]] instance if this is a cell or differential format, or null if this is a style format.
     * @throws [[InvalidOperationException]] The value assigned is non-null and the format is a style format.
     * @throws [[ArgumentException]] The value assigned is from a different [[Workbook]].
     * @see [[Workbook.styles]]
     * @see [[WorkbookStyle]]
     */
    get style() {
        return this._g.style;
    }
    /**
     * Gets or sets the parent [[WorkbookStyle]] of the format.
     * <p class="body">
     * The parent style of a cell or differential format provides default format values. Depending on which FormatOptions
     * flags are present, only certain groups of format properties will be resolved from parent style. When any of the properties in a
     * group is set to a non-default value, the FormatOptions will automatically have that flag included so the format provides values
     * in that group rather than the style providing values in that group.
     * </p>
     * <p class="body">
     * By default, all cell and differential formats will have a parent style of the normal style, which is exposed by the
     * [[WorkbookStyleCollection.normalStyle]] property. If a value of null is assigned as the Style for a cell or differential
     * format, then NormalStyle will actually be set.
     * </p>
     * A [[WorkbookStyle]] instance if this is a cell or differential format, or null if this is a style format.
     * @throws [[InvalidOperationException]] The value assigned is non-null and the format is a style format.
     * @throws [[ArgumentException]] The value assigned is from a different [[Workbook]].
     * @see [[Workbook.styles]]
     * @see [[WorkbookStyle]]
     */
    set style(a) {
        this._g.style = a;
    }
    /**
     * Gets or sets the vertical alignment of the content in a cell.
     * The vertical alignment of the content in a cell.
     * @throws [[InvalidEnumArgumentException]] The value assigned is not defined in the [[VerticalCellAlignment]] enumeration.
     * @see [[alignment]]
     */
    get verticalAlignment() {
        return this._g.verticalAlignment;
    }
    /**
     * Gets or sets the vertical alignment of the content in a cell.
     * The vertical alignment of the content in a cell.
     * @throws [[InvalidEnumArgumentException]] The value assigned is not defined in the [[VerticalCellAlignment]] enumeration.
     * @see [[alignment]]
     */
    set verticalAlignment(a) {
        this._g.verticalAlignment = a;
    }
    /**
     * Gets or sets the value which indicates whether text will wrap in a cell.
     * <p class="body">
     * If True, and the row associated with the cell has a default [[WorksheetRow.height]], the row's
     * height will automatically be increased to fit wrapped content.
     * </p>
     * The value which indicates whether text will wrap in a cell.
     * @throws [[InvalidEnumArgumentException]] The value assigned is not defined in the ExcelDefaultableBoolean enumeration.
     */
    get wrapText() {
        return unwrapNullable(this._wrapText$i);
    }
    /**
     * Gets or sets the value which indicates whether text will wrap in a cell.
     * <p class="body">
     * If True, and the row associated with the cell has a default [[WorksheetRow.height]], the row's
     * height will automatically be increased to fit wrapped content.
     * </p>
     * The value which indicates whether text will wrap in a cell.
     * @throws [[InvalidEnumArgumentException]] The value assigned is not defined in the ExcelDefaultableBoolean enumeration.
     */
    set wrapText(a) {
        arguments[0] = wrapNullable(Boolean_$type, arguments[0]);
        this._wrapText$i = arguments[0];
    }
    /**
     * @hidden
     */
    get _wrapText$i() {
        return this._g._wrapText$i;
    }
    /**
     * @hidden
     */
    set _wrapText$i(a) {
        this._g._wrapText$i = a;
    }
    /**
     * Sets the specified borders for the associated range to the specified style and color.
     * @param borders Identifies the borders to be changed
     * @param borderColor The color for the borders
     * @param borderStyle The style for the borders
     */
    setBorders(borders, borderColor, borderStyle) {
        this._g._ak(borders, borderColor, borderStyle);
    }
    /**
     * @hidden
     */
    _u(a) {
        if (a != this._j) {
            this._j = a;
            this.a("Font");
        }
    }
}
SpreadsheetCellRangeFormat.$t = markType(SpreadsheetCellRangeFormat, 'SpreadsheetCellRangeFormat', PropertyChangeNotifierExtended.$);
/**
 * @hidden
 */
export class SpreadsheetHeaderBackgroundLayer extends SpreadsheetRendererElementLayer$1 {
    constructor(a, b) {
        super(SpreadsheetScrollRegion.$, a, b, PredefinedSpreadsheetLayers.m);
        this._t = null;
        this._t = new SpreadsheetHeaderBackgroundObserver(a, runOn(this, this._o));
    }
    get__m() {
        return 0;
    }
    get _m() {
        return this.get__m();
    }
    _p() {
        super._p();
        this._t.dispose();
    }
    _q(a, b, c, d) {
        SpreadsheetRenderUtilities.b(this._j, a, b, c, d);
    }
    get__s() {
        return this._j._o.renderCache;
    }
    get _s() {
        return this.get__s();
    }
}
SpreadsheetHeaderBackgroundLayer.$t = markType(SpreadsheetHeaderBackgroundLayer, 'SpreadsheetHeaderBackgroundLayer', SpreadsheetRendererElementLayer$1.$.specialize(SpreadsheetScrollRegion.$));
/**
 * @hidden
 */
export class SpreadsheetItemLayerObserver extends Base {
    constructor() {
        super();
        this._a = null;
        this._a = new PropertyChangeListener$1(SpreadsheetItemLayerObserver.$, this, SpreadsheetItemLayerObserver._c, false);
    }
    _b(a) {
        SpreadsheetUtilities.d6(a, this._a, true);
    }
    static _c(a, b, c, d) {
        a._d(b, c, d);
    }
    _e(a) {
        SpreadsheetUtilities.ec(a, this._a);
    }
}
SpreadsheetItemLayerObserver.$t = markType(SpreadsheetItemLayerObserver, 'SpreadsheetItemLayerObserver', Base.$, [IDisposable_$type]);
/**
 * @hidden
 */
export class SpreadsheetScrollRegionLayerObserver extends SpreadsheetItemLayerObserver {
    constructor(a) {
        super();
        this._f = null;
        this._f = a;
    }
}
SpreadsheetScrollRegionLayerObserver.$t = markType(SpreadsheetScrollRegionLayerObserver, 'SpreadsheetScrollRegionLayerObserver', SpreadsheetItemLayerObserver.$);
/**
 * @hidden
 */
export class SpreadsheetHeaderBackgroundObserver extends SpreadsheetScrollRegionLayerObserver {
    constructor(a, b) {
        super(a);
        this._g = null;
        this._b(a);
        this._g = b;
    }
    dispose() {
        this._e(this._f);
    }
    _d(a, b, c) {
        let d = false;
        switch (b != null ? b : "") {
            case "":
            case "Offset":
                if (a == this._f._x) {
                    d = true;
                }
                break;
            case "Add":
            case "Remove":
            case "Replace":
            case "Move":
            case "Reset":
                if (a == this._f._l) {
                    d = true;
                }
                else if (this._f._ay(a)) {
                    d = true;
                }
                break;
            case "ActiveSelection":
            case "HotTrackedIndex":
            case "ActualItemPositions":
            case "SelectionMode":
            case "ResourceProvider":
                if (a == this._f) {
                    d = true;
                }
                break;
            case "ResourceVersion":
                if (a == this._f._ad) {
                    d = true;
                }
                break;
        }
        if (d) {
            this._g();
        }
    }
    static _h(a, b, c, d) {
        a._d(b, c, d);
    }
}
SpreadsheetHeaderBackgroundObserver.$t = markType(SpreadsheetHeaderBackgroundObserver, 'SpreadsheetHeaderBackgroundObserver', SpreadsheetScrollRegionLayerObserver.$);
/**
 * @hidden
 */
export class SpreadsheetHeaderGridlineLayer extends SpreadsheetRendererElementLayer$1 {
    constructor(a, b) {
        super(SpreadsheetScrollRegion.$, a, b, PredefinedSpreadsheetLayers.p);
        this._t = null;
        this._t = new PropertyChangeListener$1(SpreadsheetHeaderGridlineLayer.$, this, SpreadsheetHeaderGridlineLayer._u, false);
        SpreadsheetUtilities.d6(a, this._t, true);
    }
    get__m() {
        return 1;
    }
    get _m() {
        return this.get__m();
    }
    _p() {
        super._p();
        if (this._j != null) {
            SpreadsheetUtilities.ec(this._j, this._t);
        }
    }
    _q(a, b, c, d) {
        let e = this._j;
        let f = e._i(true, true);
        let g = f.length;
        let h = e._aw;
        let i = e._ad;
        let j = e._o.renderCache;
        let k = e._br;
        let l = 6;
        let m = h ? 19 : 33;
        let n = h ? 21 : 35;
        let o = h ? 20 : 34;
        let p = h ? 22 : 36;
        let q = e._co;
        let r = SpreadsheetUtilities.b8(6, e._br);
        if (g > 0) {
            let s = r / 2;
            let t = !e._aw;
            let u = e._ar();
            let v = e._l;
            let w = v.count;
            let x = d.x;
            let y = d.y;
            let z = b.d;
            let aa = z * 2;
            let ab = new Array(g);
            let ac = 0;
            for (let ad = 0; ad < g - 1; ad++) {
                let ae = e._t(v._inner[ad]._j);
                let af = ae < ac ? ac : ae;
                let ag;
                switch (af) {
                    default:
                    case 0:
                        ag = m;
                        break;
                    case 1:
                        ag = n;
                        break;
                    case 2:
                        ag = o;
                        break;
                    case 3:
                    case 4:
                        ag = p;
                        break;
                }
                ab[ad] = ag;
                ac = ae;
            }
            if (g > 0) {
                ab[g - 1] = ab[g - 2];
            }
            if (t) {
                let ah = s - x;
                let ai = -y;
                let aj = c.y - ai;
                let ak = b.h(c.bottom - s) - ai;
                let al = 1;
                for (let am = 0; am < g; am++) {
                    let an;
                    if ((am < w && e._av(am, true)) || am == w && e._au(am - 1, true)) {
                        an = b.h(c.x + al + f[am] - aa) - ah;
                        a.drawLine(l, ab[am], k, an, aj, an, ak);
                        an = b.h(c.x + al + f[am] + aa) - ah;
                    }
                    else {
                        an = b.h(c.x + al + f[am]) - ah;
                    }
                    a.drawLine(l, ab[am], k, an, aj, an, ak);
                }
                let ao = b.h(c.bottom) - (s - y);
                a.drawLine(l, m, k, b.h(c.x) - (s - x), ao, b.h(c.x + f[g - 1]) - x + s, ao);
            }
            else {
                let ap = -x;
                let aq = s - y;
                let ar = c.x - ap;
                let as = b.h(c.right - s) - ap;
                let at = 1;
                for (let au = 0; au < g; au++) {
                    let av;
                    if ((au < w && e._av(au, true)) || au == w && e._au(au - 1, true)) {
                        av = b.h(c.y + at + f[au] - aa) - aq;
                        a.drawLine(l, ab[au], k, ar, av, as, av);
                        av = b.h(c.y + at + f[au] + aa) - aq;
                    }
                    else {
                        av = b.h(c.y + at + f[au]) - aq;
                    }
                    a.drawLine(l, ab[au], k, ar, av, as, av);
                }
                let aw = b.g(c.right) - (s - x);
                a.drawLine(l, m, k, aw, b.h(c.y) - (s - y), aw, b.h(c.y + f[g - 1]) - y + s);
            }
        }
    }
    get__s() {
        return this._j._o.renderCache;
    }
    get _s() {
        return this.get__s();
    }
    _v(a, b, c) {
        let d = false;
        switch (b != null ? b : "") {
            case "Add":
            case "Remove":
            case "Replace":
            case "Move":
            case "Reset":
                if (a == this._j._l) {
                    d = true;
                }
                else if (this._j._ay(a)) {
                    d = true;
                }
                break;
            case "Offset":
                if (a == this._j._x) {
                    d = true;
                }
                break;
            case "PreviousVisibleItemIndex":
            case "NextVisibleItemIndex":
            case "HotTrackedIndex":
            case "ActualItemPositions":
            case "SelectionMode":
            case "ResourceProvider":
                if (a == this._j) {
                    d = true;
                }
                break;
            case "ResourceVersion":
                if (a == this._j._ad) {
                    d = true;
                }
                break;
        }
        if (d) {
            this._o();
        }
    }
    static _u(a, b, c, d) {
        a._v(b, c, d);
    }
}
SpreadsheetHeaderGridlineLayer.$t = markType(SpreadsheetHeaderGridlineLayer, 'SpreadsheetHeaderGridlineLayer', SpreadsheetRendererElementLayer$1.$.specialize(SpreadsheetScrollRegion.$));
/**
 * @hidden
 */
export class SpreadsheetHeaderSelectionLayer extends SpreadsheetRendererElementLayer$1 {
    constructor(a, b) {
        super(SpreadsheetScrollRegion.$, a, b, PredefinedSpreadsheetLayers.s);
        this._u = null;
        this._t = null;
        this._v = false;
        this._u = new PropertyChangeListener$1(SpreadsheetHeaderSelectionLayer.$, this, SpreadsheetHeaderSelectionLayer._x, false);
        SpreadsheetUtilities.d6(a, this._u, true);
    }
    _r(a) {
        let b = !this._j._aw;
        let c = this._j._br;
        let d = this._j._bs;
        if (!b) {
            a.width += c;
        }
        else {
            a.height += d;
        }
        return a;
    }
    get__m() {
        return 0;
    }
    get _m() {
        return this.get__m();
    }
    _p() {
        super._p();
        if (this._j != null) {
            SpreadsheetUtilities.ec(this._j, this._u);
        }
    }
    _q(a, b, c, d) {
        let e = this._j;
        if (e._ar() && e._ai != 2) {
            let f = e._bx;
            let g = 4;
            let h = b.d;
            let i = -d.x;
            let j = -d.y;
            let k = e._aw;
            let l = c.x;
            let m = c.y;
            let n = c.right - h / 2;
            let o = c.bottom - h / 2;
            let p = e._l;
            let q = e._ab.cellRanges;
            let r = q.count == 1;
            let s = 1;
            if (k) {
                m += s;
            }
            else {
                l += s;
            }
            l = b.h(l) - i;
            m = b.h(m) - j;
            n = b.h(n) - i;
            o = b.h(o) - j;
            if (k) {
                l = n - h * 2;
            }
            else {
                m = o - h * 2;
            }
            let t = false;
            if (r) {
                let u = Enumerable.ad(SpreadsheetCellRange.$, q);
                let v = e._z;
                if (v != null) {
                    if (k) {
                        if (v.startIndex > u.firstColumn && v.startIndex <= u.lastColumn) {
                            t = true;
                        }
                        else {
                            m = e._bn(u.firstRow, true) * f + c.y + s;
                            o = e._bn(u.lastRow, false) * f + c.y + s;
                            let w = 100;
                            if (m < -w) {
                                m = -w;
                            }
                            if (o > c.bottom + w) {
                                o = c.bottom + w;
                            }
                            m = b.h(m) - j;
                            o = b.h(o) - j;
                            m -= h;
                            if (v.startIndex == u.firstColumn) {
                                m -= h;
                                o += h;
                            }
                        }
                    }
                    else {
                        if (v.startIndex > u.firstRow && v.startIndex <= u.lastRow) {
                            t = true;
                        }
                        else {
                            l = e._bn(u.firstColumn, true) * f + c.x + s;
                            n = e._bn(u.lastColumn, false) * f + c.x + s;
                            l = b.h(l) - i;
                            n = b.h(n) - i;
                            l -= h;
                            if (v.startIndex == u.firstRow) {
                                l -= h;
                                n += h;
                            }
                        }
                    }
                    if (!t) {
                        t = true;
                        a.fillRectangle1(g, l, m, Math.max(n - l, 0), Math.max(o - m, 0));
                    }
                }
            }
            if (!t) {
                let x = e._i(true);
                let y = x.length - 1;
                for (let z = 0; z < y; z++) {
                    if (!e._as(p._inner[z]._j)) {
                        continue;
                    }
                    let aa = z == 0 || !e._as(p._inner[z - 1]._j);
                    let ab = x[z];
                    let ac = x[z + 1];
                    if (k) {
                        ab += c.y + s;
                        ac += c.y + s;
                        m = b.h(ab) - j;
                        o = b.h(ac) - j;
                        if (aa) {
                            m -= h;
                        }
                    }
                    else {
                        ab += c.x + s;
                        ac += c.x + s;
                        l = b.h(ab) - i;
                        n = b.h(ac) - i;
                        if (aa) {
                            l -= h;
                        }
                    }
                    a.fillRectangle1(g, l, m, Math.max(n - l, 0), Math.max(o - m, 0));
                }
            }
            this._w = r;
        }
        else {
            this._w = false;
        }
    }
    get__s() {
        return this._j._o.renderCache;
    }
    get _s() {
        return this.get__s();
    }
    get _w() {
        return this._v;
    }
    set _w(a) {
        if (a != this._v) {
            this._v = a;
            if (a) {
                let b = PropertyChangeListenerList.e(SpreadsheetScrollRegion.$, this._t, this._j._z, this._u, true);
                this._t = b.p0;
            }
            else {
                let c = PropertyChangeListenerList.e(SpreadsheetScrollRegion.$, this._t, null, this._u, true);
                this._t = c.p0;
            }
        }
    }
    _y(a, b, c) {
        let d = false;
        switch (b != null ? b : "") {
            case "":
            case "Offset":
                if (a == this._j._x || (this._j._z != null && a == this._j._z._x)) {
                    d = true;
                }
                break;
            case "Add":
            case "Remove":
            case "Replace":
            case "Move":
            case "Reset":
                if (a == this._j._l) {
                    d = true;
                }
                else if (this._j._ay(a)) {
                    d = true;
                }
                break;
            case "AdjacentRowColumn":
                if (this._v && a == this._j) {
                    let e = PropertyChangeListenerList.e(SpreadsheetScrollRegion.$, this._t, this._j._z, this._u, true);
                    this._t = e.p0;
                    d = true;
                }
                break;
            case "ActiveSelection":
            case "SelectionMode":
            case "ResourceProvider":
                if (a == this._j) {
                    d = true;
                }
                break;
            case "ResourceVersion":
                if (a == this._j._ad) {
                    d = true;
                }
                break;
        }
        if (d) {
            this._o();
        }
    }
    static _x(a, b, c, d) {
        a._y(b, c, d);
    }
}
SpreadsheetHeaderSelectionLayer.$t = markType(SpreadsheetHeaderSelectionLayer, 'SpreadsheetHeaderSelectionLayer', SpreadsheetRendererElementLayer$1.$.specialize(SpreadsheetScrollRegion.$));
/**
 * @hidden
 */
export class SpreadsheetPaneLayerObserver extends SpreadsheetItemLayerObserver {
    constructor(a) {
        super();
        this._f = null;
        this._f = a;
    }
}
SpreadsheetPaneLayerObserver.$t = markType(SpreadsheetPaneLayerObserver, 'SpreadsheetPaneLayerObserver', SpreadsheetItemLayerObserver.$);
/**
 * @hidden
 */
export class InvalidDataLayerObserver extends SpreadsheetPaneLayerObserver {
    constructor(a, b) {
        super(a);
        this._g = null;
        this._g = b;
        this._b(a.columnScrollRegion._x);
        this._b(a.rowScrollRegion._x);
        this._b(a);
    }
    _d(a, b, c) {
        let d = false;
        switch (b != null ? b : "") {
            case "":
            case "Offset":
                if (a == this._f.rowScrollRegion._x || a == this._f.columnScrollRegion._x) {
                    d = true;
                }
                break;
            case "InvalidCellArray":
                if (a == this._f) {
                    d = true;
                }
                break;
            case "ResourceProvider":
                if (a == this._f.rowScrollRegion || a == this._f.columnScrollRegion) {
                    d = true;
                }
                break;
            case "ResourceVersion":
                if (a == this._f.rowScrollRegion._ad) {
                    d = true;
                }
                break;
        }
        if (d) {
            this._g();
        }
    }
    dispose() {
        this._e(this._f.columnScrollRegion._x);
        this._e(this._f.rowScrollRegion._x);
        this._e(this._f);
    }
}
InvalidDataLayerObserver.$t = markType(InvalidDataLayerObserver, 'InvalidDataLayerObserver', SpreadsheetPaneLayerObserver.$);
/**
 * @hidden
 */
export class PaneInteractionLayerObserver extends SpreadsheetPaneLayerObserver {
    constructor(a, b) {
        super(a);
        this._g = null;
        this._h = false;
        this._g = b;
        this._b(a.columnScrollRegion);
        this._b(a.rowScrollRegion);
        this._b(a);
    }
    _d(a, b, c) {
        let d = false;
        switch (b != null ? b : "") {
            case "":
            case "Offset":
                if (this._h) {
                    if (a == this._f.rowScrollRegion._x || a == this._f.columnScrollRegion._x) {
                        d = true;
                    }
                }
                break;
            case "ItemBeingResized":
            case "ItemBeingResizedRelativeEdge":
                if (a == this._f.rowScrollRegion || a == this._f.columnScrollRegion) {
                    d = true;
                }
                break;
        }
        if (d) {
            this._g();
        }
    }
    dispose() {
        this._e(this._f.columnScrollRegion);
        this._e(this._f.rowScrollRegion);
        this._e(this._f);
    }
}
PaneInteractionLayerObserver.$t = markType(PaneInteractionLayerObserver, 'PaneInteractionLayerObserver', SpreadsheetPaneLayerObserver.$);
/**
 * @hidden
 */
export class ShapeLayerObserver extends SpreadsheetPaneLayerObserver {
    constructor(a, b) {
        super(a);
        this._g = null;
        this._g = b;
        this._b(a);
        this._b(a.columnScrollRegion._x);
        this._b(a.rowScrollRegion._x);
    }
    dispose() {
        this._e(this._f);
        this._e(this._f.columnScrollRegion._x);
        this._e(this._f.rowScrollRegion._x);
    }
    _d(a, b, c) {
        let d = false;
        switch (b != null ? b : "") {
            case "":
            case "Offset":
                if (a == this._f.rowScrollRegion._x || a == this._f.columnScrollRegion._x) {
                    d = true;
                }
                break;
            case "Add":
            case "Remove":
            case "Replace":
            case "Move":
            case "Reset":
                if (a == this._f._r) {
                    d = true;
                }
                break;
        }
        if (d) {
            this._g();
        }
    }
}
ShapeLayerObserver.$t = markType(ShapeLayerObserver, 'ShapeLayerObserver', SpreadsheetPaneLayerObserver.$);
/**
 * @hidden
 */
export class SpreadsheetPaneButtonLayer extends SpreadsheetRendererElementLayer$1 {
    constructor(a, b) {
        super(SpreadsheetPane.$, a, b, PredefinedSpreadsheetLayers.l);
        this._t = null;
        this._t = new PropertyChangeListener$1(SpreadsheetPaneButtonLayer.$, this, SpreadsheetPaneButtonLayer._y, false);
        SpreadsheetUtilities.d6(a, this._t, true);
        SpreadsheetUtilities.d6(a.columnScrollRegion, this._t, true);
        SpreadsheetUtilities.d6(a.rowScrollRegion, this._t, true);
    }
    get__m() {
        return 2;
    }
    get _m() {
        return this.get__m();
    }
    _p() {
        super._p();
        if (this._j != null) {
            SpreadsheetUtilities.ec(this._j, this._t);
            SpreadsheetUtilities.ec(this._j.columnScrollRegion, this._t);
            SpreadsheetUtilities.ec(this._j.rowScrollRegion, this._t);
        }
    }
    get__s() {
        return this._j._s.renderCache;
    }
    get _s() {
        return this.get__s();
    }
    _q(a, b, c, d) {
        let e = this._j;
        let f = e._q;
        if (f.count > 0) {
            let g = e.columnScrollRegion;
            let h = e.rowScrollRegion;
            let i = h._bx;
            let j = e.visibleRange;
            let k = g._ad;
            let l = SpreadsheetUtilities.b8(6, g._br);
            let m = l / 2;
            let n = b.d;
            let o = -d.x;
            let p = -d.y;
            let q = SpreadsheetPaneButtonLayer._v(b);
            let r = SpreadsheetPaneButtonLayer._u(b);
            for (let s = 0; s < f.count; s++) {
                let t = f._inner[s];
                let u = SpreadsheetPaneButtonLayer._x(e, t, l, g, h, q, r);
                if (u > 0) {
                    let v = t.g;
                    let w = b.h(v.x + c.x) - o;
                    let x = b.h(v.x + c.x + v.width) - o;
                    let y = b.h(v.y + c.y) - p;
                    let z = b.h(v.y + c.y + v.height) - p;
                    let aa = x - w;
                    let ab = z - y;
                    let ac = (t.a & 2) == 0;
                    a.drawRectangle(6, ac ? 65 : 68, g._br, w + m, y + m, Math.max(aa - l, 0), Math.max(ab - l, 0));
                    w += n;
                    y += n;
                    aa = Math.max(0, aa - n * 2);
                    ab = Math.max(0, ab - n * 2);
                    if (aa > 0 && ab > 0) {
                        a.fillRectangle1(ac ? 66 : 69, w, y, aa, ab);
                        a.drawDropDownGlyph(t.a, w, y, aa, ab);
                    }
                }
            }
        }
    }
    static _u(a) {
        return a.d * 2;
    }
    static _v(a) {
        return a.d;
    }
    _z(a, b, c) {
        let d = false;
        switch (b != null ? b : "") {
            case "":
            case "Offset":
                if (a == this._j.rowScrollRegion._x || a == this._j.columnScrollRegion._x) {
                    d = true;
                }
                break;
            case "Add":
            case "Remove":
            case "Replace":
            case "Move":
            case "Reset":
                if (a == this._j.rowScrollRegion._l) {
                    d = true;
                }
                else if (a == this._j.columnScrollRegion._l) {
                    d = true;
                }
                else if (getInstanceType(a) == SpreadsheetUtilities.d4) {
                    d = true;
                }
                break;
            case "ActualItemPositions":
                if (a == this._j.rowScrollRegion) {
                    d = true;
                }
                else if (a == this._j.columnScrollRegion) {
                    d = true;
                }
                break;
            case "ResourceProvider":
                if (this._j.rowScrollRegion == a) {
                    d = true;
                }
                break;
            case "ActiveCellAsRange":
                if (a == this._j.rowScrollRegion._ab) {
                    d = true;
                }
                break;
            case "ResourceVersion":
                if (a == this._j.rowScrollRegion._ad) {
                    d = true;
                }
                break;
        }
        if (d) {
            this._o();
        }
    }
    static _y(a, b, c, d) {
        a._z(b, c, d);
    }
    static _w(a, b, c) {
        let d = a.columnScrollRegion;
        let e = a.rowScrollRegion;
        let f = SpreadsheetUtilities.b8(6, d._br);
        return SpreadsheetPaneButtonLayer._x(a, b, f, d, e, SpreadsheetPaneButtonLayer._v(c), SpreadsheetPaneButtonLayer._u(c));
    }
    static _x(a, b, c, d, e, f, g) {
        let h = d._bx;
        let i = a.selection._t(new SpreadsheetCell(b.d, b.c));
        let j = d._bn(i.firstColumn, true) * h;
        let k = d._bn(i.lastColumn, false) * h;
        let l = e._bn(i.firstRow, true) * h;
        let m = e._bn(i.firstRow, false) * h;
        let n = Math.max(0, Math.min(17, (m - l) - g));
        let o;
        switch (b.b) {
            default:
            case 2:
            case 3:
                o = new Rect(0, k + c, m - n, n, n);
                break;
            case 4:
            case 1:
            case 0:
                n = Math.max(0, Math.min(n, (k - j) - f));
                o = new Rect(0, k - n - f, m - n - g, n, n);
                break;
        }
        b.g = new Rect(0, o.x, o.y, o.width, o.height);
        return n;
    }
}
SpreadsheetPaneButtonLayer.$t = markType(SpreadsheetPaneButtonLayer, 'SpreadsheetPaneButtonLayer', SpreadsheetRendererElementLayer$1.$.specialize(SpreadsheetPane.$));
/**
 * @hidden
 */
export class SpreadsheetPaneCellBackgroundLayer extends SpreadsheetRendererElementLayer$1 {
    constructor(a, b) {
        super(SpreadsheetPane.$, a, b, PredefinedSpreadsheetLayers.m);
        this._u = null;
        this._u = new PropertyChangeListener$1(SpreadsheetPaneCellBackgroundLayer.$, this, SpreadsheetPaneCellBackgroundLayer._v, false);
        SpreadsheetUtilities.d6(a, this._u, true);
        SpreadsheetUtilities.d6(a.columnScrollRegion._x, this._u, true);
        SpreadsheetUtilities.d6(a.rowScrollRegion._x, this._u, true);
    }
    get__m() {
        return 0;
    }
    get _m() {
        return this.get__m();
    }
    _p() {
        super._p();
        if (this._j != null) {
            SpreadsheetUtilities.ec(this._j, this._u);
            SpreadsheetUtilities.ec(this._j.columnScrollRegion._x, this._u);
            SpreadsheetUtilities.ec(this._j.rowScrollRegion._x, this._u);
        }
    }
    get__s() {
        return this._j._s.renderCache;
    }
    get _s() {
        return this.get__s();
    }
    _q(a, b, c, d) {
        let e = this._j;
        let f = e._w;
        let g = e._k;
        let h = e.columnScrollRegion;
        let i = e.rowScrollRegion;
        let j = i._i(true);
        let k = h._i(true);
        let l = j.length - 1;
        let m = k.length - 1;
        let n = i._bx;
        if (l > 0 && m > 0 && g != null) {
            let o = b.d;
            let p = o / 2;
            let q = -d.x;
            let r = -d.y;
            let s = i._br;
            for (let t = 1; t <= l; t++) {
                let u = g.d(t);
                for (let v = 1; v <= m; v++) {
                    let w = f.item(t, v);
                    let x = w.f;
                    let y = w.g;
                    if (x != null || y != null) {
                        let z, aa, ab, ac;
                        let ad, ae, af, ag;
                        let ah = u ? g.item(t, v) : null;
                        if (ah != null && ah.r) {
                            if (t > 1 && g.item(t - 1, v) == ah) {
                                continue;
                            }
                            if (v > 1 && g.item(t, v - 1) == ah) {
                                continue;
                            }
                            z = h._bn(ah.ab, true) * n + c.x;
                            aa = h._bn(ah.x, false) * n + c.x;
                            ab = i._bn(ah.ak, true) * n + c.y;
                            ac = i._bn(ah.ag, false) * n + c.y;
                        }
                        else {
                            z = k[v - 1] + c.x;
                            aa = k[v] + c.x;
                            ab = j[t - 1] + c.y;
                            ac = j[t] + c.y;
                        }
                        ad = z;
                        ae = aa;
                        af = ab;
                        ag = ac;
                        z = b.h(z) - q;
                        aa = b.h(aa) - q;
                        ab = b.h(ab) - r;
                        ac = b.h(ac) - r;
                        z -= o;
                        ab -= o;
                        if (ah == null || !ah.r) {
                            if (t != l - 1 && f.item(t + 1, v).f != null) {
                                ac -= o;
                            }
                            if (v != m - 1 && f.item(t, v + 1).f != null) {
                                aa -= o;
                            }
                        }
                        if (x != null) {
                            a.fillRectangle3(x, z, ab, Math.max(aa - z, 0), Math.max(ac - ab, 0));
                        }
                        if (y != null) {
                            z = ad;
                            aa = ae;
                            ab = af;
                            ac = ag;
                            z += o * 2;
                            aa -= o * 2;
                            if (z < aa) {
                                let ai = WorkbookColorInfo.l_op_Inequality(y.axisColor, null);
                                let aj = 0;
                                let ak = y.direction == -5004;
                                if (ai) {
                                    let al = ((aa - z) * y.axisPosition);
                                    aj = b.h(ak ? aa - al : z + al) - q;
                                    a.drawLine1(5, y.axisColor, s, aj - p, b.h(ab) - r, aj - p, b.h(ac) - r);
                                }
                                ab += o * 1;
                                ac -= o * 3;
                                if (ab < ac) {
                                    ab = b.h(ab) - r;
                                    ac = b.h(ac) - r;
                                    let am = ai && y.barPositionTo > y.barPositionFrom;
                                    let an, ao;
                                    if (ak) {
                                        an = am && y.barPositionTo == y.axisPosition ? aj + o : b.h(aa - ((aa - z) * y.barPositionTo)) - q;
                                        ao = am && y.barPositionFrom == y.axisPosition ? aj - o : b.h(aa - ((aa - z) * y.barPositionFrom)) - q;
                                    }
                                    else {
                                        an = am && y.barPositionFrom == y.axisPosition ? aj + o : b.h(z + ((aa - z) * y.barPositionFrom)) - q;
                                        ao = am && y.barPositionTo == y.axisPosition ? aj - o : b.h(z + ((aa - z) * y.barPositionTo)) - q;
                                    }
                                    if (ao - an >= o) {
                                        if (WorkbookColorInfo.l_op_Inequality(y.barColor, null)) {
                                            let ap, aq;
                                            if (y.barFillType == 1) {
                                                if (ak) {
                                                    aq = am && y.barPositionFrom == y.axisPosition ? SpreadsheetPaneCellBackgroundLayer._t : y.barColor;
                                                    ap = am && y.barPositionFrom == y.axisPosition ? y.barColor : SpreadsheetPaneCellBackgroundLayer._t;
                                                }
                                                else {
                                                    ap = am && y.barPositionTo == y.axisPosition ? SpreadsheetPaneCellBackgroundLayer._t : y.barColor;
                                                    aq = am && y.barPositionTo == y.axisPosition ? y.barColor : SpreadsheetPaneCellBackgroundLayer._t;
                                                }
                                            }
                                            else {
                                                ap = aq = y.barColor;
                                            }
                                            a.fillRectangle4(ap, aq, true, an, ab, ao - an, ac - ab);
                                        }
                                        if (WorkbookColorInfo.l_op_Inequality(y.barBorder, null)) {
                                            a.drawRectangle1(6, y.barBorder, s, an - p, ab + p, ao - an, ac - ab - o);
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
    }
    _w(a, b, c) {
        let d = false;
        switch (b != null ? b : "") {
            case "":
            case "Offset":
                if (a == this._j.rowScrollRegion._x || a == this._j.columnScrollRegion._x) {
                    d = true;
                }
                break;
            case "CellFillArray":
                if (a == this._j) {
                    d = true;
                }
                break;
        }
        if (d) {
            this._o();
        }
    }
    static _v(a, b, c, d) {
        a._w(b, c, d);
    }
}
SpreadsheetPaneCellBackgroundLayer.$t = markType(SpreadsheetPaneCellBackgroundLayer, 'SpreadsheetPaneCellBackgroundLayer', SpreadsheetRendererElementLayer$1.$.specialize(SpreadsheetPane.$));
SpreadsheetPaneCellBackgroundLayer._t = new WorkbookColorInfo(Color.u(255, 255, 255, 255));
/**
 * @hidden
 */
export class SpreadsheetPaneCellBorderLayer extends SpreadsheetRendererElementLayer$1 {
    constructor(a, b) {
        super(SpreadsheetPane.$, a, b, PredefinedSpreadsheetLayers.n);
        this._t = null;
        this._t = new PropertyChangeListener$1(SpreadsheetPaneCellBorderLayer.$, this, SpreadsheetPaneCellBorderLayer._u, false);
        SpreadsheetUtilities.d6(a, this._t, true);
        SpreadsheetUtilities.d6(a.columnScrollRegion._x, this._t, true);
        SpreadsheetUtilities.d6(a.rowScrollRegion._x, this._t, true);
    }
    get__m() {
        return 1;
    }
    get _m() {
        return this.get__m();
    }
    _p() {
        super._p();
        if (this._j != null) {
            SpreadsheetUtilities.ec(this._j, this._t);
            SpreadsheetUtilities.ec(this._j.columnScrollRegion._x, this._t);
            SpreadsheetUtilities.ec(this._j.rowScrollRegion._x, this._t);
        }
    }
    get__s() {
        return this._j._s.renderCache;
    }
    get _s() {
        return this.get__s();
    }
    _q(a, b, c, d) {
        let e = this._j;
        let f = e._w;
        let g = e._k;
        let h = e.columnScrollRegion;
        let i = e.rowScrollRegion;
        let j = i._i(true);
        let k = h._i(true);
        let l = j.length - 1;
        let m = k.length - 1;
        let n = i._bx;
        let o = h._br;
        let p = i._bs;
        if (l > 0 && m > 0) {
            let q = b.d;
            let r = a.getFarPixelAdjustment(b);
            let s = q * 2;
            let t = q * 3;
            let u = q * 4;
            let v = -d.x;
            let w = -d.y;
            let x = PointUtil.create();
            let y = PointUtil.create();
            let z = h._br;
            let aa = h._bs;
            let ab = c.y;
            let ac = c.x;
            let ad = l + 1;
            let ae = m + 1;
            let af = false;
            let ag = SpreadsheetUtilities.b8(6, p);
            for (let ah = 1; ah <= ad; ah++) {
                let ai = b.h(j[ah - 1] + ab);
                let aj = ah <= l ? b.h(j[ah] + ab) : ai;
                for (let ak = 1; ak <= ae; ak++) {
                    let al = b.h(k[ak - 1] + ac);
                    let am = f.item(ah, ak);
                    if (am.a != 0) {
                        af = true;
                    }
                    if (am.e != 0 && ak <= m) {
                        let an = b.h(k[ak] + ac);
                        switch (am.e) {
                            case 6:
                                {
                                    let ao = f.item(ah - 1, ak);
                                    let ap = am.n;
                                    let aq = ag / 2;
                                    x.x = al - v + am.i * q;
                                    y.x = an - r - v - am.j * q;
                                    y.y = x.y = ai - (q + aq + w);
                                    let ar = f.item(ah, ak - 1).e == 6;
                                    let as = ao.d == 6;
                                    let at = am.d == 6;
                                    let au = f.item(ah, ak + 1).e == 6;
                                    let av = f.item(ah - 1, ak + 1).d == 6;
                                    let aw = f.item(ah, ak + 1).d == 6;
                                    if (as) {
                                        x.x -= q;
                                    }
                                    else if (at) {
                                        x.x -= t;
                                    }
                                    if (av) {
                                        y.x -= s;
                                    }
                                    if (ao.c == 6) {
                                        let ax = g.item(ah - 1, ak - 1) != g.item(ah - 1, ak) || g.item(ah - 1, ak - 1) == null || g.item(ah - 1, ak) == null;
                                        if (ax && (ao.a & 2) != 0) {
                                            x.x = Math.max(x.x, al - v + u);
                                        }
                                        let ay = g.item(ah - 1, ak + 1) != g.item(ah - 1, ak) || g.item(ah - 1, ak + 1) == null || g.item(ah - 1, ak) == null;
                                        if (ay && (ao.a & 1) != 0) {
                                            y.x = Math.min(y.x, an - v - u);
                                        }
                                    }
                                    a._drawLine2$i(6, ap, p, x.x, x.y, y.x, y.y);
                                    x.x = al - v + am.i * q;
                                    y.x = an - r - v - am.j * q;
                                    x.y += s;
                                    y.y = x.y;
                                    if (at) {
                                        x.x -= q;
                                    }
                                    else if (ar) {
                                    }
                                    else if (as) {
                                        x.x -= t;
                                    }
                                    if (aw) {
                                        y.x -= s;
                                    }
                                    if (am.c == 6) {
                                        let az = g.item(ah, ak - 1) != g.item(ah, ak) || g.item(ah, ak - 1) == null || g.item(ah, ak) == null;
                                        if (az && (am.a & 2) != 0) {
                                            x.x = Math.max(x.x, al - v + u);
                                        }
                                        let a0 = g.item(ah, ak + 1) != g.item(ah, ak) || g.item(ah, ak + 1) == null || g.item(ah, ak) == null;
                                        if (a0 && (am.a & 1) != 0) {
                                            y.x = Math.min(y.x, an - v - u);
                                        }
                                    }
                                    a._drawLine2$i(6, ap, p, x.x, x.y, y.x, y.y);
                                    break;
                                }
                            case 13:
                                {
                                    let a1 = am.n;
                                    let a2 = SpreadsheetUtilities.b8(9, p) / 2;
                                    x.x = al - v + am.i * q;
                                    y.x = an - r - v - am.j * q;
                                    y.y = x.y = ai - (a2 + w) - q;
                                    a._drawLine2$i(9, a1, p, x.x, x.y, y.x, y.y);
                                    y.y = x.y = ai - (a2 + w);
                                    a._drawLine2$i(8, a1, p, x.x, x.y, y.x, y.y);
                                    break;
                                }
                            default:
                                {
                                    let a3 = SpreadsheetUtilities.i(am.e);
                                    let a4 = am.n;
                                    let a5 = SpreadsheetUtilities.b8(a3, p) / 2;
                                    x.x = al - v + am.i * q;
                                    y.x = an - r - v - am.j * q;
                                    y.y = x.y = ai - (a5 + w);
                                    if (a5 > aa) {
                                        y.y = x.y = x.y + aa;
                                    }
                                    a._drawLine2$i(a3, a4, p, x.x, x.y, y.x, y.y);
                                    break;
                                }
                        }
                    }
                    if (am.d != 0 && ah <= l) {
                        switch (am.d) {
                            case 6:
                                {
                                    let a6 = f.item(ah, ak - 1);
                                    let a7 = am.m;
                                    let a8 = ag / 2;
                                    let a9 = am.e == 6;
                                    let ba = f.item(ah - 1, ak).d == 6;
                                    let bb = a6.e == 6;
                                    let bc = f.item(ah + 1, ak).e == 6;
                                    let bd = f.item(ah + 1, ak).d == 6;
                                    let be = f.item(ah + 1, ak - 1).e == 6;
                                    y.x = x.x = al - (q + a8 + v);
                                    y.y = aj - r - w - am.h * q;
                                    x.y = ai - w + am.k * q;
                                    let bf = x.y;
                                    let bg = y.y;
                                    if (a6.c == 6) {
                                        let bh = g.item(ah, ak - 1) != g.item(ah, ak) || g.item(ah, ak - 1) == null || g.item(ah, ak) == null;
                                        if (bh && (a6.a & 2) != 0) {
                                            x.y = Math.max(x.y, ai + w + s);
                                        }
                                        let bi = g.item(ah, ak - 1) != g.item(ah, ak) || g.item(ah, ak - 1) == null || g.item(ah, ak) == null;
                                        if (bi && (a6.a & 1) != 0) {
                                            y.y = Math.min(y.y, aj - w - s);
                                        }
                                    }
                                    a._drawLine2$i(6, a7, o, x.x, x.y, y.x, y.y);
                                    x.x += s;
                                    y.x = x.x;
                                    x.y = bf;
                                    y.y = bg;
                                    if (a9) {
                                        if (am.k < 0) {
                                            x.y += s;
                                        }
                                    }
                                    else if (ba) {
                                        if (bb) {
                                            x.y -= q;
                                        }
                                    }
                                    else if (bb) {
                                        if (am.k >= 0) {
                                            x.y -= s;
                                        }
                                    }
                                    if (bc) {
                                        if (am.h < 0) {
                                            y.y -= s;
                                        }
                                    }
                                    else if (bd) {
                                        if (be) {
                                            y.y += s;
                                        }
                                    }
                                    else if (be) {
                                        y.y += s;
                                    }
                                    if (am.c == 6 && ak < ae) {
                                        let bj = g.item(ah, ak + 1) != g.item(ah, ak) || g.item(ah, ak + 1) == null || g.item(ah, ak) == null;
                                        if (bj && (am.a & 1) != 0) {
                                            x.y = Math.max(x.y, ai + w + s);
                                        }
                                        let bk = g.item(ah, ak + 1) != g.item(ah, ak) || g.item(ah, ak + 1) == null || g.item(ah, ak) == null;
                                        if (bk && (am.a & 2) != 0) {
                                            y.y = Math.min(y.y, aj - w - s);
                                        }
                                    }
                                    a._drawLine2$i(6, a7, o, x.x, x.y, y.x, y.y);
                                    break;
                                }
                            case 13:
                                {
                                    let bl = am.m;
                                    let bm = SpreadsheetUtilities.b8(9, o) / 2;
                                    y.x = x.x = al - (bm + v) - q;
                                    y.y = aj - r - w - am.h * q;
                                    x.y = ai - w + am.k * q;
                                    a._drawLine2$i(9, bl, o, x.x, x.y, y.x, y.y);
                                    y.x = x.x = al - (bm + v);
                                    a._drawLine2$i(8, bl, o, x.x, x.y, y.x, y.y);
                                    break;
                                }
                            default:
                                {
                                    let bn = SpreadsheetUtilities.i(am.d);
                                    let bo = am.m;
                                    let bp = SpreadsheetUtilities.b8(bn, o) / 2;
                                    y.x = x.x = al - (bp + v);
                                    y.y = aj - r - w - am.h * q;
                                    x.y = ai - w + am.k * q;
                                    if (bp > z) {
                                        y.x = x.x = x.x + z;
                                    }
                                    a._drawLine2$i(bn, bo, o, x.x, x.y, y.x, y.y);
                                    break;
                                }
                        }
                    }
                }
            }
            if (af) {
                for (let bq = 1; bq < ad; bq++) {
                    let br = b.h(j[bq - 1] + ab);
                    for (let bs = 1; bs < ae; bs++) {
                        let bt = f.item(bq, bs);
                        if (bt.a != 0) {
                            let bu = g.item(bq, bs);
                            if (bu == null || !bu.r || (bq == 1 && bs == 1) || (bq == 1 && g.item(bq, bs - 1) != bu) || (bs == 1 && g.item(bq - 1, bs) != bu) || (g.item(bq - 1, bs) != bu && g.item(bq, bs - 1) != bu)) {
                                let bv = br;
                                if (SpreadsheetUtilities.cm(bt.e) > 1) {
                                    bv += q;
                                }
                                let bw = b.h(k[bs - 1] + ac);
                                let bx, by;
                                if (bu != null && bu.r) {
                                    if (g.item(bq - 1, bs) == bu) {
                                        bv = b.h(i._bn(bu.ak, true) * n + ab);
                                    }
                                    if (g.item(bq, bs - 1) == bu) {
                                        bw = b.h(h._bn(bu.ab, true) * n + ac);
                                    }
                                    let bz = h._cf(bu.x);
                                    if (bz < 0) {
                                        bx = h._bn(bu.x, false) * n + ac;
                                    }
                                    else {
                                        bx = k[bz + 1] + ac;
                                        bx -= q * Math.min(SpreadsheetUtilities.cm(f.item(bq, bz + 1).d), 2);
                                    }
                                    let b0 = i._cf(bu.ag);
                                    if (b0 < 0) {
                                        by = i._bn(bu.ag, false) * n + ab;
                                    }
                                    else {
                                        by = j[b0 + 1] + ab;
                                        if (SpreadsheetUtilities.cm(f.item(b0 + 1, bs).e) > 1) {
                                            by -= q;
                                        }
                                    }
                                }
                                else {
                                    bx = k[bs] + ac;
                                    by = j[bq] + ab;
                                    bx -= q * Math.min(SpreadsheetUtilities.cm(f.item(bq, bs + 1).d), 2);
                                    if (SpreadsheetUtilities.cm(f.item(bq + 1, bs).e) > 1) {
                                        by -= q;
                                    }
                                }
                                let b1 = b.h(bx);
                                let b2 = b.h(by);
                                switch (bt.c) {
                                    case 6:
                                        {
                                            let b3 = bt.l;
                                            switch (bt.a) {
                                                case 1:
                                                    a._drawLine2$i(6, b3, o, bw + u, bv, b1, b2 - q);
                                                    a._drawLine2$i(6, b3, o, bw, bv + q, b1 - u, b2);
                                                    break;
                                                case 2:
                                                    a._drawLine2$i(6, b3, o, bw, b2 - q, b1 - u - q, bv);
                                                    a._drawLine2$i(6, b3, o, bw + u, b2, b1, bv + q);
                                                    break;
                                                case 3:
                                                    let b4 = b1 - bw;
                                                    let b5 = b2 - bv;
                                                    a._drawLine2$i(6, b3, o, bw + u, bv, bw + b4 / 2, bv + b5 / 2 - q);
                                                    a._drawLine2$i(6, b3, o, bw + b4 / 2, bv + b5 / 2 - q, b1 - u - q, bv);
                                                    a._drawLine2$i(6, b3, o, b1, bv + q, bw + b4 / 2 + u, bv + b5 / 2);
                                                    a._drawLine2$i(6, b3, o, bw + b4 / 2 + u, bv + b5 / 2, b1, b2 - q);
                                                    a._drawLine2$i(6, b3, o, b1 - u, b2, bw + b4 / 2, bv + b5 / 2 + q);
                                                    a._drawLine2$i(6, b3, o, bw + b4 / 2, bv + b5 / 2 + q, bw + u, b2);
                                                    a._drawLine2$i(6, b3, o, bw, b2 - q, bw + b4 / 2 - u, bv + b5 / 2);
                                                    a._drawLine2$i(6, b3, o, bw + b4 / 2 - u, bv + b5 / 2, bw, bv + q);
                                                    break;
                                            }
                                            break;
                                        }
                                    case 0: break;
                                    default:
                                        {
                                            let b6 = bt.c == 13 ? 10 : SpreadsheetUtilities.i(bt.c);
                                            let b7 = bt.l;
                                            if (bt.a != 2) {
                                                a._drawLine2$i(b6, b7, o, bw, bv, b1, b2);
                                            }
                                            if (bt.a != 1) {
                                                a._drawLine2$i(b6, b7, o, bw, b2, b1, bv);
                                            }
                                            break;
                                        }
                                }
                            }
                        }
                    }
                }
            }
        }
    }
    _v(a, b, c) {
        let d = false;
        switch (b != null ? b : "") {
            case "":
            case "Offset":
                if (a == this._j.rowScrollRegion._x || a == this._j.columnScrollRegion._x) {
                    d = true;
                }
                break;
            case "CellFillArray":
                if (a == this._j) {
                    d = true;
                }
                break;
        }
        if (d) {
            this._o();
        }
    }
    static _u(a, b, c, d) {
        a._v(b, c, d);
    }
}
SpreadsheetPaneCellBorderLayer.$t = markType(SpreadsheetPaneCellBorderLayer, 'SpreadsheetPaneCellBorderLayer', SpreadsheetRendererElementLayer$1.$.specialize(SpreadsheetPane.$));
/**
 * @hidden
 */
export class SpreadsheetPaneGridlineLayer extends SpreadsheetRendererElementLayer$1 {
    constructor(a, b) {
        super(SpreadsheetPane.$, a, b, PredefinedSpreadsheetLayers.p);
        this._t = null;
        this._t = new PropertyChangeListener$1(SpreadsheetPaneGridlineLayer.$, this, SpreadsheetPaneGridlineLayer._u, false);
        SpreadsheetUtilities.d6(a, this._t, true);
    }
    get__m() {
        return 1;
    }
    get _m() {
        return this.get__m();
    }
    _p() {
        super._p();
        if (this._j != null) {
            SpreadsheetUtilities.ec(this._j, this._t);
        }
    }
    get__s() {
        return this._j._s.renderCache;
    }
    get _s() {
        return this.get__s();
    }
    _q(a, b, c, d) {
        let e = this._j;
        let f = e._k;
        let g = e._aa;
        let h = e._w;
        let i = e.rowScrollRegion._i(true);
        let j = e.columnScrollRegion._i(true);
        let k = i.length - 1;
        let l = j.length - 1;
        if (f != null && g != null && k > 0 && l > 0 && e.rowScrollRegion._bx >= 0.4) {
            let m = e.rowScrollRegion._br;
            let n = SpreadsheetUtilities.b8(6, m);
            let o = n / 2;
            let p, q;
            let r = d.x;
            let s = d.y;
            let t = b.d;
            let u = t * 2;
            p = -r;
            q = o - s;
            for (let v = 0; v < k; v++) {
                let w = b.h(i[v + 1] + c.y) - q;
                let x = -1;
                let y = 0;
                for (let z = 1; z <= l; z++) {
                    let aa = h.item(v + 1, z).f != null || h.item(v + 2, z).f != null;
                    let ab = h.item(v + 2, z).e != 0;
                    let ac = h.item(v + 1, z).d != 0 || h.item(v + 2, z).d != 0;
                    let ad = (f.item(v + 1, z) != null && f.item(v + 1, z) == f.item(v + 2, z));
                    if (aa || ab || (x >= 0 && ac) || ad) {
                        if (x < 0) {
                            continue;
                        }
                        let ae = 0;
                        let af = 0;
                        if (ac) {
                            af = Math.max(SpreadsheetUtilities.cm(h.item(v + 1, z).d), SpreadsheetUtilities.cm(h.item(v + 2, z).d));
                            if (af > 1) {
                                ae = -u;
                            }
                            else {
                                ae = -t;
                            }
                        }
                        else if (aa || ab) {
                            ae = -t;
                        }
                        a.drawLine3(g, m, b.h(j[x] + y + c.x) - p, w, b.h(j[z - 1] + ae + c.x) - p, w);
                        if (ac && !ab && !ad && !aa) {
                            x = z - 1;
                            y = af > 2 ? 1 : 0;
                        }
                        else {
                            x = -1;
                            y = 0;
                        }
                    }
                    else if (x < 0) {
                        x = z - 1;
                        y = ac && Math.max(SpreadsheetUtilities.cm(h.item(v + 1, z).d), SpreadsheetUtilities.cm(h.item(v + 2, z).d)) > 2 ? 1 : 0;
                    }
                }
                if (x >= 0) {
                    a.drawLine3(g, m, b.h(j[x] + y + c.x) - p, w, b.h(j[l] + c.x) - p, w);
                }
            }
            p = o - r;
            q = -s;
            for (let ag = 1; ag <= l; ag++) {
                let ah = b.h(j[ag] + c.x) - p;
                let ai = -1;
                let aj = 0;
                for (let ak = 0; ak < k; ak++) {
                    let al = h.item(ak + 1, ag).f != null || h.item(ak + 1, ag + 1).f != null;
                    let am = h.item(ak + 1, ag + 1).d != 0;
                    let an = h.item(ak + 1, ag).e != 0 || h.item(ak + 1, ag + 1).e != 0;
                    let ao = (f.item(ak + 1, ag) != null && f.item(ak + 1, ag) == f.item(ak + 1, ag + 1));
                    if (al || am || (ai >= 0 && an) || ao) {
                        if (ai < 0) {
                            continue;
                        }
                        let ap = 0;
                        let aq = 0;
                        if (an) {
                            aq = Math.max(SpreadsheetUtilities.cm(h.item(ak + 1, ag).e), SpreadsheetUtilities.cm(h.item(ak + 1, ag + 1).e));
                            if (aq > 1) {
                                ap = -u;
                            }
                            else {
                                ap = -t;
                            }
                        }
                        else if (al || am) {
                            ap = -t;
                        }
                        a.drawLine3(g, m, ah, b.h(i[ai] + aj + c.y) - q, ah, b.h(i[ak] + ap + c.y) - q);
                        if (an && !am && !ao && !al && h.item(ak + 1, ag + 1).d == 0) {
                            ai = ak;
                            aj = aq > 2 ? 1 : 0;
                        }
                        else {
                            ai = -1;
                            aj = 0;
                        }
                    }
                    else if (ai < 0) {
                        ai = ak;
                        aj = an && Math.max(SpreadsheetUtilities.cm(h.item(ak + 1, ag).e), SpreadsheetUtilities.cm(h.item(ak + 1, ag + 1).e)) > 2 ? 1 : 0;
                    }
                }
                if (ai >= 0) {
                    a.drawLine3(g, m, ah, b.h(i[ai] + aj + c.y) - q, ah, b.h(i[k] + c.y) - q);
                }
            }
        }
    }
    _v(a, b, c) {
        let d = false;
        switch (b != null ? b : "") {
            case "CellValueArray":
            case "GridlinePen":
                if (a == this._j) {
                    d = true;
                }
                break;
        }
        if (d) {
            this._o();
        }
    }
    static _u(a, b, c, d) {
        a._v(b, c, d);
    }
}
SpreadsheetPaneGridlineLayer.$t = markType(SpreadsheetPaneGridlineLayer, 'SpreadsheetPaneGridlineLayer', SpreadsheetRendererElementLayer$1.$.specialize(SpreadsheetPane.$));
/**
 * @hidden
 */
export class SpreadsheetPaneInteractionOverlayLayer extends SpreadsheetRendererElementLayer$1 {
    constructor(a, b) {
        super(SpreadsheetPane.$, a, b, PredefinedSpreadsheetLayers.q);
        this._t = null;
        this._t = new PaneInteractionLayerObserver(a, runOn(this, this._o));
    }
    get__m() {
        return 2;
    }
    get _m() {
        return this.get__m();
    }
    _p() {
        super._p();
        this._t.dispose();
    }
    get__s() {
        return this._j._s.renderCache;
    }
    get _s() {
        return this.get__s();
    }
    _q(a, b, c, d) {
        this._t._h = SpreadsheetRenderUtilities.a(this._j, a, b, c, d);
    }
}
SpreadsheetPaneInteractionOverlayLayer.$t = markType(SpreadsheetPaneInteractionOverlayLayer, 'SpreadsheetPaneInteractionOverlayLayer', SpreadsheetRendererElementLayer$1.$.specialize(SpreadsheetPane.$));
/**
 * @hidden
 */
export class SpreadsheetPaneInvalidDataLayer extends SpreadsheetRendererElementLayer$1 {
    constructor(a, b) {
        super(SpreadsheetPane.$, a, b, PredefinedSpreadsheetLayers.r);
        this._t = null;
        this._t = new InvalidDataLayerObserver(a, runOn(this, this._o));
    }
    get__m() {
        return 2;
    }
    get _m() {
        return this.get__m();
    }
    _p() {
        super._p();
        this._t.dispose();
    }
    get__s() {
        return this._j._s.renderCache;
    }
    get _s() {
        return this.get__s();
    }
    _q(a, b, c, d) {
        SpreadsheetRenderUtilities.c(this._j, a, b, c, d);
    }
}
SpreadsheetPaneInvalidDataLayer.$t = markType(SpreadsheetPaneInvalidDataLayer, 'SpreadsheetPaneInvalidDataLayer', SpreadsheetRendererElementLayer$1.$.specialize(SpreadsheetPane.$));
/**
 * @hidden
 */
export class SpreadsheetPaneSelectionLayer extends SpreadsheetRendererElementLayer$1 {
    constructor(a, b) {
        super(SpreadsheetPane.$, a, b, PredefinedSpreadsheetLayers.s);
        this._u = null;
        this._t = null;
        this._u = new PropertyChangeListener$1(SpreadsheetPaneSelectionLayer.$, this, SpreadsheetPaneSelectionLayer._v, false);
        SpreadsheetUtilities.d6(a, this._u, true);
        SpreadsheetUtilities.d6(a.columnScrollRegion, this._u, true);
        SpreadsheetUtilities.d6(a.rowScrollRegion, this._u, true);
        let c = PropertyChangeListenerList.e(SpreadsheetSelection.$, this._t, a.rowScrollRegion._ab, this._u, true);
        this._t = c.p0;
    }
    _r(a) {
        let b = this._j.columnScrollRegion._br;
        let c = this._j.rowScrollRegion._bs;
        a.x -= b;
        a.width += b;
        a.y -= c;
        a.height += c;
        return a;
    }
    get__m() {
        return 0;
    }
    get _m() {
        return this.get__m();
    }
    _p() {
        super._p();
        if (this._j != null) {
            SpreadsheetUtilities.ec(this._j, this._u);
            SpreadsheetUtilities.ec(this._j.columnScrollRegion, this._u);
            SpreadsheetUtilities.ec(this._j.rowScrollRegion, this._u);
            if (this._t != null) {
                SpreadsheetUtilities.ec(this._t, this._u);
            }
        }
    }
    get__s() {
        return this._j._s.renderCache;
    }
    get _s() {
        return this.get__s();
    }
    _q(a, b, c, d) {
        let e = this._j;
        let f = e._ag || e.selection;
        let g = f.cellRanges;
        let h = g.count;
        if (h > 0 && e.columnScrollRegion._ai != 2) {
            let i = e.columnScrollRegion;
            let j = e.rowScrollRegion;
            let k = j._bx;
            let l = e.visibleRange;
            let m = h == 1;
            let n = i._ad;
            let o = 4;
            let p = m && i._o.renderCache.o(o);
            let q = m ? p ? 14 : 13 : 6;
            let r = m ? 3 : 2;
            let s = 1;
            let t = 0;
            let u = SpreadsheetUtilities.b8(q, i._br) / 2;
            let v = b.d;
            let w = v / 2;
            let x = v * 2;
            let y = v * 3;
            let z = v + w;
            let aa = -d.x;
            let ab = -d.y;
            let ac = 10;
            l = new SpreadsheetCellRange(Math.min(l.firstRow, j._ag(-ac / k)._j), Math.min(l.firstColumn, i._ag(-ac / k)._j), Math.max(l.lastRow, j._ag((c.height + ac) / k)._j), Math.max(l.lastColumn, i._ag((c.width + ac) / k)._j));
            let ad;
            if (p) {
                ad = u / 3;
            }
            else if (m) {
                ad = 0;
            }
            else {
                ad = u;
            }
            for (let ae = 0; ae < h; ae++) {
                let af = g.item(ae);
                af = af.intersect(l);
                if (af.isEmpty) {
                    continue;
                }
                let ag = i._bn(af.firstColumn, true) * k + c.x;
                let ah = i._bn(af.lastColumn, false) * k + c.x;
                let ai = j._bn(af.firstRow, true) * k + c.y;
                let aj = j._bn(af.lastRow, false) * k + c.y;
                if (p == false && ae == f.activeCellRangeIndex && i._ap == false) {
                    if (af.firstRow == j.startIndex) {
                        ai += v;
                    }
                    if (af.firstColumn == i.startIndex) {
                        ag += v;
                    }
                }
                ag = b.h(ag) - aa;
                ah = b.h(ah) - aa;
                ai = b.h(ai) - ab;
                aj = b.h(aj) - ab;
                ag -= v;
                ai -= v;
                let ak = ah - ag;
                let al = aj - ai;
                if (ak > x && al > x) {
                    let am = new Rect(0, ag + x, ai + x, Math.max(ak - x * 2, 0), Math.max(al - x * 2, 0));
                    if (ae == f.activeCellRangeIndex) {
                        let an = f._r;
                        let ao = af.intersect(an);
                        if (!ao.isEmpty) {
                            let ap = i._bn(ao.firstColumn, true) * k + c.x;
                            let aq = i._bn(ao.lastColumn, false) * k + c.x;
                            let ar = j._bn(ao.firstRow, true) * k + c.y;
                            let as = j._bn(ao.lastRow, false) * k + c.y;
                            as -= v;
                            aq -= v;
                            ap = b.h(ap) - aa;
                            aq = b.h(aq) - aa;
                            ar = b.h(ar) - ab;
                            as = b.h(as) - ab;
                            if (p == false && ae == f.activeCellRangeIndex && i._ap == false) {
                                if (ao.firstRow == j.startIndex) {
                                    ar += v;
                                }
                                if (ao.firstColumn == i.startIndex) {
                                    ap += v;
                                }
                            }
                            let at = new Rect(0, ap, ar, Math.max(aq - ap, 0), Math.max(as - ar, 0));
                            at.intersect(am);
                            if (at.isEmpty) {
                                a.fillRectangle1(t, am.x, am.y, am.width, am.height);
                            }
                            else {
                                a.fillRectangle2(t, am.x, am.y, am.width, am.height, at.x, at.y, at.width, at.height);
                            }
                            if (!m) {
                                a.drawRectangle(6, 37, i._br, ap + z, ar + z, Math.max((aq - ap) - y, 0), Math.max((as - ar) - y, 0));
                            }
                            am = Rect.empty;
                        }
                    }
                    if (!am.isEmpty) {
                        a.fillRectangle1(t, am.x, am.y, am.width, am.height);
                    }
                    a.drawRectangle(6, s, i._br, ag + z, ai + z, Math.max(ak - y, 0), Math.max(al - y, 0));
                }
                a.drawRectangle(q, r, i._br, ag + ad, ai + ad, Math.max(ak - ad * 2, 0), Math.max(al - ad * 2, 0));
                if (m) {
                    let au = 6;
                    let av;
                    if (g.item(0).firstColumn == 0 && g.item(0).lastColumn == i._ci) {
                        av = new Rect(0, ag, aj - y, 5 * v, 5 * v);
                        a.drawLine(6, au, i._br, av.right + w, av.y - v, av.right + w, av.bottom);
                        a.drawLine(6, au, i._br, av.x - v, av.y - w, av.right, av.y - w);
                    }
                    else if (g.item(0).firstRow == 0 && g.item(0).lastRow == j._ci) {
                        av = new Rect(0, ah - y, ai, 5 * v, 5 * v);
                        a.drawLine(6, au, i._br, av.x - w, av.y - v, av.x - w, av.bottom);
                        a.drawLine(6, au, i._br, av.x - v, av.bottom + w, av.right, av.bottom + w);
                    }
                    else {
                        av = new Rect(0, ah - y, aj - y, 5 * v, 5 * v);
                        a.drawLine(6, au, i._br, av.x - v, av.y - w, av.right, av.y - w);
                        a.drawLine(6, au, i._br, av.x - w, av.y - v, av.x - w, av.bottom);
                    }
                    let aw = 5;
                    a.fillRectangle1(aw, av.x, av.y, av.width, av.height);
                }
            }
            if (!f._v.isEmpty) {
                let ax = f._v.intersect(l);
                if (!ax.isEmpty) {
                    let ay = i._bn(ax.firstColumn, true) * k + c.x;
                    let az = i._bn(ax.lastColumn, false) * k + c.x;
                    let a0 = j._bn(ax.firstRow, true) * k + c.y;
                    let a1 = j._bn(ax.lastRow, false) * k + c.y;
                    ay = b.h(ay) - aa - v;
                    az = b.h(az) - aa;
                    a0 = b.h(a0) - ab - v;
                    a1 = b.h(a1) - ab;
                    let a2 = az - ay;
                    let a3 = a1 - a0;
                    if (a2 > 0 && a3 > 0) {
                        a.fillRectangle1(71, ay, a0, a2, a3);
                        ay += z;
                        a0 += z;
                        a2 -= y;
                        a3 -= y;
                        if (a2 > 0 && a3 > 0) {
                            a.drawRectangle(6, 72, i._br, ay, a0, a2, a3);
                        }
                    }
                }
            }
        }
    }
    _w(a, b, c) {
        let d = false;
        switch (b != null ? b : "") {
            case "":
            case "Offset":
                if (a == this._j.rowScrollRegion._x || a == this._j.columnScrollRegion._x) {
                    d = true;
                }
                break;
            case "Add":
            case "Remove":
            case "Replace":
            case "Move":
            case "Reset":
                if (this._j.rowScrollRegion._ab != null && this._j.rowScrollRegion._ab._a1(a)) {
                    d = true;
                }
                else if (getInstanceType(a) == SpreadsheetUtilities.d5) {
                    d = true;
                }
                break;
            case "ActiveSelection":
                if (this._j.rowScrollRegion == a) {
                    let e = PropertyChangeListenerList.e(SpreadsheetSelection.$, this._t, this._j.rowScrollRegion._ab, this._u, true);
                    this._t = e.p0;
                    d = true;
                }
                break;
            case "SelectionMode":
            case "ResourceProvider":
                if (this._j.rowScrollRegion == a) {
                    d = true;
                }
                break;
            case "ActiveCellAsRange":
            case "RangeToUnselect":
                if (a == this._j.rowScrollRegion._ab) {
                    d = true;
                }
                break;
            case "ResourceVersion":
                if (a == this._j.rowScrollRegion._ad) {
                    d = true;
                }
                break;
        }
        if (d) {
            this._o();
        }
    }
    static _v(a, b, c, d) {
        a._w(b, c, d);
    }
}
SpreadsheetPaneSelectionLayer.$t = markType(SpreadsheetPaneSelectionLayer, 'SpreadsheetPaneSelectionLayer', SpreadsheetRendererElementLayer$1.$.specialize(SpreadsheetPane.$));
/**
 * @hidden
 */
export class SpreadsheetRenderUtilities extends Base {
    static b(a, b, c, d, e) {
        let f = a._i(true, true);
        let g = f.length - 1;
        let h = a._bx;
        let i = a._ad;
        let j, k, l, m;
        if (a._aw) {
            j = 11;
            k = 13;
            l = 12;
            m = 14;
        }
        else {
            j = 24;
            k = 26;
            l = 25;
            m = 27;
        }
        let n = c.d;
        let o = -e.x;
        let p = -e.y;
        let q = a._aw;
        let r = d.left;
        let s = d.top;
        let t = d.right - n / 2;
        let u = d.bottom - n / 2;
        let v = a._ar();
        let w = a._l;
        let x = a._co;
        let y = 1;
        if (q) {
            s += y;
        }
        else {
            r += y;
        }
        r = c.h(r) - o;
        t = c.h(t) - o;
        s = c.h(s) - p;
        u = c.h(u) - p;
        for (let z = 0; z < g; z++) {
            let aa = f[z];
            let ab = f[z + 1] - n;
            if (q) {
                aa += d.y + y;
                ab += d.y + y;
                s = c.h(aa) - p;
                u = c.h(ab) - p;
            }
            else {
                aa += d.x + y;
                ab += d.x + y;
                r = c.h(aa) - o;
                t = c.h(ab) - o;
            }
            let ac = j;
            if (v || nullableNotEquals(x, null)) {
                switch (a._t(w._inner[z]._j)) {
                    case 3:
                    case 4:
                        ac = m;
                        break;
                    case 1:
                        ac = k;
                        break;
                    case 2:
                        ac = l;
                        break;
                }
            }
            let ad = Math.max(t - r, 0);
            let ae = Math.max(u - s, 0);
            b.fillRectangle1(ac, r, s, ad, ae);
        }
    }
    static a(a, b, c, d, e) {
        let f = a.columnScrollRegion;
        let g = a.rowScrollRegion;
        let h = nullableNotEquals(f._cp, null) ? f : nullableNotEquals(g._cp, null) ? g : null;
        let i = h != null;
        if (h != null) {
            let j = c.d;
            let k = -e.x;
            let l = -e.y;
            let m = h._aw;
            let n = h._bx;
            let o = h._bn(h._cp.value, true) * n;
            let p = d.x;
            let q = d.y;
            let r = d.right;
            let s = d.bottom;
            let t = h._br;
            p = c.h(p) - k;
            q = c.h(q) - l;
            r = c.h(r) - k;
            s = c.h(s) - l;
            let u = m ? 40 : 39;
            let v = 6;
            let w = SpreadsheetUtilities.b8(v, t) / 2;
            if (m) {
                q = s = c.h(o + d.y) - l - w;
            }
            else {
                p = r = c.h(o + d.x) - k - w;
            }
            b.drawLine(v, u, t, p, q, r, s);
            let x = h._bp;
            if (!isNaN_(x)) {
                x *= n;
                if (m) {
                    q = s = c.h(x + d.y) - l - w;
                }
                else {
                    p = r = c.h(x + d.x) - k - w;
                }
                b.drawLine(v, u, t, p, q, r, s);
            }
        }
        return i;
    }
    static c(a, b, c, d, e) {
        let f = a._h;
        let g = a._k;
        let h = a.columnScrollRegion;
        let i = a.rowScrollRegion;
        let j = i._i(true);
        let k = h._i(true);
        let l = j.length - 1;
        let m = k.length - 1;
        let n = i._bx;
        let o = Math.max(n, 1);
        if (l > 0 && m > 0) {
            let p = 64;
            let q = c.d;
            let r = -e.x;
            let s = -e.y;
            let t = SpreadsheetUtilities.b8(13, h._br) * n;
            for (let u = 1; u <= l; u++) {
                if (f.c(u) == false) {
                    continue;
                }
                let v = g.d(u);
                for (let w = 1; w <= m; w++) {
                    if (f.item(u, w)) {
                        let x, y, z, aa;
                        let ab = v ? g.item(u, w) : null;
                        if (ab != null && ab.r) {
                            if (u > 1 && g.item(u - 1, w) == ab) {
                                continue;
                            }
                            if (w > 1 && g.item(u, w - 1) == ab) {
                                continue;
                            }
                            x = h._bn(ab.ab, true) * n + d.x;
                            y = h._bn(ab.x, false) * n + d.x;
                            z = i._bn(ab.ak, true) * n + d.y;
                            aa = i._bn(ab.ag, false) * n + d.y;
                        }
                        else {
                            x = k[w - 1] + d.x;
                            y = k[w] + d.x;
                            z = j[u - 1] + d.y;
                            aa = j[u] + d.y;
                        }
                        x = c.h(x - 1) - r;
                        z = c.h(z - 1) - s;
                        y = c.h(y) - r;
                        aa = c.h(aa) - s;
                        b.drawEllipse(t, p, h._br, x - 5, z - 2, (y - x) + 10, (aa - z) + 4);
                    }
                }
            }
        }
    }
}
SpreadsheetRenderUtilities.$t = markType(SpreadsheetRenderUtilities, 'SpreadsheetRenderUtilities');
/**
 * @hidden
 */
export class SpreadsheetMouseOperation$1 extends SpreadsheetMouseOperation {
    constructor($t) {
        super();
        this.$t = null;
        this._aa = null;
        this._aw = null;
        this._ax = null;
        this._w = null;
        this._v = null;
        this._ad = null;
        this._ac = null;
        this._ag = null;
        this.$t = $t;
        this.$type = this.$type.specialize(this.$t);
    }
    _o(a, b) {
        switch (b) {
            case 3:
            case 4:
            case 0:
                this._at();
                break;
        }
    }
    _s(a) {
        this._au(a);
        if (a.b()) {
            let b = a.h();
            let c = this._av(this._ac, this._y, b.x, this._aw.left, this._aw.right, this._ai);
            this._ac = c.p0;
            let d = this._av(this._ad, this._ae, b.y, this._aw.top, this._aw.bottom, this._aj);
            this._ad = d.p0;
            if ((this._ad != null && this._ad.e) || (this._ac != null && this._ac.e)) {
                this._w = a;
            }
            else {
                this._w = null;
            }
        }
        else {
            this._w = null;
        }
    }
    _g(a) {
        this._au(a);
        return super._g(a);
    }
    get _ay() {
        return this._ax;
    }
    get _x() {
        return this._v;
    }
    get _ab() {
        return this._aa;
    }
    _am(a, b, c) {
        let d = this._aa;
        this._aa = a;
        this._ax = c;
        this._aw = b;
        if (this._aa == null) {
            this._ap(d);
        }
        else {
            this._an(a);
        }
    }
    _ah() {
        let a = this._ae;
        let b = this._y;
        if (a == null) {
            if (b == null) {
                return false;
            }
            a = typeCast(SpreadsheetRowScrollRegion.$, b._z);
        }
        else if (b == null) {
            b = typeCast(SpreadsheetColumnScrollRegion.$, a._z);
        }
        let c = a._o;
        let d = c.getPane(a, b);
        if (d == null) {
            return false;
        }
        if (!c.canActivatePane(d)) {
            return c.activePane != null && (a.isFrozen || b.isFrozen);
        }
        return c.activatePane(d);
    }
    _af() {
        return null;
    }
    _al() {
        if (this._ag != null) {
            this._ag.c();
            this._ag = null;
        }
        this._k = null;
    }
    _an(a) {
    }
    _ao(a, b) {
    }
    _ap(a) {
        this._al();
        this._at();
    }
    _ar() {
        if (this._ag != null) {
            this._ag.c();
        }
        this._ag = new TimedOperation(() => {
            let a = this._af();
            if (a == null) {
                this._al();
            }
            else {
                this._k = a;
            }
        }, 250);
    }
    _ak(a) {
        let b = 118;
        a = Math.min(b - 2, Math.abs(a));
        return Math.pow((b - a) / b, 3) * 500;
    }
    _aq() {
        let a = this._y || this._ae;
        if (a != null) {
            a._o.verifyScrollPositions();
        }
        if (this._w != null) {
            this._s(this._w);
        }
    }
    _as(a) {
        if (a != null) {
            a.h();
        }
        a = null;
        return {
            p0: a
        };
    }
    _at() {
        this._w = null;
        let a = this._as(this._ad);
        this._ad = a.p0;
        let b = this._as(this._ac);
        this._ac = b.p0;
    }
    _au(a) {
        if (this._ab != null) {
            let b = this._v;
            this._v = a;
            this._ao(b, this._v);
        }
        else if (this._v != null) {
            let c = this._v;
            this._v = null;
            this._ao(c, this._v);
        }
    }
    _av(a, b, c, d, e, f) {
        if (b == null || !f) {
            let g = this._as(a);
            a = g.p0;
        }
        else {
            if (a == null) {
                a = new SpreadsheetMouseOperation_ScrollTimer$1(this.$t, runOn(this, this._aq));
            }
            let h = c >= e;
            if (!h && c >= d) {
                a.h();
            }
            else {
                let i = h ? c - e : d - c;
                let j = this._ak(i);
                a.g(b, h, truncate(Math.abs(j)));
            }
        }
        return {
            p0: a
        };
    }
}
SpreadsheetMouseOperation$1.$t = markType(SpreadsheetMouseOperation$1, 'SpreadsheetMouseOperation$1', SpreadsheetMouseOperation.$);
/**
 * @hidden
 */
export class SpreadsheetPaneMouseOperation extends SpreadsheetMouseOperation$1 {
    constructor() {
        super(SpreadsheetPane.$);
    }
    get__y() {
        return this._ab.columnScrollRegion;
    }
    get _y() {
        return this.get__y();
    }
    get__ae() {
        return this._ab.rowScrollRegion;
    }
    get _ae() {
        return this.get__ae();
    }
}
SpreadsheetPaneMouseOperation.$t = markType(SpreadsheetPaneMouseOperation, 'SpreadsheetPaneMouseOperation', SpreadsheetMouseOperation$1.$.specialize(SpreadsheetPane.$));
/**
 * @hidden
 */
export class SpreadsheetCellDropDownOperation extends SpreadsheetPaneMouseOperation {
    constructor() {
        super(...arguments);
        this._az = null;
    }
    get__z() {
        return 19;
    }
    get _z() {
        return this.get__z();
    }
    get__ai() {
        return false;
    }
    get _ai() {
        return this.get__ai();
    }
    get__aj() {
        return false;
    }
    get _aj() {
        return this.get__aj();
    }
    _a0(a) {
        let b = a.h();
        let c = this._ab;
        let d = c._q;
        for (let e = 0; e < d.count; e++) {
            if (d._inner[e].g.containsLocation(b.x, b.y)) {
                return d._inner[e];
            }
        }
        return null;
    }
    _al() {
        this._az = null;
        super._al();
    }
    _m(a) {
        if (a.a() == 1) {
            let b = this._a0(a);
            let c = this._ab._s.spreadsheetOwnerState._h;
            let d = c._a8._bc;
            if (c._du(b)) {
                this._al();
                c._d4(this._ab, b);
                return false;
            }
        }
        return false;
    }
    _a1(a, b) {
        return WorkbookColorInfo.l_op_Inequality(b, null) ? SpreadsheetUtilities.dc(b._getResolvedColor1(a)) : null;
    }
    _af() {
        let a = this._x;
        if (this._az != null && this._ab != null && a != null && this._i == 0) {
            let b = this._a3(this._az);
            if (!stringIsNullOrEmpty(b)) {
                let c = a.h();
                return ((() => {
                    let $ret = new SpreadsheetToolTipContext();
                    $ret.d = { $type: Point_$type, x: c.x - 7, y: c.y + 20 };
                    $ret.a = 4;
                    $ret.c = this._ab._s.getHeaderCaption(this._az.d, this._az.c) + ":";
                    $ret.b = b;
                    return $ret;
                })());
            }
        }
        return null;
    }
    _a3(a) {
        if (a != null) {
            if (a.b == 1 || a.b == 0) {
                let b = this._ab._s.getFilter(a.d, a.c);
                if (b != null) {
                    return this._a4(b);
                }
                return this._ab._s.spreadsheetOwnerState._h._fs("DefaultAutoFilterToolTip");
            }
        }
        return null;
    }
    _a4(a) {
        let b = this._ab._s.spreadsheetOwnerState._h;
        if (typeCast(AverageFilter.$, a) !== null) {
            return b._fs(a.type == 0 ? "FilterDescription_AboveAverage" : "FilterDescription_BelowAverage");
        }
        else if (typeCast(CustomFilter.$, a) !== null) {
            let c = a;
            if (c.condition2 == null) {
                return this._a2(b, c.condition1);
            }
            else {
                return b._fs(c.conditionalOperator == 0 ? "FilterDescription_Custom_And" : "FilterDescription_Custom_Or", this._a2(b, c.condition1), this._a2(b, c.condition2));
            }
        }
        else if (typeCast(FixedValuesFilter.$, a) !== null) {
            let d = b.workbook._e6;
            let e = a;
            let f = new StringBuilder(0);
            for (let g of fromEnum(e._dateGroups$i)) {
                if (f.c > 0) {
                    f.l(", ");
                }
                switch (g._f) {
                    case 0:
                        f.l(b._fs("FilterDescription_FixedValues_Year", g.value));
                        break;
                    case 1:
                        f.l(b._fs("FilterDescription_FixedValues_Month", g.value));
                        break;
                    case 2:
                        f.l(b._fs("FilterDescription_FixedValues_Day", g.value));
                        break;
                    case 3:
                        f.l(b._fs("FilterDescription_FixedValues_Hour", g.value));
                        break;
                    case 4:
                        f.l(b._fs("FilterDescription_FixedValues_Minute", g.value));
                        break;
                    case 5:
                        f.l(b._fs("FilterDescription_FixedValues_Second", g.value));
                        break;
                }
            }
            for (let h of fromEnum(e._displayValues$i)) {
                if (f.c > 0) {
                    f.l(", ");
                }
                f.l(h);
            }
            if (e.includeBlanks) {
                if (f.c > 0) {
                    f.l(", ");
                }
                f.l(b._fs("FilterDescription_FixedValues_Blanks"));
            }
            return b._fs("FilterDescription_FixedValues", f.toString());
        }
        else if (typeCast(TopOrBottomFilter.$, a) !== null) {
            let i = a;
            let j;
            switch (i.type) {
                case 3:
                    j = "FilterDescription_BottomPercent";
                    break;
                case 1:
                    j = "FilterDescription_BottomItems";
                    break;
                case 2:
                    j = "FilterDescription_TopPercent";
                    break;
                default:
                case 0:
                    j = "FilterDescription_TopItems";
                    break;
            }
            return b._fs(j, i.value);
        }
        else if (typeCast(DatePeriodFilter.$, a) !== null) {
            let k = a;
            if (k.type == 1) {
                return b._fs("FilterDescription_QuarterNumber", k.value);
            }
            else {
                return b._fs("FilterDescription_MonthNumber", SpreadsheetUtilities.dh(k.value, b.workbook._e6));
            }
        }
        else if (typeCast(RelativeDateRangeFilter.$, a) !== null) {
            let l = a;
            return b._fs("FilterDescription_RelativeDate_" + EnumUtil.getName(RelativeDateRangeOffset_$type, l.offset) + EnumUtil.getName(RelativeDateRangeDuration_$type, l.duration));
        }
        else if (typeCast(YearToDateFilter.$, a) !== null) {
            return b._fs("FilterDescription_YearToDate");
        }
        else if (typeCast(FillFilter.$, a) !== null) {
            let m = a;
            if (m.fill == CellFill.noColor) {
                return b._fs("FilterDescription_CellFill_NoFill");
            }
            if (typeCast(CellFillPattern.$, m.fill) !== null) {
                let n = m.fill;
                if (n.patternStyle == 0) {
                    return b._fs("FilterDescription_CellFill_NoFill");
                }
                else if (n.patternStyle == 1) {
                    let o = this._a1(b.workbook, n.backgroundColorInfo);
                    if (!stringIsNullOrEmpty(o)) {
                        return b._fs("FilterDescription_CellFill_Named", o);
                    }
                }
            }
            return b._fs("FilterDescription_CellFill_Unknown");
        }
        else if (typeCast(FontColorFilter.$, a) !== null) {
            let p = a;
            if (p.fontColorInfo.isAutomatic) {
                return b._fs("FilterDescription_FontColor_Automatic");
            }
            let q = this._a1(b.workbook, p.fontColorInfo);
            if (!stringIsNullOrEmpty(q)) {
                return b._fs("FilterDescription_FontColor_Named", q);
            }
            return b._fs("FilterDescription_FontColor_Unknown");
        }
        else if (typeCast(IconFilter.$, a) !== null) {
            let r = a;
            let s = SpreadsheetUtilities.an(r._m, r._p);
            if (s == -1) {
                return b._fs("FilterDescription_NoCellIcon");
            }
            return b._fs("FilterDescription_WithCellIcon", b._fs("Icon_" + EnumUtil.getName(FormatConditionIcon_$type, s)));
        }
        return null;
    }
    _a2(a, b) {
        return a._fs("FilterDescription_ComparisonItem_" + EnumUtil.getName(ExcelComparisonOperator_$type, b.comparisonOperator), b.value);
    }
    _s(a) {
        if (this._i == 0) {
            let b = this._a0(a);
            if (b != this._az) {
                this._al();
                this._az = b;
                if (this._az != null && this._a3(b) != null) {
                    this._ar();
                }
            }
        }
        super._s(a);
    }
    _u(a) {
    }
}
SpreadsheetCellDropDownOperation.$t = markType(SpreadsheetCellDropDownOperation, 'SpreadsheetCellDropDownOperation', SpreadsheetPaneMouseOperation.$);
/**
 * @hidden
 */
export class SpreadsheetCellContextMenuOperation extends SpreadsheetPaneMouseOperation {
    get__ai() {
        return false;
    }
    get _ai() {
        return this.get__ai();
    }
    get__aj() {
        return false;
    }
    get _aj() {
        return this.get__aj();
    }
    get__z() {
        return 10;
    }
    get _z() {
        return this.get__z();
    }
    _m(a) {
        let b = this._ab._ag;
        let c = b._m;
        if (c != null && b != null) {
            let d = a.h();
            if (c._d7(true)) {
                let e = this._ab;
                let f = e.rowScrollRegion._bx;
                let g = e.rowScrollRegion._ag(d.y / f);
                let h = e.columnScrollRegion._ag(d.x / f);
                let i = new SpreadsheetCell(g._j, h._j);
                if (!b._ao(i)) {
                    if (!b._a9(i)) {
                        return false;
                    }
                }
                let j = SpreadsheetUtilities.aa(b);
                c._v._ShowPaneContextMenu$i(this._ab, j, d);
            }
        }
        return false;
    }
    _u(a) {
    }
}
SpreadsheetCellContextMenuOperation.$t = markType(SpreadsheetCellContextMenuOperation, 'SpreadsheetCellContextMenuOperation', SpreadsheetPaneMouseOperation.$);
/**
 * @hidden
 */
export class SpreadsheetHeaderMouseOperation extends SpreadsheetMouseOperation$1 {
    constructor() {
        super(SpreadsheetScrollRegion.$);
    }
    get__y() {
        return typeCast(SpreadsheetColumnScrollRegion.$, this._ab);
    }
    get _y() {
        return this.get__y();
    }
    get__ae() {
        return typeCast(SpreadsheetRowScrollRegion.$, this._ab);
    }
    get _ae() {
        return this.get__ae();
    }
    get _az() {
        return this._ab != null && this._ab._aw;
    }
}
SpreadsheetHeaderMouseOperation.$t = markType(SpreadsheetHeaderMouseOperation, 'SpreadsheetHeaderMouseOperation', SpreadsheetMouseOperation$1.$.specialize(SpreadsheetScrollRegion.$));
/**
 * @hidden
 */
export class SpreadsheetHeaderContextMenuOperation extends SpreadsheetHeaderMouseOperation {
    get__ai() {
        return false;
    }
    get _ai() {
        return this.get__ai();
    }
    get__aj() {
        return false;
    }
    get _aj() {
        return this.get__aj();
    }
    get__z() {
        return 10;
    }
    get _z() {
        return this.get__z();
    }
    _m(a) {
        let b = this._ab._ab;
        let c = b._m;
        if (c != null) {
            let d = a.h();
            if (c._d7(true)) {
                let e = this._ab;
                let f = typeCast(SpreadsheetRowScrollRegion.$, e) !== null;
                let g = e._z;
                let h = e._bx;
                let i = f ? d.y : d.x;
                let j = e._ag(i / h);
                let k = f ? b._bj : b._bi;
                if (i - j._m >= 0 && i - j._m <= 8) {
                    let l = e._m.indexOf(j);
                    if (e._av(l)) {
                        let m = 8;
                        let n = (e._bm(j, false) - e._bm(j, true)) * h;
                        if ((7 + 8) * 2 > n) {
                            m = Math.max(n * 0.25, 1);
                        }
                        if (i - j._m <= m) {
                            j = e._b7(j._j - 1);
                        }
                    }
                }
                if (SpreadsheetUtilities.a6(k, j._j) == false) {
                    let o = f ? new SpreadsheetCellRange(j._j, b._ac._i, j._j, b._ac._h) : new SpreadsheetCellRange(b._ad._i, j._j, b._ad._h, j._j);
                    let p = f ? new SpreadsheetCell(j._j, g.startIndex) : new SpreadsheetCell(g.startIndex, j._j);
                    if (false == b._resetSelection2(o, p, false)) {
                        return false;
                    }
                }
                c._v._ShowHeaderContextMenu$i(this._ab, d);
            }
        }
        return false;
    }
    _u(a) {
    }
}
SpreadsheetHeaderContextMenuOperation.$t = markType(SpreadsheetHeaderContextMenuOperation, 'SpreadsheetHeaderContextMenuOperation', SpreadsheetHeaderMouseOperation.$);
/**
 * @hidden
 */
export class SpreadsheetEnterEditModeOperation extends SpreadsheetPaneMouseOperation {
    get__ai() {
        return false;
    }
    get _ai() {
        return this.get__ai();
    }
    get__aj() {
        return false;
    }
    get _aj() {
        return this.get__aj();
    }
    get__z() {
        return 10;
    }
    get _z() {
        return this.get__z();
    }
    _m(a) {
        let b = this._ab.rowScrollRegion._ab._m;
        if (b != null) {
            b._gh(a.h(), this._ab);
        }
        return false;
    }
    _u(a) {
    }
}
SpreadsheetEnterEditModeOperation.$t = markType(SpreadsheetEnterEditModeOperation, 'SpreadsheetEnterEditModeOperation', SpreadsheetPaneMouseOperation.$);
/**
 * @hidden
 */
export class SpreadsheetHeaderResizeOperation extends SpreadsheetHeaderMouseOperation {
    constructor(a) {
        super();
        this._a0 = 0;
        this._a6 = 0;
        this._a7 = 0;
        this._ba = 0;
        this._a9 = 0;
        this._a8 = 0;
        this._bb = 0;
        this._a5 = null;
        this._a2 = false;
        this._a3 = false;
        this._a1 = false;
        this._bc = 0;
        this._a0 = a;
        this._a3 = a == 1;
        this._a2 = a == 2;
    }
    get__ai() {
        return false;
    }
    get _ai() {
        return this.get__ai();
    }
    get__aj() {
        return false;
    }
    get _aj() {
        return this.get__aj();
    }
    get__z() {
        return this._az ? this._a3 ? 12 : 6 : this._a3 ? 13 : 5;
    }
    get _z() {
        return this.get__z();
    }
    _an(a) {
        super._an(a);
    }
    _o(a, b) {
        super._o(a, b);
        switch (b) {
            case 4:
            case 0:
                this._ab._cp = Nullable$1.toNullable(Number_$type, null);
                break;
        }
    }
    _m(a) {
        this._a1 = false;
        if (this._a2) {
            this._bf();
            return false;
        }
        this._ab._cp = Nullable$1.toNullable(Number_$type, this._bc);
        let b = a.h();
        let c = this._ab;
        let d = (this._az ? b.y : b.x) / c._bx;
        let e = c._b7(this._bc);
        let f = c._bm(e, false);
        this._a5 = null;
        this._bb = c._cf(this._bc + (this._a3 ? 1 : 0));
        this._a6 = d - f;
        this._a7 = d;
        this._a8 = d - this._a7;
        c._bp = d - this._a6;
        this._ba = Math.min(this._a6 - d, 0);
        this._a9 = c._b4(truncate(Math.max(c._ch - e._i + this._a6, 0)));
        return true;
    }
    _s(a) {
        super._s(a);
        if (this._i == 2) {
            this._be(a);
        }
    }
    _be(a) {
        let b = a.h();
        let c = this._ab;
        let d = (this._az ? b.y : b.x) / c._bx;
        let e = d - this._a7;
        e = Math.max(Math.min(e, this._a9), this._ba);
        if (e != this._a8) {
            this._a8 = e;
            let f = c._m;
            let g = c._l;
            let h = this._ay;
            if (this._az && (b.y < h.y || b.y >= h.bottom)) {
                this._a1 = true;
            }
            else if (!this._az && (b.x < h.x || b.x >= h.right)) {
                this._a1 = true;
            }
            else {
                this._a1 = false;
            }
            c._bp = (this._a1 ? this._a7 : d) - this._a6;
            g.beginUpdate();
            g.clear();
            if (this._a1 || CoreUtilities.c(e, 0) || (e < 0 && this._bb < 0)) {
                g._a3(f);
            }
            else if (this._bb < 0) {
                g._a3(f);
                let i = f.count == 0 ? 0 : Enumerable.ah(WorksheetItemPosition.$, f)._l;
                let j = c._b5(Math.max(e + c._bw - this._a6, 0));
                g.add(new WorksheetItemPosition(1, c._ci, i, j));
            }
            else if (e < 0) {
                if (this._a5 == null) {
                    this._a5 = c._a1(this._bc + 1);
                }
                let k = c._b5(Math.max(d + c._bw - this._a6, 0));
                for (let l = 0; l <= this._bb; l++) {
                    if (k <= 0) {
                        break;
                    }
                    let m = f._inner[l];
                    let n = Math.min(m._i, k);
                    k -= n;
                    g.add(new WorksheetItemPosition(1, m._j, m._m, n));
                }
                let o = g.count == 0 ? f._inner[0]._m : g._inner[g.count - 1]._l;
                for (let p = 0; p < this._a5.count; p++) {
                    let q = this._a5.item(p);
                    g.add(new WorksheetItemPosition(1, q._j, o, q._i));
                    o += q._i;
                }
            }
            else {
                for (let r = 0; r < this._bb; r++) {
                    g.add(f._inner[r]);
                }
                let s = this._a3 ? new WorksheetItemPosition(1, this._bc, f._inner[this._bb]._m, 0) : f._inner[this._bb];
                let t = c._b5(e) + s._i;
                g.add(new WorksheetItemPosition(1, s._j, s._m, t));
                let u = g._inner[g.count - 1]._l;
                let v = this._a3 ? this._bb : this._bb + 1;
                for (let w = v; w < f.count; w++) {
                    let x = f._inner[w];
                    g.add(new WorksheetItemPosition(1, x._j, u, x._i));
                    u += x._i;
                }
            }
            g.endUpdate();
        }
    }
    _u(a) {
        if (!this._a1 && !CoreUtilities.c(this._a8, 0)) {
            if (this._l != null) {
                let b = this._az;
                let c = b ? 2 : 3;
                let d = SpreadsheetHeaderResizeOperation._a4(this._ab._ab, b, this._bc);
                this._l(c, d, runOn(this, this._bh));
            }
            else {
                this._bh();
            }
        }
    }
    _g(a) {
        return 2;
    }
    _ap(a) {
        super._ap(a);
        a._cp = Nullable$1.toNullable(Number_$type, null);
        this._a1 = false;
    }
    _bd(a) {
        if (nullableNotEquals(a, null)) {
            if (this._ab.startIndex > a.value._h || this._ab.endIndex < a.value._i) {
                let b = this._ab._o;
                if (b != null) {
                    let c = Nullable$1.toNullable(IntRange.$, null);
                    let d = c;
                    let e = c;
                    if (this._az) {
                        d = a;
                    }
                    else {
                        e = a;
                    }
                    b._scrollRangeIntoView$i(b.activePane, d, e);
                }
            }
        }
    }
    _bf() {
        if (this._l != null) {
            let a = this._az;
            let b = a ? 2 : 3;
            let c = SpreadsheetHeaderResizeOperation._a4(this._ab._ab, a, this._bc);
            this._l(b, c, runOn(this, this._bg));
        }
        else {
            this._bg();
        }
    }
    _bg() {
        let a = this._ab._ab;
        let b = this._az;
        if (SpreadsheetHeaderResizeOperation._a4(a, b, this._bc)) {
            SpreadsheetHeaderResizeOperation._bi(a, b, this._ab, -1);
            this._bd(Nullable$1.toNullable(IntRange.$, SpreadsheetUtilities.cy(b ? a._bj : a._bi, this._bc).value));
        }
        else {
            this._ab._ak(-1, this._bc);
            this._bd(Nullable$1.toNullable(IntRange.$, new IntRange(1, this._bc, this._bc)));
        }
    }
    static _a4(a, b, c) {
        let d = false;
        for (let e of fromEnum(a.cellRanges)) {
            if (b && e.firstRow <= c && c <= e.lastRow) {
                d = true;
                break;
            }
            else if (!b && e.firstColumn <= c && c <= e.lastColumn) {
                d = true;
                break;
            }
        }
        if (d) {
            for (let f of fromEnum(a.cellRanges)) {
                if (b && !a._a0(f)) {
                    d = false;
                    break;
                }
                else if (!b && !a._az(f)) {
                    d = false;
                    break;
                }
            }
        }
        return d;
    }
    _bh() {
        let a = this._ab;
        let b = a._ab;
        let c = this._az;
        let d = SpreadsheetHeaderResizeOperation._a4(b, c, this._bc);
        if (this._a8 > 0) {
            let e = this._a3 ? 0 : a._m._inner[this._bb]._i;
            let f = (e + a._b5(this._a8));
            let g = a._o != null ? a._o.activePane : null;
            if (d) {
                SpreadsheetHeaderResizeOperation._bi(b, c, a, f);
                this._bd(Nullable$1.toNullable(IntRange.$, SpreadsheetUtilities.cy(c ? b._bj : b._bi, this._bc).value));
            }
            else {
                a._ak(f, this._bc);
                this._bd(Nullable$1.toNullable(IntRange.$, new IntRange(1, this._bc, this._bc)));
            }
        }
        else {
            let h = a._m;
            let i = a._l;
            let j = this._a3 ? this._bb : this._bb + 1;
            if (d) {
                let k = 0;
                for (let l = 0; l < i.count; l++) {
                    if (i._inner[l]._j == this._bc) {
                        k = i._inner[l]._i;
                        break;
                    }
                }
                SpreadsheetHeaderResizeOperation._bi(b, c, a, k);
            }
            else {
                let m = 0;
                for (; m < j; m++) {
                    if (m >= i.count) {
                        break;
                    }
                    let n = h._inner[m];
                    let o = i._inner[m];
                    if (n._j != o._j) {
                        break;
                    }
                    if (n._i != o._i) {
                        a._ak(o._i, o._j);
                    }
                }
                if (m == j - 1) {
                    a._ak(0, h._inner[m]._j);
                }
                else if (m < j) {
                    let p = new Array(1);
                    p[0] = new IntRange(1, h._inner[m]._j, h._inner[j - 1]._j);
                    a._am(0, p);
                }
            }
        }
    }
    static _bi(a, b, c, d) {
        let e = b ? a._bg : a._bf;
        let f = b ? a._am : a._al;
        if (f) {
            c._al(d);
        }
        else {
            c._am(d, Enumerable.a(IntRange.$, e));
        }
    }
}
SpreadsheetHeaderResizeOperation.$t = markType(SpreadsheetHeaderResizeOperation, 'SpreadsheetHeaderResizeOperation', SpreadsheetHeaderMouseOperation.$);
/**
 * @hidden
 */
export class SpreadsheetInteractionManager$1 extends Base {
    constructor($t, a, b) {
        super();
        this.$t = null;
        this.h = null;
        this.j = null;
        this.a = 0;
        this.c = null;
        this.f = 0;
        this.b = null;
        this.$t = $t;
        this.$type = this.$type.specialize(this.$t);
        CoreUtilities.y(a);
        this.b = b;
        let c = PropertyChangeListenerList.e(this.$t, this.h, a, this, true);
        this.h = c.p0;
        this.n();
    }
    get e() {
        return this.c;
    }
    set e(a) {
        if (a != this.c) {
            if (this.c != null) {
                this.c._a3 = null;
            }
            this.c = a;
            if (this.c != null) {
                this.c._a3 = this.j;
            }
        }
    }
    get g() {
        return this.f;
    }
    set g(a) {
        if (a != this.f) {
            this.f = a;
            this.b.onCursorChanged(a);
        }
    }
    get i() {
        return this.h;
    }
    m(a, b, c) {
        let d = this.d;
        if (d != null) {
            let e = d.activePane;
            let f = typeCast(SpreadsheetPaneManager.$, e._s);
            if (f != null) {
                d._gi(a, c, void 0, void 0, void 0, b);
                return;
            }
        }
        c();
    }
    n() {
        let a = this.j != null ? this.j._z : 0;
        this.g = a;
    }
    o() {
        let a = this.d;
        this.e = a;
    }
    p() {
        this.e = null;
        if (this.j != null) {
            this.j._n();
        }
        this.v();
    }
    l(a) {
        let b = false;
        let c = this.d;
        if (c != null) {
            b = true;
            if (!c._d7(true)) {
                return b;
            }
            this.b.focusControlIfNeeded();
        }
        if (!a.c()) {
            return b;
        }
        if (this.j != null && this.j._i != 0) {
            b = true;
            let d = this.j._g(a);
            if (d == 2) {
                return b;
            }
            a.f();
            if (d == 1) {
                return b;
            }
        }
        this.w(a);
        if (this.j != null) {
            this.a = a.a();
            this.j._p(a);
            b = true;
            this.w(a);
        }
        return b;
    }
    q(a) {
        this.w(a);
        if (this.j != null) {
            this.j._q(a);
        }
    }
    r(a) {
        if (this.j != null) {
            this.j._r(a);
            this.v();
        }
    }
    s(a) {
        this.w(a);
        if (this.j != null) {
            this.j._s(a);
        }
    }
    t(a) {
        if (this.j != null) {
            if (a.a() == this.a || this.a == 0) {
                this.e = null;
                this.j._t(a);
            }
            this.w(a);
        }
    }
    u(a, b, c) {
        if (a == this.j) {
            switch (b) {
                case "Cursor":
                    this.n();
                    break;
                case "ToolTip":
                    this.x();
                    break;
            }
        }
    }
    v() {
        if (this.j != null && this.j._i == 0) {
            this.e = null;
            this.j._l = null;
            this.j._am(null, Rect.empty, Rect.empty);
            this.j = null;
            this.n();
        }
    }
    w(a) {
        if (this.j == null || this.j._i == 0) {
            let b = this.k(a);
            if (b != this.j) {
                let c = this.j;
                this.j = b;
                if (c != null) {
                    c._am(null, Rect.empty, Rect.empty);
                    c._l = null;
                    SpreadsheetUtilities.ec(c, this);
                }
                if (b != null) {
                    SpreadsheetUtilities.d6(b, this, false);
                }
                this.a = 0;
                let d = this.e;
                if (d != null) {
                    this.e = null;
                    if (b != null) {
                        this.e = d;
                    }
                }
                if (b != null) {
                    let e = this.d;
                    let f = this.b._getRelativeSpreadsheetControlBounds$i();
                    let g = this.b._getLayerContainerSize$i();
                    b._l = runOn(this, this.m);
                    b._am(this.i, new Rect(0, 0, 0, g.width, g.height), f);
                }
                this.n();
                this.x();
            }
        }
    }
    x() {
        let a = this.d;
        let b = this.b.isToolTipAllowed();
        if (this.j == null || this.j._k == null || b == false) {
            this.b.hideToolTip();
        }
        if (b && this.j != null && this.j._k != null) {
            this.b.showToolTip(this.j._k);
        }
    }
    onPropertyValueChanged(a, b, c) {
        this.u(a, b, c);
    }
}
SpreadsheetInteractionManager$1.$t = markType(SpreadsheetInteractionManager$1, 'SpreadsheetInteractionManager$1', Base.$, [IPropertyChangeListener_$type]);
/**
 * @hidden
 */
export class SpreadsheetMenuBuilder_InitializeItemsState$1 extends Base {
    constructor($t) {
        super();
        this.$t = null;
        this.d = new LongValue();
        this.c = new SpreadsheetCell();
        this.e = null;
        this.a = 0;
        this.f = null;
        this.b = null;
        this.g = null;
        this.$t = $t;
        this.$type = this.$type.specialize(this.$t);
    }
}
SpreadsheetMenuBuilder_InitializeItemsState$1.$t = markType(SpreadsheetMenuBuilder_InitializeItemsState$1, 'SpreadsheetMenuBuilder_InitializeItemsState$1');
/**
 * @hidden
 */
export class SpreadsheetMouseOperation_ScrollTimer$1 extends Base {
    constructor($t, a) {
        super();
        this.$t = null;
        this.b = null;
        this.a = null;
        this.d = false;
        this.c = null;
        this.$t = $t;
        this.$type = this.$type.specialize(this.$t);
        this.c = a;
    }
    get e() {
        return this.a != null && this.a.b;
    }
    g(a, b, c) {
        this.d = b;
        this.b = a;
        if (this.a == null) {
            this.a = new PlatformTimer();
            let d = this.a;
            d.tick = delegateCombine(d.tick, runOn(this, this.f));
        }
        if (!this.a.b) {
            this.a.g = c;
            this.a.k();
        }
        else {
            this.a.g = c;
        }
    }
    h() {
        if (this.a != null) {
            this.a.l();
        }
    }
    f(a, b) {
        this.b._x._an(this.d ? 4 : 1);
        this.c();
    }
}
SpreadsheetMouseOperation_ScrollTimer$1.$t = markType(SpreadsheetMouseOperation_ScrollTimer$1, 'SpreadsheetMouseOperation_ScrollTimer$1');
/**
 * @hidden
 */
export class SpreadsheetPaneInteractionManager extends SpreadsheetInteractionManager$1 {
    constructor(a, b) {
        super(SpreadsheetPane.$, a, b);
        this.ab = null;
        this.aa = null;
        this.y = null;
        this.z = null;
        this.ab = new SpreadsheetEnterEditModeOperation();
        this.aa = new SpreadsheetCellSelectionOperation();
        this.y = new SpreadsheetCellContextMenuOperation();
        this.z = new SpreadsheetCellDropDownOperation();
    }
    get_d() {
        return this.i.selection._m;
    }
    get d() {
        return this.get_d();
    }
    k(a) {
        let b = this.d != null && this.d.isInEditMode;
        if (b == false && a.c() && a.a() == 1 && a.g() == 0 && a.e() == 2) {
            return this.ab;
        }
        let c = a.h();
        let d = this.i;
        let e = d._q;
        for (let f = 0; f < e.count; f++) {
            if (e._inner[f].g.containsLocation(c.x, c.y)) {
                return this.z;
            }
        }
        if (a.c() && a.a() == 2) {
            return this.y;
        }
        let g = d.rowScrollRegion;
        if (g._m.count > 0) {
            let h = d.columnScrollRegion;
            if (h._m.count > 0) {
                if ((c.x <= h._bm(Enumerable.ah(WorksheetItemPosition.$, h._m), false) * h._bx) && (c.y <= g._bm(Enumerable.ah(WorksheetItemPosition.$, g._m), false) * g._bx)) {
                    return this.aa;
                }
            }
        }
        return null;
    }
}
SpreadsheetPaneInteractionManager.$t = markType(SpreadsheetPaneInteractionManager, 'SpreadsheetPaneInteractionManager', SpreadsheetInteractionManager$1.$.specialize(SpreadsheetPane.$));
/**
 * @hidden
 */
export class SpreadsheetScrollRegionInteractionManager extends SpreadsheetInteractionManager$1 {
    constructor(a, b) {
        super(SpreadsheetScrollRegion.$, a, b);
        this.ac = null;
        this.aa = null;
        this.ab = null;
        this.z = null;
        this.y = null;
        this.ac = new SpreadsheetHeaderSelectionOperation();
        this.aa = new SpreadsheetHeaderResizeOperation(0);
        this.ab = new SpreadsheetHeaderResizeOperation(1);
        this.z = new SpreadsheetHeaderResizeOperation(2);
        this.y = new SpreadsheetHeaderContextMenuOperation();
    }
    get_d() {
        return this.i._ab._m;
    }
    get d() {
        return this.get_d();
    }
    k(a) {
        let b = a.h();
        let c = this.i;
        let d = typeCast(SpreadsheetRowScrollRegion.$, c) !== null;
        let e = d ? b.y : b.x;
        let f = c._i(true);
        let g = 8;
        let h = 7;
        let i = this.d;
        let j = i != null && i.isInEditMode;
        let k = i._ct(d);
        let l = this.ab;
        let m = this.aa;
        if (j == false && a.c() && a.a() == 1 && a.e() == 2) {
            m = this.z;
            l = this.z;
        }
        if (a.c() && a.a() == 2) {
            return this.y;
        }
        if (f.length == 0 && nullableEquals(c._cr, null)) {
            if (k && e < h) {
                l._bc = c._ci;
                return l;
            }
        }
        else {
            for (let n = 1; n < f.length; n++) {
                if (e < f[n]) {
                    let o = f[n] - e;
                    let p = e - f[n - 1];
                    let q = f[n] - f[n - 1];
                    if ((7 + 8) * 2 > q) {
                        g = Math.max(q * 0.25, 1);
                        h = Math.max(q * 0.25, 1);
                    }
                    if (k && j == false) {
                        if (p < g) {
                            if (c._av(n - 1)) {
                                l._bc = c._m._inner[n - 1]._j - 1;
                                return l;
                            }
                            if (n != 1) {
                                m._bc = c._m._inner[n - 2]._j;
                                return m;
                            }
                        }
                        else if (o < h) {
                            m._bc = c._m._inner[n - 1]._j;
                            return m;
                        }
                    }
                    if (this.b.isMouseOver()) {
                        this.ac._a3 = Nullable$1.toNullable(Number_$type, c._m._inner[n - 1]._j);
                    }
                    else {
                        this.ac._a3 = Nullable$1.toNullable(Number_$type, null);
                    }
                    return this.ac;
                }
            }
            if (k && j == false && nullableEquals(c._cq, null) && Enumerable.ah(WorksheetItemPosition.$, c._m)._j < c._ci) {
                l._bc = c._ci;
                return l;
            }
        }
        return null;
    }
}
SpreadsheetScrollRegionInteractionManager.$t = markType(SpreadsheetScrollRegionInteractionManager, 'SpreadsheetScrollRegionInteractionManager', SpreadsheetInteractionManager$1.$.specialize(SpreadsheetScrollRegion.$));
/**
 * @hidden
 */
export class SpreadsheetCellSelectionOperation extends SpreadsheetPaneMouseOperation {
    constructor() {
        super();
        this._a3 = null;
        this._ba = false;
        this._a9 = false;
        this._az = 10;
        this._a0 = null;
        this._a7 = null;
        this._a8 = null;
        this._br = null;
        this._bc = 0;
        this._bb = null;
        this._be = Nullable$1.toNullable(SpreadsheetCell.$, null);
        this._a2 = null;
        this._a7 = new PropertyChangeListener$1(SpreadsheetCellSelectionOperation.$, this, SpreadsheetCellSelectionOperation._bk, false);
        this._bb = new Dictionary$2(SpreadsheetCell.$, Rect.$, 0);
    }
    get__ai() {
        return this._ab.columnScrollRegion == this._ab.columnScrollRegion._o.activePane.columnScrollRegion;
    }
    get _ai() {
        return this.get__ai();
    }
    get__aj() {
        return this._ab.rowScrollRegion == this._ab.rowScrollRegion._o.activePane.rowScrollRegion;
    }
    get _aj() {
        return this.get__aj();
    }
    get__z() {
        return this._az;
    }
    get _z() {
        return this.get__z();
    }
    _af() {
        let a = this._x;
        if (SpreadsheetCell._l_op_Inequality_Lifted$i(this._be, Nullable$1.toNullable(SpreadsheetCell.$, null)) && this._ab != null && a != null && this._i == 0) {
            let b = a.h();
            let c = this._ab.rowScrollRegion._bx;
            let d = this._ab.columnScrollRegion._ag(b.x / c);
            let e = this._ab.rowScrollRegion._ag(b.y / c);
            let f = this._ab.rowScrollRegion._ab;
            let g = this._ab.rowScrollRegion._cf(e._j);
            let h = this._ab.columnScrollRegion._cf(d._j);
            let i;
            let j = ((() => { let k = this._bf(g, h, i); i = k.p2; return k.ret; })());
            if (j != null) {
                if (SpreadsheetUtilities.be(i)) {
                    let k = 4;
                    let l = this._ab._k.item(g + 1, h + 1);
                    let m = l != null && l.r;
                    let n = this._ab.rowScrollRegion._bn(m ? l.ag : e._j, false) * c;
                    let o = this._ab.columnScrollRegion._bn(m ? l.ab : d._j, true) * c;
                    let p = this._ab.columnScrollRegion._bn(m ? l.x : d._j, false) * c;
                    if (this._ay.isEmpty == false) {
                        if (n > this._ay.bottom) {
                            n = this._ay.bottom;
                        }
                        if (o < this._ay.left) {
                            o = this._ay.left;
                        }
                        if (p > this._ay.right) {
                            p = this._ay.right;
                        }
                    }
                    b = SpreadsheetUtilities.e3((o + (p - o) / 2), n + k);
                }
                else {
                    b = { $type: Point_$type, x: b.x, y: b.y + 10 };
                }
                return ((() => {
                    let $ret = new SpreadsheetToolTipContext();
                    $ret.d = b;
                    $ret.b = j;
                    $ret.a = i;
                    return $ret;
                })());
            }
        }
        return null;
    }
    _an(a) {
        this._a1 = a._s.spreadsheetOwnerState;
        super._an(a);
    }
    _o(a, b) {
        if (b == 0) {
            this._bh();
            this._bg();
            this._a9 = false;
        }
        this._bq();
        super._o(a, b);
    }
    _m(a) {
        this._au(a);
        let b = a.h();
        let c = this._ab.rowScrollRegion._bx;
        let d = this._ab.columnScrollRegion._ag(b.x / c);
        let e = this._ab.rowScrollRegion._ag(b.y / c);
        let f = this._ab.rowScrollRegion._ab;
        this._br = b;
        if (!f._a3()) {
            return false;
        }
        let g = a.g();
        let h = new SpreadsheetCell(e._j, d._j);
        let i = this._ab._s.getCellRange(h);
        let j = f._x;
        let k = this._ab._s.canSelect(h);
        let l = ((g & 4) != 0) || j == 1;
        let m = ((g & 2) != 0) || j == 2;
        let n = false;
        let o = null;
        if (m == l) {
            if (!this._ah()) {
                return false;
            }
            if (m == false) {
                o = ((() => { let p = this._a4(b, d, e); d = p.p1; e = p.p2; return p.ret; })());
            }
            f = this._ab.rowScrollRegion._ab;
            if (k) {
                n = f._a9(i._c);
            }
        }
        else if (!k) {
        }
        else if (m) {
            if (f._ao(h)) {
                this._a2 = new UnselectionHelper(h, f);
                n = true;
            }
            else {
                n = f._ah(h);
            }
        }
        else if (SpreadsheetCell.l_op_Inequality(h, f.activeCell)) {
            n = f._as(h);
        }
        this._a6 = o;
        this._bo();
        if (this._a6 != null) {
            this._bm();
        }
        return n;
    }
    _s(a) {
        this._au(a);
        let b = a.h();
        let c = this._ab;
        let d = c.rowScrollRegion._bx;
        let e = c.columnScrollRegion._ag(b.x / d);
        let f = c.rowScrollRegion._ag(b.y / d);
        let g = c.rowScrollRegion._ab;
        if (this._i == 0) {
            let h, i;
            this._a6 = ((() => { let j = this._a5(b, e, f, h, i); e = j.p1; f = j.p2; h = j.p3; i = j.p4; return j.ret; })());
            let j = c._k != null ? c._k.item(h + 1, i + 1) : null;
            let k = j != null && j.r ? new SpreadsheetCell(j.ak, j.ab) : new SpreadsheetCell(f._j, e._j);
            if (SpreadsheetCell._l_op_Inequality_Lifted$i(Nullable$1.toNullable(SpreadsheetCell.$, k), this._be)) {
                this._al();
                this._be = Nullable$1.toNullable(SpreadsheetCell.$, k);
                let l;
                if (((() => { let m = this._bf(h, i, l); l = m.p2; return m.ret; })()) != null) {
                    if (SpreadsheetUtilities.be(l) == false || this._a6 != null) {
                        this._ar();
                    }
                }
            }
        }
        if (this._i == 2) {
            let m = new SpreadsheetCell(f._j, e._j);
            if (this._a2 != null) {
                this._a2.g(m);
            }
            else if (c._s.canSelect(m)) {
                g._as(m);
            }
        }
        this._bo();
        super._s(a);
    }
    _u(a) {
        this._au(a);
        this._al();
        let b = this._ab;
        let c = a.h();
        let d = b.rowScrollRegion._bx;
        let e = b.columnScrollRegion._ag(c.x / d);
        let f = b.rowScrollRegion._ag(c.y / d);
        let g = ((() => { let h = this._a4(c, e, f); e = h.p1; f = h.p2; return h.ret; })());
        if (this._a0 != null && this._a6 != null && this._a9 == false && g == this._a6) {
            if (this._a0._p != null) {
                this._a0._p(g);
            }
        }
        else {
            this._a6 = g;
        }
        this._bg();
        this._a9 = false;
        this._bn();
        this._bo();
        if (this._a2 != null) {
            let h = this._a2;
            this._a2 = null;
            h.e();
        }
    }
    _g(a) {
        this._au(a);
        return 1;
    }
    _ap(a) {
        this._au(null);
        this._a6 = null;
        this._bo();
        this._a1 = null;
        this._al();
        this._bh();
        super._ap(a);
    }
    get _a6() {
        return this._a3;
    }
    set _a6(a) {
        if (a != this._a3) {
            this._a9 = false;
            this._a3 = a;
            this._bq();
            this._al();
        }
    }
    get _a1() {
        return this._a0;
    }
    set _a1(a) {
        let b = PropertyChangeListenerList.e(SpreadsheetOwnerState.$, this._a0, a, this._a7, true);
        this._a0 = b.p0;
    }
    _bg() {
        let a = this._a8;
        this._a8 = null;
        if (a != null) {
            a.c();
        }
    }
    _bh() {
        if (this._a2 != null) {
            let a = this._a2;
            this._a2 = null;
            a.d();
        }
    }
    _bi() {
    }
    _bj() {
    }
    _a4(a, b, c) {
        let d, e;
        return {
            ret: ((() => { let f = this._a5(a, b, c, d, e); b = f.p1; c = f.p2; d = f.p3; e = f.p4; return f.ret; })()),
            p1: b,
            p2: c
        };
    }
    _a5(a, b, c, d, e) {
        this._bp();
        d = this._ab.rowScrollRegion._cf(c._j);
        e = this._ab.columnScrollRegion._cf(b._j);
        if (e < 0 || d < 0) {
            return {
                ret: null,
                p1: b,
                p2: c,
                p3: d,
                p4: e
            };
        }
        if (this._ab._l == null) {
            return {
                ret: null,
                p1: b,
                p2: c,
                p3: d,
                p4: e
            };
        }
        let f = this._ab._l.item(d + 1, e + 1);
        let g = this._ab._k.item(d + 1, e + 1);
        if (g != null) {
            let h = c._j;
            let i = b._j;
            if (g != null && g.r) {
                h = g.ak;
                i = g.ab;
            }
            let j;
            if (this._bb.count > 0 && ((() => { let k = this._bb.tryGetValue(new SpreadsheetCell(h, i), j); j = k.p1; return k.ret; })())) {
                if (j.containsPoint(a) == false) {
                    return {
                        ret: null,
                        p1: b,
                        p2: c,
                        p3: d,
                        p4: e
                    };
                }
            }
        }
        return {
            ret: f,
            p1: b,
            p2: c,
            p3: d,
            p4: e
        };
    }
    _bf(a, b, c) {
        let d = this._ab;
        if (d != null && d._l != null) {
            let e = d._l.item(a + 1, b + 1);
            if (e != null) {
                if (stringIsNullOrEmpty(e.toolTip) == false) {
                    c = 3;
                    return {
                        ret: e.toolTip,
                        p2: c
                    };
                }
                let f = e.targetAddress;
                if (!stringIsNullOrEmpty(f)) {
                    c = 2;
                    return {
                        ret: SpreadsheetUtilities.di(this._a0 != null ? this._a0._h : null, "DefaultHyperlinkToolTip", f),
                        p2: c
                    };
                }
            }
            let g = d._k.item(a + 1, b + 1);
            if (g != null && g.k && this._a0 != null) {
                if (g.q) {
                    c = 1;
                    return {
                        ret: SpreadsheetUtilities.di(this._a0._h, "InvalidDateTimeToolTip"),
                        p2: c
                    };
                }
                let h = new SpreadsheetCell(d.rowScrollRegion._m._inner[a]._j, d.columnScrollRegion._m._inner[b]._j);
                c = 0;
                return {
                    ret: this._a0._w(h),
                    p2: c
                };
            }
        }
        c = 0;
        return {
            ret: null,
            p2: c
        };
    }
    _al() {
        this._be = Nullable$1.toNullable(SpreadsheetCell.$, null);
        super._al();
    }
    _ao(a, b) {
        super._ao(a, b);
        if (b == null) {
            this._bn();
        }
    }
    _bl(a, b, c) {
        if (a == this._a0) {
            switch (b) {
                case "IsInEditMode":
                    this._bo();
                    break;
            }
        }
    }
    static _bk(a, b, c, d) {
        a._bl(b, c, d);
    }
    _bm() {
        if (this._a8 == null) {
            this._a8 = new TimedOperation(() => {
                this._a9 = true;
                this._bg();
                this._bo();
            }, 1000);
        }
    }
    _bn() {
        let a = this._x;
        if (a == null || this._ab == null) {
            this._ba = false;
        }
        else {
            let b = a.g();
            this._ba = ((b & 4) != 0) || ((b & 2) != 0);
        }
    }
    _bo() {
        let a = this._a0 != null && this._a0._s;
        let b = this._a3 != null && this._ba == false && a == false && this._a9 == false ? 17 : 10;
        if (b != this._az) {
            this._az = b;
            this.a("Cursor");
        }
    }
    _bp() {
        if (this._ab == null) {
            this._bb.clear();
        }
        else if (this._bc != this._ab._ao) {
            this._bc = this._ab._ao;
            this._bb.clear();
            let a = this._ab._ap;
            if (a != null && this._ab._l != null && this._ab._l.c && this._ab._p.count > 0) {
                this._ab.selection._m._v.addCellTextLocations(this._bb, this._ab);
            }
        }
    }
    _bq() {
        if (this._a6 != null && this._i == 0) {
            this._bj();
        }
        else {
            this._bi();
        }
    }
}
SpreadsheetCellSelectionOperation.$t = markType(SpreadsheetCellSelectionOperation, 'SpreadsheetCellSelectionOperation', SpreadsheetPaneMouseOperation.$);
/**
 * @hidden
 */
export class SpreadsheetHeaderSelectionOperation extends SpreadsheetHeaderMouseOperation {
    constructor() {
        super(...arguments);
        this._a2 = Nullable$1.toNullable(Number_$type, null);
        this._a0 = null;
    }
    get__ai() {
        return this._y != null && this._ab == this._ab._o.activePane.columnScrollRegion;
    }
    get _ai() {
        return this.get__ai();
    }
    get__aj() {
        return this._ae != null && this._ab == this._ab._o.activePane.rowScrollRegion;
    }
    get _aj() {
        return this.get__aj();
    }
    get__z() {
        return this._az ? 11 : 9;
    }
    get _z() {
        return this.get__z();
    }
    _an(a) {
        super._an(a);
        a._co = this._a2;
    }
    _o(a, b) {
        if (b == 0) {
            this._a4();
        }
        super._o(a, b);
    }
    _m(a) {
        let b = a.h();
        let c = this._ab._bx;
        let d = this._az;
        let e = d ? b.y : b.x;
        let f = this._ab._ag(e / c);
        let g = this._ab._ab;
        if (!g._a3()) {
            return false;
        }
        let h = a.g();
        let i = this._ab._z.startIndex;
        let j = d ? new SpreadsheetCell(f._j, i) : new SpreadsheetCell(i, f._j);
        let k = d ? new SpreadsheetCellRange(f._j, g._ac._i, f._j, g._ac._h) : new SpreadsheetCellRange(g._ad._i, f._j, g._ad._h, f._j);
        let l = g._x;
        let m = this._ab._o.canSelect1(k);
        let n = ((h & 4) != 0) || l == 1;
        let o = ((h & 2) != 0) || l == 2;
        let p = false;
        if (o == n) {
            if (!this._ah()) {
                return false;
            }
            g = this._ab._ab;
            if (m) {
                p = g._resetSelection2(k, j, false);
            }
        }
        else if (!m) {
        }
        else if (o) {
            if (g._ap(k)) {
                this._a0 = new UnselectionHelper(j, g);
                this._a0.h(k);
                p = true;
            }
            else {
                p = g._addActiveCellRange1(k, j, false);
            }
        }
        else if (SpreadsheetCell.l_op_Inequality(j, g.activeCell)) {
            p = g._at(k, false);
        }
        return p;
    }
    _q(a) {
        super._q(a);
    }
    _r(a) {
        this._ab._co = Nullable$1.toNullable(Number_$type, null);
        super._r(a);
    }
    _s(a) {
        if (this._i == 2) {
            this._a5(a);
        }
        super._s(a);
    }
    _a5(a) {
        let b = a.h();
        let c = this._ab._bx;
        let d = this._az;
        let e = d ? b.y : b.x;
        let f = this._ab._ag(e / c);
        let g = this._ab._ab;
        let h = d ? new SpreadsheetCellRange(f._j, g._ac._i, f._j, g._ac._h) : new SpreadsheetCellRange(g._ad._i, f._j, g._ad._h, f._j);
        if (this._a0 != null) {
            this._a0.h(h);
        }
        else if (this._ab._o.canSelect1(h)) {
            g._at(h, false);
        }
    }
    _u(a) {
        if (this._a0 != null) {
            let b = this._a0;
            this._a0 = null;
            b.e();
        }
    }
    _g(a) {
        return 1;
    }
    _ap(a) {
        super._ap(a);
        a._co = Nullable$1.toNullable(Number_$type, null);
        this._a4();
    }
    get _a3() {
        return this._a2;
    }
    set _a3(a) {
        if (nullableNotEquals(this._a2, a)) {
            this._a2 = a;
            if (this._ab != null) {
                this._ab._co = a;
            }
        }
    }
    _a4() {
        if (this._a0 != null) {
            let a = this._a0;
            this._a0 = null;
            a.d();
        }
    }
}
SpreadsheetHeaderSelectionOperation.$t = markType(SpreadsheetHeaderSelectionOperation, 'SpreadsheetHeaderSelectionOperation', SpreadsheetHeaderMouseOperation.$);
/**
 * @hidden
 */
export class UnselectionHelper extends Base {
    constructor(a, b) {
        super();
        this.a = new SpreadsheetCell();
        this.b = new SpreadsheetCell();
        this.c = null;
        this.a = a;
        this.c = b;
        this.f(a);
    }
    d() {
        this.c._v = SpreadsheetCellRange.empty;
    }
    e() {
        let a = this.c._v;
        if (!a.isEmpty) {
            this.d();
            this.c.unselectRange(a);
        }
    }
    f(a) {
        this.c._v = new SpreadsheetCellRange(this.a.row, this.a.column, a.row, a.column);
        this.b = a;
    }
    g(a) {
        if (SpreadsheetCell.l_op_Inequality(a, this.b)) {
            this.f(a);
        }
    }
    h(a) {
        this.c._v = new SpreadsheetCellRange(Math.min(a.firstRow, this.a.row), Math.min(a.firstColumn, this.a.column), Math.max(a.lastRow, this.a.row), Math.max(a.lastColumn, this.a.column));
    }
}
UnselectionHelper.$t = markType(UnselectionHelper, 'UnselectionHelper');
/**
 * @hidden
 */
export class SpreadsheetCellHitTestResult extends SpreadsheetHitTestResult {
    constructor(a, b) {
        super();
        this.a = new SpreadsheetCell();
        this.c = null;
        CoreUtilities.z(b, "pane");
        this.a = a;
        this.c = b;
    }
    get b() {
        return this.a;
    }
    get d() {
        return this.c;
    }
}
SpreadsheetCellHitTestResult.$t = markType(SpreadsheetCellHitTestResult, 'SpreadsheetCellHitTestResult', SpreadsheetHitTestResult.$);
/**
 * @hidden
 */
export class SpreadsheetHeaderHitTestResult extends SpreadsheetHitTestResult {
    constructor(a, b) {
        super();
        this.c = 0;
        this.a = null;
        CoreUtilities.z(b, "scrollRegion");
        this.c = a;
        this.a = b;
    }
    get d() {
        return this.c;
    }
    get b() {
        return this.a;
    }
}
SpreadsheetHeaderHitTestResult.$t = markType(SpreadsheetHeaderHitTestResult, 'SpreadsheetHeaderHitTestResult', SpreadsheetHitTestResult.$);
/**
 * @hidden
 */
export let ISpreadsheetPaneOwner_$type = new Type(null, 'ISpreadsheetPaneOwner');
/**
 * @hidden
 */
export class SpreadsheetPaneManager extends PropertyChangeNotifierExtended {
    constructor(a, b, c, d, e, f) {
        super();
        this._av = 184550424;
        this._bm = true;
        this._h = null;
        this._n = null;
        this._g = null;
        this._m = null;
        this._i = null;
        this._o = null;
        this._de = null;
        this._df = null;
        this._an = null;
        this._bg = null;
        this._bb = null;
        this._p = null;
        this._ji = Size.empty;
        this._fl = null;
        this._jl = new Size();
        this._jk = new Size();
        this._jj = new Size();
        this._dv = 0;
        this._du = 0;
        this._eb = null;
        this._d9 = null;
        this._ea = null;
        this._am = null;
        this._a2 = null;
        this._ba = null;
        this._v = SpreadsheetCellRange.empty;
        this._w = SpreadsheetCellRange.empty;
        this._t = SpreadsheetCellRange.empty;
        this._u = SpreadsheetCellRange.empty;
        this._ed = 0;
        this._ee = 0;
        this._dw = 1;
        this._a7 = null;
        this._a5 = null;
        this._at = 0;
        this._bn = false;
        this._ft = null;
        this._jg = null;
        this._dq = 0;
        this._dr = 0;
        this._ds = 0;
        this._dt = 0;
        this._al = null;
        this._bk = null;
        this._a0 = null;
        this._dp = null;
        this._bl = null;
        this._dx = 0;
        this._d2 = 0;
        this._az = null;
        CoreUtilities.z(a, "worksheet");
        CoreUtilities.z(b, "selectionFactory");
        CoreUtilities.z(d, "onPrompt");
        CoreUtilities.z(e, "tabManager");
        CoreUtilities.z(f, "ownerState");
        let g = PropertyChangeListenerList.e(ObservableCollectionExtended$1.$.specialize(SpreadsheetPane.$), this._h, new ObservableCollectionExtended$1(SpreadsheetPane.$, 2, false, true), this, false);
        this._h = g.p0;
        this._n = new ReadOnlyNotifyCollection$1(SpreadsheetPane.$, this._h);
        let h = PropertyChangeListenerList.e(ObservableCollectionExtended$1.$.specialize(SpreadsheetColumnScrollRegion.$), this._g, new ObservableCollectionExtended$1(SpreadsheetColumnScrollRegion.$, 2, false, true), this, false);
        this._g = h.p0;
        this._m = new ReadOnlyNotifyCollection$1(SpreadsheetColumnScrollRegion.$, this._g);
        let i = PropertyChangeListenerList.e(ObservableCollectionExtended$1.$.specialize(SpreadsheetRowScrollRegion.$), this._i, new ObservableCollectionExtended$1(SpreadsheetRowScrollRegion.$, 2, false, true), this, false);
        this._i = i.p0;
        this._o = new ReadOnlyNotifyCollection$1(SpreadsheetRowScrollRegion.$, this._i);
        this._df = CoreUtilities.j(SpreadsheetScrollRegion.$, this._i);
        this._de = CoreUtilities.j(SpreadsheetScrollRegion.$, this._g);
        this._bk = new PropertyChangeListener$1(SpreadsheetPaneManager.$, this, (j, k, l, m) => j._hj(k, l, m), false);
        this._bb = a;
        this._eb = b;
        this._d9 = c;
        this._ea = d;
        this._a7 = new DeferredOperation(runOn(this, this._jc));
        this._p = new InViewPaneInfo(this);
        this._a2 = e;
        this._ba = new WorkbookFontSnapshot(this._bb.workbook._styles$i.normalStyle._i);
        this._dp = new Queue$1(DisposableAction.$);
        SpreadsheetUtilities.d6(this._a2._j, this._bk, true);
        this._al = f;
        SpreadsheetUtilities.d6(this._al, this._bk, true);
        this._gs();
        this._gq();
        this._iz();
    }
    e(a, b, c) {
        switch (b != null ? b : "") {
            case "Offset":
                if (!this._b7(64) && typeCast(SpreadsheetScrollInfo.$, a) !== null) {
                    let d = a;
                    let e = d._a2;
                    let f = truncate(MathUtilities.f(d._ac));
                    let g = !e._aw ? this._be(f) : this._bb._cq(f);
                    let h = !e._aw ? runOn(this, this._dy) : runOn(this, this._dz);
                    e.startIndex = g._j;
                    e._bw = h((f - g._m));
                    this._cj = true;
                }
                break;
            case "StartIndex":
                if (typeCast(SpreadsheetScrollRegion.$, a) !== null) {
                    this._cj = true;
                    this._ht(134217728);
                }
                break;
            case "EndIndex":
                if (typeCast(SpreadsheetScrollRegion.$, a) !== null) {
                    this._ht(134217728);
                }
                break;
            case "ActivePane":
                if (a == this) {
                    this._i4();
                    this._ht(512 | 1024 | 33554432 | 16777216);
                    if (this._a2._j.count > 1) {
                        this._ht(2097152);
                    }
                    let i = this._ff(this.activePane);
                    if (nullableNotEquals(i, null)) {
                        this._bb.displayOptions._z = i.value;
                    }
                }
                break;
            case "Add":
            case "Remove":
            case "Replace":
            case "Move":
            case "Reset":
                let j = getInstanceType(a);
                if (j == SpreadsheetUtilities.d3 || j == SpreadsheetUtilities.d2) {
                    this._at &= ~2048;
                    this._ht(512 | 2097152);
                }
                break;
            case "ActiveCell":
                if (this.activePane != null && a == this.activePane.selection) {
                    this._at &= ~2048;
                    this._ht(1024 | 16777216);
                }
                this._ht(2097152);
                break;
            case "ResourceVersion":
                if (a == this._a6) {
                    this._p.ac();
                    this._cj = true;
                }
                break;
            case "AvailableColumnRange":
            case "AvailableRowRange":
            case "CellSelectionMode":
            case "ActiveCellRangeIndex":
            case "ActiveCellAsRange":
                if (this.activePane != null && a == this.activePane.selection) {
                    this._at &= ~2048;
                }
                this._ht(2097152);
                break;
            case "IsRangeChangeSuspended":
                if (typeCast(SpreadsheetScrollInfo.$, a) !== null) {
                    this._hi(a);
                }
                break;
        }
        if (this.activePane != null && a == this.activePane.selection) {
            this._at &= ~2048;
        }
        super.e(a, b, c);
    }
    get _ao() {
        return this._am;
    }
    set _ao(a) {
        if (this._am != a) {
            this._am = a;
            this.a("ActiveCellPane");
        }
    }
    get _fu() {
        return this._ft;
    }
    set _fu(a) {
        if (this._ft != a) {
            this._ft = a;
            this.a("ActiveCellInputMessage");
        }
    }
    get _jh() {
        return this._jg;
    }
    set _jh(a) {
        if (PointUtil.notEquals(this._jg, a)) {
            this._jg = a;
            this.a("ActiveCellInputMessagePosition");
        }
    }
    get activePane() {
        return this._an;
    }
    set activePane(a) {
        if (this._an != a) {
            this._an = a;
            this.a("ActivePane");
        }
    }
    get _a1() {
        return this._a0;
    }
    set _a1(a) {
        if (a != this._a0) {
            this._a0 = a;
            this._i4();
        }
    }
    get _bh() {
        return this._bg;
    }
    set _bh(a) {
        if (this._bg != a) {
            this._bg = a;
            this.a("ActiveTable");
        }
    }
    get _dg() {
        return this._de;
    }
    get _dh() {
        return this._m;
    }
    get _j() {
        return this._g;
    }
    get _b9() {
        return this._b7(2048);
    }
    get _ca() {
        return this._b7(2);
    }
    set _ca(a) {
        if (this._c5(2, a)) {
            this._ip(4, true);
        }
    }
    get _cd() {
        return this._b7(128);
    }
    set _cd(a) {
        this._c5(128, a);
    }
    get _ce() {
        return this._b7(1);
    }
    set _ce(a) {
        if (this._c5(1, a)) {
            this._ip(4, true);
        }
    }
    get _cc() {
        return WorksheetRegionAddress._r(this._bb._g1, Nullable$1.toNullable(WorksheetRegionAddress.$, null));
    }
    get _cj() {
        return this._bm;
    }
    set _cj(a) {
        if (this._bm != a) {
            this._iw();
            this._bm = a;
            this.a("IsLayoutDirty");
            this._iv();
        }
    }
    get _dl() {
        return this._n;
    }
    get _k() {
        return this._h;
    }
    get _d0() {
        return this._ds;
    }
    get _d1() {
        return this._dt;
    }
    get _jo() {
        return this._ji;
    }
    get _a6() {
        return this._a5;
    }
    set _a6(a) {
        if (this._a5 != a) {
            let b = PropertyChangeListenerList.e(ISpreadsheetResourceProvider_$type, this._a5, a, this, true);
            this._a5 = b.p0;
            this._p.ac();
            this.a("ResourceProvider");
            this._ht(4096);
        }
    }
    get _dm() {
        return this._df;
    }
    get _dn() {
        return this._o;
    }
    get _l() {
        return this._i;
    }
    get _fs() {
        return this._fl;
    }
    set _fs(a) {
        if (a != this._fl) {
            let b = stringIsNullOrEmpty(a) ? null : this._bb._getRegion1(a, 1);
            this._v = b == null ? SpreadsheetCellRange.empty : new SpreadsheetCellRange(b.firstRow, b.firstColumn, b.lastRow, b.lastColumn);
            this._fl = a;
            this.a("ScrollRange");
        }
    }
    get _d3() {
        return this._du;
    }
    set _d3(a) {
        if (this._du != a) {
            this._du = a;
            this.a("SplitterHeight");
        }
    }
    get _d4() {
        return this._dv;
    }
    set _d4(a) {
        if (this._dv != a) {
            this._dv = a;
            this.a("SplitterWidth");
        }
    }
    get _a3() {
        return this._a2;
    }
    get _bc() {
        return this._bb;
    }
    get _d8() {
        return this._dw;
    }
    set _d8(a) {
        if (a != this._dw) {
            this._dw = a;
            if (this._al._j.p) {
                this._hv();
            }
            this.a("ZoomLevel");
        }
    }
    _fx() {
        this._fv(false);
    }
    _fw() {
        this._fv(true);
    }
    _fy(a) {
        let b = this._bh;
        if (b == null) {
            return;
        }
        let c = this.activePane.selection;
        if (a) {
            b.insertColumns(b._columns$i.count);
            if (c.cellRanges.count == 1 && c.cellRanges.item(0)._ad == 1) {
                c._bw(0, 1);
            }
        }
        else {
            b.insertDataRows(b.dataAreaRegion._aa);
            if (c.cellRanges.count == 1 && c.cellRanges.item(0)._aa == 1) {
                c._bw(1, 0);
            }
        }
    }
    _en() {
        let a = this._bb.isProtected;
        if (this._a2._j.count > 0) {
            for (let b of fromEnum(this._a2._j)) {
                let c = b._j;
                let d = c.isProtected;
                if (d != a) {
                    return Nullable$1.toNullable(Boolean_$type, null);
                }
            }
        }
        return Nullable$1.toNullable(Boolean_$type, a);
    }
    _f1(a) {
        let b = this.activePane.selection;
        if (nullableNotEquals(this._fj(a ? 16 : 8), true)) {
            this._ea(new SpreadsheetUserPromptInfo(23, null, null, null, false));
            return;
        }
        if (a) {
            if (b._am) {
                this._h4(-1);
            }
            else {
                this._h8(-1, Enumerable.a(IntRange.$, b._bg));
            }
        }
        else {
            if (b._al) {
                this._h3(-1);
            }
            else {
                this._f0(Enumerable.a(SpreadsheetCellRange.$, b.cellRanges), true);
            }
        }
    }
    _f2(a, b, c = null) {
        if (c == null) {
            c = this.activePane;
        }
        let d;
        let e;
        let f;
        let g;
        let h;
        switch (a) {
            default:
            case 2:
                g = runOn(this._bb, this._bb._cq);
                f = runOn(this._bb, this._bb._cp);
                d = b.firstRow;
                e = c.rowScrollRegion;
                h = runOn(this, this._fi);
                if (this._b9 && this._dn.count > 0 && this._dn.item(0).isFrozen && d <= this._dn.item(0).endIndex) {
                    return;
                }
                break;
            case 3:
                g = runOn(this._bb, this._bb._cq);
                f = runOn(this._bb, this._bb._cp);
                d = b.lastRow;
                e = c.rowScrollRegion;
                h = runOn(this, this._fe);
                break;
            case 0:
                g = runOn(this, this._be);
                f = runOn(this._bb, this._bb._cn);
                d = b.firstColumn;
                e = c.columnScrollRegion;
                h = runOn(this, this._fh);
                if (this._b9 && this._dh.count > 0 && this._dh.item(0).isFrozen && d <= this._dh.item(0).endIndex) {
                    return;
                }
                break;
            case 1:
                g = runOn(this, this._be);
                f = runOn(this._bb, this._bb._cn);
                d = b.lastColumn;
                e = c.columnScrollRegion;
                h = runOn(this, this._fc);
                break;
        }
        let i = e._aj(true);
        if (d < i._i) {
            e.startIndex = d;
            e._bw = 0;
        }
        else if (d > i._h) {
            let j = f(d);
            let k = e._x._af;
            let l = j._m + j._i - k;
            let m = g(truncate(l));
            let n = m._j;
            if (m._m + k < j._l) {
                let o = h(n);
                if (o.hasValue) {
                    n = o.value;
                }
            }
            e.startIndex = n;
            e._bw = 0;
        }
    }
    _f3(a, b) {
        let c = b[0];
        for (let d = 1; d < b.length; d++) {
            c = c.union(b[d]);
        }
        this._f5(a, c);
    }
    _f5(a, b) {
        if (a == null) {
            a = this.activePane;
        }
        let c = false;
        let d = Nullable$1.toNullable(Number_$type, b.firstRow);
        let e = Nullable$1.toNullable(Number_$type, b.lastRow);
        let f = Nullable$1.toNullable(Number_$type, b.firstColumn);
        let g = Nullable$1.toNullable(Number_$type, b.lastColumn);
        if (this._b9) {
            let h = this._ar(b._c);
            let i = this._ar(b._b);
            if (i.rowScrollRegion.isFrozen) {
                e = Nullable$1.toNullable(Number_$type, null);
            }
            if (h.rowScrollRegion.isFrozen) {
                d = Nullable$1.toNullable(Number_$type, null);
            }
            if (i.columnScrollRegion.isFrozen) {
                g = Nullable$1.toNullable(Number_$type, null);
            }
            if (h.columnScrollRegion.isFrozen) {
                f = Nullable$1.toNullable(Number_$type, null);
            }
            a = i;
        }
        if (a == null) {
            return;
        }
        c = SpreadsheetPaneManager._bp(a.columnScrollRegion, f, g);
        c = SpreadsheetPaneManager._bp(a.rowScrollRegion, d, e) || c;
        if (c) {
            this._cj = true;
        }
    }
    static _bp(a, b, c) {
        let d, e;
        if (nullableEquals(b, null)) {
            if (nullableEquals(c, null)) {
                return false;
            }
            d = e = c.value;
        }
        else {
            d = b.value;
            e = nullableEquals(c, null) ? d : c.value;
        }
        let f = a.endIndex;
        if (f > a.startIndex && a._bk != 0) {
            f--;
        }
        if (d < a.startIndex || e > f) {
            let g = a._b7(d);
            let h = a._b7(e);
            let i = a.actualExtent / a._bx;
            let j = a._b4(h._l - g._m);
            a._bw = 0;
            if (j > i || d < a.startIndex) {
                a.startIndex = d;
            }
            else {
                let k = a._b5(i);
                let l = Math.max(0, h._l - k);
                let m = a._b8(l);
                a.startIndex = l > m._m ? a._b8(m._l)._j : m._j;
            }
            return true;
        }
        return false;
    }
    _f4(a, b, c, d, e, f) {
        if (a == null) {
            a = this.activePane;
            if (a == null) {
                return;
            }
        }
        let g = a.columnScrollRegion;
        let h = this._bb._cn(b.column);
        let i = g._x._af;
        let j = h._m + truncate((h._i * d)) - truncate((i * c));
        if (j < 0) {
            j = 0;
        }
        let k = this._be(j);
        let l = k._j;
        if (l < b.column && k._m + i < h._l) {
            l++;
        }
        let m = a.rowScrollRegion;
        let n = this._bb._cp(b.row);
        let o = m._x._af;
        let p = n._m;
        if (f != 0) {
            p += (n._i * f);
        }
        if (e != 0) {
            p -= (o * e);
        }
        if (p < 0) {
            p = 0;
        }
        k = this._bb._cq(truncate(p));
        let q = k._j;
        if (q < b.row && k._m + o < n._l) {
            q++;
        }
        g.startIndex = l;
        g._bw = 0;
        m.startIndex = q;
        m._bw = 0;
    }
    _bq(a) {
        for (let b of fromEnum(this._a2._j)) {
            let c = Nullable$1.toNullable(Boolean_$type, null);
            let d = SpreadsheetPaneManager._b5(b._j, a.firstRow, a.firstColumn, a.lastRow, a.lastColumn, (e) => {
                let f = nullableEquals(e._c5, true);
                if (nullableEquals(c, null)) {
                    c = Nullable$1.toNullable(Boolean_$type, f);
                    return true;
                }
                else {
                    return f == c.value;
                }
            });
            if (d == false) {
                this._ea(new SpreadsheetUserPromptInfo(25, null, null, null, false));
                return false;
            }
        }
        return true;
    }
    _br(a) {
        if (this._bb.isProtected) {
            let b = [this._bb];
            let c = [new WorksheetRegionAddress(1, a.row, a.row, a.column, a.column)];
            let d = this._ay(boxArray$1(b), boxArray$1(c), false, void 0, true);
            if (d == 2) {
                d = this._ay(boxArray$1(b), boxArray$1(c), false, void 0, false);
            }
            if (d != 1) {
                return false;
            }
        }
        return true;
    }
    _bs(a) {
        if (this._bb.isProtected) {
            let b = this.activePane;
            if (b == null) {
                return false;
            }
            let c = b._ag;
            if (c._bi.count == 0 && c._bj.count == 0) {
                return false;
            }
            if (c._aw) {
                return false;
            }
            if (c._ax) {
                return false;
            }
            let d = this._bb.protection;
            if (c._bi.count > 0) {
                let e = a ? d.allowInsertingColumns : d.allowDeletingColumns;
                if (e == false) {
                    return false;
                }
            }
            else {
                let f = a ? d.allowInsertingRows : d.allowDeletingRows;
                if (f == false) {
                    return false;
                }
            }
        }
        return true;
    }
    _bt(a) {
        this._jc();
        let b = this._bh;
        if (b != null && b.isHeaderRowVisible) {
            let c = this.activePane != null ? this.activePane.selection : null;
            if (c != null) {
                let d = b._bz.index;
                for (let e = 0; e < c._bg.count; e++) {
                    let f = c._bg.item(e);
                    if (f._i <= d && f._h >= d) {
                        if (!a && f._i <= b._by._ac && f._h >= b._by._ae) {
                            return true;
                        }
                        return false;
                    }
                }
                return true;
            }
        }
        return false;
    }
    _bu() {
        let a = this.activePane;
        if (a != null) {
            for (let b of fromEnum(a.selection.cellRanges)) {
                let c = SpreadsheetUtilities.ay(b);
                for (let d of fromEnum(this._a2._j)) {
                    for (let e of fromEnum(d._j._tables$i)) {
                        if (c._j(e._by)) {
                            return false;
                        }
                    }
                }
            }
        }
        return true;
    }
    _bv(a, b = null) {
        let c;
        return ((() => { let d = this._cy(a, true, c, b); c = d.p2; return d.ret; })());
    }
    _canSelect(a) {
        if (this._bb.isProtected) {
            switch (this._bb.protection.selectionMode) {
                case 2: return false;
                case 1:
                    if (!this._cr(a.row, a.column)) {
                        return false;
                    }
                    break;
            }
        }
        return true;
    }
    _canSelect1(a) {
        if (this._bb.isProtected) {
            switch (this._bb.protection.selectionMode) {
                case 2: return false;
                case 1:
                    if (!SpreadsheetPaneManager._cp(this._bb, a.firstRow, a.firstColumn, a.lastRow, a.lastColumn, null)) {
                        return false;
                    }
                    break;
            }
        }
        return true;
    }
    _f6(a) {
        let b = this.activePane;
        if (b != null) {
            let c = b.selection;
            let d = a ? 1 : -1;
            let e = c.cellRanges.count;
            let f = (c.activeCellRangeIndex + d + e) % e;
            let g = c.cellRanges.item(f);
            if (this._canSelect(g._c)) {
                c._setActiveCell(g._c, Nullable$1.toNullable(Number_$type, f));
            }
        }
    }
    _f7(a) {
        if (nullableNotEquals(this._fj(4), true)) {
            this._ea(new SpreadsheetUserPromptInfo(23, null, null, null, false));
            return;
        }
        SpreadsheetPaneManager_IndentHelper.o(this, a);
    }
    _gb() {
        let a = this._bb._fd.count;
        this._bb._g8();
        if (a != 0 || this._bb._fd.count != 0) {
            this._cj = true;
        }
    }
    _ak(a, b, c = null, d = null) {
        if (c == null) {
            let e = this.activePane;
            if (e != null) {
                if (c == null) {
                    c = Enumerable.a(SpreadsheetCellRange.$, e.selection.cellRanges);
                }
            }
        }
        if (c != null) {
            if (this._b1(true, true)) {
                return 1;
            }
            let f = new List$1(WorksheetRegion.$, 0);
            for (let g of fromEnum(this._a2._j)) {
                f.o(SpreadsheetUtilities.f(g._j, boxArray$1(c)));
            }
            let h = f.toArray();
            let i = new HashSet$1(IRegionBlockingValue_$type, 0);
            try {
                ExcelUtils.gf(h, i);
            }
            catch (j) {
                if (this._ea(new SpreadsheetUserPromptInfo(a, null, j, null, b))) {
                    return 1;
                }
                return 0;
            }
            let k = false;
            for (let l of fromEnum(i)) {
                if (d != null) {
                    let m = l.blockedRegion.worksheet;
                    if (m.isProtected && m == this._bb) {
                        let n = d.a(m);
                        let o = l.blockedRegion._h;
                        if (SpreadsheetPaneManager._cp(m, o._ac, o._w, o._ae, o._x, n) == false) {
                            k = true;
                            continue;
                        }
                    }
                }
                l.removeFromRegion();
            }
            let p = SpreadsheetUtilities.h(boxArray$1(c));
            let q = this._a2._j.count > 1 && a != 2;
            for (let r of fromEnum(this._a2._j)) {
                let s = r._j;
                if (q) {
                    if (SpreadsheetPaneManager._cf(s, p)) {
                        this._ea((((t, u, v) => new SpreadsheetUserPromptInfo(t, null, null, v, u))(20, b, s)));
                        continue;
                    }
                }
                let w = s.isProtected && s == this._bb && d != null ? d.a(s) : null;
                let x = s._tables$i;
                for (let y = x.count - 1; y >= 0; y--) {
                    let z = x._item(y);
                    let aa = z._by;
                    for (let ab = 0; ab < p.length; ab++) {
                        if (p[ab]._h(aa)) {
                            x.removeAt(y, false);
                            break;
                        }
                    }
                }
                let ac = s.filterSettings.region;
                if (ac != null && ac._aa > 0) {
                    let ad = ac._h._f(ac._h._ac);
                    for (let ae = 0; ae < p.length; ae++) {
                        if (p[ae]._h(ad)) {
                            s.filterSettings.clearRegion();
                            break;
                        }
                    }
                }
                let af = s._eh;
                s._eh = true;
                try {
                    let ag = s._rows$i;
                    for (let ai = 0; ai < c.length; ai++) {
                        let ah = c[ai];
                        let aj = w != null ? LockedEditRangeInfoForCellRange.a(w, ah.firstRow, ah.firstColumn, ah.lastRow, ah.lastColumn) : null;
                        for (let ak of fromEnum(s._rows$i._m(ah.firstRow, ah.lastRow))) {
                            let al = ak.index;
                            for (let am = ah.firstColumn; am <= ah.lastColumn; am++) {
                                let an = SpreadsheetPaneManager._getCellRange2(al, am, s);
                                let ao = an._c;
                                if (!an.isSingleCell) {
                                    let ap = SpreadsheetPaneManager._e2(an, s);
                                    if (SpreadsheetCell._l_op_Inequality_Lifted$i(ap, Nullable$1.toNullable(SpreadsheetCell.$, null))) {
                                        ao = ap.value;
                                    }
                                }
                                if (ao.row == al && ao.column >= am) {
                                    if (aj != null) {
                                        let aq = s._b4(ak, ao.column);
                                        if (nullableEquals(aq._c5, true) && aj.e(al, ao.column) == false) {
                                            k = true;
                                            continue;
                                        }
                                    }
                                    ak.setCellValue(ao.column, null);
                                }
                                else {
                                    am = an.lastColumn;
                                }
                            }
                        }
                    }
                }
                finally {
                    s._eh = af;
                }
                let ar;
                let as = SpreadsheetPaneManager._hx(false, false, ar, s, boxArray$1(c));
                ar = as.p2;
                SpreadsheetUtilities.e0(s, p);
            }
            if (k) {
                this._ea(new SpreadsheetUserPromptInfo(23, null, null, null, false));
            }
        }
        return 2;
    }
    _gc(a, b, c = true) {
        let d = this.activePane;
        if (d == null) {
            return;
        }
        let e = new HashSet$1(WorksheetMergedCellsRegion.$, 0);
        if (this._b1(true, a, e)) {
            return;
        }
        for (let f of fromEnum(e)) {
            f.worksheet._mergedCellsRegions$i.remove_1(f);
        }
        let g = d.selection;
        if (b && nullableNotEquals(this._fj(4), true)) {
            let h = this._ax(g, false, void 0, c);
            switch (h) {
                case 0: return;
                case 2:
                    this._gc(a, true, false);
                    return;
                case 1: break;
            }
        }
        let i = this._bb.workbook._styles$i._i(0);
        let j = i._i;
        for (let k of fromEnum(this._a2._j)) {
            let l = k._j;
            for (let m of fromEnum(g.cellRanges)) {
                let n = g._a0(m);
                let o = g._az(m);
                let p = false;
                let q = m.firstRow;
                let r = l._f9(m.firstColumn);
                let s = null;
                if (o == false) {
                    let t = l._f9(m.lastColumn);
                    s = new Array(t - r + 1);
                    for (let u = r; u <= t; u++) {
                        let v = l._ff._inner[u];
                        let w = v.b;
                        let x;
                        if (w._cd || Base.referenceEquals(v.b, j)) {
                            x = false;
                        }
                        else if ((w.style == null || w.style._n) && !WorksheetCellFormatProxy._y(w, j, ExcelUtils.n(w.formatOptions))) {
                            x = false;
                        }
                        else {
                            x = true;
                        }
                        s[u - r] = x;
                        p = x || p;
                    }
                    if (p) {
                        for (let y = m.firstRow; y <= m.lastRow; y++) {
                            let z = l._rows$i.item(y);
                        }
                    }
                }
                for (let aa of fromEnum(l._rows$i._m(m.firstRow, m.lastRow))) {
                    let ab = aa.index;
                    if (n == false && aa._hasCellFormat && !Base.referenceEquals(aa._cellFormatInternal.d, j)) {
                        for (let ac = m.firstColumn; ac <= m.lastColumn; ac++) {
                            aa._bc(ac).formatOptions = 0;
                            aa._bc(ac).style = i;
                        }
                    }
                    else {
                        let ad = null;
                        let ae = -1;
                        let af = m.firstColumn;
                        for (let ag of fromEnum(aa._ch(m.firstColumn, m.lastColumn, true))) {
                            if (p && o == false && af != ag.r) {
                                for (; af < ag.r; af++) {
                                    if (ad == null || af > ad.r) {
                                        ae = l._f9(af);
                                        ad = l._ff._inner[ae];
                                    }
                                    if (!s[ae - r]) {
                                        af = ad.r;
                                        continue;
                                    }
                                    aa._bc(af).formatOptions = 0;
                                    aa._bc(af).style = i;
                                }
                            }
                            if (ad == null || ag.r > ad.r) {
                                ae = l._f9(ag.r);
                                ad = l._ff._inner[ae];
                            }
                            let ah = (ag.n && !Base.referenceEquals(ag.j, j)) || s[ae - r];
                            if (ah) {
                                aa._bc(ag.r).formatOptions = 0;
                                aa._bc(ag.r).style = i;
                            }
                            af = ag.r + 1;
                        }
                        if (p && o == false) {
                            for (; af <= m.lastColumn; af++) {
                                if (ad == null || af > ad.r) {
                                    ae = l._f9(af);
                                    ad = l._ff._inner[ae];
                                }
                                if (!s[ae - r]) {
                                    af = ad.r;
                                    continue;
                                }
                                aa._bc(af).style = i;
                                aa._bc(af).formatOptions = 0;
                            }
                        }
                    }
                }
            }
            let ai = new WorksheetCellFormatData(l.workbook, 0);
            for (let aj of fromEnum(g._bj)) {
                for (let ak of fromEnum(l._rows$i._m(aj._i, aj._h))) {
                    if (ak._hasCellFormat) {
                        ak._cellFormatInternal._setFormatting1(ai, -97);
                    }
                }
            }
            let al = l.workbook._ca._p;
            for (let am of fromEnum(g._bi)) {
                for (let an = am._i; an <= am._h; an++) {
                    let ao = l._cb(an);
                    if (ao.b != null && al._ca(ao.b) == false) {
                        let ap = Math.min(am._h, ao.r);
                        for (let aq = an; aq <= ap; aq++) {
                            l._columns$i.item(aq)._cellFormatInternal._setFormatting1(ai, 8);
                        }
                    }
                    an = ao.r;
                }
            }
            let ar = l._conditionalFormats$i;
            if (ar.count > 0) {
                let as = SpreadsheetUtilities.h(g.cellRanges);
                SpreadsheetUtilities.eb(l, as);
            }
        }
    }
    _gd() {
        let a = this._bh;
        if (a != null) {
            a.clearFilters();
            a.clearSortConditions();
        }
        else if (this._bb.filterSettings.region != null) {
            this._bb.filterSettings.clearFilters();
            this._bb.filterSettings.sortSettings._sortConditions$i.clear();
        }
    }
    _ge() {
        if (this._bb._fd.count > 0) {
            this._bb._fd.clear();
            this._cj = true;
        }
    }
    _s(a) {
        let b;
        let c;
        let d = this._bb._cr(a.row, a.column);
        if (d == null) {
            let e = this._bb._rows$i.item(a.row);
            c = this._bd(e, a.row, a.column);
            b = this._ai(e, a.column);
        }
        else {
            c = this._bd(this._bb._rows$i._aj(d.firstRow), d.firstRow, d._v);
            b = this._ah(d);
        }
        let f = this._bb._ck(b.h, b.ak, b.ab);
        let g = this._e5(f);
        this._aj(b, g, c, false);
        return new SpreadsheetCellEditInfo(b, c, nullableEquals(g, true));
    }
    _ah(a) {
        let b = a._h;
        return ((() => {
            let $ret = new SpreadsheetCellValueInfo();
            $ret.ab = b._w;
            $ret.ak = b._ac;
            $ret.x = b._x;
            $ret.ag = b._ae;
            $ret.r = true;
            $ret.h = a._k;
            $ret.w = a.firstColumn;
            $ret.ao = a.value;
            $ret.d = this._p.k.c(b._ac, b._w);
            return $ret;
        })());
    }
    _ai(a, b) {
        let c = a.index;
        return ((() => {
            let $ret = new SpreadsheetCellValueInfo();
            $ret.ab = b;
            $ret.x = b;
            $ret.ak = c;
            $ret.ag = c;
            $ret.r = false;
            $ret.h = a;
            $ret.w = b;
            $ret.ao = a._getCellValue1(b);
            $ret.d = this._p.k.c(c, b);
            return $ret;
        })());
    }
    _b0(a, b) {
        let c = this._bb._rows$i._aj(a);
        if (c != null) {
            let d = c._a2(b);
            if (d != null && d.j(b)) {
                return true;
            }
        }
        return false;
    }
    _bz(a) {
        let b = a._h;
        return this._b0(b._ac, b._w);
    }
    _gf(a) {
        let b = this.activePane;
        if (b == null) {
            return;
        }
        let c = b.selection;
        if (c._aw) {
            this._ea(new SpreadsheetUserPromptInfo(8, null, null, enumGetBox(SpreadsheetAction_$type, 144), false));
        }
        else if (c._ax) {
            this._ea(new SpreadsheetUserPromptInfo(6, null, null, enumGetBox(SpreadsheetAction_$type, 144), false));
        }
        else if (nullableEquals(a, true) && c._bj.count > 0) {
            return;
        }
        else if (nullableEquals(a, false) && c._bi.count > 0) {
            return;
        }
        else {
            if (nullableEquals(a, null)) {
                if (c._bj.count > 0) {
                    this._gh();
                    if (c._bi.count > 0) {
                        this._h0(true);
                    }
                    return;
                }
                else if (c._bi.count > 0) {
                    this._gg();
                    return;
                }
                else {
                    if (this._bh != null && !this._cb()) {
                        if (c.cellRanges.count > 1) {
                            this._gi(false);
                            return;
                        }
                        let d = this._bh.dataAreaRegion._h;
                        let e = c.cellRanges.item(0);
                        let f = e._aa > e._ad;
                        if (e._ad == d._af) {
                            f = false;
                        }
                        else if (e.firstRow <= d._ac && e.lastRow >= d._ae) {
                            f = true;
                        }
                        this._gi(f);
                        return;
                    }
                    let g = c.cellRanges.item(0);
                    if (g._aa > g._ad) {
                        a = Nullable$1.toNullable(Boolean_$type, true);
                    }
                    else if (g._ad > g._aa) {
                        a = Nullable$1.toNullable(Boolean_$type, false);
                    }
                    else {
                        for (let h = g.firstColumn; h <= g.lastColumn; h++) {
                            if (SpreadsheetCell._l_op_Inequality_Lifted$i(Nullable$1.toNullable(SpreadsheetCell.$, null), this._ev(g.lastRow, h, 3))) {
                                a = Nullable$1.toNullable(Boolean_$type, false);
                                break;
                            }
                        }
                        if (nullableEquals(a, null)) {
                            a = Nullable$1.toNullable(Boolean_$type, true);
                        }
                    }
                }
            }
            if (nullableNotEquals(this._en(), false)) {
                this._ea(new SpreadsheetUserPromptInfo(23, null, null, null, false));
                return;
            }
            let i = Enumerable.a(SpreadsheetCellRange.$, c.cellRanges);
            for (let j of fromEnum(this._a2._j)) {
                for (let l = 0; l < i.length; l++) {
                    let k = i[l];
                    j._j._he(SpreadsheetUtilities.ay(k), nullableEquals(a, true));
                }
            }
        }
    }
    _gg() {
        let a = this.activePane;
        if (a == null) {
            return;
        }
        let b = a.selection;
        if (b._aw) {
            this._ea(new SpreadsheetUserPromptInfo(8, null, null, enumGetBox(SpreadsheetAction_$type, 146), false));
        }
        else if (b._ax) {
            this._ea(new SpreadsheetUserPromptInfo(6, null, null, enumGetBox(SpreadsheetAction_$type, 146), false));
        }
        else {
            if (nullableNotEquals(this._fj(256), true)) {
                this._ea(new SpreadsheetUserPromptInfo(23, null, null, null, false));
                return;
            }
            let c = Enumerable.a(IntRange.$, Enumerable.n(IntRange.$, b._bf));
            for (let d of fromEnum(this._a2._j)) {
                if (SpreadsheetPaneManager._co(d._j, b) == false) {
                    this._ea(new SpreadsheetUserPromptInfo(27, null, null, null, false));
                    return;
                }
            }
            for (let e of fromEnum(this._a2._j)) {
                for (let g = 0; g < c.length; g++) {
                    let f = c[g];
                    e._j._columns$i._remove1(f._i, (f._h - f._i) + 1);
                }
            }
        }
    }
    _gh() {
        let a = this.activePane;
        if (a == null) {
            return;
        }
        let b = a.selection;
        if (b._aw) {
            this._ea(new SpreadsheetUserPromptInfo(8, null, null, enumGetBox(SpreadsheetAction_$type, 144), false));
        }
        else if (b._ax) {
            this._ea(new SpreadsheetUserPromptInfo(6, null, null, enumGetBox(SpreadsheetAction_$type, 144), false));
        }
        else {
            if (nullableNotEquals(this._fj(512), true)) {
                this._ea(new SpreadsheetUserPromptInfo(23, null, null, null, false));
                return;
            }
            let c = Enumerable.a(IntRange.$, Enumerable.n(IntRange.$, b._bg));
            for (let d of fromEnum(this._a2._j)) {
                if (SpreadsheetPaneManager._co(d._j, b) == false) {
                    this._ea(new SpreadsheetUserPromptInfo(28, null, null, null, false));
                    return;
                }
            }
            for (let e of fromEnum(this._a2._j)) {
                for (let g = 0; g < c.length; g++) {
                    let f = c[g];
                    e._j._rows$i._remove1(f._i, (f._h - f._i) + 1);
                }
            }
        }
    }
    _gi(a) {
        let b = this._bh;
        if (b == null) {
            return;
        }
        let c = this.activePane.selection;
        let d = Enumerable.a(IntRange.$, (a ? c._bf : c._bg));
        for (let e = d.length - 1; e >= 0; e--) {
            let f = d[e];
            let g = (f._h - f._i) + 1;
            if (a) {
                if (f._i == b._by._w && g == b._by._af) {
                    let h = b.worksheet;
                    let i = b._by;
                    h._tables$i.remove_1(b, false);
                    h._he(i, true);
                }
                else {
                    b.deleteColumns(f._i - b._by._w, g);
                }
            }
            else {
                if (f._i == b._by._ac && f._h == b._by._ae) {
                    let j = b.worksheet;
                    let k = b._by;
                    j._tables$i.remove_1(b, false);
                    j._he(k, false);
                }
                else {
                    if (b.isTotalsRowVisible && f._h == b._by._ae) {
                        b.isTotalsRowVisible = false;
                        if (g == 1) {
                            continue;
                        }
                        g--;
                    }
                    if (f._i <= b.dataAreaRegion.firstRow && f._h >= b.dataAreaRegion.lastRow) {
                        b.deleteDataRows(1, b.dataAreaRegion._aa - 1);
                        let l = b.worksheet._rows$i._aj(b.dataAreaRegion.firstRow);
                        if (l != null) {
                            for (let m = b._by._w, n = b._by._x; m <= n; m++) {
                                l.setCellValue(m, null);
                            }
                        }
                    }
                    else {
                        b.deleteDataRows(f._i - b.dataAreaRegion.firstRow, g);
                    }
                }
            }
        }
    }
    _gj() {
        this._a7.i();
        this._at = 0;
        SpreadsheetUtilities.ec(this._a2._j, this._bk);
        SpreadsheetUtilities.ec(this._al, this._bk);
        if (this._a5 != null) {
            SpreadsheetUtilities.ec(this._a5, this);
        }
    }
    _b1(a, b, c = null) {
        let d = this.activePane;
        if (d != null) {
            let e = d.selection;
            let f = SpreadsheetUtilities.h(e.cellRanges);
            let g = false;
            for (let h of fromEnum(this._a2._j)) {
                let i = h._j;
                for (let j = 0; j < f.length; j++) {
                    let k = f[j];
                    let l = i._hi(f[j], c);
                    f[j] = l.p0;
                    if (WorksheetRegionAddress._q(f[j], k)) {
                        g = true;
                        if (a == false) {
                            break;
                        }
                    }
                }
                if (g && a == false) {
                    break;
                }
            }
            if (g) {
                if (a) {
                    e._resetSelection(SpreadsheetUtilities.g(boxArray$1(f)), e.activeCell, e.activeCellRangeIndex, false);
                    this._i2();
                }
                if (b) {
                    this._ea(new SpreadsheetUserPromptInfo(17, null, null, null, false));
                }
                return true;
            }
        }
        return false;
    }
    _b2(a, b, c) {
        return this._b3(a, new SpreadsheetCellRange(b.row, b.column), c);
    }
    _b3(a, b, c) {
        return this._b4(a, Nullable$1.toNullable(IntRange.$, new IntRange(1, b.firstRow, b.lastRow)), Nullable$1.toNullable(IntRange.$, new IntRange(1, b.firstColumn, b.lastColumn)), c);
    }
    _b4(a, b, c, d) {
        if (a == null) {
            a = this.activePane;
            if (a == null) {
                return false;
            }
        }
        if (nullableNotEquals(b, null)) {
            b = Nullable$1.toNullable(IntRange.$, b.value._b(this._bb._rows$i.maxCount - 1)._a(0));
        }
        if (nullableNotEquals(c, null)) {
            c = Nullable$1.toNullable(IntRange.$, c.value._b(this._bb._columns$i.maxCount - 1)._a(0));
        }
        let e = nullableNotEquals(c, null) ? c.value._i : a.visibleRange.firstColumn;
        let f = nullableNotEquals(c, null) ? c.value._h : a.visibleRange.lastColumn;
        let g = nullableNotEquals(b, null) ? b.value._i : a.visibleRange.firstRow;
        let h = nullableNotEquals(b, null) ? b.value._h : a.visibleRange.lastRow;
        let i = nullableNotEquals(c, null) ? this._e6(a.columnScrollRegion, c.value, d) : Nullable$1.toNullable(IntRange.$, null);
        let j = nullableNotEquals(b, null) ? this._e6(a.rowScrollRegion, b.value, d) : Nullable$1.toNullable(IntRange.$, null);
        let k = (nullableNotEquals(c, null) && (nullableEquals(i, null) || !c.value.equals(i.value))) || (nullableNotEquals(b, null) && (nullableEquals(j, null) || !b.value.equals(j.value)));
        if (!k) {
            return true;
        }
        let l, m, n, o;
        l = m = n = o = 0;
        let p, q;
        let r = a.visibleRange;
        if ((nullableEquals(i, null) && f <= r.firstColumn) || (nullableNotEquals(i, null) && e < i.value._i)) {
            q = e;
            l = 0;
            n = 0;
        }
        else if ((nullableEquals(i, null) && e >= r.lastColumn) || (nullableNotEquals(i, null) && f > i.value._h)) {
            let s = this._bb._fq(e, f, false);
            let t = this._el(s);
            if (t > a.columnScrollRegion._x._af) {
                q = e;
                l = 0;
                n = 0;
            }
            else {
                q = f;
                l = n = 1;
            }
        }
        else {
            q = r.firstColumn;
            l = n = 0;
        }
        if ((nullableEquals(j, null) && h <= r.firstRow) || (nullableNotEquals(j, null) && g < j.value._i)) {
            p = g;
            m = 0;
            o = 0;
        }
        else if ((nullableEquals(j, null) && g >= r.lastRow) || (nullableNotEquals(j, null) && h > j.value._h)) {
            let u = this._bb._ft(g, h, false);
            let v = this._em(u);
            if (v > a.rowScrollRegion._x._af) {
                p = g;
                m = 0;
                o = 0;
            }
            else {
                p = h;
                m = o = 1;
            }
        }
        else {
            p = r.firstRow;
            m = o = 0;
        }
        if (this._b9) {
            if (a.rowScrollRegion.isFrozen || (this._dn.count > 1 && this._dn.item(0).isFrozen && this._dn.item(0).endIndex >= p)) {
                p = r.firstRow;
                m = o = 0;
            }
            if (a.columnScrollRegion.isFrozen || (this._dh.count > 1 && this._dh.item(0).isFrozen && this._dh.item(0).endIndex >= q)) {
                q = r.firstColumn;
                l = n = 0;
            }
            if (p == r.firstRow && q == r.firstColumn) {
                return true;
            }
        }
        this._f4(a, new SpreadsheetCell(p, q), l, n, m, o);
        return true;
    }
    extendRangeForMergedCells(a) {
        return SpreadsheetPaneManager._extendRangeForMergedCells1(this._bb, a, null);
    }
    _gl(a) {
        if (this.activePane == null) {
            return;
        }
        let b = this._bh;
        let c = this.activePane.selection;
        let d = c.activeCell;
        if (b != null) {
            let e = b._columns$i._item(d.column - b._by._w);
            switch (a) {
                case 0:
                    let f = this._fm(d);
                    if (stringIsNullOrEmpty(f)) {
                        e._j(true);
                    }
                    else {
                        e._j(false, f);
                    }
                    break;
                case 3:
                    let g = this._bb._getCellConditionalFormat1(d.row, d.column);
                    if (g == null || g.iconInfo == null || g.iconInfo.icon == -1) {
                        e._r(0, Nullable$1.toNullable(Number_$type, null));
                    }
                    else {
                        e._r(ExcelUtils.ak(g.iconInfo.iconSet), Nullable$1.toNullable(Number_$type, intSToU(g.iconInfo.iconIndex)));
                    }
                    break;
                case 1:
                case 2:
                    {
                        let h = this._bb._rows$i._aj(d.row);
                        let i = this._bb._b4(h, d.column);
                        let j = this._bb._getCellConditionalFormat1(d.row, d.column);
                        if (a == 1) {
                            e._applyFontColorFilter(j != null && j.cellFormat != null && WorkbookColorInfo.l_op_Inequality(j.cellFormat.font.colorInfo, null) ? j.cellFormat.font.colorInfo : i._bh);
                        }
                        else {
                            e.applyFillFilter(j != null && j.cellFormat != null && j.cellFormat.fill != null ? j.cellFormat.fill : i._ar);
                        }
                    }
                    break;
                default:
                    e.clearFilter();
                    break;
            }
        }
        else {
            let k = this._bb.filterSettings;
            if (k.region == null || !k.region._q(d.row, d.column)) {
                let l;
                let m;
                let n = ((() => { let o = this._ae(false, l, m); l = o.p1; m = o.p2; return o.ret; })());
                if (n.isEmpty) {
                    this._ea(new SpreadsheetUserPromptInfo(30, null, null, null, false));
                    return;
                }
                if (k.region != null) {
                    k.clearRegion();
                }
                k._setRegion1(n._toString1(1), 1);
            }
            let o = d.column - k.region.firstColumn;
            switch (a) {
                case 0:
                    let p = this._fm(d);
                    if (stringIsNullOrEmpty(p)) {
                        k._k(o, true);
                    }
                    else {
                        k._k(o, false, p);
                    }
                    break;
                case 3:
                    let q = this._bb._getCellConditionalFormat1(d.row, d.column);
                    if (q == null || q.iconInfo == null || q.iconInfo.icon == -1) {
                        k._s(o, 0, Nullable$1.toNullable(Number_$type, null));
                    }
                    else {
                        k._s(o, ExcelUtils.ak(q.iconInfo.iconSet), Nullable$1.toNullable(Number_$type, intSToU(q.iconInfo.iconIndex)));
                    }
                    break;
                case 1:
                case 2:
                    {
                        let r = this._bb._rows$i._aj(d.row);
                        let s = this._bb._b4(r, d.column);
                        let t = this._bb._getCellConditionalFormat1(d.row, d.column);
                        if (a == 1) {
                            k._applyFontColorFilter(o, t != null && t.cellFormat != null && WorkbookColorInfo.l_op_Inequality(t.cellFormat.font.colorInfo, null) ? t.cellFormat.font.colorInfo : s._bh);
                        }
                        else {
                            k.applyFillFilter(o, t != null && t.cellFormat != null && t.cellFormat.fill != null ? t.cellFormat.fill : s._ar);
                        }
                    }
                    break;
                default:
                    k.clearFilter(o);
                    break;
            }
        }
    }
    _gm(a, b) {
        if (this._cv() == false) {
            return;
        }
        let c = this._bb.displayOptions;
        let d = c.frozenPaneSettings;
        d.frozenColumns = b;
        d.frozenRows = a;
        d.firstColumnInRightPane = this._dh.item(0).startIndex + b;
        d.firstRowInBottomPane = this._dn.item(0).startIndex + a;
        c.panesAreFrozen = true;
    }
    _z(a) {
        let b = a.firstRow;
        let c = a.firstColumn;
        let d = a.lastRow;
        let e = a.lastColumn;
        let f = this._bb._rows$i;
        do {
            let g = this._fi(b);
            let h = this._fh(c);
            let i = this._fe(d);
            let j = this._fc(e);
            if (nullableNotEquals(g, null)) {
                let k = this._ga(g.value, b, c, e, f, h, j);
                b = k.p1;
                c = k.p2;
                e = k.p3;
            }
            if (nullableNotEquals(i, null)) {
                let l = this._ga(i.value, d, c, e, f, h, j);
                d = l.p1;
                c = l.p2;
                e = l.p3;
            }
            if (h.hasValue && nullableNotEquals(h, c)) {
                let m = this._f8(h.value, c, b, d);
                c = m.p1;
            }
            if (j.hasValue && nullableNotEquals(j, e)) {
                let n = this._f8(j.value, e, b, d);
                e = n.p1;
            }
            let o = this._f9(b, c, d, e, g, h, i, j);
            b = o.p0;
            c = o.p1;
            d = o.p2;
            e = o.p3;
            if (nullableNotEquals(b, g) && nullableNotEquals(d, i) && nullableNotEquals(c, h) && nullableNotEquals(e, j)) {
                break;
            }
        } while (true);
        return new SpreadsheetCellRange(b, c, d, e);
    }
    static *__dd(a, b, c = null) {
        for (let d of fromEnum(b)) {
            if (c != null) {
                c(d);
            }
            for (let e = d.firstRow; e <= d.lastRow; e++) {
                for (let f = d.firstColumn; f <= d.lastColumn; f++) {
                    let g = SpreadsheetPaneManager._getCellRange2(e, f, a);
                    let h = g._c;
                    if (!g.isSingleCell) {
                        let i = SpreadsheetPaneManager._e2(g, a);
                        if (SpreadsheetCell._l_op_Inequality_Lifted$i(i, Nullable$1.toNullable(SpreadsheetCell.$, null))) {
                            h = i.value;
                        }
                    }
                    if (h.row == e && h.column >= f) {
                        yield h;
                    }
                    else {
                        f = g.lastColumn;
                    }
                }
            }
        }
    }
    static _dd(a, b, c = null) {
        return toEnum(() => SpreadsheetPaneManager.__dd(a, b, c));
    }
    _aa() {
        return this._u;
    }
    _es(a, b) {
        let c, d;
        if (SpreadsheetCell._l_op_Inequality_Lifted$i(b, Nullable$1.toNullable(SpreadsheetCell.$, null)) && a._contains(b.value)) {
            d = b.value.column;
            c = this._getCellRange1(b.value.row, d).firstRow - 1;
        }
        else {
            c = a.lastRow;
            d = a.lastColumn;
        }
        do {
            if (d < a.firstColumn) {
                break;
            }
            if (c < a.firstRow) {
                if (d <= a.firstColumn) {
                    break;
                }
                d--;
                c = a.lastRow;
            }
            else if (this._bb._eg(c)) {
                c--;
            }
            else {
                let e = this._bb._cb(d);
                if (e.i) {
                    d = e.q - 1;
                }
                else {
                    let f = this._getCellRange1(c, d);
                    let g = f._c;
                    if (!f.isSingleCell) {
                        let h = this._e1(f);
                        if (SpreadsheetCell._l_op_Inequality_Lifted$i(h, Nullable$1.toNullable(SpreadsheetCell.$, null))) {
                            g = h.value;
                        }
                    }
                    if (g.column == d && g.row == c) {
                        return Nullable$1.toNullable(SpreadsheetCell.$, g);
                    }
                    else if (g.column == d) {
                        c = g.row;
                    }
                    else {
                        c = f.firstRow - 1;
                    }
                }
            }
        } while (true);
        return Nullable$1.toNullable(SpreadsheetCell.$, null);
    }
    _a8(a) {
        let b = this._bd(this._bb._rows$i._aj(a.row), a.row, a.column);
        let c = b._ar;
        let d = this._bb._getCellConditionalFormat1(a.row, a.column);
        if (d != null && d._h != null && d._h.fill != null) {
            c = d._h.fill;
        }
        return SpreadsheetUtilities.bc(c) ? null : c;
    }
    _et(a, b) {
        let c, d;
        if (SpreadsheetCell._l_op_Inequality_Lifted$i(b, Nullable$1.toNullable(SpreadsheetCell.$, null)) && a._contains(b.value)) {
            d = b.value.column;
            c = this._getCellRange1(b.value.row, d).lastRow + 1;
        }
        else {
            c = a.firstRow;
            d = a.firstColumn;
        }
        do {
            if (d > a.lastColumn) {
                break;
            }
            if (c > a.lastRow) {
                if (d >= a.lastColumn) {
                    break;
                }
                d++;
                c = a.firstRow;
            }
            else if (this._bb._eg(c)) {
                c++;
            }
            else {
                let e = this._bb._cb(d);
                if (e.i) {
                    d = e.r + 1;
                }
                else {
                    let f = this._getCellRange1(c, d);
                    let g = f._c;
                    if (!f.isSingleCell) {
                        let h = this._e1(f);
                        if (SpreadsheetCell._l_op_Inequality_Lifted$i(h, Nullable$1.toNullable(SpreadsheetCell.$, null))) {
                            g = h.value;
                        }
                    }
                    if (g.row >= c && g.column >= d) {
                        return Nullable$1.toNullable(SpreadsheetCell.$, g);
                    }
                    else {
                        c = f.lastRow + 1;
                    }
                }
            }
        } while (true);
        return Nullable$1.toNullable(SpreadsheetCell.$, null);
    }
    _eu(a, b, c, d = Nullable$1.toNullable(SpreadsheetCellRange.$, null), e = false, f = false) {
        let g = this._u;
        if (SpreadsheetCellRange._l_op_Inequality_Lifted$i(d, Nullable$1.toNullable(SpreadsheetCellRange.$, null))) {
            g = g.intersect(d.value);
        }
        let h = e ? new SpreadsheetCellRange(a, b) : this._getCellRange1(a, b);
        switch (c) {
            case 0:
                {
                    do {
                        b--;
                        if (b < g.firstColumn) {
                            return Nullable$1.toNullable(SpreadsheetCell.$, null);
                        }
                        let i = this._bb._cb(b);
                        if (i.i) {
                            b = i.q;
                        }
                        else if (!h._contains2(a, b)) {
                            if (f == false || this._cr(a, b)) {
                                break;
                            }
                        }
                    } while (true);
                    break;
                }
            case 1:
                {
                    do {
                        b++;
                        if (b > g.lastColumn) {
                            return Nullable$1.toNullable(SpreadsheetCell.$, null);
                        }
                        let j = this._bb._cb(b);
                        if (j.i) {
                            b = j.r;
                        }
                        else if (!h._contains2(a, b)) {
                            if (f == false || this._cr(a, b)) {
                                break;
                            }
                        }
                    } while (true);
                    break;
                }
            case 2:
                {
                    do {
                        a--;
                        if (a < g.firstRow) {
                            return Nullable$1.toNullable(SpreadsheetCell.$, null);
                        }
                        if (!this._bb._eg(a) && !h._contains2(a, b)) {
                            if (f == false || this._cr(a, b)) {
                                break;
                            }
                        }
                    } while (true);
                    break;
                }
            case 3:
                {
                    do {
                        a++;
                        if (a > g.lastRow) {
                            return Nullable$1.toNullable(SpreadsheetCell.$, null);
                        }
                        if (!this._bb._eg(a) && !h._contains2(a, b)) {
                            if (f == false || this._cr(a, b)) {
                                break;
                            }
                        }
                    } while (true);
                    break;
                }
        }
        return Nullable$1.toNullable(SpreadsheetCell.$, new SpreadsheetCell(a, b));
    }
    getCellRange(a) {
        return this._getCellRange1(a.row, a.column);
    }
    _getCellRange1(a, b) {
        return SpreadsheetPaneManager._getCellRange2(a, b, this._bb);
    }
    static _getCellRange2(a, b, c) {
        let d = c._cr(a, b);
        if (d == null) {
            return new SpreadsheetCellRange(a, b);
        }
        else {
            let e = d._h;
            return new SpreadsheetCellRange(e._ac, e._w, e._ae, e._x);
        }
    }
    _fm(a, b = true) {
        let c = this._bb._rows$i._aj(a.row);
        if (c != null) {
            return c._getCellText1(a.column, b ? 1 : 0);
        }
        return null;
    }
    _fk(a) {
        let b = this._bb._rows$i._aj(a.row);
        let c = null;
        if (b != null) {
            c = b.getCellFormula(a.column);
            if (c == null) {
                c = b._getCellValue1(a.column);
            }
        }
        return c;
    }
    _ev(a, b, c, d = Nullable$1.toNullable(SpreadsheetCellRange.$, null), e = false, f = true) {
        let g = this._u;
        if (SpreadsheetCellRange._l_op_Inequality_Lifted$i(d, Nullable$1.toNullable(SpreadsheetCellRange.$, null))) {
            g = g.intersect(d.value);
        }
        switch (c) {
            case 0:
            case 1:
                let h = c == 0;
                let i = this._bb._rows$i._aj(a);
                let j = Nullable$1.toNullable(Number_$type, null);
                if (i != null) {
                    do {
                        let k = i._c1(b, !h);
                        if (nullableEquals(k, null)) {
                            break;
                        }
                        if (h && nullableLessThan(k, g.firstColumn)) {
                            break;
                        }
                        if (!h && nullableGreaterThan(k, g.lastColumn)) {
                            break;
                        }
                        if (this._bb._cb(k.value).i || (e && this._cq(i, k.value) == false)) {
                            b = k.value;
                        }
                        else {
                            j = k;
                        }
                    } while (nullableEquals(j, null));
                }
                if (nullableEquals(j, null) || Math.abs(j.value - b) > 1) {
                    let l = nullableEquals(j, null) ? g : new SpreadsheetCellRange(g.firstRow, h ? Math.max(j.value - 1, g.firstColumn) : g.firstColumn, g.lastRow, !h ? Math.min(j.value - 1, g.lastColumn) : g.lastColumn);
                    let m = this._fb(a, b, c, l);
                    if (nullableNotEquals(m, null)) {
                        if (m.value._c(b)) {
                            j = Nullable$1.toNullable(Number_$type, h ? b - 1 : b + 1);
                        }
                        else if (nullableNotEquals(j, null)) {
                            j = Nullable$1.toNullable(Number_$type, h ? Math.max(m.value._h, j.value) : Math.min(m.value._i, j.value));
                        }
                        else {
                            j = Nullable$1.toNullable(Number_$type, h ? m.value._h : m.value._i);
                        }
                    }
                }
                if (nullableEquals(j, null)) {
                    if (!f) {
                        return Nullable$1.toNullable(SpreadsheetCell.$, null);
                    }
                    if (h) {
                        let n = g.firstColumn;
                        do {
                            let o = this._bb._cb(n);
                            if (o.i) {
                                n = o.r + 1;
                            }
                            else if (e && this._cr(a, n) == false) {
                                n++;
                            }
                            else {
                                break;
                            }
                            if (n > g.lastColumn) {
                                return Nullable$1.toNullable(SpreadsheetCell.$, null);
                            }
                        } while (true);
                        j = Nullable$1.toNullable(Number_$type, n);
                    }
                    else {
                        let p = g.lastColumn;
                        do {
                            let q = this._bb._cb(p);
                            if (q.i) {
                                p = q.q - 1;
                            }
                            else if (e && this._cr(a, p) == false) {
                                p--;
                            }
                            else {
                                break;
                            }
                            if (p < g.firstColumn) {
                                return Nullable$1.toNullable(SpreadsheetCell.$, null);
                            }
                        } while (true);
                        j = Nullable$1.toNullable(Number_$type, p);
                    }
                }
                b = j.value;
                break;
            case 2:
            case 3:
                let r = c == 2;
                let s = Nullable$1.toNullable(Number_$type, null);
                do {
                    let t = this._bb._rows$i._ap(a, b, !r);
                    if (nullableEquals(t, null)) {
                        break;
                    }
                    if (r && nullableLessThan(t, g.firstRow)) {
                        break;
                    }
                    if (!r && nullableGreaterThan(t, g.lastRow)) {
                        break;
                    }
                    if (this._bb._eg(t.value) || (e && this._cr(t.value, b) == false)) {
                        a = t.value;
                    }
                    else {
                        s = t;
                    }
                } while (nullableEquals(s, null));
                if (nullableEquals(s, null) || Math.abs(s.value - a) > 1) {
                    let u = nullableEquals(s, null) ? g : new SpreadsheetCellRange(r ? Math.max(s.value - 1, g.firstRow) : g.firstRow, g.firstColumn, !r ? Math.min(s.value - 1, g.lastRow) : g.lastRow, g.lastColumn);
                    let v = this._fb(a, b, c, u);
                    if (nullableNotEquals(v, null)) {
                        if (v.value._c(a)) {
                            s = Nullable$1.toNullable(Number_$type, r ? a - 1 : a + 1);
                        }
                        else if (nullableNotEquals(s, null)) {
                            s = Nullable$1.toNullable(Number_$type, r ? Math.max(v.value._h, s.value) : Math.min(v.value._i, s.value));
                        }
                        else {
                            s = Nullable$1.toNullable(Number_$type, r ? v.value._h : v.value._i);
                        }
                    }
                }
                if (nullableEquals(s, null)) {
                    if (!f) {
                        return Nullable$1.toNullable(SpreadsheetCell.$, null);
                    }
                    if (r) {
                        let w = g.firstRow;
                        do {
                            if (!this._bb._eg(w) && (e == false || this._cr(w, b))) {
                                break;
                            }
                            w++;
                            if (w > g.lastRow) {
                                return Nullable$1.toNullable(SpreadsheetCell.$, null);
                            }
                        } while (true);
                        s = Nullable$1.toNullable(Number_$type, w);
                    }
                    else {
                        let x = g.lastRow;
                        do {
                            if (!this._bb._eg(x) && (e == false || this._cr(x, b))) {
                                break;
                            }
                            x--;
                            if (x < g.firstRow) {
                                return Nullable$1.toNullable(SpreadsheetCell.$, null);
                            }
                        } while (true);
                        s = Nullable$1.toNullable(Number_$type, x);
                    }
                }
                a = s.value;
                break;
        }
        return Nullable$1.toNullable(SpreadsheetCell.$, new SpreadsheetCell(a, b));
    }
    _fp(a) {
        let b = this._bi(a.row, a.column);
        if (b != null) {
            if (b.isHeaderRowVisible) {
                return b._bz._getCellText1(a.column, 1);
            }
        }
        else {
            let c = this._bb.filterSettings.region;
            if (c != null && c._q(a.row, a.column)) {
                let d = this._bb._rows$i._aj(c.firstRow);
                if (d != null) {
                    let e = d._getCellText1(a.column, 1);
                    if (stringIsNullOrEmpty(e)) {
                        e = "(Column " + this.activePane.columnScrollRegion._b6(a.column) + ")";
                    }
                    return e;
                }
            }
        }
        return null;
    }
    _e1(a) {
        return SpreadsheetPaneManager._e2(a, this._bb);
    }
    static _e2(a, b) {
        let c = SpreadsheetPaneManager._e3(a.firstColumn, a.lastColumn, b);
        if (nullableEquals(c, null)) {
            return Nullable$1.toNullable(SpreadsheetCell.$, null);
        }
        let d = SpreadsheetPaneManager._e4(a.firstRow, a.lastRow, b);
        if (nullableEquals(d, null)) {
            return Nullable$1.toNullable(SpreadsheetCell.$, null);
        }
        return Nullable$1.toNullable(SpreadsheetCell.$, new SpreadsheetCell(d.value, c.value));
    }
    static _e3(a, b, c) {
        let d = a;
        while (d <= b) {
            let e = c._cb(d);
            if (!e.i) {
                return Nullable$1.toNullable(Number_$type, d);
            }
            d = e.r + 1;
        }
        return Nullable$1.toNullable(Number_$type, null);
    }
    static _e4(a, b, c) {
        if (a <= b) {
            for (let d = a; d <= b; d++) {
                if (!c._eg(d)) {
                    return Nullable$1.toNullable(Number_$type, d);
                }
            }
        }
        return Nullable$1.toNullable(Number_$type, null);
    }
    _e6(a, b, c) {
        let d = a._aj(c);
        return d._j(b);
    }
    _e8(a, b) {
        let c = b;
        while (c >= a) {
            let d = this._bb._cb(c);
            if (!d.i) {
                return Nullable$1.toNullable(Number_$type, c);
            }
            c = d.q - 1;
        }
        return Nullable$1.toNullable(Number_$type, null);
    }
    _e7(a) {
        let b = this._e8(a.firstColumn, a.lastColumn);
        if (nullableEquals(b, null)) {
            return Nullable$1.toNullable(SpreadsheetCell.$, null);
        }
        let c = this._e9(a.firstRow, a.lastRow);
        if (nullableEquals(c, null)) {
            return Nullable$1.toNullable(SpreadsheetCell.$, null);
        }
        return Nullable$1.toNullable(SpreadsheetCell.$, new SpreadsheetCell(c.value, b.value));
    }
    _e9(a, b) {
        for (let c = b; c >= a; c--) {
            if (!this._bb._eg(c)) {
                return Nullable$1.toNullable(Number_$type, c);
            }
        }
        return Nullable$1.toNullable(Number_$type, null);
    }
    _fa(a, b) {
        let c, d;
        if (SpreadsheetCell._l_op_Inequality_Lifted$i(b, Nullable$1.toNullable(SpreadsheetCell.$, null)) && a._contains(b.value)) {
            c = b.value.row;
            d = this._getCellRange1(c, b.value.column).lastColumn + 1;
        }
        else {
            c = a.firstRow;
            d = a.firstColumn;
        }
        do {
            if (c > a.lastRow) {
                break;
            }
            if (d > a.lastColumn) {
                if (c >= a.lastRow) {
                    break;
                }
                c++;
                d = a.firstColumn;
            }
            else if (this._bb._eg(c)) {
                c++;
            }
            else {
                let e = this._bb._cb(d);
                if (e.i) {
                    d = e.r + 1;
                }
                else {
                    let f = this._getCellRange1(c, d);
                    let g = f._c;
                    if (!f.isSingleCell) {
                        let h = this._e1(f);
                        if (SpreadsheetCell._l_op_Inequality_Lifted$i(h, Nullable$1.toNullable(SpreadsheetCell.$, null))) {
                            g = h.value;
                        }
                    }
                    if (g.row == c && g.column >= d) {
                        return Nullable$1.toNullable(SpreadsheetCell.$, g);
                    }
                    else {
                        d = f.lastColumn + 1;
                    }
                }
            }
        } while (true);
        return Nullable$1.toNullable(SpreadsheetCell.$, null);
    }
    _fc(a) {
        let b = this._bb._columns$i.maxCount - 1;
        return this._fd(a, b);
    }
    _fd(a, b) {
        let c = a + 1;
        while (c <= b) {
            let d = this._bb._cb(c);
            if (!d.i) {
                return Nullable$1.toNullable(Number_$type, c);
            }
            c = d.r + 1;
        }
        return Nullable$1.toNullable(Number_$type, null);
    }
    _fe(a) {
        let b = this._bb._rows$i.maxCount - 1;
        if (this._bb._dv && a + 1 <= b) {
            for (let c of fromEnum(this._bb._rows$i._m(a + 1, b))) {
                if (!c.hidden) {
                    return Nullable$1.toNullable(Number_$type, c.index);
                }
            }
        }
        else {
            for (let d = a + 1; d <= b; d++) {
                if (!this._bb._eg(d)) {
                    return Nullable$1.toNullable(Number_$type, d);
                }
            }
        }
        return Nullable$1.toNullable(Number_$type, null);
    }
    _ei(a, b, c, d) {
        if (b <= 0 || b >= c) {
            return 0;
        }
        let e = a ? this._dm : this._dg;
        if (e.count < 2) {
            return 0;
        }
        b /= this._d8;
        let f = e.item(0);
        let g = f._ag(b);
        let h = f._bm(g, true);
        let i = f._bm(g, false);
        let j = b > h + (i - h) / 2 ? i : h;
        if (j < 1 || j >= c) {
            return 0;
        }
        else {
            return this._ef(j * this._d8 + d);
        }
    }
    _getPane2(a, b) {
        let c = a * this._dh.count + b;
        if (c < 0 || c >= this._dl.count) {
            throw new ArgumentOutOfRangeException(0);
        }
        return this._dl.item(c);
    }
    _ar(a) {
        let b = this.activePane;
        if (b != null && this._b9) {
            let c = this._dn.count * this._dh.count - 1;
            if (this._dn.count > 1 && this._dn.item(0).isFrozen && this._dn.item(0).endIndex >= a.row) {
                c -= this._dh.count;
            }
            if (this._dh.count > 1 && this._dh.item(0).isFrozen && this._dh.item(0).endIndex >= a.column) {
                c -= 1;
            }
            b = this._dl.item(c);
        }
        return b;
    }
    _fg(a, b) {
        let c, d;
        if (SpreadsheetCell._l_op_Inequality_Lifted$i(b, Nullable$1.toNullable(SpreadsheetCell.$, null)) && a._contains(b.value)) {
            c = b.value.row;
            d = this._getCellRange1(c, b.value.column).firstColumn - 1;
        }
        else {
            c = a.lastRow;
            d = a.lastColumn;
        }
        do {
            if (c < a.firstRow) {
                break;
            }
            if (d < a.firstColumn) {
                if (c <= a.firstRow) {
                    break;
                }
                c--;
                d = a.lastColumn;
            }
            else if (this._bb._eg(c)) {
                c--;
            }
            else {
                let e = this._bb._cb(d);
                if (e.i) {
                    d = e.q - 1;
                }
                else {
                    let f = this._getCellRange1(c, d);
                    let g = f._c;
                    if (!f.isSingleCell) {
                        let h = this._e1(f);
                        if (SpreadsheetCell._l_op_Inequality_Lifted$i(h, Nullable$1.toNullable(SpreadsheetCell.$, null))) {
                            g = h.value;
                        }
                    }
                    if (g.column == d && g.row == c) {
                        return Nullable$1.toNullable(SpreadsheetCell.$, g);
                    }
                    else if (g.row == c) {
                        d = g.column;
                    }
                    else {
                        d = f.firstColumn - 1;
                    }
                }
            }
        } while (true);
        return Nullable$1.toNullable(SpreadsheetCell.$, null);
    }
    _fh(a) {
        let b = a - 1;
        while (b >= 0) {
            let c = this._bb._cb(b);
            if (!c.i) {
                return Nullable$1.toNullable(Number_$type, b);
            }
            b = c.q - 1;
        }
        return Nullable$1.toNullable(Number_$type, null);
    }
    _fi(a) {
        if (this._bb._dv && a > 0) {
            for (let b of fromEnum(this._bb._rows$i._n(0, a - 1, false))) {
                if (!b.hidden) {
                    return Nullable$1.toNullable(Number_$type, b.index);
                }
            }
        }
        else {
            for (let c = a - 1; c >= 0; c--) {
                if (!this._bb._eg(c)) {
                    return Nullable$1.toNullable(Number_$type, c);
                }
            }
        }
        return Nullable$1.toNullable(Number_$type, null);
    }
    _ae(a, b, c) {
        c = Nullable$1.toNullable(SortContext_$type, null);
        b = 0;
        if (this._bh == null && this.activePane != null) {
            let d = true;
            let e = this.activePane.selection;
            let f = this._af(false);
            let g = SpreadsheetCellRange.empty;
            let h = e.activeCell;
            let i = this.getCellRange(h);
            if (e._s()._equals(i)) {
                g = this._z(i);
                let j = this._bb._tables$i;
                for (let k = 0; k < j.count; k++) {
                    let l = j._item(k)._by;
                    if (SpreadsheetUtilities.a9(g, l)) {
                        if (l._ac > i.lastRow) {
                            g = new SpreadsheetCellRange(g.firstRow, g.firstColumn, l._ac - 1, g.lastColumn);
                        }
                        else if (l._ae < i.firstRow) {
                            g = new SpreadsheetCellRange(l._ae + 1, g.firstColumn, g.lastRow, g.lastColumn);
                        }
                        else if (l._w > i.lastColumn) {
                            g = new SpreadsheetCellRange(g.firstRow, g.firstColumn, g.lastRow, l._w - 1);
                        }
                        else if (l._x < i.firstColumn) {
                            g = new SpreadsheetCellRange(g.firstRow, l._x + 1, g.lastRow, g.lastColumn);
                        }
                    }
                }
                g = g.intersect(f);
                if (g.isEmpty || !g._contains2(h.row, h.column)) {
                    c = Nullable$1.toNullable(SortContext_$type, null);
                    return {
                        ret: SpreadsheetCellRange.empty,
                        p1: b,
                        p2: c
                    };
                }
                if (a && this._bb.filterSettings.region != null && WorksheetRegionAddress._o(SpreadsheetUtilities.ay(g), this._bb.filterSettings.region._h)) {
                    c = Nullable$1.toNullable(SortContext_$type, 2);
                }
                else if (a && SpreadsheetPaneManager._cm(this._bb, g, 0)) {
                    c = Nullable$1.toNullable(SortContext_$type, 1);
                }
                else {
                    if (a && this._bb.sortSettings.region != null) {
                        if (g.intersectsWith(SpreadsheetUtilities.z(this._bb.sortSettings.region._h))) {
                            c = Nullable$1.toNullable(SortContext_$type, 1);
                            d = this._bb.sortSettings.sortType == 0;
                        }
                    }
                    if (d) {
                        let m = SpreadsheetUtilities.cr(a, g, this._bb);
                        if (!a) {
                            m--;
                        }
                        if (m > 0) {
                            b = m;
                            g = new SpreadsheetCellRange(g.firstRow + m, g.firstColumn, g.lastRow, g.lastColumn);
                        }
                    }
                }
            }
            else {
                let n = e.cellRanges.item(e.activeCellRangeIndex);
                g = f.intersect(n);
                if (g.isEmpty) {
                    c = Nullable$1.toNullable(SortContext_$type, null);
                    return {
                        ret: SpreadsheetCellRange.empty,
                        p1: b,
                        p2: c
                    };
                }
                let o = a ? SpreadsheetUtilities.cr(a, g, this._bb) : 0;
                if (a) {
                    if (n._ad == 1 || n._aa == 1) {
                        let p = this._z(n);
                        if ((n._ad == 1 && p._ad > 1) || (n._aa == 1 && p._aa > 1)) {
                            if (this._bb.sortSettings.region != null) {
                                if (p.intersectsWith(SpreadsheetUtilities.z(this._bb.sortSettings.region._h))) {
                                    c = Nullable$1.toNullable(SortContext_$type, 1);
                                    d = this._bb.sortSettings.sortType == 0;
                                }
                            }
                            if (d) {
                                g = p;
                                o = SpreadsheetUtilities.cr(a, g, this._bb);
                            }
                        }
                    }
                    else if (this._bb.sortSettings.region != null && WorksheetRegionAddress._o(SpreadsheetUtilities.ay(g), this._bb.sortSettings.region._h)) {
                        let q = this._z(n);
                        if (n._aa < q._aa) {
                            g = q;
                            o = SpreadsheetUtilities.cr(a, g, this._bb);
                        }
                    }
                    if (this._bb.filterSettings.region != null && WorksheetRegionAddress._o(SpreadsheetUtilities.ay(g), this._bb.filterSettings.region._h)) {
                        c = Nullable$1.toNullable(SortContext_$type, 2);
                        return {
                            ret: g,
                            p1: b,
                            p2: c
                        };
                    }
                }
                else if (!g._contains2(h.row, h.column)) {
                    c = Nullable$1.toNullable(SortContext_$type, null);
                    return {
                        ret: SpreadsheetCellRange.empty,
                        p1: b,
                        p2: c
                    };
                }
                if (o > 0 && g._aa > o) {
                    b = o;
                    g = new SpreadsheetCellRange(g.firstRow + o, g.firstColumn, g.lastRow, g.lastColumn);
                }
            }
            if (SpreadsheetPaneManager._cm(this._bb, g, b)) {
                c = Nullable$1.toNullable(SortContext_$type, 1);
            }
            return {
                ret: g,
                p1: b,
                p2: c
            };
        }
        c = Nullable$1.toNullable(SortContext_$type, null);
        return {
            ret: SpreadsheetCellRange.empty,
            p1: b,
            p2: c
        };
    }
    _fj(a) {
        let b = this._bb.isProtected == false || (this._bb.protection._m & a) == a;
        if (this._a2._j.count > 1) {
            for (let c of fromEnum(this._a2._j)) {
                let d = c._j;
                let e = d.isProtected == false || (d.protection._m & a) == a;
                if (e != b) {
                    return Nullable$1.toNullable(Boolean_$type, null);
                }
            }
        }
        return Nullable$1.toNullable(Boolean_$type, b);
    }
    _q(a) {
        let b = new SpreadsheetCellRange();
        let c = new SpreadsheetCell();
        if (SpreadsheetCell._l_op_Equality_Lifted$i(a, Nullable$1.toNullable(SpreadsheetCell.$, null))) {
            if (this.activePane == null) {
                return null;
            }
            let d = this.activePane.selection;
            if (d.cellRanges.count > 1) {
                this._ea(new SpreadsheetUserPromptInfo(7, null, null, null, false));
                return null;
            }
            c = d.activeCell;
            b = d.cellRanges.item(0);
        }
        else {
            c = a.value;
            b = new SpreadsheetCellRange(c.row, c.column);
        }
        let e = new WorksheetCellAddress(1, c.row, c.column);
        let f = this._bi(c.row, c.column);
        if (f != null) {
            return new SortTargetResult(f, this._bb, f.wholeTableRegion._h, e, 0, 3);
        }
        if (this._bb.filterSettings.region != null && this._bb.filterSettings.region._q(c.row, c.column) && a.hasValue) {
            return new SortTargetResult(f, this._bb, this._bb.filterSettings.region._h, e, 0, 2);
        }
        else if (this._bb.sortSettings.region != null && this._bb.sortSettings.region._q(c.row, c.column) && a.hasValue) {
            return new SortTargetResult(f, this._bb, this._bb.sortSettings.region._h, e, 0, 1);
        }
        let g;
        let h;
        let i = ((() => { let j = this._ae(true, g, h); g = j.p1; h = j.p2; return j.ret; })());
        if (i.isEmpty) {
            this._ea(new SpreadsheetUserPromptInfo(30, null, null, null, false));
            return null;
        }
        if (h.hasValue) {
            switch (h.value) {
                case 1: return new SortTargetResult(f, this._bb, SpreadsheetUtilities.ay(i), e, g, 1);
                case 3: return new SortTargetResult(f, this._bb, f.wholeTableRegion._h, e, 0, 3);
            }
        }
        if (this._bb.filterSettings.region != null && WorksheetRegionAddress._o(SpreadsheetUtilities.ay(i), this._bb.filterSettings.region._h)) {
            if (i._contains1(b)) {
                return new SortTargetResult(f, this._bb, this._bb.filterSettings.region._h, e, 0, 2);
            }
            i = i.union(b).intersect(this._af(false));
        }
        return new SortTargetResult(f, this._bb, SpreadsheetUtilities.ay(i), e, g, 0);
    }
    _af(a = false, b = 1, c = 1) {
        let d = this._bb._c4(this._u.firstRow, this._u.lastRow, this._u.firstColumn, this._u.lastColumn, a);
        if (b < 1) {
            b = 1;
        }
        if (c < 1) {
            c = 1;
        }
        return new SpreadsheetCellRange(d._ac, d._w, Math.max(d._ae, d._ac + b - 1), Math.max(d._x, d._w + c - 1));
    }
    static _cf(a, b) {
        for (let c of fromEnum(a._tables$i)) {
            for (let e = 0; e < b.length; e++) {
                let d = b[e];
                if (c._by._j(d)) {
                    return true;
                }
            }
        }
        return false;
    }
    _b8(a = false) {
        this._jc();
        let b = this.activePane != null ? this.activePane.selection : null;
        if (b != null) {
            let c = this._bh;
            if (c != null) {
                if (!a && c.sortSettings._sortConditions$i.count > 0) {
                    return true;
                }
                for (let d = 0; d < c._columns$i.count; d++) {
                    if (c._columns$i._item(d).filter != null) {
                        return true;
                    }
                }
            }
            else {
                let e = this._bb.filterSettings;
                if (e.region != null) {
                    if (!a || e.region._q(b.activeCell.row, b.activeCell.column)) {
                        if (!a && e.sortSettings._sortConditions$i.count > 0) {
                            return true;
                        }
                        for (let f = 0, g = e.region._ad; f < g; f++) {
                            if (e.getFilter(f) != null) {
                                return true;
                            }
                        }
                    }
                }
            }
        }
        return false;
    }
    _cb() {
        let a = this.activePane != null ? this.activePane.selection : null;
        if (this._bh != null) {
            let b = this._bh._by;
            for (let c = 0; c < a.cellRanges.count; c++) {
                let d = a.cellRanges.item(c);
                if (!b._i(d.firstRow, d.firstColumn) || !b._i(d.lastRow, d.lastColumn)) {
                    return true;
                }
            }
        }
        else if (a.cellRanges.count > 1 || !a.cellRanges.item(0).isSingleCell) {
            let e = this._bb._tables$i;
            if (e.count > 0) {
                for (let f = 0; f < e.count; f++) {
                    let g = e._item(f);
                    for (let h = 0; h < a.cellRanges.count; h++) {
                        let i = a.cellRanges.item(h);
                        if (SpreadsheetUtilities.a9(i, g._by)) {
                            return true;
                        }
                    }
                }
            }
        }
        return false;
    }
    _gp(a, b) {
        if (b) {
            this._go(a);
        }
        else {
            this._gn(a);
        }
    }
    _gt() {
        let a = this._bb.displayOptions;
        a._br();
        for (let b of fromEnum(this._dl)) {
            let c = this._ff(b);
            let d = a._af.a(c.value);
            if (d == null) {
                d = new WorksheetPaneSelection();
                d.a = c.value;
                d.f = 0;
                let e = b.rowScrollRegion.startIndex;
                let f = b.columnScrollRegion.startIndex;
                d.b = new WorksheetCellAddress(1, e, f);
                let g = new WorksheetRegionAddress(1, e, e, f, f);
                let h = this._bb._hi(g);
                g = h.p0;
                d.d.add(g);
                a._af.b.add(d);
            }
            let i = b.selection;
            if (i._resetSelection(SpreadsheetUtilities.g(d.d), SpreadsheetUtilities.y(d.b), d.f, false)) {
                i._bz();
            }
            b._am = false;
        }
    }
    _gw(a) {
        let b = this.activePane;
        if (b == null) {
            return;
        }
        let c = b.selection;
        if (c._aw) {
            this._ea(new SpreadsheetUserPromptInfo(8, null, null, enumGetBox(SpreadsheetAction_$type, 147), false));
        }
        else if (c._ax) {
            this._ea(new SpreadsheetUserPromptInfo(6, null, null, enumGetBox(SpreadsheetAction_$type, 147), false));
        }
        else if (nullableEquals(a, true) && c._bj.count > 0) {
            return;
        }
        else if (nullableEquals(a, false) && c._bi.count > 0) {
            return;
        }
        else {
            if (nullableEquals(a, null)) {
                if (c._bj.count > 0) {
                    this._gy();
                    return;
                }
                else if (c._bi.count > 0) {
                    this._gx();
                    return;
                }
                else if (this._bh != null && !this._cb() && c.cellRanges.count == 1) {
                    let d = c.cellRanges.item(0);
                    let e = this._bh.dataAreaRegion._h;
                    let f = d._aa > d._ad;
                    if (d._ad == e._af) {
                        f = false;
                    }
                    else if (d.firstRow <= e._ac && d.lastRow >= e._ae) {
                        f = true;
                    }
                    this._gz(f);
                    return;
                }
                else {
                    let g = c.cellRanges.item(0);
                    if (g._aa > g._ad) {
                        a = Nullable$1.toNullable(Boolean_$type, true);
                    }
                    else if (g._ad > g._aa) {
                        a = Nullable$1.toNullable(Boolean_$type, false);
                    }
                    else {
                        for (let h = g.firstColumn; h <= g.lastColumn; h++) {
                            if (SpreadsheetCell._l_op_Inequality_Lifted$i(Nullable$1.toNullable(SpreadsheetCell.$, null), this._ev(g.lastRow, h, 3))) {
                                a = Nullable$1.toNullable(Boolean_$type, false);
                                break;
                            }
                        }
                        if (nullableEquals(a, null)) {
                            a = Nullable$1.toNullable(Boolean_$type, true);
                        }
                    }
                }
            }
            if (nullableNotEquals(this._en(), false)) {
                this._ea(new SpreadsheetUserPromptInfo(23, null, null, null, false));
                return;
            }
            let i = Enumerable.a(SpreadsheetCellRange.$, c.cellRanges);
            for (let j of fromEnum(this._a2._j)) {
                for (let l = 0; l < i.length; l++) {
                    let k = i[l];
                    j._j._hr(SpreadsheetUtilities.ay(k), nullableEquals(a, true));
                }
            }
        }
    }
    _gx() {
        let a = this.activePane;
        if (a == null) {
            return;
        }
        let b = a.selection;
        if (b._aw) {
            this._ea(new SpreadsheetUserPromptInfo(8, null, null, enumGetBox(SpreadsheetAction_$type, 147), false));
        }
        else if (b._ax) {
            this._ea(new SpreadsheetUserPromptInfo(6, null, null, enumGetBox(SpreadsheetAction_$type, 147), false));
        }
        else {
            if (nullableNotEquals(this._fj(32), true)) {
                this._ea(new SpreadsheetUserPromptInfo(23, null, null, null, false));
                return;
            }
            let c = Enumerable.a(IntRange.$, Enumerable.n(IntRange.$, b._bf));
            for (let d of fromEnum(this._a2._j)) {
                for (let f = 0; f < c.length; f++) {
                    let e = c[f];
                    d._j._columns$i.insert(e._i, (e._h - e._i) + 1);
                }
            }
        }
    }
    _gy() {
        let a = this.activePane;
        if (a == null) {
            return;
        }
        let b = a.selection;
        if (b._aw) {
            this._ea(new SpreadsheetUserPromptInfo(8, null, null, enumGetBox(SpreadsheetAction_$type, 145), false));
        }
        else if (b._ax) {
            this._ea(new SpreadsheetUserPromptInfo(6, null, null, enumGetBox(SpreadsheetAction_$type, 145), false));
        }
        else {
            if (nullableNotEquals(this._fj(64), true)) {
                this._ea(new SpreadsheetUserPromptInfo(23, null, null, null, false));
                return;
            }
            let c = Enumerable.a(IntRange.$, Enumerable.n(IntRange.$, b._bg));
            for (let d of fromEnum(this._a2._j)) {
                for (let f = 0; f < c.length; f++) {
                    let e = c[f];
                    d._j._rows$i.insert(e._i, (e._h - e._i) + 1);
                }
            }
        }
    }
    _gz(a) {
        if (this._bh == null) {
            return;
        }
        let b = this.activePane.selection;
        let c = this._bh;
        let d = b._s();
        if (a) {
            c.insertColumns(d.firstColumn - c._by._w, d._ad);
        }
        else {
            c.insertDataRows(d.firstRow - c.dataAreaRegion.firstRow, d._aa);
        }
    }
    _g0() {
        this._cj = true;
    }
    _cg() {
        let a = this._bh;
        if (a != null) {
            if (a.isHeaderRowVisible && a.isFilterUIVisible) {
                return true;
            }
            for (let b = 0; b < a._columns$i.count; b++) {
                if (a._columns$i._item(b).filter != null) {
                    return true;
                }
            }
            return false;
        }
        else {
            return this._bb.filterSettings.region != null;
        }
    }
    _ck(a) {
        return a == this._n || a == this._h;
    }
    _cl(a) {
        return a == this._i || a == this._g || a == this._o || a == this._m;
    }
    _jn(a) {
        this._i9();
        if (a.isEmpty) {
            a = new Size(0);
        }
        if (isInfinity(a.height)) {
            a.height = this._dz(truncate(this._jl.height));
        }
        if (isInfinity(a.width)) {
            a.width = this._dy(truncate(this._jl.width));
        }
        let b = false;
        if (Size.l_op_Inequality(a, this._ji) || this._cj) {
            b = true;
            {
                let c = Workbook._fc(this._bb.workbook);
                try {
                    if (a.width != this._ji.width) {
                        this._g1(this._dh);
                    }
                    if (a.height != this._ji.height) {
                        this._g1(this._dn);
                    }
                    this._i5();
                    this._i7();
                    this._cj = false;
                    this._ji = a;
                    this._ek(this._dh, a.width, this._d4, this._bb.workbook.maxColumnCount - 1, false, runOn(this, this._di), runOn(this, this._dy), runOn(this, this._el), runOn(this, this._fh), runOn(this, this._fc));
                    this._ek(this._dn, a.height, this._d3, this._bb.workbook.maxRowCount - 1, false, runOn(this._bb, this._bb._e2), runOn(this, this._dz), runOn(this, this._em), runOn(this, this._fi), runOn(this, this._fe));
                    this._jb();
                    this._i8();
                    for (let d of fromEnum(this._dh)) {
                        d._z = this._dn.item(0);
                    }
                    for (let e of fromEnum(this._dn)) {
                        e._z = this._dh.item(0);
                    }
                    this._i3();
                    this._i1();
                }
                finally {
                    if (c != null) {
                        c.dispose();
                    }
                }
            }
        }
        if (b) {
            if (this._al._o != null) {
                this._al._o();
            }
        }
        return a;
    }
    _g2(a) {
        let b = this.activePane;
        if (b == null) {
            return;
        }
        let c = b.selection;
        switch (a) {
            case 1:
            case 2:
                if (c._ax) {
                    return;
                }
                break;
        }
        if (nullableNotEquals(this._en(), false)) {
            this._ea(new SpreadsheetUserPromptInfo(23, null, null, null, false));
            return;
        }
        let d = new Array(this._a2._j.count);
        let e = Enumerable.a(SpreadsheetCellRange.$, c.cellRanges);
        let f = Enumerable.a(SpreadsheetCellRange.$, c.cellRanges);
        let g = false;
        let h = false;
        for (let i = 0; i < d.length; i++) {
            d[i] = new SpreadsheetPaneManager_MergedCellOperationInfo(this._a2._j.item(i)._j, e);
            if (d[i].d) {
                g = true;
                for (let j = 0; j < f.length; j++) {
                    f[j] = f[j].union(d[i].a[j]);
                }
                h = h || d[i].c;
            }
        }
        if (g) {
            c._resetSelection(f, c.activeCell, c.activeCellRangeIndex, false);
            switch (a) {
                case 1:
                case 2:
                case 3:
                    if (!this._bu()) {
                        return;
                    }
                    break;
            }
        }
        let k = a == 3 && Enumerable.c(SpreadsheetPaneManager_MergedCellOperationInfo.$, Enumerable.u(SpreadsheetPaneManager_MergedCellOperationInfo.$, d, (l) => l.b == this._a2._o._j && l.e.count > 0));
        for (let m = 0; m < d.length; m++) {
            let l = d[m];
            let n = l.b;
            let o = n._mergedCellsRegions$i;
            for (let p of fromEnum(l.e)) {
                o.remove_1(p);
            }
            if (a != 0) {
                let q = Enumerable.n(SpreadsheetCellRange.$, l.a);
                switch (a) {
                    case 3:
                        if (k) {
                            for (let r of fromEnum(l.e)) {
                                let s = r._h;
                                for (let t = s._ac, u = s._ae; t <= u; t++) {
                                    let v = n._rows$i.item(t);
                                    for (let w = s._w, x = s._x; w <= x; w++) {
                                        v._bc(w).alignment = 0;
                                    }
                                }
                            }
                            continue;
                        }
                        for (let y of fromEnum(q)) {
                            if (y.isSingleCell) {
                                n._rows$i.item(y.firstRow).getCellFormat(y.firstColumn).alignment = 2;
                            }
                            else {
                                let z = o._add1(y.firstRow, y.firstColumn, y.lastRow, y.lastColumn);
                                z.cellFormat.alignment = 2;
                            }
                        }
                        break;
                    case 1:
                        for (let aa of fromEnum(q)) {
                            if (!aa.isSingleCell) {
                                o._add1(aa.firstRow, aa.firstColumn, aa.lastRow, aa.lastColumn);
                            }
                        }
                        break;
                    case 2:
                        for (let ab of fromEnum(q)) {
                            if (ab.firstColumn == ab.lastColumn) {
                                continue;
                            }
                            for (let ac = ab.firstRow; ac <= ab.lastRow; ac++) {
                                o._add1(ac, ab.firstColumn, ac, ab.lastColumn);
                            }
                        }
                        break;
                }
            }
        }
        if (g) {
            let ad = c.activeCell;
            for (let af = 0; af < d.length; af++) {
                let ae = d[af];
                ad = SpreadsheetPaneManager._getCellRange2(ad.row, ad.column, ae.b)._c;
            }
            c._setActiveCell(ad);
        }
    }
    _g3(a, b, c) {
        let d = this.activePane;
        let e = d != null ? d.selection : null;
        if (e != null) {
            let f = e.activeCell;
            let g = f;
            let h = this._getCellRange1(f.row, f.column);
            let i = e._s();
            let j = c == false && this._bb.isProtected && this._bb.protection.selectionMode == 1 && b != 2;
            if (c) {
                if (a == 0 || a == 1) {
                    h = new SpreadsheetCellRange(i.firstRow, h.firstColumn, i.lastRow, h.lastColumn);
                }
                else {
                    h = new SpreadsheetCellRange(h.firstRow, i.firstColumn, h.lastRow, i.lastColumn);
                }
                h = this.extendRangeForMergedCells(h);
                let k = b == 2 || b == 1;
                let l = k ? f.row : i.firstRow < f.row ? i.firstRow : i.lastRow;
                let m = k ? f.column : i.firstColumn < f.column ? i.firstColumn : i.lastColumn;
                switch (a) {
                    case 1:
                        if (h.firstColumn <= i.firstColumn) {
                            g = new SpreadsheetCell(l, i.lastColumn);
                        }
                        else {
                            g = new SpreadsheetCell(l, i.firstColumn);
                        }
                        break;
                    case 0:
                        if (h.lastColumn >= i.lastColumn) {
                            g = new SpreadsheetCell(l, i.firstColumn);
                        }
                        else {
                            g = new SpreadsheetCell(l, i.lastColumn);
                        }
                        break;
                    case 3:
                        if (h.firstRow <= i.firstRow) {
                            g = new SpreadsheetCell(i.lastRow, m);
                        }
                        else {
                            g = new SpreadsheetCell(i.firstRow, m);
                        }
                        break;
                    case 2:
                        if (h.lastRow >= i.lastRow) {
                            g = new SpreadsheetCell(i.firstRow, m);
                        }
                        else {
                            g = new SpreadsheetCell(i.lastRow, m);
                        }
                        break;
                    default: return;
                }
            }
            let n = this._eo(g, a, b, j);
            let o = !nullableIsNull(n) ? n.value : g;
            if (c == false) {
                this._ij(o);
            }
            else {
                this._hz(a, f, i, o);
            }
        }
    }
    _g4(a, b) {
        if (!this._ji.isEmpty) {
            this._jn(this._ji);
        }
        let c = this.activePane;
        if (c != null) {
            let d = c.selection;
            let e = d.activeCell;
            let f = this._jo;
            if (!f.isEmpty) {
                let g = d._s();
                let h;
                let i;
                switch (a) {
                    default:
                        h = c.rowScrollRegion;
                        i = e.row;
                        break;
                    case 0:
                    case 1:
                        h = c.columnScrollRegion;
                        i = e.column;
                        break;
                }
                if (b) {
                    let j = this._getCellRange1(e.row, e.column);
                    switch (a) {
                        case 2:
                            i = g.lastRow;
                            break;
                        case 0:
                            i = g.lastColumn;
                            break;
                        case 3:
                            i = Math.max(g.lastRow, j.lastRow);
                            break;
                        case 1:
                            i = Math.max(g.lastColumn, j.lastColumn);
                            break;
                    }
                }
                let k = i - h.startIndex;
                this._ia(a);
                this._jn(f);
                let l = h.startIndex + k;
                if (l < h.startIndex) {
                    l = h.startIndex;
                }
                else if (l > h.endIndex) {
                    l = h.endIndex;
                }
                let m = new SpreadsheetCell();
                switch (a) {
                    default:
                    case 2:
                    case 3:
                        m = new SpreadsheetCell(l, e.column);
                        break;
                    case 0:
                    case 1:
                        m = new SpreadsheetCell(e.row, l);
                        break;
                }
                if (!b) {
                    this._ij(m);
                }
                else {
                    this._hz(a, e, g, m);
                }
            }
        }
    }
    _g5(a, b) {
        let c = this.activePane;
        if (c != null) {
            let d = c.columnScrollRegion._aj(true);
            let e = c.rowScrollRegion._aj(true);
            let f = new SpreadsheetCellRange(e._i, d._i, e._h, d._h);
            let g = a ? this._e1(f) : this._e7(f);
            if (SpreadsheetCell._l_op_Inequality_Lifted$i(g, Nullable$1.toNullable(SpreadsheetCell.$, null))) {
                if (!b) {
                    this._ij(g.value);
                }
                else {
                    this._cs(g.value);
                }
            }
        }
    }
    _g6(a, b) {
        let c = 0;
        if (b && this._b9) {
            let d = Enumerable.af(SpreadsheetColumnScrollRegion.$, this._dh);
            if (d != null && d.isFrozen) {
                c = d.endIndex + 1;
            }
        }
        let e = SpreadsheetPaneManager._e3(c, this._bc._columns$i.maxCount - 1, this._bb);
        if (nullableNotEquals(e, null)) {
            let f = new SpreadsheetCell(this.activePane.selection.activeCell.row, e.value);
            if (!a) {
                this._ij(f);
            }
            else {
                this._hz(0, this.activePane.selection.activeCell, this.activePane.selection._s(), f);
            }
        }
    }
    _g7(a, b) {
        let c = this._aa();
        if (b && this._b9) {
            let d = 0;
            let e = 0;
            let f = Enumerable.af(SpreadsheetColumnScrollRegion.$, this._dh);
            let g = Enumerable.af(SpreadsheetRowScrollRegion.$, this._dn);
            if (f != null && f.isFrozen) {
                d = f.endIndex + 1;
            }
            if (g != null && g.isFrozen) {
                e = g.endIndex + 1;
            }
            c = new SpreadsheetCellRange(Math.max(Math.min(e, c.lastRow), c.firstRow), Math.max(Math.min(d, c.lastColumn), c.firstColumn), c.lastRow, c.lastColumn);
        }
        let h = this._e1(c);
        if (SpreadsheetCell._l_op_Inequality_Lifted$i(h, Nullable$1.toNullable(SpreadsheetCell.$, null))) {
            if (!a) {
                this._ij(h.value);
            }
            else {
                if (this._cs(h.value)) {
                    this._b2(null, h.value, true);
                }
            }
        }
    }
    _g8(a) {
        this._jd();
        let b = new SpreadsheetCellRange(this._t.firstRow, this._t.firstColumn, this._t.lastRow + 1, this._t.lastColumn + 1);
        let c = a ? this._e1(b) : this._e7(b);
        if (SpreadsheetCell._l_op_Inequality_Lifted$i(c, Nullable$1.toNullable(SpreadsheetCell.$, null))) {
            while (SpreadsheetCell._l_op_Inequality_Lifted$i(c, Nullable$1.toNullable(SpreadsheetCell.$, null)) && this._cr(c.value.row, c.value.column) == false) {
                c = a ? this._fa(b, c) : this._fg(b, c);
            }
            if (SpreadsheetCell._l_op_Inequality_Lifted$i(c, Nullable$1.toNullable(SpreadsheetCell.$, null))) {
                this._ij(c.value);
            }
        }
    }
    _g9(a) {
        let b = this.activePane.visibleRange;
        let c = this.activePane.selection;
        let d = c._s();
        d = b.intersect(d);
        if (!d.isEmpty) {
            let e = a ? this._e1(d) : this._e7(d);
            if (SpreadsheetCell._l_op_Inequality_Lifted$i(e, Nullable$1.toNullable(SpreadsheetCell.$, null)) && this._canSelect(e.value)) {
                c._setActiveCell(e.value, Nullable$1.toNullable(Number_$type, c.activeCellRangeIndex));
            }
        }
    }
    _ha(a) {
        let b = this._af(false, 1, 1);
        let c = this._e7(b);
        if (SpreadsheetCell._l_op_Inequality_Lifted$i(c, Nullable$1.toNullable(SpreadsheetCell.$, null))) {
            let d = this._getCellRange1(c.value.row, c.value.column);
            c = this._e1(d);
            if (!a) {
                this._ij(c.value);
            }
            else {
                if (this._cs(c.value)) {
                    this._b2(null, c.value, true);
                }
            }
        }
    }
    _hb(a) {
        let b = this._af(false, 1, 1);
        let c = this._e8(b.firstColumn, b.lastColumn);
        let d = this.activePane;
        if (nullableNotEquals(c, null) && d != null) {
            let e = d.selection;
            let f = e.activeCell;
            let g = this._getCellRange1(f.row, c.value);
            let h = SpreadsheetPaneManager._e4(g.firstRow, g.lastRow, this._bb);
            let i = new SpreadsheetCell(!nullableIsNull(h) ? h.value : f.row, c.value);
            if (!a) {
                this._ij(i);
            }
            else {
                this._hz(1, f, e._s(), i);
            }
        }
    }
    _ct(a) {
        if (!this._b9) {
            let b = this._bb.displayOptions.unfrozenPaneSettings;
            let c = a ? b.topPaneHeight : b.leftPaneWidth;
            let d = a ? this._dm : this._dg;
            if (c > 0 && d.count > 1) {
                let e = d.item(0);
                let f = e._bk;
                if (f < 0.5 || e._m.count == 0) {
                    return false;
                }
                let g = Enumerable.ah(WorksheetItemPosition.$, e._m);
                let h = a ? this._dz(g._i) : this._dy(g._i);
                if (Math.abs(h - f) < 0.5) {
                    return false;
                }
                return true;
            }
        }
        return false;
    }
    _hc(a, b = Nullable$1.toNullable(Boolean_$type, null)) {
        let c = this.activePane.selection;
        if (c != null) {
            let d = c.cellRanges;
            c._by();
            let e = c.activeCell;
            let f = this._getCellRange1(e.row, e.column);
            let g = e;
            let h = c.activeCellRangeIndex;
            let i = !nullableIsNull(b) ? b.value : this._bb.isProtected;
            if (d.count == 1 && f._contains1(d.item(0))) {
                if (i) {
                    let j = this._eo(e, a, 0, true);
                    g = !nullableIsNull(j) ? j.value : e;
                }
                else {
                    let k = e.row;
                    let l = e.column;
                    switch (a) {
                        case 1:
                            l = f.lastColumn;
                            break;
                        case 0:
                            l = f.firstColumn;
                            break;
                        case 3:
                            k = f.lastRow;
                            break;
                        case 2:
                            k = f.firstRow;
                            break;
                    }
                    let m = this._eu(k, l, a);
                    g = !nullableIsNull(m) ? m.value : e;
                }
                this._ik(g, false, Nullable$1.toNullable(SpreadsheetCellRange.$, new SpreadsheetCellRange(g.row, g.column)));
            }
            else {
                let n = c.activeCellRangeIndex;
                let o = d.count;
                let p = a == 0 || a == 2 ? -1 : 1;
                for (let q = 0; q <= o; q++) {
                    let r = (q * p + n + o) % o;
                    let s = d.item(r);
                    let t = q == 0 ? Nullable$1.toNullable(SpreadsheetCell.$, e) : Nullable$1.toNullable(SpreadsheetCell.$, null);
                    let u = Nullable$1.toNullable(SpreadsheetCell.$, null);
                    if (i) {
                        if (q != 0) {
                            switch (a) {
                                case 2:
                                case 0:
                                    t = Nullable$1.toNullable(SpreadsheetCell.$, s._b);
                                    break;
                                case 3:
                                case 1:
                                    t = Nullable$1.toNullable(SpreadsheetCell.$, s._c);
                                    break;
                            }
                        }
                        u = this._eo(t.value, a, 0, true, Nullable$1.toNullable(SpreadsheetCellRange.$, s), q != 0);
                    }
                    else {
                        switch (a) {
                            case 2:
                                u = this._es(s, t);
                                break;
                            case 3:
                                u = this._et(s, t);
                                break;
                            case 0:
                                u = this._fg(s, t);
                                break;
                            case 1:
                                u = this._fa(s, t);
                                break;
                        }
                    }
                    if (SpreadsheetCell._l_op_Inequality_Lifted$i(u, Nullable$1.toNullable(SpreadsheetCell.$, null))) {
                        g = u.value;
                        h = r;
                        break;
                    }
                }
                if (this._canSelect(g) && c._setActiveCell(g, Nullable$1.toNullable(Number_$type, h))) {
                    this._b3(null, new SpreadsheetCellRange(g.row, g.column), true);
                }
            }
        }
    }
    _hd($tContext, $tValue, a, b) {
        if (this._b7(1048576) && SpreadsheetPaneManager._ch(b)) {
            return;
        }
        let c = 0;
        switch (b.a) {
            case 28:
                switch (b.c) {
                    case "Remove":
                        c = 5 | 32768 | 3;
                        break;
                }
                break;
            case 7:
                if (this._p.n) {
                    if (b.c == "ChartShift") {
                        this._p.ab(a);
                    }
                    else {
                        this._p.aa(a.source);
                    }
                }
                break;
            case 6:
            case 8:
                c = 515;
                break;
            case 66:
            case 68:
            case 69:
            case 67:
            case 70:
            case 71: break;
            case 4:
            case 61:
            case 85:
            case 27:
                switch (b.c) {
                    case "Alignment":
                    case "FontBold":
                    case "FontColorInfo":
                    case "FontHeight":
                    case "FontItalic":
                    case "FontName":
                    case "FontStrikeout":
                    case "FontSuperscriptSubscriptStyle":
                    case "FontUnderlineStyle":
                    case "FormatString":
                    case "Indent":
                    case "Rotation":
                    case "ShrinkToFit":
                    case "Style":
                    case "VerticalAlignment":
                    case "WrapText":
                    case "FormatOptions":
                    case "SetFormatting":
                    case "SetFontFormatting":
                        c = 5 | 3;
                        break;
                    case "Locked":
                        c = 3;
                        break;
                    case "BottomBorderColorInfo":
                    case "BottomBorderStyle":
                    case "DiagonalBorderColorInfo":
                    case "DiagonalBorders":
                    case "DiagonalBorderStyle":
                    case "Fill":
                    case "LeftBorderColorInfo":
                    case "LeftBorderStyle":
                    case "RightBorderColorInfo":
                    case "RightBorderStyle":
                    case "TopBorderColorInfo":
                    case "TopBorderStyle":
                        c = 3;
                        break;
                    default: break;
                }
                break;
            case 47:
                switch (b.c) {
                    case "OnVisited":
                    case "DisplayText":
                        c = 5;
                        break;
                }
                break;
            case 48:
            case 49:
            case 16:
                c = 5 | 3;
                break;
            case 5:
                c = 5 | 3;
                break;
            case 26:
                switch (b.c) {
                    case "Width":
                        c = 5 | 9;
                        break;
                    case "Hidden":
                        c = 5 | 9;
                        if (this._p.n) {
                            this._p.g.m(b.k(a), a);
                            this._ht(268435456);
                        }
                        break;
                }
                break;
            case 60:
                switch (b.c) {
                    case "Height":
                        c = 5 | 9;
                        break;
                    case "Hidden":
                        c = 5 | 9;
                        if (this._p.n) {
                            this._p.g.m(b.k(a), a);
                            this._ht(268435456);
                        }
                        break;
                }
                break;
            case 65:
            case 9:
            case 90:
                switch (b.c) {
                    case "DefaultColumnWidth":
                    case "DefaultRowHeight":
                    case "DefaultRowHidden":
                        c = 5 | 9;
                        break;
                    case "ImageBackground":
                        c = 1;
                        break;
                    case "IsProtected":
                        c = this._au() | 128;
                        break;
                    case "ValidationInputMessagePosition":
                        c = 1024;
                        break;
                    case "ResizeColumns":
                    case "ResizeRows":
                        c = 5 | 9;
                        if (this._p.n) {
                            if (a.hasHiddenChanges) {
                                this._p.g.m(b.k(a), a);
                                this._ht(268435456);
                            }
                        }
                        break;
                }
                break;
            case 35:
                switch (b.c) {
                    case "Reset":
                        c = 1 | 5 | 3 | 17 | 128 | 1024;
                        break;
                    case "ShowGridlines":
                    case "GridlineColor":
                        this._p.ac();
                        c = 1;
                        break;
                    case "ShowRowAndColumnHeaders":
                    case "MagnificationInNormalView":
                        c = 1 | 128;
                        break;
                    case "ShowZeroValues":
                    case "ShowFormulasInCells":
                        c = 5 | 3 | 1024;
                        break;
                    case "FirstColumnInRightPane":
                    case "FirstRowInBottomPane":
                    case "FirstColumnInLeftPane":
                    case "FirstRowInTopPane":
                    case "FrozenColumns":
                    case "FrozenRows":
                    case "LeftPaneWidth":
                    case "TopPaneHeight":
                    case "PanesAreFrozen":
                        c = 17;
                        break;
                }
                break;
            case 86:
                switch (b.c) {
                    case "ScrollBars":
                    case "ObjectDisplayStyle":
                        c = 1;
                        break;
                    case "Reset":
                        c = 1;
                        break;
                }
                break;
            case 99:
                c = 49;
                break;
            case 89:
                c = 257;
                break;
            case 87:
                switch (b.c) {
                    case "CellReferenceMode":
                        c = 17;
                        break;
                    case "Culture":
                    case "EditingCulture":
                    case "DateSystem":
                    case "Precision":
                    case "VolatileFormulaDirtied":
                        c = 5;
                        break;
                }
                break;
            case 93:
            case 94:
            case 95:
            case 96:
            case 97:
            case 98:
                c = 32768 | 1 | 5 | 3 | 8192;
                break;
            case 50:
                c = 5 | 3 | 64 | 17;
                break;
            case 18:
            case 51:
                c = 5 | 3 | 64;
                break;
            case 62:
                c = 515;
                break;
            case 21:
            case 63:
            case 64:
                c = 5 | 3;
                break;
            case 25:
            case 73:
            case 75:
            case 76:
            case 77:
            case 78:
            case 84:
            case 79:
                c = 5 | 3 | 8192;
                break;
            case 72:
                c = 5 | 8192;
                break;
            case 103:
                switch (b.c) {
                    case "SelectionMode":
                        c = this._au() | 128;
                        break;
                }
                break;
            case 74:
                switch (b.c) {
                    case "Filter":
                        c = 16384;
                        break;
                }
                break;
            case 12:
            case 31:
            case 32:
            case 33:
                c = 4096 | 16384;
                break;
            case 38:
            case 23:
            case 22:
            case 80:
                c = 16384;
                break;
            case 3:
            case 88:
            case 91:
            case 92:
            case 17:
            case 53:
            case 54:
            case 11:
            case 29:
            case 30:
            case 13:
            case 36:
            case 37:
            case 10:
            case 0:
            case 59:
            case 15:
            case 39:
            case 40:
            case 19:
            case 55:
            case 56:
            case 20:
            case 57:
            case 58:
            case 24:
            case 81:
            case 82:
            case 83:
            case 41:
            case 42:
            case 43:
            case 44:
            case 45:
            case 14:
            case 34:
            case 46:
            case 52: break;
            default: break;
        }
        if (c != 0) {
            this._at |= c;
            this._ht(65536);
        }
    }
    _he(a, b, c) {
        if (this._p.n) {
            this._p.g.k(a, b, c);
            this._ht(268435456);
        }
        if (a == this._bb && !this._b7(16384)) {
            if (b >= 0 && c >= 0) {
                this._p.af(b, c);
            }
            this._ip(8192, true);
            this._ht(16);
            this._cj = true;
        }
    }
    _hf(a) {
        this._p.k.n(true);
        this._p.z();
        if (!this._b7(16384)) {
            this._cj = true;
        }
    }
    _hg() {
        this._gs();
        this._ht(32 | 8 | 8192 | 1024 | 16);
        this._cj = true;
        this._jn(this._jo);
    }
    _hh() {
        this._p.ag();
    }
    _cu(a, b) {
        if (b) {
            let c = this._bb.displayOptions.magnificationInNormalView;
            let d = Math.max(10, Math.min(400, truncate(MathUtilities.f(c - a * 5))));
            for (let e of fromEnum(this._a2._j)) {
                e._j.displayOptions.magnificationInNormalView = d;
            }
        }
        else {
            let f = this.activePane != null ? this.getScrollableRegion(this.activePane.rowScrollRegion) : null;
            if (f != null) {
                let g = a < 0;
                let h = truncate(Math.max(1, MathUtilities.f(Math.abs(a)))) * (g ? -1 : 1);
                let i = f.startIndex + h;
                if (i < 0) {
                    i = 0;
                }
                else if (i >= this._bb._rows$i.maxCount) {
                    i = this._bb._rows$i.maxCount - 1;
                }
                else if (this._bb._eg(i)) {
                    let j = this._er(i, !g);
                    if (nullableNotEquals(j, null)) {
                        i = j.value;
                    }
                }
                return this._c2(f, i, this._ee, this._bb.workbook.maxRowCount, this._jj.height, runOn(this._bb, this._bb._cq), runOn(this._bb, this._bb._cp));
            }
        }
        return false;
    }
    _hk() {
        this._p.ah();
        this._cj = true;
    }
    _hm(a) {
        if (this._bb.isProtected && this._bb.protection.selectionMode == 1) {
            this._g3(a, 0, false);
        }
        else {
            this._hc(a, Nullable$1.toNullable(Boolean_$type, false));
        }
    }
    _hr() {
        if (this._cc) {
            this._jf(true);
        }
    }
    queueExpensiveOperation(a) {
        let b = new DisposableAction(a);
        this._dp.g(b);
        this._iv();
        return b;
    }
    _hu() {
        let a = this._bh;
        if (a != null) {
            a.reapplyFilters();
            a.reapplySortConditions();
        }
        else if (this._bb.filterSettings.region != null) {
            this._bb.filterSettings.reapplyFilters();
            this._bb.filterSettings.reapplySortConditions();
        }
    }
    _ag(a) {
        let b = SpreadsheetUtilities.ay(a);
        let c = this._bb._ic(b);
        b = c.p0;
        if (!b._n) {
            return a;
        }
        return SpreadsheetUtilities.z(b);
    }
    _hv() {
        this._p.z();
        this._al._j.al();
    }
    _cx(a, b) {
        this._jc();
        let c = SpreadsheetUtilities.w(this._bb, b.row, b.column);
        if (c != null) {
            if (a) {
                return c.g;
            }
            return c.n();
        }
        return false;
    }
    _hw(a, b = true) {
        if (a == false && this._b1(true, true)) {
            return;
        }
        if (nullableNotEquals(this._en(), false)) {
            let c = this._fj(128);
            if (nullableNotEquals(c, true)) {
                this._ea(new SpreadsheetUserPromptInfo(23, null, null, null, false));
                return;
            }
            else {
                let d = new LockedEditRangeInfoForOperation();
                let e;
                let f = this._cy(a, true, e, d, true);
                e = f.p2;
                let g = this._aw(d, e, b);
                switch (g) {
                    case 0: return;
                    case 1: break;
                    case 2:
                        this._hw(a, false);
                        return;
                }
            }
        }
        let h;
        let i = this._cy(a, false, h, null);
        h = i.p2;
    }
    _hy(a, b) {
        let c = this._bb.displayOptions;
        if (c.panesAreFrozen) {
            if (a) {
                c.frozenPaneSettings.frozenRows = 0;
            }
            if (b) {
                c.frozenPaneSettings.frozenColumns = 0;
            }
        }
        else {
            if (a) {
                c.unfrozenPaneSettings.topPaneHeight = 0;
            }
            if (b) {
                c.unfrozenPaneSettings.leftPaneWidth = 0;
            }
        }
    }
    _h0(a) {
        let b = this.activePane;
        let c = b != null ? b.selection : null;
        if (c != null) {
            let d = a ? c._bi : c._bf;
            if (d.count > 0) {
                let e = new List$1(IndexRange.$, 2, d.count);
                for (let f = 0; f < d.count; f++) {
                    e.add(new IndexRange(1, d.item(f)._i, d.item(f)._h));
                }
                for (let g of fromEnum(this._a2._j)) {
                    let h = g._j;
                    let i = h.defaultColumnWidth;
                    h._ik(e, i);
                }
            }
        }
    }
    _h1(a) {
        let b = this.activePane;
        let c = b != null ? b.selection : null;
        if (c != null) {
            let d = a ? c._bj : c._bg;
            if (d.count > 0) {
                let e = false;
                for (let f of fromEnum(this._a2._j)) {
                    let g = f._j;
                    let h = g._d4 ? g.defaultRowHeight : -1;
                    for (let i of fromEnum(d)) {
                        for (let j of fromEnum(g._rows$i._m(i._i, i._h))) {
                            if (this._c6(j, h)) {
                                e = true;
                            }
                        }
                    }
                }
                if (e) {
                    this._at |= 5 | 9;
                    this._ht(65536);
                }
            }
        }
    }
    _h9(a) {
        let b = this.activePane;
        if (null != b) {
            switch (a) {
                case 2:
                    this._c3(b.rowScrollRegion, 1, b.rowScrollRegion._x._ac);
                    break;
                case 3:
                    this._c3(b.rowScrollRegion, 4, b.rowScrollRegion._x._ac);
                    break;
                case 0:
                    this._c0(b.columnScrollRegion, 1, b.columnScrollRegion._x._ac);
                    break;
                case 1:
                    this._c0(b.columnScrollRegion, 4, b.columnScrollRegion._x._ac);
                    break;
            }
        }
    }
    _ia(a) {
        let b = this.activePane;
        if (null != b) {
            switch (a) {
                case 2:
                    this._c3(b.rowScrollRegion, 0, b.rowScrollRegion._x._ac);
                    break;
                case 3:
                    this._c3(b.rowScrollRegion, 3, b.rowScrollRegion._x._ac);
                    break;
                case 0:
                    this._c0(b.columnScrollRegion, 0, b.columnScrollRegion._x._ac);
                    break;
                case 1:
                    this._c0(b.columnScrollRegion, 3, b.columnScrollRegion._x._ac);
                    break;
            }
        }
    }
    _ib() {
        let a = this.activePane;
        if (a != null) {
            let b = a.selection;
            if (this._canSelect(b.activeCell)) {
                b.clearCellRanges();
            }
        }
    }
    _ic() {
        this._cz(this._aa());
    }
    _c4() {
        let a = this.activePane;
        if (a == null) {
            return false;
        }
        let b = a.selection;
        let c = b.activeCell;
        let d = this._bb._rows$i._aj(c.row);
        if (d != null) {
            let e = typeCast(ArrayFormula.$, d.getCellFormula(c.column));
            if (e != null) {
                let f = e.blockedRegion;
                let g = SpreadsheetUtilities.z(f._h);
                if (this._canSelect1(g)) {
                    b._resetSelection2(g, c, false);
                }
                return true;
            }
        }
        return false;
    }
    _id() {
        let a = this.activePane;
        if (a == null) {
            return;
        }
        let b = a.selection;
        let c = b.activeCell;
        let d = this._getCellRange1(c.row, c.column);
        let e = b._s();
        let f = false;
        let g = SpreadsheetUtilities.ay(e);
        let h = SpreadsheetCellRange.empty;
        let i = this._bj(g, c);
        if (i != null) {
            let j = i._by;
            if (!j._h(g) && j._i(c.row, c.column)) {
                h = SpreadsheetUtilities.z(j);
            }
            else if (WorksheetRegionAddress._o(j, g) || !j._h(g)) {
                f = true;
            }
            else {
                let k = i.dataAreaRegion;
                if (k == null) {
                    f = true;
                }
                else {
                    let l = k._h;
                    if (l._h(g) && WorksheetRegionAddress._q(l, g)) {
                        h = SpreadsheetUtilities.z(l);
                    }
                    else {
                        h = SpreadsheetUtilities.z(j);
                    }
                }
            }
        }
        if (f) {
            h = this._aa();
        }
        else if (h.isEmpty) {
            h = this._z(d);
            if (SpreadsheetCellRange.l_op_Equality(d, h) || !h._contains1(e) || SpreadsheetCellRange.l_op_Equality(e, h)) {
                h = this._aa();
            }
        }
        if (this._canSelect1(h)) {
            b._replaceActiveCellRange1(h, c);
        }
    }
    _ie(a) {
        let b = this.activePane.selection;
        let c = b._s();
        let d = this._aa();
        let e = SpreadsheetUtilities.ay(c);
        let f = this._bj(e, b.activeCell);
        if (f != null) {
            let g = f._by;
            if (g._h(e)) {
                let h = new IntRange(), i = new IntRange(), j = new IntRange();
                if (a == false) {
                    h = new IntRange(1, g._ac, g._ae);
                    i = new IntRange(1, e._ac, e._ae);
                }
                else {
                    h = new IntRange(1, g._w, g._x);
                    i = new IntRange(1, e._w, e._x);
                }
                if (!h.equals(i)) {
                    let k = f.dataAreaRegion;
                    if (k != null) {
                        let l = k._h;
                        j = a == false ? new IntRange(1, l._ac, l._ae) : new IntRange(1, l._w, l._x);
                        let m = new IntRange();
                        if (i._i < j._i || i._h > j._h || i.equals(j)) {
                            m = h;
                        }
                        else {
                            m = j;
                        }
                        if (a == false) {
                            d = new SpreadsheetCellRange(m._i, d.firstColumn, m._h, d.lastColumn);
                        }
                        else {
                            d = new SpreadsheetCellRange(d.firstRow, m._i, d.lastRow, m._h);
                        }
                    }
                }
            }
        }
        if (a) {
            c = new SpreadsheetCellRange(c.firstRow, d.firstColumn, c.lastRow, d.lastColumn);
        }
        else {
            c = new SpreadsheetCellRange(d.firstRow, c.firstColumn, d.lastRow, c.lastColumn);
        }
        c = this.extendRangeForMergedCells(c);
        if (this._canSelect1(c)) {
            b._replaceActiveCellRange1(c, b.activeCell);
        }
    }
    _ig(a) {
        let b = this._bh;
        if (b != null) {
            let c = this.activePane.selection;
            let d = c._s();
            let e = b._by;
            let f = b.dataAreaRegion._h;
            let g = new SpreadsheetCellRange(a ? e._ac : Math.min(c.activeCell.row, f._ac), Math.max(d.firstColumn, e._w), a ? e._ae : Math.max(c.activeCell.row, f._ae), Math.min(d.lastColumn, e._x));
            c._replaceActiveCellRange1(g, c.activeCell);
        }
    }
    _ih() {
        let a = this._bh;
        if (a != null) {
            let b = this.activePane.selection;
            let c = b._s();
            let d = a._by;
            let e = new SpreadsheetCellRange(Math.max(c.firstRow, d._ac), d._w, Math.min(c.lastRow, d._ae), d._x);
            b._replaceActiveCellRange1(e, b.activeCell);
        }
    }
    _ii() {
        let a = this.activePane;
        if (a != null) {
            let b = a.selection;
            let c = Enumerable.a(SpreadsheetCellRange.$, b.cellRanges);
            let d = new List$1(SpreadsheetCellRange.$, 0);
            let e = new List$1(IntRange.$, 0);
            let f = b.activeCellRangeIndex;
            let g = b.activeCell;
            let h = -1;
            for (let i = 0; i < c.length; i++) {
                let j = c[i];
                let k, l;
                k = l = Nullable$1.toNullable(Number_$type, null);
                e.clear();
                for (let m = j.firstColumn; m <= j.lastColumn; m++) {
                    let n = this._bb._cb(m);
                    if (n.i) {
                        if (nullableNotEquals(k, null)) {
                            e.add(new IntRange(1, k.value, l.value));
                            k = l = Nullable$1.toNullable(Number_$type, null);
                        }
                        m = n.r;
                    }
                    else {
                        if (nullableEquals(k, null)) {
                            k = Nullable$1.toNullable(Number_$type, Math.max(n.q, j.firstColumn));
                        }
                        l = Nullable$1.toNullable(Number_$type, Math.min(n.r, j.lastColumn));
                    }
                }
                if (nullableNotEquals(k, null)) {
                    e.add(new IntRange(1, k.value, l.value));
                }
                if (e.count == 0) {
                    continue;
                }
                let o = SpreadsheetPaneManager._e4(j.firstRow, j.lastRow, this._bb);
                let p = this._bb._dv;
                let q;
                let r = this._bb._rows$i;
                while (nullableNotEquals(o, null)) {
                    q = Nullable$1.toNullable(Number_$type, null);
                    let s = false;
                    for (let t of fromEnum(r._m(o.value + 1, j.lastRow))) {
                        if (t.hidden) {
                            s = true;
                            if (p == false) {
                                q = Nullable$1.toNullable(Number_$type, t.index - 1);
                            }
                            break;
                        }
                        else {
                            if (p == false) {
                                q = Nullable$1.toNullable(Number_$type, t.index);
                            }
                            else if (nullableNotEquals(q, t.index - 1)) {
                                s = true;
                                break;
                            }
                        }
                    }
                    if (nullableEquals(q, null)) {
                        if (p) {
                            q = o;
                        }
                        else {
                            q = Nullable$1.toNullable(Number_$type, j.lastRow);
                        }
                    }
                    else if (!s && !p) {
                        q = Nullable$1.toNullable(Number_$type, j.lastRow);
                    }
                    for (let u = 0; u < e.count; u++) {
                        d.add(new SpreadsheetCellRange(o.value, e._inner[u]._i, q.value, e._inner[u]._h));
                        if (i == f && d._inner[d.count - 1]._contains(g)) {
                            h = d.count - 1;
                        }
                    }
                    o = SpreadsheetPaneManager._e4(q.value + 2, j.lastRow, this._bb);
                }
            }
            if (d.count > 0) {
                if (h < 0) {
                    h = 0;
                    g = d._inner[0]._c;
                }
                b._resetSelection(d.toArray(), g, h);
            }
        }
    }
    _il(a) {
        let b = this._bh;
        if (b != null) {
            if (a) {
                b.isHeaderRowVisible = true;
                b.isFilterUIVisible = true;
            }
            else {
                b.clearFilters();
                b.clearSortConditions();
                b.isFilterUIVisible = false;
            }
        }
        else {
            let c = this._bb.filterSettings;
            if (c.region != null) {
                if (!a) {
                    c.clearRegion();
                }
            }
            else if (a) {
                let d = this.activePane.selection;
                if (d.cellRanges.count > 1) {
                    this._ea(new SpreadsheetUserPromptInfo(7, null, null, null, false));
                }
                else {
                    let e;
                    let f;
                    let g = ((() => { let h = this._ae(false, e, f); e = h.p1; f = h.p2; return h.ret; })());
                    if (g.isEmpty) {
                        this._ea(new SpreadsheetUserPromptInfo(30, null, null, null, false));
                    }
                    else {
                        c._setRegion1(g._toString1(1), 1);
                    }
                }
            }
        }
    }
    _im(a, b, c, d) {
        if (nullableNotEquals(this._fj(4), true)) {
            this._ea(new SpreadsheetUserPromptInfo(23, null, null, null, false));
            return;
        }
        let e = this._aa();
        let f = new SpreadsheetPaneManager_SetBorderHelper(b, c, d);
        let g = (b & (64 | 128)) != 0;
        let h = d == 0;
        for (let i of fromEnum(this._a2._j)) {
            let j = i._j;
            let k = new Array(1);
            for (let l of fromEnum(a)) {
                k[0] = l;
                let m = SpreadsheetUtilities.ay(l);
                let n = l.firstRow <= e.firstRow && l.lastRow >= e.lastRow;
                if (n) {
                    let o = j._columns$i;
                    if ((b & 16) == 16) {
                        for (let p = l.firstColumn; p <= l.lastColumn; p++) {
                            f.o(o.item(p).cellFormat);
                        }
                    }
                    if ((b & 32) == 32) {
                        for (let q = l.firstColumn + 1; q <= l.lastColumn; q++) {
                            f.j(o.item(q).cellFormat);
                        }
                    }
                    if ((b & 1) == 1) {
                        f.j(o.item(l.firstColumn).cellFormat);
                    }
                    if ((b & 4) == 4) {
                        f.m(o.item(l.lastColumn).cellFormat);
                    }
                    for (let r of fromEnum(j._mergedCellsRegions$i)) {
                        if (r._ad > 1 && m._h(r._h)) {
                            f.l(r, m, false, true);
                        }
                    }
                    if (g) {
                        for (let s = l.firstColumn; s <= l.lastColumn; s++) {
                            f.h(o.item(s)._cellFormatInternal);
                        }
                        let t = l.firstColumn;
                        let u = l.lastColumn;
                        for (let v of fromEnum(j._rows$i)) {
                            if (v._hasCellFormat && (h == false || v._cellFormatInternal.d._aw != 1)) {
                                for (let w = l.firstColumn; w <= l.lastColumn; w++) {
                                    f.h(v._bc(w));
                                }
                            }
                            else {
                                v._dj(t, u, runOn(f, f.i));
                            }
                        }
                    }
                }
                else {
                    let x = l.firstColumn <= e.firstColumn && l.lastColumn >= e.lastColumn;
                    let y = j._rows$i;
                    if (x) {
                        if ((b & 16) == 16) {
                            for (let z = l.firstRow + 1; z <= l.lastRow; z++) {
                                f.n(y.item(z).cellFormat);
                            }
                        }
                        if ((b & 32) == 32) {
                            for (let aa = l.firstRow; aa <= l.lastRow; aa++) {
                                f.k(y.item(aa).cellFormat);
                            }
                        }
                        if ((b & 2) == 2) {
                            f.n(y.item(l.firstRow).cellFormat);
                        }
                        if ((b & 8) == 8) {
                            f.g(y.item(l.lastRow).cellFormat);
                        }
                        for (let ab of fromEnum(j._mergedCellsRegions$i)) {
                            if (ab._aa > 1 && m._h(ab._h)) {
                                f.l(ab, m, true, false);
                            }
                        }
                        if (g) {
                            let ac = j._columns$i.maxCount;
                            for (let ad = l.firstRow; ad <= l.lastRow; ad++) {
                                let ae = y.item(ad);
                                f.h(ae._cellFormatInternal);
                                ae._dj(0, ac, runOn(f, f.i));
                            }
                        }
                    }
                    else {
                        for (let af = l.firstRow; af <= l.lastRow; af++) {
                            let ag = y.item(af);
                            for (let ah = l.firstColumn; ah <= l.lastColumn; ah++) {
                                let ai = ag.getCellAssociatedMergedCellsRegion(ah);
                                if (ai == null) {
                                    let aj = ag._bc(ah);
                                    if (af == l.firstRow) {
                                        if ((b & 2) == 2) {
                                            f.n(aj);
                                        }
                                    }
                                    else if ((b & 16) == 16) {
                                        f.n(aj);
                                    }
                                    if (l.lastRow == af) {
                                        if ((b & 8) == 8) {
                                            f.g(aj);
                                        }
                                    }
                                    else if ((b & 16) == 16) {
                                        f.g(aj);
                                    }
                                    if (ah == l.firstColumn) {
                                        if ((b & 1) == 1) {
                                            f.j(aj);
                                        }
                                    }
                                    else if ((b & 32) == 32) {
                                        f.j(aj);
                                    }
                                    if (l.lastColumn == ah) {
                                        if ((b & 4) == 4) {
                                            f.m(aj);
                                        }
                                    }
                                    else if ((b & 32) == 32) {
                                        f.m(aj);
                                    }
                                    if (g) {
                                        f.h(aj);
                                    }
                                }
                                else if (m._h(ai._h) && af == ai.firstRow) {
                                    f.l(ai, m, true, true);
                                    if (g) {
                                        f.h(ai._cellFormatInternal);
                                    }
                                    ah = ai.lastColumn;
                                }
                            }
                        }
                    }
                }
            }
        }
    }
    _io($t, a, b, c, d, e = false) {
        let f = this._aa();
        if ((d & 1048576) == 1048576) {
            let g = this._ez(c);
            if (nullableNotEquals(null, g)) {
                this._ea(new SpreadsheetUserPromptInfo(g.value, null, null, null, false));
                return;
            }
        }
        if (nullableNotEquals(this._fj(4), true)) {
            this._ea(new SpreadsheetUserPromptInfo(23, null, null, null, false));
            return;
        }
        for (let h of fromEnum(this._a2._j)) {
            let i = h._j;
            let j = e ? new HashSet$1(Number_$type, 0) : null;
            for (let k of fromEnum(c)) {
                let l = SpreadsheetUtilities.ay(k);
                let m = k.firstRow <= f.firstRow && k.lastRow >= f.lastRow;
                if (m) {
                    let n = i._columns$i;
                    for (let o = k.firstColumn; o <= k.lastColumn; o++) {
                        b(n.item(o)._cellFormatInternal, a);
                    }
                    for (let p of fromEnum(i._mergedCellsRegions$i)) {
                        if (p._ad > 1) {
                            if (l._h(p._h)) {
                                b(p._cellFormatInternal, a);
                            }
                        }
                    }
                }
                else {
                    let q = k.firstColumn <= f.firstColumn && k.lastColumn >= f.lastColumn;
                    let r = i._rows$i;
                    if (q) {
                        for (let s = k.firstRow; s <= k.lastRow; s++) {
                            b(r.item(s)._cellFormatInternal, a);
                        }
                        for (let t of fromEnum(i._mergedCellsRegions$i)) {
                            if (t._aa > 1) {
                                if (l._h(t._h)) {
                                    b(t._cellFormatInternal, a);
                                }
                            }
                        }
                    }
                    else {
                        for (let u = k.firstRow; u <= k.lastRow; u++) {
                            let v = r.item(u);
                            for (let w = k.firstColumn; w <= k.lastColumn; w++) {
                                if (j == null || j.add_1((v.index << 32) + w)) {
                                    let x = v.getCellAssociatedMergedCellsRegion(w);
                                    if (x != null && !l._h(x._h)) {
                                        continue;
                                    }
                                    b(v._bc(w), a);
                                }
                            }
                        }
                    }
                }
            }
        }
    }
    _is(a) {
        for (let b of fromEnum(this._a2._j)) {
            b._j.displayOptions.magnificationInNormalView = a;
        }
    }
    _iq(a) {
        for (let b of fromEnum(this._a2._j)) {
            b._j.displayOptions.showGridlines = a;
        }
    }
    _ir(a) {
        for (let b of fromEnum(this._a2._j)) {
            b._j.displayOptions.showRowAndColumnHeaders = a;
        }
    }
    _it(a, b) {
        if (!this._b9) {
            let c = this._bb.displayOptions.unfrozenPaneSettings;
            if (this._cv()) {
                this._jn(this._ji);
                if (a && c.topPaneHeight > 0) {
                    let d = this._dn.item(0)._bk;
                    if (CoreUtilities.c(d, 0) == false) {
                        let e = Enumerable.ah(WorksheetItemPosition.$, this._dn.item(0)._m);
                        let f = this._dz(e._i);
                        let g = d < f / 2 ? d : d - f;
                        c.topPaneHeight += this._ef(g);
                    }
                }
                if (b && c.leftPaneWidth > 0) {
                    let h = this._dh.item(0)._bk;
                    if (CoreUtilities.c(h, 0) == false) {
                        let i = Enumerable.ah(WorksheetItemPosition.$, this._dh.item(0)._m);
                        let j = this._dy(i._i);
                        let k = h < j / 2 ? h : h - j;
                        c.leftPaneWidth += this._ef(k);
                    }
                }
            }
        }
    }
    _iu(a, b, c) {
        let d = b ? 0 : 1;
        let e = this._q(c);
        if (e == null) {
            return;
        }
        let f = e.c;
        let g;
        switch (a) {
            case 0:
                g = new OrderedSortCondition(d);
                break;
            case 3:
                let h = this._bb._getCellConditionalFormat1(f.o, f.m);
                g = h == null || h.iconInfo == null || h.iconInfo.icon == -1 ? new IconSortCondition(true, 0, Nullable$1.toNullable(Number_$type, null)) : new IconSortCondition(true, ExcelUtils.ak(h.iconInfo.iconSet), Nullable$1.toNullable(Number_$type, intSToU(h.iconInfo.iconIndex)));
                break;
            case 1:
            case 2:
                {
                    let i = this._bb._rows$i._aj(f.o);
                    let j = this._bb._b4(i, f.m);
                    let k = this._bb._getCellConditionalFormat1(f.o, f.m);
                    if (a == 1) {
                        g = new FontColorSortCondition(k != null && k.cellFormat != null && WorkbookColorInfo.l_op_Inequality(k.cellFormat.font.colorInfo, null) ? k.cellFormat.font.colorInfo : j._bh);
                    }
                    else {
                        g = new FillSortCondition(k != null && k.cellFormat != null && k.cellFormat.fill != null ? k.cellFormat.fill : j._ar);
                    }
                }
                break;
            default: return;
        }
        let l = e.e;
        let m = e.d;
        if (l != null) {
            let n = l._columns$i._item(f.m - l._by._w);
            l.clearSortConditions();
            l.sortSettings._sortConditions$i._addItem$i(n, g);
        }
        else if (this._bb.filterSettings.region != null && WorksheetRegionAddress._o(m, this._bb.filterSettings.region._h)) {
            let o = this._bb.filterSettings.sortSettings._sortConditions$i;
            o.clear();
            o._addItem$i(new RelativeIndex(f.m - this._bb.filterSettings.region.firstColumn), g);
        }
        else {
            let p = m._ah(true, true, this._bb.workbook.currentFormat, 1);
            let q = this._bb.sortSettings;
            q.clearRegion();
            q._setRegion1(p, 1);
            q.sortType = 0;
            q._sortConditions$i._addItem$i(new RelativeIndex(f.m - m._w), g);
        }
    }
    _ix() {
        let a = !this._bb.displayOptions.showFormulasInCells;
        for (let b of fromEnum(this._a2._j)) {
            b._j.displayOptions.showFormulasInCells = a;
        }
    }
    _iy(a) {
        if (this._cv() == false) {
            return;
        }
        let b = this._bb.displayOptions;
        let c = b.frozenPaneSettings;
        let d = b.unfrozenPaneSettings;
        let e = this._dn.count > 1;
        let f = this._dh.count > 1;
        let g = f || e;
        let h = b.panesAreFrozen && g;
        let i = !h && g;
        let j = false;
        if (a) {
            d.firstColumnInLeftPane = this._dh.item(0).startIndex;
            d.firstRowInTopPane = this._dn.item(0).startIndex;
            if (h) {
                if (c._z) {
                    c._z = false;
                    if (e) {
                        d.topPaneHeight = this._ef(this._dx + this._dn.item(0).actualExtent);
                        d.firstRowInBottomPane = this._dn.item(1).startIndex;
                    }
                    else {
                        d.topPaneHeight = 0;
                    }
                    if (f) {
                        d.leftPaneWidth = this._ef(this._d2 + this._dh.item(0).actualExtent);
                        d.firstColumnInRightPane = this._dh.item(1).startIndex;
                    }
                    else {
                        d.leftPaneWidth = 0;
                    }
                }
                else {
                    d.leftPaneWidth = 0;
                    d.topPaneHeight = 0;
                    j = true;
                }
                b.panesAreFrozen = false;
            }
            else if (i) {
                if (f) {
                    let k = this._dh.item(0).endIndex - this._dh.item(0).startIndex;
                    if (k == 0 || this._dh.item(0)._bk < this._dy(Enumerable.ah(WorksheetItemPosition.$, this._dh.item(0)._m)._i) / 2) {
                        k++;
                    }
                    c.frozenColumns = k;
                    c.firstColumnInRightPane = this._dh.item(1).startIndex;
                }
                else {
                    c.frozenColumns = 0;
                }
                if (e) {
                    let l = this._dn.item(0).endIndex - this._dn.item(0).startIndex;
                    if (l == 0 || this._dn.item(0)._bk < this._dz(Enumerable.ah(WorksheetItemPosition.$, this._dn.item(0)._m)._i) / 2) {
                        l++;
                    }
                    c.frozenRows = l;
                    c.firstRowInBottomPane = this._dn.item(1).startIndex;
                }
                else {
                    c.frozenRows = 0;
                }
                c._z = true;
                b.panesAreFrozen = true;
            }
            else {
                let m = this._r();
                let n = Math.max(m.column - this._dh.item(0).startIndex, 0);
                let o = Math.max(m.row - this._dn.item(0).startIndex, 0);
                if (n > 0 || o > 0) {
                    c.frozenRows = o;
                    c.frozenColumns = n;
                    c.firstRowInBottomPane = m.row;
                    c.firstColumnInRightPane = m.column;
                    b.panesAreFrozen = true;
                }
            }
        }
        else {
            if (h) {
                c._z = true;
                this._iy(true);
            }
            else if (i) {
                d.firstColumnInLeftPane = this._dh.item(0).startIndex;
                d.firstRowInTopPane = this._dn.item(0).startIndex;
                d.leftPaneWidth = 0;
                d.topPaneHeight = 0;
                j = true;
            }
            else {
                let p = this._r();
                let q = this._bb._cp(p.row)._m - this._bb._cp(this._dn.item(0).startIndex)._m;
                let r = this._bb._cn(p.column)._m - this._bb._cn(this._dh.item(0).startIndex)._m;
                d.firstColumnInLeftPane = this._dh.item(0).startIndex;
                d.firstRowInTopPane = this._dn.item(0).startIndex;
                if (q > 0) {
                    d.firstRowInBottomPane = p.row;
                }
                if (r > 0) {
                    d.firstColumnInRightPane = p.column;
                }
                let s = this._d8;
                d.leftPaneWidth = r > 0 ? truncate(MathUtilities.f(this._bb._fl(r, 5, true) * s)) + this._ef(this._d2) : 0;
                d.topPaneHeight = q > 0 ? truncate(MathUtilities.f(q * s)) + this._ef(this._dx) : 0;
            }
        }
        if (j && b._z != 3) {
            let t = b._af.a(b._z);
            if (t != null) {
                let u = b._af.a(3);
                if (u != null) {
                    b._af.b.remove(u);
                }
                t.a = 3;
            }
        }
    }
    _i3(a = true) {
        let b = this._dl.count > 0;
        if (!b) {
            this.activePane = null;
        }
        else {
            this.activePane = this._as(Nullable$1.toNullable(Boolean_$type, null));
        }
        if (a && this.activePane != null) {
            this.activePane.selection._by();
        }
    }
    _i5() {
        this._jc();
    }
    _c7(a, b, c, d) {
        if (a != null && this._a2._j.count > 1) {
            for (let e of fromEnum(this._a2._j)) {
                if (e._j == this._bb || e._j.isProtected == false) {
                    continue;
                }
                let f = a.a(e._j);
                for (let g of fromEnum(b)) {
                    if (SpreadsheetPaneManager._cp(e._j, g.firstRow, g.firstColumn, g.lastRow, g.lastColumn, f) == false) {
                        if (this._ea(new SpreadsheetUserPromptInfo(23, null, null, null, c))) {
                            d = 1;
                        }
                        else {
                            d = 0;
                        }
                        return {
                            ret: false,
                            p3: d
                        };
                    }
                }
            }
        }
        d = 2;
        return {
            ret: true,
            p3: d
        };
    }
    _c8(a, b, c) {
        for (let d of fromEnum(b)) {
            if (d._ac < 0 || d._w < 0 || d._ae >= this._bb._rows$i.maxCount || d._x >= this._bb._columns$i.maxCount) {
                return this._ea(new SpreadsheetUserPromptInfo(10, null, null, null, false));
            }
        }
        if (nullableNotEquals(this._en(), false)) {
            let e = this._ay(a, b, false, void 0, c);
            if (e == 2) {
                e = this._ay(a, b, false, void 0, false);
            }
            return e == 1;
        }
        return true;
    }
    _c9() {
        if (nullableEquals(this._en(), false)) {
            return true;
        }
        let a = this.activePane;
        if (a == null) {
            return false;
        }
        let b = a._ag;
        let c = this._ax(b, false);
        if (c == 2) {
            c = this._ax(b, false, void 0, false);
        }
        return c == 1;
    }
    _da() {
        if (nullableEquals(this._en(), false)) {
            return true;
        }
        let a = this.activePane;
        if (a == null) {
            return false;
        }
        let b = a._ag;
        return this._ax(b, true) != 0;
    }
    _je(a) {
        switch (a) {
            case 0:
                {
                    let b = this._bb.displayOptions.magnificationInNormalView + 10;
                    b = Math.min(b - (b % 10), 400);
                    for (let c of fromEnum(this._a2._j)) {
                        c._j.displayOptions.magnificationInNormalView = b;
                    }
                }
                break;
            case 1:
                {
                    let d = this._bb.displayOptions.magnificationInNormalView - 1;
                    d = Math.max(d - (d % 10), 10);
                    for (let e of fromEnum(this._a2._j)) {
                        e._j.displayOptions.magnificationInNormalView = d;
                    }
                }
                break;
            case 3:
                {
                    this._ip(524288, true);
                    for (let f of fromEnum(this._a2._j)) {
                        f._j.displayOptions.magnificationInNormalView = 100;
                    }
                }
                break;
            case 2:
                this._jf(false);
                break;
        }
    }
    _fv(a) {
        this.activePane = this._as(Nullable$1.toNullable(Boolean_$type, a));
    }
    _bo(a, b, c, d, e, f) {
        let g = null;
        if (b != null) {
            for (let h = 0; h < b.count; h++) {
                let i = b.item(h);
                if (i.d == c && i.c == d && i.b == e) {
                    g = i;
                    break;
                }
            }
        }
        let j = false;
        if (g == null) {
            g = new SpreadsheetDropDownButton();
            g.d = c;
            g.c = d;
            g.b = e;
            j = true;
        }
        if (g.a != f) {
            g.a = f;
            j = true;
        }
        a.add(g);
        return j;
    }
    _fz() {
    }
    _f0(a, b) {
        {
            let c = this._a9();
            try {
                let d = new CellSizeMeasurementContext(this._bb.workbook, c);
                for (let e of fromEnum(this._a2._j)) {
                    let f = e._j;
                    let g = new Dictionary$2(Number_$type, Number_$type, 0);
                    if (a.length <= 1) {
                        b = false;
                    }
                    for (let i = 0; i < a.length; i++) {
                        let h = a[i];
                        for (let j = h.firstColumn; j <= h.lastColumn; j++) {
                            let k = f._columns$i.item(j);
                            let l = k._ay(h.firstRow, h.lastRow, d);
                            if (l.hasValue) {
                                let m = l.value;
                                if (b) {
                                    let n;
                                    if (((() => { let o = g.tryGetValue(j, n); n = o.p1; return o.ret; })())) {
                                        m = Math.max(n, m);
                                    }
                                    g.item(j, m);
                                }
                                else {
                                    k.hidden = false;
                                    k.width = m;
                                }
                            }
                        }
                    }
                    if (b) {
                        for (let o of fromEnum(g)) {
                            let p = f._columns$i.item(o.key);
                            p.hidden = false;
                            p.width = o.value;
                        }
                    }
                }
            }
            finally {
                if (c != null) {
                    c.dispose();
                }
            }
        }
    }
    _x() {
        return this._af(true);
    }
    _ax(a, b, c = true, d = true) {
        let e = b ? null : new LockedEditRangeInfoForOperation();
        let f = true;
        for (let g of fromEnum(this._a2._j)) {
            if (false == (f = SpreadsheetPaneManager._co(g._j, a, e))) {
                break;
            }
        }
        if (b) {
            if (f) {
                return 1;
            }
            this._ea(new SpreadsheetUserPromptInfo(23, null, null, e, false));
            return 0;
        }
        return this._aw(e, c, d);
    }
    _ay(a, b, c, d = true, e = true) {
        let f = c ? null : new LockedEditRangeInfoForOperation();
        let g = true;
        for (let h of fromEnum(a)) {
            let i = f != null ? f.a(h) : null;
            for (let j of fromEnum(b)) {
                if (false == (g = SpreadsheetPaneManager._cp(h, j._ac, j._w, j._ae, j._x, i))) {
                    break;
                }
            }
            if (g == false) {
                break;
            }
        }
        if (c) {
            if (g) {
                return 1;
            }
            this._ea(new SpreadsheetUserPromptInfo(23, null, null, f, false));
            return 0;
        }
        return this._aw(f, d, e);
    }
    _aw(a, b = true, c = true) {
        let d = a.b();
        let e;
        if (!d) {
            if (a.e(false).count > 0) {
                e = 24;
            }
            else {
                e = 23;
            }
        }
        else if (b == false && a.e(false).count == 0) {
            return 0;
        }
        else {
            let f = a.e(true);
            if (f.count == 0) {
                return 1;
            }
            let g = this._al._x;
            if (c && g != null) {
                let h = g(a);
                if (h == false) {
                    return 0;
                }
                let i = a.e(true);
                if (f.count == i.count) {
                    e = 24;
                }
                else if (i.count == 0) {
                    return 1;
                }
                else {
                    return 2;
                }
            }
            else {
                e = 23;
            }
        }
        this._ea(new SpreadsheetUserPromptInfo(e, null, null, a, false));
        return 0;
    }
    _f8(a, b, c, d) {
        for (let e = c; e <= d; e++) {
            if (this._b0(e, a)) {
                b = a;
                return {
                    p1: b
                };
            }
        }
        return {
            p1: b
        };
    }
    _f9(a, b, c, d, e, f, g, h) {
        let i = this._bb._es;
        let j;
        if (nullableGreaterThan(b, f)) {
            if (nullableNotEquals(e, null)) {
                if (((() => { let k = i.tryGetValue(new WorksheetCellAddress(1, e.value, f.value), j); j = k.p1; return k.ret; })()) && this._bz(j)) {
                    a = e.value;
                    b = f.value;
                }
            }
            if (nullableNotEquals(g, null)) {
                if (((() => { let k = i.tryGetValue(new WorksheetCellAddress(1, g.value, f.value), j); j = k.p1; return k.ret; })()) && this._bz(j)) {
                    c = g.value;
                    b = f.value;
                }
            }
        }
        if (nullableLessThan(d, h)) {
            if (nullableNotEquals(e, null)) {
                if (((() => { let k = i.tryGetValue(new WorksheetCellAddress(1, e.value, h.value), j); j = k.p1; return k.ret; })()) && this._bz(j)) {
                    a = e.value;
                    d = h.value;
                }
            }
            if (nullableNotEquals(g, null)) {
                if (((() => { let k = i.tryGetValue(new WorksheetCellAddress(1, g.value, h.value), j); j = k.p1; return k.ret; })()) && this._bz(j)) {
                    c = g.value;
                    d = h.value;
                }
            }
        }
        let k = a;
        let l = b;
        let m = c;
        let n = d;
        if (nullableEquals(a, e)) {
            for (let o = b; o < d; o++) {
                if (((() => { let p = i.tryGetValue(new WorksheetCellAddress(1, a, o), j); j = p.p1; return p.ret; })())) {
                    let p = j._h;
                    if (this._bz(j)) {
                        if (p._w < b) {
                            l = p._w;
                        }
                        if (p._x > d) {
                            n = p._x;
                        }
                        if (p._ac < a) {
                            k = p._ac;
                        }
                    }
                    o = p._x;
                }
            }
        }
        if (nullableEquals(c, g)) {
            for (let q = b; q < d; q++) {
                if (((() => { let r = i.tryGetValue(new WorksheetCellAddress(1, c, q), j); j = r.p1; return r.ret; })())) {
                    let r = j._h;
                    if (this._bz(j)) {
                        if (r._w < b) {
                            l = r._w;
                        }
                        if (r._x > d) {
                            n = r._x;
                        }
                        if (r._ae > c) {
                            m = r._ae;
                        }
                    }
                    q = r._x;
                }
            }
        }
        if (nullableEquals(b, f)) {
            for (let s = a; s < c; s++) {
                if (((() => { let t = i.tryGetValue(new WorksheetCellAddress(1, s, b), j); j = t.p1; return t.ret; })())) {
                    let t = j._h;
                    if (this._bz(j)) {
                        if (t._ac < a) {
                            k = t._ac;
                        }
                        if (t._ae > c) {
                            m = t._ae;
                        }
                        if (t._w < b) {
                            l = t._w;
                        }
                    }
                    s = t._ae;
                }
            }
        }
        if (nullableEquals(d, h)) {
            for (let u = a; u < c; u++) {
                if (((() => { let v = i.tryGetValue(new WorksheetCellAddress(1, u, d), j); j = v.p1; return v.ret; })())) {
                    let v = j._h;
                    if (this._bz(j)) {
                        if (v._ac < a) {
                            k = v._ac;
                        }
                        if (v._ae > c) {
                            m = v._ae;
                        }
                        if (v._x > d) {
                            n = v._x;
                        }
                    }
                    u = v._ae;
                }
            }
        }
        if (nullableLessThanOrEqual(k, e) || nullableGreaterThanOrEqual(m, g) || nullableLessThanOrEqual(l, f) || nullableGreaterThanOrEqual(n, h)) {
            let w = new WorksheetRegionAddress(1, k, m, l, n);
            let x = this._bb._hi(w);
            w = x.p0;
            k = w._ac;
            l = w._w;
            m = w._ae;
            n = w._x;
        }
        a = k;
        b = l;
        c = m;
        d = n;
        return {
            p0: a,
            p1: b,
            p2: c,
            p3: d
        };
    }
    _ga(a, b, c, d, e, f, g) {
        if (e._aj(a) != null) {
            if (nullableNotEquals(f, null) && this._b0(a, f.value)) {
                b = a;
                c = f.value;
            }
            if (nullableNotEquals(g, null) && this._b0(a, g.value)) {
                b = a;
                d = g.value;
            }
            if (b != a) {
                for (let h = c; h <= d; h++) {
                    if (this._b0(a, h)) {
                        b = a;
                        break;
                    }
                }
            }
        }
        return {
            p1: b,
            p2: c,
            p3: d
        };
    }
    _ef(a) {
        if (this._al._t) {
            return SpreadsheetUtilities.ck(Workbook._ey(this._bb.workbook, a, false, false));
        }
        return truncate(MathUtilities.f(Workbook._ep(this._bb.workbook, a, false)));
    }
    convertTwipsToPixels(a, b) {
        if (this._al._t) {
            return Workbook._ey(this._bb.workbook, SpreadsheetUtilities.b4(a), b, true);
        }
        return Workbook._er(this._bb.workbook, a, b, false);
    }
    _a9() {
        if (this._al._j != null) {
            return this._al._j.j();
        }
        return Workbook._br(this._bb.workbook);
    }
    static _dc() {
        let a = new Dictionary$2(SpreadsheetPaneManager_InternalFlags_$type, String_$type, 0);
        for (let b of fromEnum(CoreUtilities.k(SpreadsheetPaneManager_InternalFlags_$type))) {
            a.item(b, EnumUtil.getName(SpreadsheetPaneManager_InternalFlags_$type, b));
        }
        return a;
    }
    _by(a, b, c, d, e) {
        if (!e._contains(a)) {
            return false;
        }
        if (d && !this._cr(a.row, a.column)) {
            return false;
        }
        if (b) {
            if (nullableEquals(SpreadsheetPaneManager._e3(a.column, a.column, this._bb), null)) {
                return false;
            }
        }
        else {
            if (nullableEquals(SpreadsheetPaneManager._e4(a.row, a.row, this._bb), null)) {
                return false;
            }
        }
        switch (c) {
            case 1: return this._b0(a.row, a.column);
            case 2: return this._b0(a.row, a.column) || this._bi(a.row, a.column) != null;
            case 0: return true;
            default: return true;
        }
    }
    _gk() {
        if (this._au() == 2048) {
            let a = this.activePane;
            let b = a != null ? a.selection : null;
            if (b != null) {
                this._g3(1, 0, false);
            }
        }
    }
    static _b5(a, b, c, d, e, f) {
        let g = b;
        let h = false;
        for (let i of fromEnum(a._rows$i._m(b, d))) {
            let j = i.index;
            if (g != j) {
                h = true;
            }
            else {
                g++;
            }
            let k;
            let l = c;
            let m = i._hasCellFormat;
            let n = false;
            for (let o of fromEnum(i._ch(c, e, true))) {
                if (o.n == false) {
                    continue;
                }
                if (l != o.r) {
                    if (m) {
                        n = true;
                    }
                    else {
                        for (let p = l, q = o.r; p < q; p++) {
                            k = a._cb(p);
                            if (!f(k.b)) {
                                return false;
                            }
                            p = k.r;
                        }
                    }
                }
                if (!f(o.j)) {
                    return false;
                }
                l = o.r + 1;
            }
            if (l <= e) {
                if (m) {
                    n = true;
                }
                else {
                    for (let r = l; r <= e; r++) {
                        k = a._cb(r);
                        if (!f(k.b)) {
                            return false;
                        }
                        r = k.r;
                    }
                }
            }
            if (n && !f(i._cellFormatInternal.d)) {
                return false;
            }
        }
        if (g != d + 1) {
            h = true;
        }
        if (h) {
            let s = a._f9(c);
            let t = a._ff;
            let u = t._inner[s];
            for (let v = s; v < t.count; v++) {
                u = t._inner[v];
                if (!f(u.b)) {
                    return false;
                }
                if (u.r >= e) {
                    break;
                }
            }
        }
        return true;
    }
    static _extendRangeForMergedCells1(a, b, c = null) {
        let d = SpreadsheetUtilities.ay(b);
        let e = a._hi(d, c);
        d = e.p0;
        return SpreadsheetUtilities.z(d);
    }
    _eo(a, b, c, d, e = Nullable$1.toNullable(SpreadsheetCellRange.$, null), f = false) {
        let g = Nullable$1.toNullable(SpreadsheetCellRange.$, null);
        if (SpreadsheetCellRange._l_op_Inequality_Lifted$i(e, Nullable$1.toNullable(SpreadsheetCellRange.$, null))) {
            g = e;
        }
        else if (d) {
            this._jd();
            let h = this._bb.protection.selectionMode == 0;
            g = Nullable$1.toNullable(SpreadsheetCellRange.$, new SpreadsheetCellRange(h ? 0 : this._t.firstRow, h ? 0 : this._t.firstColumn, this._t.lastRow + (h ? 0 : 1), this._t.lastColumn + (h ? 0 : 1)));
        }
        let i = !nullableIsNull(g) ? g.value : new SpreadsheetCellRange(a.row, a.column);
        let j = b == 0 || b == 1;
        let k;
        if (f && this._by(a, j, c, d, i)) {
            return Nullable$1.toNullable(SpreadsheetCell.$, a);
        }
        do {
            k = this._ep(a, b, c, g, d);
            if (SpreadsheetCell._l_op_Inequality_Lifted$i(k, Nullable$1.toNullable(SpreadsheetCell.$, null)) && d && !i._contains(k.value)) {
                k = Nullable$1.toNullable(SpreadsheetCell.$, null);
            }
            if (SpreadsheetCell._l_op_Inequality_Lifted$i(k, Nullable$1.toNullable(SpreadsheetCell.$, null)) || d == false) {
                break;
            }
            switch (b) {
                case 1:
                    {
                        let l = SpreadsheetPaneManager._e4(a.row + 1, i.lastRow, this._bb);
                        if (nullableEquals(l, null) && SpreadsheetCellRange._l_op_Equality_Lifted$i(e, Nullable$1.toNullable(SpreadsheetCellRange.$, null))) {
                            l = SpreadsheetPaneManager._e4(i.firstRow, a.row, this._bb);
                        }
                        if (nullableEquals(l, null) || (nullableEquals(l, a.row) && a.column <= i.firstColumn)) {
                            return Nullable$1.toNullable(SpreadsheetCell.$, null);
                        }
                        a = new SpreadsheetCell(l.value, i.firstColumn);
                        break;
                    }
                case 0:
                    {
                        let m = this._e9(i.firstRow, a.row - 1);
                        if (nullableEquals(m, null) && SpreadsheetCellRange._l_op_Equality_Lifted$i(e, Nullable$1.toNullable(SpreadsheetCellRange.$, null))) {
                            m = this._e9(a.row, i.lastRow);
                        }
                        if (nullableEquals(m, null) || (nullableEquals(m, a.row) && a.column >= i.lastColumn)) {
                            return Nullable$1.toNullable(SpreadsheetCell.$, null);
                        }
                        a = new SpreadsheetCell(m.value, i.lastColumn);
                        break;
                    }
                case 3:
                    {
                        let n = SpreadsheetPaneManager._e3(a.column + 1, i.lastColumn, this._bb);
                        if (nullableEquals(n, null) && SpreadsheetCellRange._l_op_Equality_Lifted$i(e, Nullable$1.toNullable(SpreadsheetCellRange.$, null))) {
                            n = SpreadsheetPaneManager._e3(i.firstColumn, a.column, this._bb);
                        }
                        if (nullableEquals(n, null) || (nullableEquals(n, a.column) && a.row <= i.firstRow)) {
                            return Nullable$1.toNullable(SpreadsheetCell.$, null);
                        }
                        a = new SpreadsheetCell(i.firstRow, n.value);
                        break;
                    }
                case 2:
                    {
                        let o = this._e8(i.firstColumn, a.column - 1);
                        if (nullableEquals(o, null) && SpreadsheetCellRange._l_op_Equality_Lifted$i(e, Nullable$1.toNullable(SpreadsheetCellRange.$, null))) {
                            o = this._e8(a.column, i.lastColumn);
                        }
                        if (nullableEquals(o, null) || (nullableEquals(o, a.column) && a.row >= i.lastRow)) {
                            return Nullable$1.toNullable(SpreadsheetCell.$, null);
                        }
                        a = new SpreadsheetCell(i.lastRow, o.value);
                        break;
                    }
            }
            if (this._by(a, j, c, true, i)) {
                return Nullable$1.toNullable(SpreadsheetCell.$, a);
            }
        } while (d);
        return k;
    }
    _ep(a, b, c, d, e) {
        let f;
        switch (c) {
            default:
            case 0:
                f = this._eu(a.row, a.column, b, d, void 0, e);
                break;
            case 1:
                f = this._ev(a.row, a.column, b, d, e, !e);
                break;
            case 2:
                {
                    let g = this._bi(a.row, a.column);
                    if (!this._b0(a.row, a.column) && g == null) {
                        f = this._ev(a.row, a.column, b, d, e);
                    }
                    else {
                        let h = this._eu(a.row, a.column, b, d, true, e);
                        if (SpreadsheetCell._l_op_Equality_Lifted$i(h, Nullable$1.toNullable(SpreadsheetCell.$, null))) {
                            f = Nullable$1.toNullable(SpreadsheetCell.$, null);
                        }
                        else {
                            let i = h.value.row;
                            let j = h.value.column;
                            let k = this._bi(i, j);
                            let l = this._b0(i, j);
                            if (!l && (g != k || g == null)) {
                                if (k != null) {
                                    f = h;
                                }
                                else {
                                    f = this._ev(i, j, b, d, e);
                                }
                            }
                            else {
                                let m = false;
                                do {
                                    f = this._eu(i, j, b, d, true, e);
                                    if (SpreadsheetCell._l_op_Equality_Lifted$i(f, Nullable$1.toNullable(SpreadsheetCell.$, null))) {
                                        break;
                                    }
                                    k = this._bi(f.value.row, f.value.column);
                                    if (g != k) {
                                        break;
                                    }
                                    m = this._b0(f.value.row, f.value.column);
                                    if (!m && l) {
                                        break;
                                    }
                                    i = f.value.row;
                                    j = f.value.column;
                                    if (m && !l) {
                                        break;
                                    }
                                } while (true);
                                f = Nullable$1.toNullable(SpreadsheetCell.$, new SpreadsheetCell(i, j));
                            }
                        }
                    }
                    break;
                }
        }
        return f;
    }
    _eq(a, b) {
        return b ? this._fc(a) : this._fh(a);
    }
    _er(a, b) {
        return b ? this._fe(a) : this._fi(a);
    }
    _r() {
        let a = this.activePane.selection.activeCell;
        let b = a.column;
        let c = a.row;
        let d = b == this._dh.item(0).startIndex && c == this._dn.item(0).startIndex;
        let e = b < this._dh.item(0).startIndex || b > this._dh.item(0).endIndex;
        let f = c < this._dn.item(0).startIndex || c > this._dn.item(0).endIndex;
        if (d || e || f) {
            if (e || d || (f && b != this._dh.item(0).startIndex)) {
                let g = truncate(MathUtilities.f(this._dh.item(0)._x._ac + this._dh.item(0)._x._af / 2));
                let h = this._be(g);
                if (g > (h._m + intDivide(h._i, 2))) {
                    h = this._be(h._l + 1);
                }
                b = h._j;
            }
            if (f || d || (e && c != this._dn.item(0).startIndex)) {
                let i = truncate(MathUtilities.f(this._dn.item(0)._x._ac + this._dn.item(0)._x._af / 2));
                let j = this._bb._cq(i);
                if (i > (j._m + intDivide(j._i, 2))) {
                    j = this._bb._cq(j._l + 1);
                }
                c = j._j;
            }
        }
        return new SpreadsheetCell(c, b);
    }
    _bd(a, b, c) {
        let d;
        d = this._bb._b4(a, c);
        d = this._bb._b5(d, b, c) || d;
        return d;
    }
    _ez(a) {
        let b = this.activePane;
        let c = Nullable$1.toNullable(SpreadsheetUserPromptTrigger_$type, null);
        {
            for (let d of fromEnum(this._a2._j)) {
                let e = d._j;
                for (let f of fromEnum(a)) {
                    let g = SpreadsheetUtilities.ay(f);
                    if (nullableNotEquals(null, (c = this._ew(e, f.firstRow, g)))) {
                        return c;
                    }
                    if (f._aa > 1 && nullableNotEquals(null, (c = this._ew(e, f.lastRow, g)))) {
                        return c;
                    }
                    let h = f._ad > 1;
                    for (let i of fromEnum(e._rows$i._m(f.firstRow, f.lastRow))) {
                        if (nullableNotEquals(null, (c = this._ey(i, f.firstColumn, g)))) {
                            return c;
                        }
                        if (h && nullableNotEquals(null, (c = this._ey(i, f.lastColumn, g)))) {
                            return c;
                        }
                    }
                }
            }
        }
        return c;
    }
    _ew(a, b, c) {
        let d = a._rows$i._aj(b);
        if (d != null) {
            let e;
            for (let f of fromEnum(d._ch(c._w, c._x, true))) {
                if (nullableNotEquals(null, (e = this._ex(d, f, c)))) {
                    return e;
                }
            }
        }
        return Nullable$1.toNullable(SpreadsheetUserPromptTrigger_$type, null);
    }
    _ey(a, b, c) {
        let d = a._c6(b);
        return this._e0(d, c);
    }
    _e0(a, b) {
        let c = typeCast(ArrayInteriorFormula.$, a);
        if (c != null) {
            if (!b._h(c._cz.cellRange._h)) {
                return Nullable$1.toNullable(SpreadsheetUserPromptTrigger_$type, 25);
            }
        }
        else {
            let d = typeCast(DataTableInteriorFormula.$, a);
            if (d != null) {
                if (!b._h(d._cz._h._h)) {
                    return Nullable$1.toNullable(SpreadsheetUserPromptTrigger_$type, 26);
                }
            }
        }
        return Nullable$1.toNullable(SpreadsheetUserPromptTrigger_$type, null);
    }
    _ex(a, b, c) {
        let d = Nullable$1.toNullable(SpreadsheetUserPromptTrigger_$type, null);
        if (b.o && b.d.l(b.h, b.f)) {
            let e = b.d.ab(a, b.r, null, b.h, b.f);
            if (nullableNotEquals(null, (d = this._e0(e, c)))) {
                return d;
            }
        }
        return Nullable$1.toNullable(SpreadsheetUserPromptTrigger_$type, null);
    }
    static _fn(a) {
        return CellAddress.w(a, true, 16384, -1, false, 1);
    }
    static _fo(a) {
        return (a + 1).toString();
    }
    _be(a) {
        let b = Math.max(Math.min(a, 0x7FFFFFFF), 0);
        return this._bb._co(b);
    }
    _di(a, b, c = 0x7FFFFFFF) {
        return this._bb._e0(a, Math.min(b, 0x7FFFFFFF), c);
    }
    _bi(a, b) {
        return this._bb._de(a, b);
    }
    _b6(a, b, c, d, e, f, g = null) {
        let h = false;
        let i = this._bb._tables$i;
        let j = new SpreadsheetCellRange(c, e, d, f);
        for (let k = i.count - 1; k >= 0; k--) {
            let l = i._item(k);
            if (!l.isFilterUIVisible) {
                continue;
            }
            let m = l._by;
            if (m._ac >= c && SpreadsheetUtilities.a9(j, m)) {
                for (let n = Math.max(j.firstColumn, m._w), o = Math.min(f, m._x); n <= o; n++) {
                    let p = 0;
                    if (l._columns$i._item(n - m._w).filter != null) {
                        p |= 16;
                    }
                    let q = l._columns$i._item(n - m._w).sortCondition;
                    if (q != null) {
                        p |= (q.sortDirection == 0 ? 4 : 8);
                    }
                    h = this._bo(a, g, m._ac, n, 1, p) || h;
                }
            }
        }
        let r = this._bb.filterSettings.region;
        if (r != null && r.firstRow >= c && r._t(c, e, d, f)) {
            let s = r._h;
            for (let t = Math.max(j.firstColumn, s._w), u = Math.min(f, s._x); t <= u; t++) {
                let v = 0;
                if (this._bb.filterSettings.getFilter(t - s._w) != null) {
                    v |= 16;
                }
                let w = this._bb.filterSettings.sortSettings._sortConditions$i._item(new RelativeIndex(t - s._w));
                if (w != null) {
                    v |= (w.sortDirection == 0 ? 4 : 8);
                }
                h = this._bo(a, g, s._ac, t, 0, v) || h;
            }
        }
        if (b == this._ao) {
            let x = b._ag._r;
            if (x.intersectsWith(j)) {
                let y = x._c;
                let z = this._bh;
                if (z != null && z.isTotalsRowVisible && z._by._ae == y.row) {
                    h = this._bo(a, g, y.row, y.column, 3, 0) || h;
                }
                else {
                    let aa = this._bb._dataValidationRules$i._e(new WorksheetRegionAddress(1, y.row, y.row, y.column, y.column));
                    if (typeCast(ListDataValidationRule.$, aa) !== null && aa.showDropdown) {
                        h = this._bo(a, g, y.row, y.column, 2, 0) || h;
                    }
                }
            }
        }
        return h;
    }
    _el(a) {
        a *= 1 / this._ds;
        let b = this._bb._fw(a, 3, false);
        return b;
    }
    _em(a) {
        a *= 1 / this._dt;
        if (this._al._t) {
            a = Workbook._ey(this._bb.workbook, a, true, false);
        }
        let b = truncate(MathUtilities.f(Workbook._ep(this._bb.workbook, a, true)));
        return b;
    }
    _bj(a, b) {
        let c = null;
        for (let d of fromEnum(this._bb._tables$i)) {
            let e = d._by;
            if (e._j(a)) {
                let f = d._cf(b.row, b.column);
                if (c == null || f) {
                    c = d;
                }
                if (f) {
                    break;
                }
            }
        }
        return c;
    }
    _b7(a) {
        return (this._av & a) != 0;
    }
    _a4(a, b, c, d, e, f, g) {
        let h = this._al._j;
        let i = a.j || a.e == 4 ? b : 0;
        let j = TextMetricsProviderBase._c(f);
        let k;
        let l = null;
        if (typeCast(FormattedString.$, a.ap) !== null) {
            a.k = false;
            a.q = false;
            a.l = false;
            a.p = false;
            if (g) {
                l = SpreadsheetUtilities.au(this._bb.workbook);
            }
            let m = typeCast(FormattedString.$, a.ap);
            k = h.g(m, d, i, c, a.j, g, this._d8, SpreadsheetUtilities.e2(l, this._bb.workbook));
            if (WorkbookColorInfo.l_op_Equality(l, null)) {
                l = new FormattedStringFontResolved(m._getFont(0), d).colorInfo;
            }
        }
        else {
            let n = new GetCellTextParameters(a.w);
            n.b = 0;
            n.a = 0;
            n.d = runOn(h, h.k);
            n.f = a.ai + a.ah;
            let o = a.h._av(n);
            let p = o.g;
            a.q = isNaN_(o.e) == false && o.c && nullableEquals(ExcelCalcValue._be(this._bb.workbook, o.e, true, false), null);
            a.l = isNaN_(o.e) == false && o.d;
            if (a.d != null && a.d.cellFormat != null && (a.d.cellFormat.formatOptions & 1) != 0) {
                a.p = "General" == a.d.cellFormat.formatString;
            }
            else {
                a.p = d._cs == 0;
            }
            if (!a.j) {
                p = SpreadsheetUtilities.dl(p);
            }
            a.k = SpreadsheetUtilities.a2(p);
            if (o.f != null && e) {
                l = SpreadsheetUtilities.av(o.f, this._bb.workbook._palette$i);
            }
            else if (g && this._ci(d)) {
                l = SpreadsheetUtilities.au(this._bb.workbook);
            }
            let q = a.d != null ? a.d._h : null;
            if (q != null && q.font != null) {
                let r = 4096 | 16384 | 1024 | 128 | 256;
                let s = this._bb.workbook._cd(0);
                s.setFormatting(d);
                for (let t = 1; t != 1073741824; t = (t << 1)) {
                    if ((r & t) == 0) {
                        continue;
                    }
                    let u = q._dd(t);
                    if (WorksheetCellFormatData._cf(t, u) == false) {
                        s._dv(t, u);
                    }
                }
                d = s;
            }
            if (a.k && a.e == 4) {
                i = 0;
            }
            k = h.h(p, d, i, c, a.j, g, this._d8, SpreadsheetUtilities.e2(l, this._bb.workbook));
            if (WorkbookColorInfo.l_op_Equality(l, null)) {
                l = d._bh;
            }
        }
        if (j) {
            let v = truncate(h.ac(d, 1 / this._dt));
            AccountingUnderlineInfo.d(v, f == 33, this._bb, a, d);
            {
                let w = h.k();
                try {
                    a.u = w._g(d, "Wj", Nullable$1.toNullable(Size.$, null), true, true).height - v;
                }
                finally {
                    if (w != null) {
                        w.dispose();
                    }
                }
            }
        }
        else {
            a.a = null;
        }
        a.ar = WorkbookColorInfo.l_op_Equality(l, null) ? ExcelUtils.gv : SpreadsheetUtilities.e2(l, this._bb.workbook);
        a.g = l;
        return k;
    }
    _e5(a) {
        if (a == null) {
            return Nullable$1.toNullable(Boolean_$type, null);
        }
        else {
            return Nullable$1.toNullable(Boolean_$type, a._s());
        }
    }
    _ad(a, b, c, d, e) {
        let f = this._getCellRange1(b.row, b.column);
        let g = this._getCellRange1(d.row, d.column);
        let h = c;
        let i = new SpreadsheetCellRange();
        let j;
        e = a;
        switch (a) {
            default:
            case 1:
                i = new SpreadsheetCellRange(c.firstRow, Math.min(f.firstColumn, g.firstColumn), c.lastRow, Math.max(c.lastColumn, g.lastColumn));
                j = i.lastColumn <= c.lastColumn;
                break;
            case 0:
                i = new SpreadsheetCellRange(c.firstRow, Math.min(c.firstColumn, g.firstColumn), c.lastRow, Math.max(f.lastColumn, g.lastColumn));
                j = i.firstColumn >= c.firstColumn;
                break;
            case 3:
                i = new SpreadsheetCellRange(Math.min(f.firstRow, g.firstRow), c.firstColumn, Math.max(c.lastRow, g.lastRow), c.lastColumn);
                j = i.lastRow <= c.lastRow;
                break;
            case 2:
                i = new SpreadsheetCellRange(Math.min(c.firstRow, g.firstRow), c.firstColumn, Math.max(f.lastRow, g.lastRow), c.lastColumn);
                j = i.firstRow >= c.firstRow;
                break;
        }
        if (j && SpreadsheetCellRange.l_op_Inequality(h, i)) {
            i = this._ag(i);
            i = i.union(this._getCellRange1(b.row, b.column));
            e = SpreadsheetUtilities.n(a);
        }
        else {
            i = this.extendRangeForMergedCells(i);
        }
        return {
            ret: i,
            p4: e
        };
    }
    _getPane1(a) {
        if (this._dl.count == 0) {
            return null;
        }
        switch (a) {
            default:
            case 3: return this._getPane2(0, 0);
            case 1: return this._getPane2(0, this._dh.count - 1);
            case 2: return this._getPane2(this._dn.count - 1, 0);
            case 0: return this._getPane2(this._dn.count - 1, this._dh.count - 1);
        }
    }
    _ff(a) {
        if (a == null) {
            return Nullable$1.toNullable(PaneLocation_$type, null);
        }
        let b = this._dn.indexOf(a.rowScrollRegion);
        let c = this._dh.indexOf(a.columnScrollRegion);
        if (b == 1) {
            return Nullable$1.toNullable(PaneLocation_$type, c == 1 ? 0 : 2);
        }
        else if (c == 1) {
            return Nullable$1.toNullable(PaneLocation_$type, 1);
        }
        else {
            return Nullable$1.toNullable(PaneLocation_$type, 3);
        }
    }
    _as(a) {
        let b = this._dl.count;
        if (b == 0) {
            return null;
        }
        this._bb.displayOptions._br();
        let c = this._getPane1(this._bb.displayOptions._z);
        if (c != null && c != this.activePane) {
            return c;
        }
        let d = this._dl.indexOf(this.activePane);
        if (this._bb.displayOptions.panesAreFrozen) {
            d = b - 1;
        }
        else if (d < 0 || b == 1) {
            d = 0;
        }
        else if (nullableEquals(a, null)) {
        }
        else if (b == 2) {
            d = d == 0 ? 1 : 0;
        }
        else {
            let e = a.value ? [1, 3, 0, 2] : [2, 0, 3, 1];
            d = e[d];
        }
        return this._dl.item(d);
    }
    _dy(a) {
        let b = a < 0;
        let c = this._bb._fl(Math.abs(a), 3, false);
        c *= this._ds;
        if (b) {
            c = -c;
        }
        return c;
    }
    _dz(a) {
        let b = a < 0;
        let c = this._bb.workbook;
        let d = this.convertTwipsToPixels(Math.abs(a), true);
        if (b) {
            d = -d;
        }
        return d;
    }
    _ec(a, b, c, d = Nullable$1.toNullable(HorizontalCellAlignment_$type, null)) {
        let e = Nullable$1.toNullable(Number_$type, a);
        do {
            e = b._c1(e.value, false);
            if (nullableEquals(e, null) || nullableLessThan(e, c)) {
                break;
            }
        } while (this._bb._cb(e.value).i);
        let f;
        if (nullableNotEquals(e, null)) {
            f = Math.max(e.value + 1, c);
        }
        else {
            f = c;
        }
        for (let g = (a - 1), h = f; g >= h; g--) {
            if (this._bb._cr(b.index, g) != null) {
                f = g + 1;
                break;
            }
            let i = this._bb._cb(g);
            if (i.i) {
                g = i.q;
            }
            else if (nullableNotEquals(d, null)) {
                let j = b._bc(g);
                if (nullableNotEquals(j.alignment, d)) {
                    f = g + 1;
                    break;
                }
            }
        }
        return f;
    }
    _jm(a) {
        if (a.isEmpty) {
            return Size.empty;
        }
        let b = this._bb._cn(a.firstColumn);
        let c = this._bb._cn(a.lastColumn);
        let d = c._l - b._m;
        let e = this._bb._cp(a.firstRow);
        let f = this._bb._cp(a.lastRow);
        let g = f._l - e._m;
        return new Size(1, d, g);
    }
    _bf() {
        if (this._bb.isProtected) {
            return this._bb.protection.selectionMode;
        }
        return 0;
    }
    _fq(a) {
        return CellAddress.y(a, true, 1048576, -1, false, 1);
    }
    _fr(a) {
        return (a + 1).toString();
    }
    _fb(a, b, c, d) {
        let e = c == 0 || c == 1;
        let f = c == 0 || c == 2;
        let g = Nullable$1.toNullable(IntRange.$, null);
        let h = 0x7FFFFFFF;
        for (let i of fromEnum(this._bb._tables$i)) {
            let j = i._by;
            if (e) {
                if (j._ac > a || j._ae < a) {
                    continue;
                }
                if (f && j._w >= b) {
                    continue;
                }
                else if (!f && j._x <= b) {
                    continue;
                }
                if (f && j._x < d.firstColumn) {
                    continue;
                }
                else if (!f && j._w > d.lastColumn) {
                    continue;
                }
                let k = SpreadsheetPaneManager._e3(j._w, j._x, this._bb);
                if (nullableEquals(k, null)) {
                    continue;
                }
                if (f && nullableGreaterThanOrEqual(k, b)) {
                    continue;
                }
                let l = (f ? b - j._x : j._w - b);
                if (l < h) {
                    let m = this._e8(k.value, j._x);
                    if (!f && nullableLessThanOrEqual(m, b)) {
                        continue;
                    }
                    h = l;
                    g = Nullable$1.toNullable(IntRange.$, new IntRange(1, k.value, m.value));
                }
            }
            else {
                if (j._w > b || j._x < b) {
                    continue;
                }
                if (f && j._ac >= a) {
                    continue;
                }
                else if (!f && j._ae <= a) {
                    continue;
                }
                if (f && j._ae < d.firstRow) {
                    continue;
                }
                else if (!f && j._ac > d.lastRow) {
                    continue;
                }
                let n = SpreadsheetPaneManager._e4(j._ac, j._ae, this._bb);
                if (nullableEquals(n, null)) {
                    continue;
                }
                if (f && nullableGreaterThanOrEqual(n, a)) {
                    continue;
                }
                let o = (f ? a - j._ae : j._ac - a);
                if (o < h) {
                    let p = this._e9(n.value, j._ae);
                    if (!f && nullableLessThanOrEqual(p, a)) {
                        continue;
                    }
                    h = o;
                    g = Nullable$1.toNullable(IntRange.$, new IntRange(1, n.value, p.value));
                }
            }
        }
        return g;
    }
    _au() {
        if (this._bb.isProtected && this._bb.protection.selectionMode == 1) {
            let a = this.activePane;
            let b = a != null ? a.selection : null;
            if (b != null && !this._canSelect(b.activeCell)) {
                return 2048;
            }
        }
        return 0;
    }
    _dj(a, b) {
        return this._bb._e0(a, b);
    }
    _dk(a, b) {
        return this._bb._e2(a, b);
    }
    _gn(a) {
        let b = this.activePane;
        let c = b.selection;
        let d = c._bf;
        if (nullableNotEquals(this._fj(8), true)) {
            this._ea(new SpreadsheetUserPromptInfo(23, null, null, null, false));
            return;
        }
        for (let e of fromEnum(this._a2._j)) {
            let f = e._j;
            for (let g of fromEnum(d)) {
                let h = (g._h - g._i) + 1;
                if (a) {
                    f._hideColumns$i(Nullable$1.toNullable(Number_$type, g._i), Nullable$1.toNullable(Number_$type, h));
                }
                else {
                    f._unhideColumns$i(Nullable$1.toNullable(Number_$type, g._i), Nullable$1.toNullable(Number_$type, h));
                }
            }
        }
        this._b2(b, c.activeCell, true);
    }
    _go(a) {
        let b = this.activePane;
        let c = b.selection;
        if (nullableNotEquals(this._fj(16), true)) {
            this._ea(new SpreadsheetUserPromptInfo(23, null, null, null, false));
            return;
        }
        for (let d of fromEnum(this._a2._j)) {
            let e = d._j;
            for (let f of fromEnum(c._bg)) {
                let g = (f._h - f._i) + 1;
                if (a) {
                    e._hideRows$i(Nullable$1.toNullable(Number_$type, f._i), Nullable$1.toNullable(Number_$type, g));
                }
                else {
                    e._unhideRows$i(Nullable$1.toNullable(Number_$type, f._i), Nullable$1.toNullable(Number_$type, g));
                }
            }
        }
        this._b2(b, c.activeCell, true);
    }
    _gq() {
        this._dq = Workbook._et(this._bb.workbook, false);
        this._dr = Workbook._et(this._bb.workbook, true);
        if (this._al._t) {
            this._ds = 96 / this._dq;
            this._dt = 96 / this._dr;
        }
        else {
            this._dt = this._ds = 1;
        }
    }
    _aj(a, b, c, d = true) {
        let e = c._a4;
        if (e == 0) {
            e = SpreadsheetUtilities.ap(a.ao, c, this._bb, a.h, a.ab);
        }
        a.e = e;
        a.v = c._cl;
        a.y = c._cm;
        a.z = c._cn;
        a.ac = c._cp;
        a.aa = c._co;
        a.s = c._b7;
        a.f = c._a8;
        a.j = c._b8;
        a.t = nullableEquals(c._c7, true);
        if (a.d != null && ((a.d.dataBarInfo != null && !a.d.dataBarInfo.showValue) || (a.d.iconInfo != null && !a.d.iconInfo.showValue))) {
            a.ap = null;
        }
        else if (this._bn) {
            a.ap = a.h.getCellFormula(a.w) || a.h._getCellValue1(a.w);
        }
        else {
            a.ap = a.h._getCellValue1(a.w);
        }
        if (e == 4 && typeCast(FormattedString.$, a.ap) !== null) {
            a.ap = a.ap.unformattedString;
        }
        a.ae = a.ab;
        a.ad = a.x;
        a.n = b.hasValue;
        if (this._bn) {
            if (a.ap != null && typeof a.ap === 'string' == false) {
                e = 1;
            }
            else {
                if (e == 4) {
                    e = 1;
                }
            }
            a.e = e;
        }
        if (!a.r) {
            switch (a.e) {
                case 4:
                case 6:
                    a.x = a.h._ck(a.w, this._u.lastColumn, Nullable$1.toNullable(HorizontalCellAlignment_$type, a.e));
                    a.ad = a.x;
                    break;
            }
        }
        let f;
        let g = this._bb._cn(a.ae);
        let h = g;
        let i = this._bb._gl;
        a.y *= i;
        a.z *= i;
        let j = a.y;
        let k = a.z;
        let l = this._bb._ge();
        let m = intDivide(l, 2);
        if (a.j) {
            a.y += m;
            a.z += (l - m);
        }
        else {
            switch (e) {
                case 1:
                case 4:
                    a.y += m;
                    break;
                case 3:
                    a.z += (l - m);
                    break;
                case 7:
                case 5:
                    a.y += m;
                    a.z += (l - m);
                    break;
                case 6:
                case 2: break;
            }
        }
        let n = ExcelUtils.dc(a.d, c);
        let o = n == 0 ? 0 : ExcelUtils.db(c._cq);
        a.ai = o;
        a.ah = ExcelUtils.dc(a.d, c) - o;
        let p = a.y + a.z + a.ah + a.ai;
        if (a.ad == a.ae) {
            f = this._dy(g._i) - p;
        }
        else {
            h = this._bb._cn(a.ad);
            let q = h._l - g._m;
            f = this._dy(q) - p;
        }
        f -= this._ds;
        let r = f;
        if (f < 1) {
            f = 1;
        }
        let s = SpreadsheetUtilities.ac(a.e);
        let t = this._a4(a, f, s, c, d, c._a1, nullableEquals(b, true));
        a.c = t;
        if (a.j && a.e == 7 && f < t.b) {
            let u = (r + (j + k)) - t.b;
            let v = truncate((u / 2));
            let w = truncate((u - v));
            a.y -= Math.max(j - v, 0);
            a.z -= Math.max(k - w, 0);
        }
        a.am = a.al = Nullable$1.toNullable(Number_$type, null);
        if (this._bn) {
            a.am = Nullable$1.toNullable(Number_$type, a.ae);
            a.al = Nullable$1.toNullable(Number_$type, a.ad);
        }
        else if (!a.j && !a.s) {
            switch (a.e) {
                case 4:
                    if (f < t.b) {
                        a.am = Nullable$1.toNullable(Number_$type, a.ae);
                        a.al = Nullable$1.toNullable(Number_$type, a.ad);
                    }
                    break;
                case 1:
                    if (f < t.b) {
                        let x = this._el(t.b);
                        a.ad = this._be(g._m + this._el(a.aj) + x)._j;
                        if (a.r) {
                            if (a.ad > a.x) {
                                a.al = Nullable$1.toNullable(Number_$type, a.x);
                            }
                        }
                        else {
                            let y = a.h._ck(a.x, a.ad, Nullable$1.toNullable(HorizontalCellAlignment_$type, null));
                            if (y < a.ad) {
                                a.al = Nullable$1.toNullable(Number_$type, y);
                            }
                        }
                    }
                    break;
                case 3:
                    if (f < t.b) {
                        let z = this._el(t.b);
                        let aa = h._l - this._el(a.z);
                        a.ae = this._be(Math.max(aa - z, 0))._j;
                        if (a.r) {
                            if (a.ae < a.ab) {
                                a.am = Nullable$1.toNullable(Number_$type, a.ab);
                            }
                        }
                        else {
                            let ab = this._ec(a.ab, a.h, a.ae, Nullable$1.toNullable(HorizontalCellAlignment_$type, null));
                            if (ab > a.ae) {
                                a.am = Nullable$1.toNullable(Number_$type, ab);
                            }
                        }
                    }
                    break;
                case 6:
                case 2:
                    if (f < t.b) {
                        let ac = this._el(t.b);
                        let ad = h._l - this._el(a.z);
                        let ae = g._m + this._el(a.y);
                        let af = ae + intDivide((ad - ae), 2);
                        a.ae = this._be(Math.max(af - intDivide(ac, 2), 0))._j;
                        a.ad = this._be(af + intDivide(ac, 2))._j;
                        if (a.r) {
                            if (a.ad > a.x) {
                                a.al = Nullable$1.toNullable(Number_$type, a.x);
                            }
                            if (a.ae < a.ab) {
                                a.am = Nullable$1.toNullable(Number_$type, a.ab);
                            }
                        }
                        else {
                            let ag = a.h._ck(a.x, a.ad, Nullable$1.toNullable(HorizontalCellAlignment_$type, null));
                            if (ag < a.ad) {
                                a.al = Nullable$1.toNullable(Number_$type, ag);
                            }
                            let ah = this._ec(a.ab, a.h, a.ae, Nullable$1.toNullable(HorizontalCellAlignment_$type, null));
                            if (ah > a.ae) {
                                a.am = Nullable$1.toNullable(Number_$type, ah);
                            }
                        }
                    }
                    break;
            }
        }
        let ai = this._bb._cp(a.ak);
        let aj = a.ak != a.ag ? this._bb._cp(a.ag) : ai;
        let ak = aj._l - ai._m;
        let al = Math.max(this._dz(ak) - (a.ac + a.v), 0);
        a.i = al < t.a;
        return a;
    }
    _gr() {
        this._ip(4194304, false);
        let a = this._bb.displayOptions.showRowAndColumnHeaders;
        this._d8 = this._bb.displayOptions.magnificationInNormalView / 100;
        let b = this._bb.workbook;
        let c = this._ba = this._ba._d(b._styles$i.normalStyle._i);
        let d = this._bf();
        for (let e = 0; e < 2; e++) {
            let f = e == 0 ? this._dm : this._dg;
            for (let g of fromEnum(f)) {
                g._ap = a;
                g._af = c;
                g._bx = this._d8;
                g._ai = d;
            }
        }
    }
    _ej(a, b, c, d, e, f, g, h, i, j) {
        let k;
        let l;
        if (a.isFrozen) {
            k = 1.7976931348623157E+308;
            l = a.endIndex;
        }
        else {
            let m = !isNaN_(j) ? j : a._bu;
            k = m + c;
            l = h;
        }
        if (k > b) {
            k = b;
        }
        if (k != 1.7976931348623157E+308) {
            k += a._bw * this._dw;
            k /= this._dw;
        }
        let n = e(k);
        let o = d(a.startIndex, n, l);
        if (!i) {
            let p = o == null || o.count == 0 || o.item(0)._j == 0 ? Nullable$1.toNullable(Number_$type, null) : f(o.item(0)._j);
            a._cr = p;
            let q = o == null || o.count == 0 || o.item(o.count - 1)._j == h ? Nullable$1.toNullable(Number_$type, null) : g(o.item(o.count - 1)._j);
            a._cq = q;
            if (!CoreUtilities.d(WorksheetItemPosition.$, a._m, o)) {
                a._m._a3(o);
            }
        }
        return o == null || o.count == 0 ? 0 : o.item(o.count - 1)._j;
    }
    _gu() {
        this._i9();
        this._ip(8, false);
        this._ip(4194304, false);
        this._ip(16777216, true);
        let a = this._bb;
        let b = a.workbook;
        let c = this._bb.displayOptions;
        let d = c.panesAreFrozen;
        let e = c.frozenPaneSettings;
        let f = c.unfrozenPaneSettings;
        let g = d ? e : f;
        let h = g._h ? 2 : 1;
        let i = g._i ? 2 : 1;
        let j = this.activePane;
        let k = c.showRowAndColumnHeaders;
        let l = this._bb._rows$i.maxCount - 1;
        let m = this._bb._columns$i.maxCount - 1;
        let n = this._l;
        let o = this._j;
        let p = this._k;
        n.beginUpdate();
        o.beginUpdate();
        p.beginUpdate();
        this._d8 = c.magnificationInNormalView / 100;
        let q = b.cellReferenceMode == 1;
        let r = this._ba = this._ba._d(b._styles$i.normalStyle._i);
        let s = this._bf();
        try {
            let t = new Queue$1(SpreadsheetRowScrollRegion.$);
            for (let u of fromEnum(n)) {
                t.g(u);
            }
            n.clear();
            for (let v = 0; v < h; v++) {
                let w = t.count > 0 ? t.b() : new SpreadsheetRowScrollRegion();
                w._x._a4 = runOn(this, this._c3);
                w._x._a5 = runOn(this, this._d6);
                w._b4 = runOn(this, this._dz);
                w._b5 = runOn(this, this._em);
                w._b7 = runOn(a, a._cp);
                w._b8 = runOn(a, a._cq);
                w._b9 = runOn(this, this._dk);
                w._ak = runOn(this, this._h7);
                w._am = runOn(this, this._h8);
                w._al = runOn(this, this._h4);
                w._b6 = q ? runOn(this, this._fq) : runOn(this, this._fr);
                w._bx = this._d8;
                w._bj = this._dr;
                w._bi = this._dq;
                w._br = this._ds;
                w._bs = this._dt;
                w._ad = this._a6;
                w._ci = l;
                w._ch = 8192;
                w._bq = this._jj.height;
                w._af = r;
                w._o = this;
                w._ap = k;
                w._ai = s;
                n.add(w);
            }
            if (h > 1) {
                let x = n._inner[0];
                x._v = d ? 1 : 2;
                x.isFrozen = d;
                x.startIndex = Math.min(f.firstRowInTopPane, l);
                if (d) {
                    x.endIndex = Math.min(x.startIndex + e.frozenRows - 1, l);
                }
                else {
                    x._bt = this.convertTwipsToPixels(f.topPaneHeight, true);
                }
            }
            let y = Enumerable.ah(SpreadsheetRowScrollRegion.$, n);
            y._v = 0;
            y.isFrozen = false;
            y.startIndex = Math.min(h == 1 ? f.firstRowInTopPane : g.firstRowInBottomPane, l);
            if (h > 1 && d && y.startIndex <= n._inner[0].endIndex) {
                y.startIndex = n._inner[0].endIndex + 1;
            }
            let z = new Queue$1(SpreadsheetColumnScrollRegion.$);
            for (let aa of fromEnum(o)) {
                z.g(aa);
            }
            o.clear();
            for (let ab = 0; ab < i; ab++) {
                let ac = z.count > 0 ? z.b() : new SpreadsheetColumnScrollRegion();
                ac._x._a4 = runOn(this, this._c0);
                ac._x._a5 = runOn(this, this._d5);
                ac._b4 = runOn(this, this._dy);
                ac._b5 = runOn(this, this._el);
                ac._b7 = runOn(a, a._cn);
                ac._b8 = runOn(this, this._be);
                ac._b9 = runOn(this, this._dj);
                ac._ak = runOn(this, this._h5);
                ac._am = runOn(this, this._h6);
                ac._al = runOn(this, this._h3);
                ac._b6 = q ? SpreadsheetPaneManager._fn : SpreadsheetPaneManager._fo;
                ac._bx = this._d8;
                ac._bj = this._dr;
                ac._bi = this._dq;
                ac._br = this._ds;
                ac._bs = this._dt;
                ac._ad = this._a6;
                ac._ci = m;
                ac._ch = 65535;
                ac._bq = this._jj.width;
                ac._af = r;
                ac._o = this;
                ac._ap = k;
                ac._ai = s;
                o.add(ac);
            }
            if (i > 1) {
                let ad = o._inner[0];
                ad._v = d ? 1 : 2;
                ad.isFrozen = d;
                ad.startIndex = Math.min(f.firstColumnInLeftPane, m);
                if (d) {
                    ad.endIndex = Math.min(ad.startIndex + e.frozenColumns - 1, m);
                }
                else {
                    ad._bt = this.convertTwipsToPixels(f.leftPaneWidth, false);
                }
            }
            let ae = Enumerable.ah(SpreadsheetColumnScrollRegion.$, o);
            ae._v = 0;
            ae.isFrozen = false;
            ae.startIndex = Math.min(i == 1 ? f.firstColumnInLeftPane : g.firstColumnInRightPane, m);
            if (i > 1 && d && ae.startIndex <= o._inner[0].endIndex) {
                ae.startIndex = o._inner[0].endIndex + 1;
            }
            let af = p.toArray();
            p.clear();
            for (let ag = 0; ag < n.count; ag++) {
                let ah = n._inner[ag];
                for (let ai = 0; ai < o.count; ai++) {
                    let aj = o._inner[ai];
                    let ak = null;
                    for (let am = 0; am < af.length; am++) {
                        let al = af[am];
                        if (al.rowScrollRegion == ah && al.columnScrollRegion == aj) {
                            ak = al;
                            break;
                        }
                    }
                    if (ak == null) {
                        ak = new SpreadsheetPane(ah, o._inner[ai], this._eb, this);
                    }
                    let an = ak.selection;
                    an._ac = new IntRange(1, this._u.firstColumn, this._u.lastColumn);
                    an._ad = new IntRange(1, this._u.firstRow, this._u.lastRow);
                    p.add(ak);
                }
            }
            this._gt();
            if (j != null) {
                let ao = this._as(Nullable$1.toNullable(Boolean_$type, null));
                if (ao != j) {
                    let ap = j.selection;
                    ao.selection._resetSelection(Enumerable.a(SpreadsheetCellRange.$, ap.cellRanges), ap.activeCell, ap.activeCellRangeIndex, false);
                }
            }
        }
        finally {
            this._ip(4, true);
            this._ip(4096, true);
            this._i4();
            n.endUpdate();
            o.endUpdate();
            p.endUpdate();
            this._c5(2048, d);
        }
    }
    _gv(a, b, c, d, e, f, g, h, i) {
        let j = 0;
        i = 0;
        for (let k of fromEnum(a)) {
            let l = k._x;
            let m = l._at;
            if (m) {
                continue;
            }
            let n = l._ac;
            let o = n;
            let p = l._af;
            let q = f(k.actualExtent / this._dw);
            let r = q;
            if (l._a3) {
                let s = d(k.startIndex);
                n = s._m + f(k._bw);
            }
            else if (!m) {
                let t = d(k.startIndex);
                n = t._m;
                if (!k.isFrozen) {
                    let u = e(truncate(MathUtilities.f(j + q)));
                    let v = u._l;
                    if (u._j < g - 1 && CoreUtilities.c(v, q)) {
                        u = e(u._j + 1);
                    }
                    r = v - j;
                }
            }
            let w = Math.max(r, Math.max(b, n + q) - j);
            if (k.isFrozen) {
                let x = k._m.count == 0 ? d(k.endIndex) : Enumerable.ah(WorksheetItemPosition.$, k._m);
                i = x._j + 1;
                j = x._l;
            }
            else {
                if (n > j && w + j > b) {
                }
                else {
                    let y = k._r;
                    let z = w + j - q;
                    if (y != null && y.a == z && y.c == q) {
                        w = y.b;
                    }
                    else {
                        let aa = e(truncate(MathUtilities.f(z)));
                        let ab = aa._j;
                        if (z > aa._m) {
                            ab++;
                        }
                        let ac = w + aa._l - z;
                        k._r = new PageStartScrollCache(q, z, ac, ab);
                        w = ac;
                    }
                }
                l._ab = j;
                l._ae = c;
            }
            l._aj(q, w, n);
            if (!this._b7(262144)) {
                if (!CoreUtilities.c(o, l._ac) || !CoreUtilities.c(h, k._bh)) {
                    k._bg = l._ac + l._af / 2;
                    k._bh = h;
                }
            }
        }
        return {
            p8: i
        };
    }
    _gs() {
        let a = this._bb.workbook;
        this._u = new SpreadsheetCellRange(0, 0, a.maxRowCount - 1, a.maxColumnCount - 1);
    }
    _g1(a) {
        for (let b of fromEnum(a)) {
            b._r = b._s = null;
        }
    }
    static _ch(a) {
        switch (a.a) {
            case 35:
                switch (a.c) {
                    case "FirstColumnInLeftPane":
                    case "FirstRowInTopPane":
                    case "FirstColumnInRightPane":
                    case "FirstRowInBottomPane": return true;
                }
                break;
        }
        return false;
    }
    _ci(a) {
        let b = typeCast(WorkbookBuiltInStyle.$, a._bs);
        if (b != null && b._ac == 8) {
            let c = a._bh;
            let d = b._i._bh;
            if (WorkbookColorInfo.l_op_Equality(c, d)) {
                return true;
            }
            else {
                let e = this._bb.workbook;
                if (Color.b(c._aj(e, true, true), d._aj(e, true, true))) {
                    return true;
                }
            }
        }
        return false;
    }
    static _cm(a, b, c) {
        let d = a.sortSettings.region;
        if (d == null) {
            return false;
        }
        let e = d._h;
        if (WorksheetRegionAddress._o(SpreadsheetUtilities.ay(b), e)) {
            return true;
        }
        if (c > 0) {
            let f = e._ac - c;
            e = e._d(f);
            if (WorksheetRegionAddress._o(SpreadsheetUtilities.ay(b), e)) {
                return true;
            }
        }
        return false;
    }
    static _cn(a, b) {
        switch (a) {
            case 0: return false;
            default:
            case 3: return true;
            case 1: return !b;
            case 2: return b;
        }
    }
    _cr(a, b) {
        let c = this._bb._rows$i._aj(a);
        let d = this._bb._b4(c, b);
        return nullableEquals(d._c5, false);
    }
    _cq(a, b) {
        let c = this._bb._b4(a, b);
        return nullableEquals(c._c5, false);
    }
    static _co(a, b, c = null) {
        if (a.isProtected) {
            let d = 0;
            let e = a._columns$i.maxCount;
            let f = c != null ? c.a(a) : null;
            for (let g of fromEnum(b._bj)) {
                if (SpreadsheetPaneManager._cp(a, g._i, d, g._h, e, f) == false) {
                    return false;
                }
            }
            if (b._al == false || b._am == false) {
                if (b._bi.count > 0) {
                    let h = 0;
                    let i = a._rows$i.maxCount - 1;
                    for (let j of fromEnum(b._bi)) {
                        if (SpreadsheetPaneManager._cp(a, h, j._i, i, j._h, f) == false) {
                            return false;
                        }
                    }
                }
                if ((b._bi.count == 0 && b._bj.count == 0) || b._aw) {
                    for (let k of fromEnum(b.cellRanges)) {
                        if (b._az(k) == false && b._a0(k) == false) {
                            if (SpreadsheetPaneManager._cp(a, k.firstRow, k.firstColumn, k.lastRow, k.lastColumn, f) == false) {
                                return false;
                            }
                        }
                    }
                }
            }
        }
        return true;
    }
    static _cp(a, b, c, d, e, f) {
        if (a.isProtected == false) {
            return true;
        }
        let g = b;
        let h = false;
        let i = LockedEditRangeInfoForCellRange.a(f, b, c, d, e);
        for (let j of fromEnum(a._rows$i._m(b, d))) {
            let k = j.index;
            if (g != k) {
                if (i != null) {
                    i.f(g, k - 1);
                }
                h = true;
            }
            else {
                g++;
            }
            let l;
            let m = c;
            let n = j._hasCellFormat;
            let o = n && nullableEquals(j._cellFormatInternal.d._c5, true);
            for (let p of fromEnum(j._ch(c, e, true))) {
                if (p.n == false) {
                    continue;
                }
                if (m != p.r) {
                    if (n) {
                        if (o) {
                            if (i == null || i.b(j, m, p.r - 1) == false) {
                                return false;
                            }
                        }
                    }
                    else {
                        for (let q = m, r = p.r; q < r; q++) {
                            l = a._cb(q);
                            if (nullableEquals(l.b._c5, true)) {
                                if (i == null || i.b(j, Math.max(q, l.q), Math.min(p.r - 1, l.r)) == false) {
                                    return false;
                                }
                            }
                            q = l.r;
                        }
                    }
                }
                if (nullableEquals(p.j._c5, true)) {
                    if (i == null || i.c(k, p.r) == false) {
                        return false;
                    }
                }
                m = p.r + 1;
            }
            if (m <= e) {
                if (n) {
                    if (o) {
                        if (i == null || i.b(j, m, e) == false) {
                            return false;
                        }
                    }
                }
                else {
                    for (let s = m; s <= e; s++) {
                        l = a._cb(s);
                        if (nullableEquals(l.b._c5, true)) {
                            if (i == null || i.b(j, Math.max(m, l.q), Math.min(e, l.r)) == false) {
                                return false;
                            }
                        }
                        s = l.r;
                    }
                }
            }
        }
        if (g != d + 1) {
            if (i != null) {
                i.f(g, d);
            }
            h = true;
        }
        if (h) {
            let t = a._f9(c);
            let u = a._ff;
            let v = u._inner[t];
            for (let w = t; w < u.count; w++) {
                v = u._inner[w];
                if (nullableEquals(v.b._c5, true)) {
                    if (i == null || i.d(Math.max(c, v.q), Math.min(e, v.r)) == false) {
                        return false;
                    }
                }
                if (v.r >= e) {
                    break;
                }
            }
        }
        return true;
    }
    _eh(a) {
        if (isInfinity(a)) {
            a = this._dz(truncate(this._jl.height));
        }
        return this._ek(this._dn, a, this._d3, this._bb.workbook.maxRowCount - 1, true, runOn(this._bb, this._bb._e2), runOn(this, this._dz), runOn(this, this._em), runOn(this, this._fi), runOn(this, this._fe));
    }
    _ek(a, b, c, d, e, f, g, h, i, j) {
        let k = Enumerable.ad(SpreadsheetScrollRegion.$, a);
        let l = Enumerable.ah(SpreadsheetScrollRegion.$, a);
        let m = 0;
        let n = 0;
        if (k != l) {
            let o = 0;
            if (c > 0 && !k.isFrozen) {
                let p = k._bu;
                if (b > p && b - p < c) {
                    o = b - p;
                }
            }
            m = this._ej(k, b, o, f, h, i, j, d, e, NaN);
            if (!e && k.isFrozen) {
                k._bt = (g(truncate(Enumerable.ab(WorksheetItemPosition.$, k._m, (q) => q._i))) - k._bw) * this._dw;
            }
            let q = Math.min(k._bu + o, b);
            b -= q;
            if (!e) {
                k.actualExtent = q;
                this._i0(k, g);
            }
            if (!k.isFrozen) {
                k.endIndex = k._m.count == 0 ? k.startIndex : Enumerable.ah(WorksheetItemPosition.$, k._m)._j;
            }
            else {
                k._bk = 0;
            }
            b -= c;
            if (!e) {
            }
        }
        if (b < 0) {
            b = 0;
        }
        if (!e) {
            l._bt = b;
        }
        n = this._ej(l, b, 0, f, h, i, j, d, e, e ? b : NaN);
        if (!e) {
            if (l._m.count > 0) {
                l.startIndex = l._m._inner[0]._j;
            }
            l.actualExtent = b;
            l.endIndex = l._m.count == 0 ? l.startIndex : Enumerable.ah(WorksheetItemPosition.$, l._m)._j;
            this._i0(l, g);
        }
        return Math.max(m, n);
    }
    _cs(a) {
        let b = this.activePane.selection;
        let c = b._s();
        let d = this._getCellRange1(a.row, a.column);
        c = c.union(d);
        c = this.extendRangeForMergedCells(c);
        return this._cz(c);
    }
    _hi(a) {
    }
    _hj(a, b, c) {
        switch (b != null ? b : "") {
            case "Add":
            case "Remove":
            case "Replace":
            case "Move":
            case "Reset":
                if (this._a2._af(a)) {
                    if (this._a2._j.count > 1) {
                        this._ht(2097152);
                    }
                }
                break;
            case "ChartAdapter":
                this._cj = true;
                this._p.ad();
                break;
        }
    }
    _hl(a, ...b) {
    }
    _hn() {
        this._bl = null;
        let a = dateNow();
        while (this._dp.count > 0) {
            let b = this._dp.b();
            if (b._b) {
                b._c();
                break;
            }
        }
        this._iv();
    }
    _cv() {
        this._ho(false);
        if (this._b7(8)) {
            this._gu();
        }
        if (this._dn.count == 0 || this._dh.count == 0) {
            return false;
        }
        return true;
    }
    _ho(a = true) {
        let b = this._b7(32768);
        if (b) {
            return;
        }
        try {
            this._ip(32768, true);
            this._hp();
        }
        finally {
            this._ip(32768, false);
        }
        if (this._cw() && a) {
            this._ho(false);
        }
        this._ip(65536, this._at != 0);
    }
    _hp() {
        let a = this._at;
        this._at = 0;
        if (a != 0) {
            if ((a & 5) == 5) {
                this._p.z();
            }
            if ((a & 3) == 3) {
                this._ht(16);
            }
            if ((a & 64) == 64) {
                this._ht(1024);
            }
            if ((a & 8192) == 8192) {
                this._ht(8388608);
            }
            if ((a & 128) == 128) {
                this._ht(4194304);
            }
            if ((a & 9) == 9) {
                this._ip(32, true);
            }
            if ((a & 17) == 17) {
                this._ip(8, true);
            }
            if ((a & 49) == 49) {
                this._ip(131072, true);
            }
            if ((a & 257) == 257) {
                this._ht(4194304);
            }
            if ((a & 515) == 515) {
                this._p.ad();
            }
            if ((a & 65536) == 65536) {
                this._p.g.l();
                this._ht(268435456);
            }
            if ((a & 4096) == 4096) {
                this._ip(33554432 | 67108864, true);
            }
            if ((a & 1024) == 1024) {
                this._iz();
            }
            if ((a & 2048) == 2048) {
                this._gk();
            }
            if ((a & 16384) == 16384) {
                this._ip(134217728, true);
            }
            if ((a & 32768) == 32768) {
                this._p.k.n(true);
            }
            if ((a & 1) == 1) {
                this._cj = true;
            }
        }
    }
    _cw() {
        let a = this._b7(131072);
        if (a) {
            this._hq();
        }
        this._ip(524288, false);
        return a;
    }
    _hq() {
        this._ip(131072, false);
        let a = this._ji.height;
        let b = this._ji.width;
        let c = this._bb.displayOptions;
        let d = this._bb.displayOptions.magnificationInNormalView / 100;
        let e = d - this._d8;
        a -= this._dx * e;
        b -= this._d2 * e;
        for (let f of fromEnum(this._dn)) {
            if (f.isFrozen == false && f._ab != null) {
                let g = f._ab;
                let h = g._u(true);
                let i = g.activeCell;
                let j = f.startIndex <= i.row && i.row <= f.endIndex && h._contains(i);
                let k = Math.max(Math.min(a, f.actualExtent) / (c.magnificationInNormalView / 100), 0);
                let l = new WorksheetItemPosition();
                if (this._b7(524288)) {
                    if (j) {
                        l = this._bb._cp(f.startIndex);
                    }
                    else {
                        l = this._bb._cp(h.firstRow);
                    }
                }
                else {
                    let m = Math.max(truncate(f._bg) - this._em(k / 2), 0);
                    l = this._bb._cq(m);
                    if (m > l._m + intDivide(l._i, 2) && l._j < this._u.lastRow) {
                        l = this._bb._cq(l._l + 1);
                    }
                }
                let n = l._j;
                if (j) {
                    if (h.firstRow < n) {
                        n = h.firstRow;
                        l = this._bb._cp(n);
                    }
                    else if (h.firstRow > n) {
                        let o = l._m + this._em(k);
                        let p = this._bb._cq(o);
                        if (o < p._l && p._j > n) {
                            p = this._bb._cq(p._m - 1);
                        }
                        if (h.lastRow > p._j) {
                            p = this._bb._cp(h.lastRow);
                            let q = Math.max(p._l - this._em(k), 0);
                            l = this._bb._cq(q);
                            if (l._m < q) {
                                l = this._bb._cq(l._l + 1);
                            }
                            n = l._j;
                        }
                    }
                    if (i.row < n) {
                        n = i.row;
                    }
                    else if (i.row > n) {
                        let r = l._m + this._em(k);
                        let s = this._bb._cq(r);
                        if (s._l < r && s._j > l._j) {
                            s = this._bb._cq(s._m - 1);
                        }
                        if (i.row > s._j) {
                            let t = Math.max(s._l - this._em(k), 0);
                            l = this._bb._cq(t);
                            if (l._m < t) {
                                l = this._bb._cq(l._l + 1);
                            }
                            n = l._j;
                        }
                    }
                }
                if (f == this._dn.item(0)) {
                    c.unfrozenPaneSettings.firstRowInTopPane = n;
                }
                else if (this._dn.item(0).isFrozen) {
                    c.frozenPaneSettings.firstRowInBottomPane = n;
                }
                else {
                    c.unfrozenPaneSettings.firstRowInBottomPane = n;
                }
            }
            a -= f.actualExtent;
            if (f.isFrozen) {
                a -= f.actualExtent * e;
            }
        }
        for (let u of fromEnum(this._dh)) {
            if (u.isFrozen == false && u._ab != null) {
                let v = u._ab;
                let w = v._u(true);
                let x = v.activeCell;
                let y = u.startIndex <= x.column && x.column <= u.endIndex && w._contains(x);
                let z = Math.max(Math.min(b, u.actualExtent) / (c.magnificationInNormalView / 100), 0);
                let aa = new WorksheetItemPosition();
                if (this._b7(524288)) {
                    if (y) {
                        aa = this._bb._cn(u.startIndex);
                    }
                    else {
                        aa = this._bb._cn(w.firstColumn);
                    }
                }
                else {
                    let ab = Math.max(truncate(u._bg) - this._el(z / 2), 0);
                    aa = this._bb._co(ab);
                    if (ab > aa._m + intDivide(aa._i, 2) && aa._j < this._u.lastColumn) {
                        aa = this._bb._co(aa._l + 1);
                    }
                }
                let ac = aa._j;
                if (y) {
                    if (w.firstColumn < ac) {
                        ac = w.firstColumn;
                        aa = this._bb._cn(ac);
                    }
                    else if (w.firstColumn > ac) {
                        let ad = aa._m + this._el(z);
                        let ae = this._bb._co(ad);
                        if (ad < ae._l && ae._j > ac) {
                            ae = this._bb._co(ae._m - 1);
                        }
                        if (w.lastColumn > ae._j) {
                            ae = this._bb._cn(w.lastColumn);
                            let af = Math.max(ae._l - this._el(z), 0);
                            aa = this._bb._co(af);
                            if (aa._m < af) {
                                aa = this._bb._co(aa._l + 1);
                            }
                            ac = aa._j;
                        }
                    }
                    if (x.column < ac) {
                        ac = x.column;
                    }
                    else if (x.column > ac) {
                        let ag = aa._m + this._el(z);
                        let ah = this._bb._co(ag);
                        if (ah._l < ag && ah._j > aa._j) {
                            ah = this._bb._co(ah._m - 1);
                        }
                        if (x.column > ah._j) {
                            let ai = Math.max(ah._l - this._el(z), 0);
                            aa = this._bb._co(ai);
                            if (aa._m < ai) {
                                aa = this._bb._co(aa._l + 1);
                            }
                            ac = aa._j;
                        }
                    }
                }
                if (u == this._dh.item(0)) {
                    c.unfrozenPaneSettings.firstColumnInLeftPane = ac;
                }
                else if (this._dh.item(0).isFrozen) {
                    c.frozenPaneSettings.firstColumnInRightPane = ac;
                }
                else {
                    c.unfrozenPaneSettings.firstColumnInRightPane = ac;
                }
            }
            b -= u.actualExtent;
            if (u.isFrozen) {
                b -= u.actualExtent * e;
            }
        }
        if (!this._b7(524288)) {
            this._ip(262144, true);
        }
    }
    _hs() {
        if (!this._b7(256)) {
            this._a7.m();
        }
    }
    _ht(a) {
        if ((this._av & a) != a) {
            this._ip(a, true);
            this._hs();
        }
    }
    _cy(a, b, c, d, e = false) {
        let f = this.activePane;
        let g = f != null ? f.selection : null;
        c = false;
        if (g != null) {
            for (let h of fromEnum(this._a2._j)) {
                let i = h._j;
                if (b && i.isProtected && i.protection.allowInsertingHyperlinks == false) {
                    continue;
                }
                let j = SpreadsheetPaneManager._hx(a, b, c, i, g.cellRanges);
                c = j.p2;
                if (b && (c || e)) {
                    if (SpreadsheetPaneManager._co(i, g, d) == false) {
                        return {
                            ret: false,
                            p2: c
                        };
                    }
                    else {
                        return {
                            ret: true,
                            p2: c
                        };
                    }
                }
            }
        }
        return {
            ret: c,
            p2: c
        };
    }
    static _hx(a, b, c, d, e) {
        c = false;
        if (d._d8) {
            for (let f of fromEnum(e)) {
                let g = SpreadsheetUtilities.ay(f);
                for (let h = d._hyperlinks$i.count - 1; h >= 0; h--) {
                    let i = d._hyperlinks$i.item(h);
                    let j = i.sourceRegion._h;
                    if (g._h(j) || j._h(g)) {
                        c = true;
                        if (b) {
                            return {
                                p2: c
                            };
                        }
                        d._hyperlinks$i._s(h, a);
                    }
                }
            }
        }
        return {
            p2: c
        };
    }
    _cz(a) {
        let b = this.activePane.selection;
        if (b != null && this._canSelect1(a) && b._replaceActiveCellRange1(a, b.activeCell)) {
            return true;
        }
        return false;
    }
    _hz(a, b, c, d) {
        let e;
        let f = ((() => { let g = this._ad(a, b, c, d, e); e = g.p4; return g.ret; })());
        this._cz(f);
        this._f2(e, f, null);
    }
    _h2() {
        this._t = this._w = SpreadsheetCellRange.empty;
    }
    _h3(a) {
        for (let b of fromEnum(this._a2._j)) {
            let c = b._j;
            let d = c._columns$i;
            if (a == 0) {
                c._hideColumns$i();
            }
            else if (a < 0) {
                {
                    let e = this._a9();
                    try {
                        let f = new CellSizeMeasurementContext(c.workbook, e);
                        let g = this._u;
                        let h = c._c4(g.firstRow, g.lastRow, g.firstColumn, g.lastColumn, false);
                        let i = false;
                        for (let j = h._w; j <= h._x; j++) {
                            let k = d.item(j);
                            let l = k._ay(h._ac, h._ae, f);
                            k.width = !nullableIsNull(l) ? l.value : k.width;
                            if (i) {
                                k.hidden = false;
                            }
                        }
                    }
                    finally {
                        if (e != null) {
                            e.dispose();
                        }
                    }
                }
            }
            else {
                c.defaultColumnWidth = a;
                let m = new List$1(IndexRange.$, 0);
                m.add(new IndexRange(1, 0, c._columns$i.maxCount - 1));
                c._ik(m, -1);
            }
        }
    }
    _h4(a) {
        let b = false;
        for (let c of fromEnum(this._a2._j)) {
            let d = c._j;
            if (a == 0) {
                d._dv = true;
                d._hideRows$i();
            }
            else {
                d._dv = false;
                d.defaultRowHeight = a;
                for (let e of fromEnum(d._rows$i)) {
                    e.hidden = false;
                    if (this._c6(e, a)) {
                        b = true;
                    }
                }
            }
        }
        if (b) {
            this._at |= 5 | 9;
            this._ht(65536);
        }
    }
    _h5(a, b) {
        for (let c of fromEnum(this._a2._j)) {
            let d = a;
            let e = c._j;
            let f = e._columns$i.item(b);
            if (d == 0) {
                f.hidden = true;
            }
            else {
                if (d < 0) {
                    let g;
                    {
                        let h = this._a9();
                        try {
                            g = f._ay(0, e._rows$i.maxCount - 1, new CellSizeMeasurementContext(e.workbook, h));
                        }
                        finally {
                            if (h != null) {
                                h.dispose();
                            }
                        }
                    }
                    if (!g.hasValue) {
                        continue;
                    }
                    d = g.value;
                }
                f.hidden = false;
                f.width = d;
            }
        }
    }
    _h6(a, b) {
        if (a < 0) {
            let c = new Array(b.length);
            for (let d = 0; d < b.length; d++) {
                c[d] = new SpreadsheetCellRange(this._u.firstRow, b[d]._i, this._u.lastRow, b[d]._h);
            }
            this._f0(c, false);
        }
        else {
            let e = new List$1(IndexRange.$, 2, b.length);
            for (let f = 0; f < b.length; f++) {
                e.add(new IndexRange(1, b[f]._i, b[f]._h));
            }
            for (let g of fromEnum(this._a2._j)) {
                g._j._ik(e, a);
            }
        }
    }
    _h7(a, b) {
        let c = false;
        for (let d of fromEnum(this._a2._j)) {
            let e = d._j;
            let f = e._rows$i.item(b);
            if (a == 0) {
                f.hidden = true;
            }
            else {
                f.hidden = false;
                if (this._c6(f, a)) {
                    c = true;
                }
            }
        }
        if (c) {
            this._at |= 5 | 9;
            this._ht(65536);
        }
    }
    _h8(a, b) {
        let c = new List$1(IndexRange.$, 2, b.length);
        for (let d = 0; d < b.length; d++) {
            c.add(new IndexRange(1, b[d]._i, b[d]._h));
        }
        for (let e of fromEnum(this._a2._j)) {
            e._j._im(c, a);
        }
    }
    _c1(a, b, c, d, e, f, g, h, i) {
        let j = a.startIndex;
        let k;
        switch (b) {
            case 4:
                k = g(a.startIndex, true);
                j = !nullableIsNull(k) ? k.value : a.startIndex;
                break;
            case 1:
                k = g(a.startIndex, false);
                j = !nullableIsNull(k) ? k.value : a.startIndex;
                break;
            case 3:
                let l = (a.endIndex - a.startIndex) + 1;
                if (!CoreUtilities.c(a._bk, 0) && a.endIndex != a.startIndex) {
                    l -= 1;
                }
                k = g(a.startIndex + l - 1, true);
                j = !nullableIsNull(k) ? k.value : a.startIndex + l;
                break;
            case 0:
                let m = i(a.startIndex);
                if (CoreUtilities.c(a._x._ac, m._m) && CoreUtilities.e(a._x._ac, a._x._ab)) {
                    m = i(a.startIndex - 1);
                }
                let n = Math.max(m._l - a._x._af, a._x._ab);
                let o = h(truncate(MathUtilities.f(n)));
                if (CoreUtilities.e(n, o._m)) {
                    o = i(Math.min(o._j + 1, a.startIndex - 1));
                }
                j = o._j;
                break;
            default: return false;
        }
        return this._c2(a, j, d, e, f, h, i);
    }
    _c2(a, b, c, d, e, f, g) {
        a._bw = 0;
        if (b < 0) {
            b = c;
        }
        else {
            b = Math.max(Math.min(b, d - 1), c);
            if (b != a.startIndex) {
                let h = a._s;
                let i = a._x;
                if (h == null || h.c != i._af || h.a != e) {
                    let j = g(b);
                    if (j._m >= e - i._af) {
                        let k = e - i._af;
                        let l = f(truncate(MathUtilities.f(k)));
                        let m = l._j;
                        if (l._m < k) {
                            m++;
                            k = l._l;
                        }
                        a._s = h = new PageStartScrollCache(i._af, e, k, m);
                    }
                    else {
                        a._s = h = null;
                    }
                }
                if (h != null && b > h.d) {
                    b = h.d;
                }
            }
        }
        a.startIndex = b;
        return true;
    }
    _c0(a, b, c) {
        return this._c1(a, b, c, this._ed, this._bb.workbook.maxColumnCount, this._jj.width, runOn(this, this._eq), runOn(this, this._be), runOn(this._bb, this._bb._cn));
    }
    _c3(a, b, c) {
        return this._c1(a, b, c, this._ee, this._bb.workbook.maxRowCount, this._jj.height, runOn(this, this._er), runOn(this._bb, this._bb._cq), runOn(this._bb, this._bb._cp));
    }
    _ij(a, b = true) {
        let c = Nullable$1.toNullable(SpreadsheetCellRange.$, this._getCellRange1(a.row, a.column));
        this._ik(a, b, c);
    }
    _ik(a, b, c) {
        let d = this.activePane;
        let e = d != null ? d.selection : null;
        if (e != null && this._canSelect(a)) {
            let f = e._x == 2;
            let g = true;
            if (f) {
                if (b && !e._av) {
                    e._av = true;
                    g = e._ah(a);
                }
                else {
                    g = e._a4(a);
                }
            }
            else {
                g = e._a9(a);
            }
            if (g && SpreadsheetCellRange._l_op_Inequality_Lifted$i(c, Nullable$1.toNullable(SpreadsheetCellRange.$, null))) {
                this._b3(null, c.value, true);
            }
        }
    }
    _c5(a, b) {
        let c = this._av;
        if (b) {
            c |= a;
        }
        else {
            c &= ~a;
        }
        if (c == this._av) {
            return false;
        }
        this._av = c;
        this.a(SpreadsheetPaneManager._db.item(a));
        return true;
    }
    _ip(a, b) {
        if (b) {
            this._av |= a;
        }
        else {
            this._av &= ~a;
        }
    }
    _c6(a, b) {
        if (b < 0 && a.height < 0) {
            a._dx(true);
            return true;
        }
        else {
            a.height = b;
            return false;
        }
    }
    _iv() {
        if (this._dp.count > 0 && this._bl == null && (this._az == null || !this._az._i || !this._az._at)) {
            this._az = null;
            this._bl = new TimedOperation(runOn(this, this._hn), 50);
        }
    }
    _iw() {
        if (this._bl != null) {
            let a = this._bl;
            this._bl = null;
            a.c();
        }
    }
    _iz() {
        this._bn = this._bb.displayOptions.showFormulasInCells;
        this._jh = this._bb._jg;
    }
    _i0(a, b) {
        if (a.isFrozen || a._m.count == 0) {
            a._bk = 0;
        }
        else {
            let c = Enumerable.ah(WorksheetItemPosition.$, a._m);
            let d = b(c._l) - (a._bw + b(a._m._inner[0]._m) + a.actualExtent / this._dw);
            a._bk = Math.max(d, 0);
        }
    }
    _i1() {
        let a = this._bb.displayOptions;
        let b = a.unfrozenPaneSettings;
        let c = a.frozenPaneSettings;
        let d = a.panesAreFrozen ? c : b;
        let e = this._b7(1048576);
        try {
            this._ip(1048576, true);
            if (this._dh.count > 0) {
                b.firstColumnInLeftPane = this._dh.item(0).startIndex;
                if (this._dh.count > 1) {
                    d.firstColumnInRightPane = this._dh.item(1).startIndex;
                }
            }
            if (this._dn.count > 0) {
                b.firstRowInTopPane = this._dn.item(0).startIndex;
                if (this._dn.count > 1) {
                    d.firstRowInBottomPane = this._dn.item(1).startIndex;
                }
            }
        }
        finally {
            this._ip(1048576, e);
        }
    }
    _i2() {
        if (this._b7(2097152)) {
            this._ip(2097152, false);
            let a = this._bb.displayOptions;
            let b = this._ff(this.activePane);
            if (nullableNotEquals(b, null)) {
                a._z = b.value;
            }
            let c = a._af.b;
            if (c.count != this._dl.count) {
                while (c.count > this._dl.count) {
                    c.removeAt(c.count - 1);
                }
                while (c.count < this._dl.count) {
                    c.add(new WorksheetPaneSelection());
                }
            }
            let d = null;
            for (let e = 0; e < this._dl.count; e++) {
                let f = this._dl.item(e);
                let g = f.selection;
                let h = c.item(e);
                if (f == this.activePane) {
                    d = h;
                }
                h.a = this._ff(f).value;
                h.b = SpreadsheetUtilities.aw(g.activeCell);
                h.f = g.activeCellRangeIndex;
                let i = g.cellRanges;
                let j = h.d;
                j.clear();
                for (let k of fromEnum(i)) {
                    j.add(SpreadsheetUtilities.ay(k));
                }
            }
            if (d != null) {
                for (let l of fromEnum(this._a2._j)) {
                    if (l._j != this._bb) {
                        let m = l._j.displayOptions;
                        let n = m._af;
                        m._br();
                        for (let o of fromEnum(n.b)) {
                            o.g(d);
                        }
                    }
                }
            }
        }
    }
    _i4() {
        let a = this.activePane != null ? this.activePane.selection : null;
        if (this._a0 != null) {
            a = this._a0;
        }
        for (let b of fromEnum(this._dh)) {
            b._ab = a;
        }
        for (let c of fromEnum(this._dn)) {
            c._ab = a;
        }
        if (a != null) {
            a._by();
        }
    }
    _i6() {
        let a = this._dl;
        for (let b = 0; b < a.count; b++) {
            let c = a.item(b);
            let d = c.rowScrollRegion.startIndex;
            let e = c.rowScrollRegion.endIndex;
            let f = !nullableIsNull(c.columnScrollRegion._cr) ? c.columnScrollRegion._cr.value : c.columnScrollRegion.startIndex;
            let g = c.columnScrollRegion.endIndex;
            let h = c._q;
            let i = new List$1(SpreadsheetDropDownButton.$, 0);
            let j = this._b6(i, c, d, e, f, g, h);
            if (j || !CoreUtilities.d(SpreadsheetDropDownButton.$, i, c._q)) {
                c._q._a3(i);
            }
        }
    }
    _i7() {
        if (this._b7(8192)) {
            this._p.ae();
            this._ip(8192, false);
        }
    }
    _i8() {
        let a = this._b7(16384);
        let b = this._al._j;
        this._ip(16384, true);
        b.ak();
        try {
            this._p.ak();
        }
        finally {
            b.an();
            this._ip(16384, a);
        }
    }
    _i9() {
        this._jd();
        if (this._b7(32)) {
            this._ip(32, false);
            this._jl = this._jm(this._w);
            this._jk = this._jm(this._v);
            this._jj = this._jm(this._u);
        }
    }
    _jb() {
        this._i9();
        let a = this._b7(64);
        this._ip(64, true);
        try {
            let b = this._gv(this._dh, this._jl.width, this._bb.defaultColumnWidth, runOn(this._bb, this._bb._cn), runOn(this, this._be), runOn(this, this._el), this._bb.workbook.maxColumnCount, this._ji.width + this._d2, this._ed);
            this._ed = b.p8;
            let c = this._gv(this._dn, this._jl.height, this._bb.defaultRowHeight, runOn(this._bb, this._bb._cp), runOn(this._bb, this._bb._cq), runOn(this, this._em), this._bb.workbook.maxRowCount, this._ji.height + this._dx, this._ee);
            this._ee = c.p8;
        }
        finally {
            this._ip(64, a);
            this._ip(262144, false);
        }
    }
    _ja() {
        let a = this._bb.workbook;
        if (a == null) {
            return;
        }
        let b = a.windowOptions.scrollBars;
        this._ca = SpreadsheetPaneManager._cn(b, false);
        this._ce = SpreadsheetPaneManager._cn(b, true);
        if (this._b7(4)) {
            this._ip(4, false);
            let c = this._ca ? 3 : 2;
            let d = this._ce ? 3 : 2;
            for (let e of fromEnum(this._dh)) {
                e._x._b = c;
            }
            for (let f of fromEnum(this._dn)) {
                f._x._b = d;
            }
        }
    }
    _d7(a, b, c, d) {
        if (b < 0) {
            b = 0;
        }
        let e = d(truncate(MathUtilities.f(b)));
        let f;
        let g;
        if (a._x._a3) {
            f = e._j;
            g = a._b4(truncate(b) - e._m);
        }
        else {
            f = Math.min(b < (e._m + intDivide(e._i, 2)) ? e._j : e._j + 1, c - 1);
            g = 0;
        }
        a.startIndex = f;
        a._bw = g;
        this._cj = true;
        return b;
    }
    _d5(a, b) {
        return this._d7(a, b, this._bb.workbook.maxColumnCount, runOn(this, this._be));
    }
    _d6(a, b) {
        return this._d7(a, b, this._bb.workbook.maxRowCount, runOn(this._bb, this._bb._cq));
    }
    _jc() {
        let a = this._b7(256);
        if (a) {
            return;
        }
        this._a7.i();
        this._ip(256, true);
        try {
            this._i2();
            if (this._b7(65536)) {
                this._ho();
            }
            if (this._b7(8)) {
                this._gu();
            }
            if (this._b7(4194304)) {
                this._gr();
            }
            this._ja();
            this._i2();
            if (this._b7(4096)) {
                this._ip(4096, false);
                for (let b of fromEnum(this._dn)) {
                    b._ad = this._a6;
                }
                for (let c of fromEnum(this._dh)) {
                    c._ad = this._a6;
                }
            }
            if (this._b7(1024)) {
                this._ip(1024, false);
                this._ip(8388608 | 134217728, true);
                let d = this.activePane;
                if (d != null) {
                    d.selection._bz();
                }
            }
            if (this._b7(512)) {
                this._ip(512, false);
                let e = this.activePane;
                let f = e != null ? e.selection : null;
                this._cd = f != null && f._bi.count == 1 && f._bi.item(0)._i <= this._u.firstColumn && f._bi.item(0)._h >= this._u.lastColumn && f._bj.count == 1 && f._bj.item(0)._i <= this._u.firstRow && f._bj.item(0)._h >= this._u.firstColumn;
            }
            if (this._b7(16777216)) {
                this._ip(16777216, false);
                this._ip(33554432 | 134217728, true);
                let g = this.activePane;
                let h = g != null ? g.selection : null;
                this._ao = h != null ? this._ar(h.activeCell) : null;
            }
            if (this._b7(33554432)) {
                this._ip(33554432, false);
                let i = this.activePane;
                let j = i != null ? i.selection : null;
                let k = j == null || this._bb._d6 == false ? null : this._bb._dataValidationRules$i._e(SpreadsheetUtilities.ax(j.activeCell));
                this._fu = k == null || k.showInputMessage == false || stringIsNullOrEmpty(k.inputMessageDescription) ? null : Tuple.a(String_$type, String_$type, k.inputMessageTitle, k.inputMessageDescription);
            }
            if (this._b7(67108864)) {
                this._ip(67108864, false);
                this._ip(134217728, true);
                let l = this._bb._fd;
                let m = l.count;
                for (let n = m - 1; n >= 0; n--) {
                    if (l._inner[n].dataValidationRule == null) {
                        l.removeAt(n);
                    }
                }
                if (m != l.count) {
                    this._cj = true;
                }
            }
            if (this._b7(8388608)) {
                this._ip(8388608, false);
                this._ip(134217728, true);
                let o = null;
                let p = this.activePane;
                let q = p != null ? p.selection : null;
                if (q != null) {
                    o = this._bi(q.activeCell.row, q.activeCell.column);
                }
                this._bh = o;
            }
            if (this._b7(134217728)) {
                this._ip(134217728, false);
                this._i6();
            }
            if (this._b7(268435456)) {
                this._ip(268435456, false);
                if (this._p.o()) {
                    this._cj = true;
                }
            }
        }
        finally {
            this._ip(256, a);
        }
    }
    _jd() {
        if (this._b7(16)) {
            this._ip(16, false);
            this._t = this._x();
            let a = 20;
            let b = 8;
            let c = this._v.isEmpty ? 0 : this._v.firstRow;
            let d = this._v.isEmpty ? 0 : this._v.firstColumn;
            this._w = new SpreadsheetCellRange(c, d, Math.max(this._t.lastRow, Math.min(this._u.lastRow, c + a)), Math.max(this._t.lastColumn, Math.min(this._u.lastColumn, d + b)));
            this._ip(32, true);
        }
    }
    _jf(a) {
        let b = this._bb.workbook;
        if (b == null) {
            return;
        }
        let c = this.activePane.selection._u(true);
        if (a) {
            if (WorksheetRegionAddress._p(this._bb._g1, Nullable$1.toNullable(WorksheetRegionAddress.$, null))) {
                return;
            }
            c = SpreadsheetUtilities.z(this._bb._g1.value);
        }
        else {
            let d = SpreadsheetUtilities.ay(c);
            for (let e of fromEnum(this._a2._j)) {
                e._j._g1 = Nullable$1.toNullable(WorksheetRegionAddress.$, d);
            }
        }
        this._bb._g1 = Nullable$1.toNullable(WorksheetRegionAddress.$, null);
        let f = this._dz(this._bb._cp(c.firstRow)._m);
        let g = this._dz(this._bb._cp(c.lastRow)._l);
        let h = this._dy(this._bb._cn(c.firstColumn)._m);
        let i = this._dy(this._bb._cn(c.lastColumn)._l);
        let j = i - h;
        let k = g - f;
        if (this._dn.item(0).isFrozen && this._dn.item(0).startIndex < c.firstRow) {
            let l = this._dz(this._bb._cp(this._dn.item(0).startIndex)._m);
            let m = this._dz(this._bb._cp(Math.min(this._dn.item(0).endIndex, c.firstRow - 1))._l);
            k += m - l;
        }
        if (this._dh.item(0).isFrozen && this._dh.item(0).startIndex < c.firstColumn) {
            let n = this._dy(this._bb._cn(this._dh.item(0).startIndex)._m);
            let o = this._dy(this._bb._cn(Math.min(this._dh.item(0).endIndex, c.firstColumn - 1))._l);
            j += o - n;
        }
        let p = this._bb.displayOptions.showRowAndColumnHeaders;
        let q = this._ji;
        if (p) {
            let r = Math.max(c.lastRow, 100);
            let s;
            if (b.cellReferenceMode == 1) {
                s = this._fq(r);
            }
            else {
                s = this._fr(r);
            }
            let t = this._al._j.z(this._dn.item(0), s);
            let u = this._al._j.w(b, 100, 0);
            let v = t;
            k += u;
            j += v;
            q.height += Math.max(0, this._dx - (3 * this._dt + this._dt));
            q.width += Math.max(0, this._d2 - (3 * this._ds + this._ds));
        }
        let w = Math.floor(q.width / j * 100);
        let x = Math.floor(q.height / k * 100);
        this._ip(524288, true);
        let y = truncate(CoreUtilities.l(Math.min(w, x), 10, 400));
        if (y != this._bb.displayOptions.magnificationInNormalView) {
            this._bb.displayOptions.magnificationInNormalView = y;
        }
        else if (!this._b7(131072)) {
            this._ip(131072, true);
            this._cw();
        }
    }
    activatePane(a) {
        if (!this.canActivatePane(a)) {
            return false;
        }
        if (this.activePane != a) {
            if (this._d9 != null && !this._d9(a)) {
                return false;
            }
        }
        this.activePane = a;
        return true;
    }
    scrollRangeIntoView(pane, rowRange, columnRange) {
        arguments[1] = wrapNullable(IntRange.$, arguments[1]);
        arguments[2] = wrapNullable(IntRange.$, arguments[2]);
        return this._scrollRangeIntoView$i.apply(this, arguments);
    }
    _scrollRangeIntoView$i(a, b, c) {
        this._b4(a, b, c, true);
    }
    canActivatePane(a) {
        return !a.rowScrollRegion.isFrozen && !a.columnScrollRegion.isFrozen;
    }
    canSelect(a) {
        return this._canSelect(a);
    }
    canSelect1(a) {
        return this._canSelect1(a);
    }
    getFilter(a, b) {
        let c = this._bi(a, b);
        if (c != null) {
            return c._columns$i._item(b - c._by._w).filter;
        }
        let d = this._bb.filterSettings;
        if (d.region != null && d.region._q(a, b)) {
            let e = b - d.region.firstColumn;
            return d.getFilter(e);
        }
        return null;
    }
    getHeaderCaption(a, b) {
        return this._fp(new SpreadsheetCell(a, b));
    }
    getPane(a, b) {
        for (let c of fromEnum(this._dl)) {
            if (c.rowScrollRegion == a && c.columnScrollRegion == b) {
                return c;
            }
        }
        return null;
    }
    get renderCache() {
        return this._al._j;
    }
    get spreadsheetOwnerState() {
        return this._al;
    }
    verifyScrollPositions() {
        if (!this._ji.isEmpty) {
            this._jn(this._ji);
        }
    }
    getScrollableRegion(a) {
        if (a != null && a.isFrozen) {
            let b = a._aw ? this._dm : this._dg;
            if (b.count > 1) {
                a = b.item(1);
            }
        }
        return a;
    }
}
SpreadsheetPaneManager.$t = markType(SpreadsheetPaneManager, 'SpreadsheetPaneManager', PropertyChangeNotifierExtended.$, [ISpreadsheetPaneOwner_$type]);
SpreadsheetPaneManager._db = SpreadsheetPaneManager._dc();
/**
 * @hidden
 */
export class SpreadsheetPaneManager_IndentHelper extends Base {
    constructor(a, b) {
        super();
        this.a = null;
        this.d = null;
        this.k = 0x7FFFFFFF;
        this.j = 0;
        this.g = null;
        this.m = Nullable$1.toNullable(HorizontalCellAlignment_$type, null);
        this.h = -1;
        this.i = 0;
        this.f = null;
        this.e = false;
        this.c = null;
        this.b = new SpreadsheetCellRange();
        this.c = a.activePane;
        this.b = a._aa();
        this.i = b ? 1 : -1;
        this.e = b;
        this.a = Enumerable.a(Worksheet.$, Enumerable.o(SpreadsheetTabInfo.$, Worksheet.$, a._a3._j, (c) => c._j));
        this.g = new HashSet$1(WorksheetCellFormatData.$, 0);
    }
    n() {
        let a = this.c;
        if (a == null) {
            return;
        }
        let b = this.b;
        let e = this.a;
        for (let d = 0; d < e.length; d++) {
            let c = e[d];
            this.d = c;
            let f = runOn(this, this.r);
            for (let g of fromEnum(a.selection.cellRanges)) {
                this.g.clear();
                let h = g.firstRow <= b.firstRow && g.lastRow >= b.lastRow;
                let i = g.firstColumn <= b.firstColumn && g.lastColumn >= b.lastColumn;
                let j = Math.max(g.firstColumn, b.firstColumn);
                let k = Math.min(g.lastColumn, b.lastColumn);
                let l = Math.max(g.firstRow, b.firstRow);
                let m = Math.min(g.lastRow, b.lastRow);
                let n = 0;
                for (let o of fromEnum(c._rows$i._m(l, m))) {
                    n++;
                    this.h = j;
                    o._dj(j, k, f);
                    this.p(o, (k + 1));
                }
                if (n < (m + 1 - l)) {
                    this.h = j;
                    this.p(null, (k + 1));
                }
                if (this.k == 0 && this.e == false) {
                    return;
                }
                else if (this.j == 250 && this.e) {
                    return;
                }
            }
            this.f = null;
            if (a.selection._ax) {
                this.f = new HashSet$1(SpreadsheetCell.$, 0);
            }
            let p = runOn(this, this.u);
            for (let q of fromEnum(a.selection.cellRanges)) {
                let r = q.firstRow <= b.firstRow && q.lastRow >= b.lastRow;
                let s = Math.max(q.firstColumn, b.firstColumn);
                let t = Math.min(q.lastColumn, b.lastColumn);
                let u = Math.max(q.firstRow, b.firstRow);
                let v = Math.min(q.lastRow, b.lastRow);
                if (r) {
                    for (let w = s; w <= t; w++) {
                        this.t(c._columns$i.item(w)._cellFormatInternal, true);
                    }
                    for (let x of fromEnum(c._rows$i._m(u, v))) {
                        x._dj(s, t, p);
                    }
                }
                else {
                    let y = q.firstColumn <= b.firstColumn && q.lastColumn >= b.lastColumn;
                    if (y) {
                        for (let z = q.firstRow; z <= q.lastRow; z++) {
                            let aa = c._rows$i.item(z);
                            this.t(aa._cellFormatInternal, true);
                            aa._dj(s, t, p);
                        }
                    }
                    else {
                        for (let ab = q.firstRow; ab <= q.lastRow; ab++) {
                            let ac = c._rows$i.item(ab);
                            for (let ad = q.firstColumn; ad <= q.lastColumn; ad++) {
                                this.s(ac, ad);
                            }
                        }
                    }
                }
            }
        }
    }
    static l(a, b) {
        let c = a._ct;
        if (c != 0) {
            let d = a._co;
            if (d == 0) {
                switch (b) {
                    case 1:
                    case 3:
                    case 7: break;
                    default:
                        c = 0;
                        break;
                }
            }
            else if (d == 255) {
                switch (a._a8) {
                    case 0:
                    case 2:
                    case 4: break;
                    default:
                        c = 0;
                        break;
                }
            }
            else {
                c = 0;
            }
        }
        return c;
    }
    p(a, b) {
        while (b > this.h) {
            let c = this.d._cb(this.h);
            if (a != null && a._hasCellFormat) {
                this.q(a._cellFormatInternal.d);
            }
            else if (c.b != null) {
                this.q(c.b);
            }
            else {
                this.q(this.d.workbook._ca._p);
            }
            this.h = (c.r + 1);
        }
    }
    q(a) {
        if (this.g.add_1(a)) {
            let b = a._a4;
            if (this.g.count == 1) {
                this.m = Nullable$1.toNullable(HorizontalCellAlignment_$type, b);
            }
            else if (nullableNotEquals(b, this.m)) {
                this.m = Nullable$1.toNullable(HorizontalCellAlignment_$type, null);
            }
            let c = SpreadsheetPaneManager_IndentHelper.l(a, b);
            if (c < this.k) {
                this.k = c;
            }
            if (c > this.j) {
                this.j = c;
            }
        }
    }
    r(a, b, c) {
        this.p(a, c);
        this.q(b);
        this.h = (c + 1);
    }
    s(a, b) {
        let c = new SpreadsheetCell(a.index, b);
        if (this.f == null || this.f.add_1(c)) {
            let d = a.worksheet;
            let e = SpreadsheetPaneManager._getCellRange2(c.row, c.column, d);
            if (e.isSingleCell == false) {
                if (SpreadsheetCell._l_op_Inequality_Lifted$i(SpreadsheetPaneManager._e2(e, d), Nullable$1.toNullable(SpreadsheetCell.$, c))) {
                    return;
                }
            }
            let f = a._bc(b);
            this.t(f, false);
        }
    }
    t(a, b) {
        let c = a.d;
        let d = c._cw;
        let e = nullableEquals(this.m, null);
        let f = c._ct;
        let g = b ? 8 : 0;
        if (d == 0) {
            switch (c._a4) {
                case 1:
                case 3:
                case 7: break;
                default:
                    f = 0;
                    e = true;
                    break;
            }
        }
        else if (d == 255) {
            switch (c._a8) {
                case 0:
                case 2:
                case 4: break;
                default:
                    f = 0;
                    a._bm(2, true, g);
                    break;
            }
        }
        else {
            c.rotation = 0;
            f = 0;
        }
        if (e) {
            a._au(d == 255 ? 0 : 1, true, g);
        }
        a._a8(f + this.i, true, g);
    }
    u(a, b, c) {
        this.s(a, c);
    }
    static o(a, b) {
        let c = new SpreadsheetPaneManager_IndentHelper(a, b);
        c.n();
    }
}
SpreadsheetPaneManager_IndentHelper.$t = markType(SpreadsheetPaneManager_IndentHelper, 'SpreadsheetPaneManager_IndentHelper');
/**
 * @hidden
 */
export class SpreadsheetPaneManager_MergedCellOperationInfo extends Base {
    constructor(a, b) {
        super();
        this.e = new HashSet$1(WorksheetMergedCellsRegion.$, 0);
        this.d = false;
        this.a = null;
        this.b = null;
        this.c = false;
        let c = new HashSet$1(WorksheetMergedCellsRegion.$, 0);
        let d = false;
        let e = new Array(b.length);
        arrayCopyTo(b, e, 0);
        if (a._d9) {
            for (let f = e.length - 1; f >= 0; f--) {
                let g = e[f];
                let h = false;
                for (let i = f + 1; i < e.length; i++) {
                    if (g._contains1(e[i])) {
                        h = true;
                        break;
                    }
                }
                if (h) {
                    continue;
                }
                let j = SpreadsheetPaneManager._extendRangeForMergedCells1(a, g, c);
                if (SpreadsheetCellRange.l_op_Inequality(j, g)) {
                    e[f] = j;
                    d = true;
                }
            }
        }
        this.d = d;
        this.a = e;
        this.c = SpreadsheetCellRange._j(boxArray$1(e));
        this.e = c;
        this.b = a;
    }
}
SpreadsheetPaneManager_MergedCellOperationInfo.$t = markType(SpreadsheetPaneManager_MergedCellOperationInfo, 'SpreadsheetPaneManager_MergedCellOperationInfo');
/**
 * @hidden
 */
export class InViewPaneInfo extends Base {
    constructor(a) {
        super();
        this.v = 1;
        this.r = null;
        this.h = null;
        this.i = null;
        this.aq = null;
        this.l = null;
        this.j = null;
        this.m = false;
        this.a = null;
        this.p = null;
        this.s = null;
        this.b = SpreadsheetCellRange.empty;
        this.k = null;
        this.g = null;
        this.q = null;
        this.j = a;
        this.l = a._bc;
        this.a = new RotationHelper();
        this.p = new Dictionary$2(String_$type, SpreadsheetCellValueInfo.$, 0);
        this.s = new Dictionary$2(WorksheetMergedCellsRegion.$, SpreadsheetCellValueInfo.$, 0);
        this.r = new HashSet$1(SpreadsheetCell.$, 0);
        this.g = new SpreadsheetChartDataInfo(this.l.workbook);
        this.q = new Dictionary$2(WorksheetChart.$, InViewPaneInfo_ChartInfo.$, 0);
        this.k = new SpreadsheetViewCache(a._bc);
    }
    w(a) {
        if (a.i) {
            let b = a.d;
            let c;
            if (!((() => { let d = this.q.tryGetValue(b, c); c = d.p1; return d.ret; })())) {
                this.q.item(b, c = new InViewPaneInfo_ChartInfo(a));
            }
            else {
                c.d(a);
            }
        }
        else if (a.j != null) {
            for (let d of fromEnum(a.j)) {
                this.w(d);
            }
        }
    }
    static x(a, b, c, d) {
        let e = Math.max(SpreadsheetUtilities.cm(b.item(c - 1, d).d), SpreadsheetUtilities.cm(b.item(c, d).d));
        let f = Math.max(SpreadsheetUtilities.cm(b.item(c, d - 1).e), SpreadsheetUtilities.cm(b.item(c, d).e));
        if (a) {
            if (e == 3) {
                b.item(c, d - 1).j = -1;
                b.item(c, d).i = 1;
            }
        }
        else {
            let g = e <= 1 ? -1 : -2;
            b.item(c, d).i = g;
            b.item(c, d - 1).j = -g;
        }
        b.item(c - 1, d).h = f == 1 ? 1 : 2;
        if (f == 3) {
            b.item(c, d).k = 1;
        }
    }
    static y(a, b, c, d) {
        let e = Math.max(SpreadsheetUtilities.cm(b.item(c - 1, d).d), SpreadsheetUtilities.cm(b.item(c, d).d));
        let f = Math.max(SpreadsheetUtilities.cm(b.item(c, d - 1).e), SpreadsheetUtilities.cm(b.item(c, d).e));
        if (a) {
            if (f == 3) {
                b.item(c - 1, d).h = -1;
                b.item(c, d).k = 1;
            }
        }
        else {
            let g = f <= 1 ? -1 : -2;
            b.item(c, d).k = g;
            b.item(c - 1, d).h = -g;
        }
        b.item(c, d - 1).j = e == 1 ? 1 : 2;
        if (e == 3) {
            b.item(c, d).i = 1;
        }
    }
    z() {
        this.p.clear();
        this.s.clear();
    }
    aa(a) {
        let b = a.chart;
        let c;
        if (b != null && ((() => { let d = this.q.tryGetValue(b, c); c = d.p1; return d.ret; })())) {
            c.e();
        }
    }
    ab(a) {
        for (let b of fromEnum(a.charts())) {
            this.aa(b);
        }
    }
    ac() {
        this.h = null;
    }
    ad() {
        this.m = true;
    }
    c(a, b, c = true, d = true) {
        let e = null;
        let f = a.index + "-" + b;
        if (!((() => { let g = this.p.tryGetValue(f, e); e = g.p1; return g.ret; })()) && c) {
            this.p.item(f, e = this.j._ai(a, b));
            e.af = this.v;
        }
        else if (e != null && (e.af < this.v || e.ao != e.h._c5(e.ab))) {
            e.af = this.v;
            if (e.e == 4 || e.e == 6) {
                if (e.x != e.h._ck(e.w, this.b.lastColumn, Nullable$1.toNullable(HorizontalCellAlignment_$type, e.e))) {
                    this.p.item(f, e = this.j._ai(a, b));
                    e.af = this.v;
                }
            }
        }
        if (e != null && d) {
            this.am(e);
        }
        return e;
    }
    d(a, b, c) {
        let d = c;
        do {
            let e = b._c1(d, !a);
            if (nullableEquals(e, null)) {
                return null;
            }
            d = e.value;
        } while (this.l._cb(d).i);
        if (a && d < this.b.firstColumn) {
            return null;
        }
        if (!a && d > this.b.lastColumn) {
            return null;
        }
        let f = this.c(b, d, false);
        if (f == null) {
            if (this.l._cr(b.index, d) != null) {
                return null;
            }
            let g = this.k.g(b, b.index, d);
            if (g._b8) {
                return null;
            }
            let h = g._a4;
            if (g._b7) {
                return null;
            }
            if (h == 0) {
                h = SpreadsheetUtilities.ap(b._getCellValue1(d), g, this.l, b, d);
            }
            switch (h) {
                case 5:
                case 7: return null;
                case 4:
                    if (!a) {
                        return null;
                    }
                    break;
                case 2:
                case 6: break;
                case 3:
                    if (a) {
                        return null;
                    }
                    break;
                case 1:
                    if (!a) {
                        return null;
                    }
                    break;
                default: break;
            }
            f = this.c(b, d, true);
        }
        if ((a && f.ad < c) || (!a && f.ae > c)) {
            return null;
        }
        return f;
    }
    e(a, b) {
        let c = this.l._cr(a, b);
        if (c != null) {
            let d;
            if (!((() => { let e = this.s.tryGetValue(c, d); d = e.p1; return e.ret; })())) {
                this.s.item(c, d = this.j._ah(c));
            }
            else if (d.af != this.v) {
                d.af = this.v;
                if (d.ao != d.h._c5(d.w)) {
                    this.s.item(c, d = this.j._ah(c));
                }
            }
            return d;
        }
        return null;
    }
    t(a, b) {
        let c = this.l._cn(a);
        let d;
        if (b <= 0) {
            d = c._m;
        }
        else if (b >= 100) {
            d = c._l;
        }
        else {
            d = truncate((c._m + c._i * b / 100));
        }
        return this.l._fl(d, 5, false);
    }
    u(a, b) {
        let c = this.l._cp(a);
        if (b <= 0) {
            return c._m;
        }
        else if (b >= 100) {
            return c._l;
        }
        else {
            return c._m + c._i * b / 100;
        }
    }
    ae() {
        for (let a of fromEnum(this.r)) {
            this.l._rows$i.item(a.row)._getCellValue1(a.column);
        }
        this.v++;
    }
    get n() {
        return this.q.count > 0;
    }
    f(a, b) {
        let c = this.k.g(a.h, a.ak, a.ab);
        return this.j._aj(a, b, c);
    }
    af(a, b) {
        this.p.removeItem(a + "-" + b);
        this.k.o(a, b);
    }
    ag() {
        for (let a of fromEnum(this.j._dl)) {
            for (let b of fromEnum(a._r)) {
                b.m = null;
            }
        }
    }
    ah() {
        for (let a of fromEnum(this.j._dl)) {
            for (let b of fromEnum(a._r)) {
                b.m = null;
            }
            a._r.clear();
        }
    }
    ai(a, b, c, d, e, f, g, h, i) {
        let j = this.k.a(g, h, i);
        let k = j.d;
        let l = j.j;
        if (f >= 0) {
            let m = this.k.a(d, e, f);
            let n = m.e;
            if (SpreadsheetUtilities.bm(k, n)) {
                k = n;
                l = m.k;
            }
        }
        a.m(b, c, k, l);
    }
    aj(a, b, c, d, e, f, g, h, i) {
        let j = this.k.a(d, e, f);
        let k = j.f;
        let l = j.l;
        if (h >= 0) {
            let m = this.k.a(g, h, i);
            let n = m.b;
            if (SpreadsheetUtilities.bm(k, n)) {
                k = n;
                l = m.h;
            }
        }
        a.p(b, c, k, l);
    }
    ak() {
        try {
            this.ap();
        }
        finally {
            this.k.n(false);
        }
    }
    o() {
        let a = false;
        let b = this.g.e;
        for (let c of fromEnum(this.q)) {
            if (c.value.b(b && this.g.f(c.key))) {
                a = true;
            }
        }
        this.g.j();
        return a;
    }
    ap() {
        this.ao();
        this.al();
        this.r.clear();
        let a = this.l.workbook;
        let b = a != null && a.windowOptions.objectDisplayStyle == 2;
        let c = !b && this.m;
        let d = this.j._al._l != null;
        this.m = false;
        this.b = this.j._aa();
        this.o();
        this.q.clear();
        for (let e of fromEnum(this.j._dl)) {
            let f = e._p;
            f.beginUpdate();
            f.clear();
            let g = e.columnScrollRegion._m;
            let h = e.rowScrollRegion._m;
            let i = h.count;
            let j = g.count;
            let k = j + 2;
            let l = i + 2;
            let m = e._k;
            if (m == null) {
                m = new MDList$1(SpreadsheetCellValueInfo.$, l, k);
            }
            else {
                m.j(l, k);
            }
            let n = e._l;
            if (n == null) {
                n = new MDList$1(WorksheetHyperlink.$, l, k);
            }
            else {
                n.j(l, k);
            }
            let o = e._h;
            if (o == null) {
                o = new MDBitArray(l, k);
            }
            else {
                o.i(l, k);
            }
            if (j > 0 && i > 0) {
                let p = null;
                let q = g._inner[0];
                let r = g._inner[j - 1];
                let s, t;
                if (q._m > 0) {
                    s = Nullable$1.toNullable(WorksheetItemPosition.$, this.j._be(q._m - 1));
                }
                else {
                    s = Nullable$1.toNullable(WorksheetItemPosition.$, null);
                }
                if (r._j < this.b.lastColumn) {
                    t = Nullable$1.toNullable(WorksheetItemPosition.$, this.j._be(r._l));
                }
                else {
                    t = Nullable$1.toNullable(WorksheetItemPosition.$, null);
                }
                let u = h._inner[0];
                let v = h._inner[i - 1];
                let w, x;
                if (u._m > 0) {
                    w = Nullable$1.toNullable(WorksheetItemPosition.$, this.l._cq(u._m - 1));
                }
                else {
                    w = Nullable$1.toNullable(WorksheetItemPosition.$, null);
                }
                if (v._j < this.b.lastRow) {
                    x = Nullable$1.toNullable(WorksheetItemPosition.$, this.l._cq(v._l));
                }
                else {
                    x = Nullable$1.toNullable(WorksheetItemPosition.$, null);
                }
                let y = new Array(k);
                if (WorksheetItemPosition._d(s, Nullable$1.toNullable(WorksheetItemPosition.$, null))) {
                    y[0] = s.value._j;
                }
                else {
                    y[0] = -1;
                }
                for (let z = 0; z < j; z++) {
                    y[z + 1] = g._inner[z]._j;
                }
                if (WorksheetItemPosition._d(t, Nullable$1.toNullable(WorksheetItemPosition.$, null))) {
                    y[j + 1] = t.value._j;
                }
                else {
                    y[j + 1] = -1;
                }
                let aa = new Array(l);
                if (WorksheetItemPosition._d(w, Nullable$1.toNullable(WorksheetItemPosition.$, null))) {
                    aa[0] = w.value._j;
                }
                else {
                    aa[0] = -1;
                }
                for (let ab = 0; ab < i; ab++) {
                    aa[ab + 1] = h._inner[ab]._j;
                }
                if (WorksheetItemPosition._d(x, Nullable$1.toNullable(WorksheetItemPosition.$, null))) {
                    aa[i + 1] = x.value._j;
                }
                else {
                    aa[i + 1] = -1;
                }
                let ac = this.l._hyperlinks$i;
                let ad = SpreadsheetUtilities.ay(new SpreadsheetCellRange(u._j, q._j, v._j, r._j));
                for (let ae = ac.count - 1; ae >= 0; ae--) {
                    let af = ac.item(ae);
                    let ag = af.sourceRegion._h;
                    if (ag._j(ad)) {
                        let ah = e.rowScrollRegion._cg(ag._ac, ag._ae);
                        if (ah >= 0) {
                            let ai = e.columnScrollRegion._cg(ag._w, ag._x);
                            if (ai >= 0) {
                                for (let aj = ah + 1; aj < l - 1; aj++) {
                                    if (aa[aj] > ag._ae) {
                                        break;
                                    }
                                    for (let ak = ai + 1; ak < k - 1; ak++) {
                                        if (y[ak] > ag._x) {
                                            break;
                                        }
                                        if (n.item(aj, ak) == null) {
                                            n.item(aj, ak, af);
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                let al = this.l._fd;
                for (let am = 0, an = al.count; am < an; am++) {
                    let ao = al._inner[am];
                    if (ad._i(ao.rowIndex, ao._ab)) {
                        let ap = e.rowScrollRegion._cf(ao.rowIndex);
                        let aq = e.columnScrollRegion._cf(ao.columnIndex);
                        o.item(ap + 1, aq + 1, true);
                    }
                }
                for (let ar = 0; ar < l; ar++) {
                    let as = aa[ar];
                    if (as < 0) {
                        continue;
                    }
                    let at = this.l._rows$i._aj(as);
                    if (at == null && !this.l._d1) {
                        continue;
                    }
                    for (let au = 0; au < k; au++) {
                        let av = y[au];
                        if (av >= 0 && m.item(ar, au) == null) {
                            let aw = this.e(as, av);
                            if (aw != null) {
                                let ax = n.item(ar, au);
                                p = aw.h._a2(av);
                                if (p != null && p.m(av)) {
                                    this.r.add_1(new SpreadsheetCell(aw.ak, av));
                                    if (ax == null) {
                                        ax = aw.h._bi(av);
                                    }
                                }
                                this.an(aw, this.j._e5(ax));
                                let ay = au + 1;
                                while (ay < k && y[ay] <= aw.x && y[ay] >= 0) {
                                    ay++;
                                }
                                let az = ar + 1;
                                while (az < l && aa[az] <= aw.ag && aa[az] >= 0) {
                                    az++;
                                }
                                for (let a0 = ar; a0 < az; a0++) {
                                    for (let a1 = au; a1 < ay; a1++) {
                                        m.item(a0, a1, aw);
                                    }
                                }
                                if (ax != null) {
                                    for (let a2 = ar; a2 < az; a2++) {
                                        for (let a3 = au; a3 < ay; a3++) {
                                            if (n.item(a2, a3) == null) {
                                                n.item(a2, a3, ax);
                                            }
                                        }
                                    }
                                }
                                if (ay < k) {
                                    au = ay - 1;
                                }
                                else if (au == 0) {
                                    ar = az - 1;
                                    au = k;
                                }
                                else {
                                    au = k;
                                }
                            }
                            else if (at != null && ar > 0 && ar <= i) {
                                p = at._a2(av);
                                if (p != null && p.j(av)) {
                                    let a4 = null;
                                    if (p.m(av)) {
                                        this.r.add_1(new SpreadsheetCell(as, av));
                                        if (n.item(ar, au) == null) {
                                            a4 = at._bi(av);
                                        }
                                    }
                                    m.item(ar, au, aw = this.c(at, av, void 0, false));
                                    this.an(aw, this.j._e5(n.item(ar, au) || a4));
                                    if (a4 != null) {
                                        n.item(ar, au, a4);
                                    }
                                }
                            }
                        }
                    }
                }
                for (let a5 = 1; a5 <= i; a5++) {
                    let a6 = this.l._rows$i._aj(aa[a5]);
                    if (a6 != null) {
                        if (m.item(a5, 1) == null) {
                            m.item(a5, 0, this.d(true, a6, q._j));
                        }
                        if (m.item(a5, j) == null && WorksheetItemPosition._d(t, Nullable$1.toNullable(WorksheetItemPosition.$, null))) {
                            m.item(a5, j + 1, this.d(false, a6, r._j));
                        }
                    }
                }
                for (let a7 = 1; a7 <= i; a7++) {
                    for (let a8 = 0; a8 < k; a8++) {
                        let a9 = m.item(a7, a8);
                        if (a9 != null) {
                            if (a8 > 0 && m.item(a7, a8 - 1) == a9) {
                                continue;
                            }
                            if (a7 > 1 && m.item(a7 - 1, a8) == a9) {
                                continue;
                            }
                            f.add(a9);
                        }
                    }
                }
                for (let ba = 1; ba < l; ba++) {
                    for (let bb = 0; bb < k; bb++) {
                        let bc = m.item(ba, bb);
                        if (bc != null) {
                            if (bb == 0) {
                                let bd = !nullableIsNull(bc.al) ? bc.al.value : bc.ad;
                                for (let be = 1; be <= j; be++) {
                                    if (g._inner[be - 1]._j > bd || m.item(ba, be) != null) {
                                        break;
                                    }
                                    m.item(ba, be, bc);
                                }
                            }
                            else if (bb == j + 1) {
                                let bf = !nullableIsNull(bc.am) ? bc.am.value : bc.ae;
                                for (let bg = bb - 1; bg > 0; bg--) {
                                    if (g._inner[bg - 1]._j < bf || m.item(ba, bg) != null) {
                                        break;
                                    }
                                    m.item(ba, bg, bc);
                                }
                            }
                            else if (bc.ap != null) {
                                let bh = !nullableIsNull(bc.am) ? bc.am.value : bc.ae;
                                for (let bi = bb - 1; bi > 0; bi--) {
                                    if (g._inner[bi - 1]._j < bh || m.item(ba, bi) != null) {
                                        break;
                                    }
                                    m.item(ba, bi, bc);
                                }
                                let bj = !nullableIsNull(bc.al) ? bc.al.value : bc.ad;
                                for (let bk = bb + 1; bk <= j; bk++) {
                                    if (g._inner[bk - 1]._j > bj || m.item(ba, bk) != null) {
                                        break;
                                    }
                                    m.item(ba, bk, bc);
                                }
                            }
                        }
                    }
                }
                let bl = e._w;
                if (bl == null) {
                    bl = new SpreadsheetCellRenderInfoArray(l, k);
                }
                else {
                    bl.h(l, k);
                }
                e._w = bl;
                let bm = null;
                for (let bn = 0; bn < l; bn++) {
                    let bo = aa[bn];
                    let bp = bo >= 0 ? this.l._rows$i._aj(bo) : null;
                    for (let bq = 0; bq < k; bq++) {
                        let br = false;
                        let bs = m.item(bn, bq);
                        let bt = bs != null && bs.r;
                        let bu = y[bq];
                        let bv = null;
                        if (bo >= 0) {
                            if (bt) {
                                let bw = m.item(bn, bq);
                                if (bn > 0 && bw == m.item(bn - 1, bq)) {
                                    bl.g(bn - 1, bq, bn, bq);
                                    br = true;
                                }
                                else if (bq > 0 && bw == m.item(bn, bq - 1)) {
                                    bl.g(bn, bq - 1, bn, bq);
                                    br = true;
                                }
                                else {
                                    let bx = bw.ak;
                                    let by = bw.w;
                                    let bz = bx == bo ? bp : this.l._rows$i._aj(bx);
                                    bv = this.k.a(bz, bx, by);
                                }
                            }
                            if (!br && bu >= 0) {
                                if (bv == null) {
                                    bv = this.k.a(bp, bo, bu);
                                }
                                let b0 = this.k.c(bo, bu);
                                if (b0 != null) {
                                    bl.k(bn, bq, b0.dataBarInfo);
                                }
                                bl.i(bn, bq, bv.g);
                                let b1 = bv.a;
                                if (b1 != 0) {
                                    bl.l(bn, bq, b1, bv.c, bv.i);
                                }
                            }
                            if (bq > 0) {
                                if (bu < 0) {
                                    let b2 = this.k.a(bp, bo, y[bq - 1]);
                                    bl.m(bn, bq, b2.e, b2.k);
                                }
                                else if (bt == false || bu == bs.ab) {
                                    if (bs == null || bs != m.item(bn, bq - 1)) {
                                        this.ai(bl, bn, bq, bp, bo, y[bq - 1], bp, bo, bu);
                                    }
                                }
                            }
                            if (bn > 0) {
                                if (bt == false || bo == bs.ak) {
                                    if (y[bq] >= 0) {
                                        this.aj(bl, bn, bq, bp, bo, y[bq], bm, aa[bn - 1], y[bq]);
                                    }
                                }
                            }
                        }
                        else if (bn > 0 && bu >= 0) {
                            let b3 = this.k.a(bm, aa[bn - 1], bu);
                            bl.p(bn, bq, b3.b, b3.h);
                        }
                    }
                    bm = bp;
                }
                for (let b4 = 1; b4 < l; b4++) {
                    if (aa[b4] == 0) {
                        continue;
                    }
                    for (let b5 = 1; b5 < k; b5++) {
                        if (y[b5] == 0) {
                            continue;
                        }
                        let b6, b7;
                        let b8 = bl.item(b4, b5).d;
                        let b9 = bl.item(b4 - 1, b5).d;
                        let ca = bl.item(b4, b5 - 1).e;
                        let cb = bl.item(b4, b5).e;
                        if (b8 == b9 && ca == cb && b9 == ca) {
                            if (b8 == 0) {
                                continue;
                            }
                            else {
                                b7 = b6 = true;
                            }
                        }
                        else {
                            let cc = 0;
                            if (b8 == 6) {
                                cc++;
                            }
                            if (ca == 6) {
                                cc++;
                            }
                            if (cb == 6) {
                                cc++;
                            }
                            if (b9 == 6) {
                                cc++;
                            }
                            if (cc > 1) {
                                if (ca == 6) {
                                    b7 = b6 = true;
                                }
                                else if (b9 == 6) {
                                    b7 = true;
                                    b6 = false;
                                }
                                else if (b8 == 6) {
                                    b7 = b6 = false;
                                }
                                else {
                                    b7 = false;
                                    b6 = true;
                                }
                            }
                            else if (cc == 1) {
                                if (b8 == 6 || b9 == 6) {
                                    if (ca == 0 && cb == 0) {
                                        b6 = false;
                                        b7 = b8 == 0 || b9 != 0;
                                    }
                                    else {
                                        let cd = SpreadsheetUtilities.cn(ca);
                                        let ce = SpreadsheetUtilities.cn(cb);
                                        b6 = true;
                                        b7 = cd >= ce;
                                    }
                                }
                                else {
                                    if (b8 == 0 && b9 == 0) {
                                        b6 = true;
                                        b7 = cb == 0 || ca != 0;
                                    }
                                    else {
                                        let cf = SpreadsheetUtilities.cn(b9);
                                        let cg = SpreadsheetUtilities.cn(b8);
                                        b6 = false;
                                        b7 = cf >= cg;
                                    }
                                }
                            }
                            else {
                                let ch = SpreadsheetUtilities.cn(ca);
                                let ci = SpreadsheetUtilities.cn(cb);
                                let cj = SpreadsheetUtilities.cn(b9);
                                let ck = SpreadsheetUtilities.cn(b8);
                                let cl = ch >= ci;
                                let cm = cj >= ck;
                                b6 = (cl ? ch : ci) >= (cm ? cj : ck);
                                b7 = b6 ? cl : cm;
                            }
                        }
                        if (b6) {
                            InViewPaneInfo.x(b7, bl, b4, b5);
                        }
                        else {
                            InViewPaneInfo.y(b7, bl, b4, b5);
                        }
                    }
                }
                let cn = e._r;
                let co = new Dictionary$2(WorksheetShape.$, SpreadsheetShape.$, 0);
                cn.beginUpdate();
                for (let cp of fromEnum(cn)) {
                    co.item(cp.d, cp);
                    if (c) {
                        cp.p();
                    }
                }
                cn.clear();
                if (b == false && this.l._shapes$i.count > 0) {
                    let cq = 30;
                    let cr = h._inner[0]._m - cq;
                    let cs = v._l + cq;
                    let ct = this.l._fl(g._inner[0]._m, 5, false) - cq;
                    let cu = this.l._fl(r._l, 5, false) + cq;
                    for (let cv of fromEnum(this.l._shapes$i)) {
                        if (!cv.visible) {
                            continue;
                        }
                        if (!SpreadsheetUtilities.a4(cv, d)) {
                            continue;
                        }
                        if (nullableEquals(SpreadsheetPaneManager._e3(cv._ah.m, cv._ad.m, this.l), null)) {
                            continue;
                        }
                        if (nullableEquals(SpreadsheetPaneManager._e4(cv._ah.o, cv._ad.o, this.l), null)) {
                            continue;
                        }
                        let cw = SpreadsheetUtilities.b9(cv);
                        let cx = this.t(cv._ah.m, cv._topLeftCornerPosition$i.x) - cw;
                        let cy = this.t(cv._ad.m, cv._bottomRightCornerPosition$i.x) + cw;
                        let cz = this.u(cv._ah.o, cv._topLeftCornerPosition$i.y) - cw;
                        let c0 = this.u(cv._ad.o, cv._bottomRightCornerPosition$i.y) + cw;
                        if (cv._b6 % 90 != 0) {
                            let c1 = ExcelUtils.bd(cv._b6);
                            this.a.g(cx, cz, cy, c0, cv._b6, c1);
                            if (this.a.b(ct, cr, cu, cs)) {
                                continue;
                            }
                        }
                        else {
                            if (cy < ct || cx > cu) {
                                continue;
                            }
                            if (c0 < cr || cz > cs) {
                                continue;
                            }
                        }
                        let c2;
                        if (!((() => { let c3 = co.tryGetValue(cv, c2); c2 = c3.p1; return c3.ret; })())) {
                            c2 = new SpreadsheetShape(cv, null);
                        }
                        else {
                            co.removeItem(cv);
                        }
                        c2.r(d);
                        this.w(c2);
                        cn.add(c2);
                    }
                }
                cn.endUpdate();
            }
            else {
                let c3 = e._r;
                c3.clear();
            }
            e._k = m;
            e._l = n;
            e._h = o;
            f.endUpdate();
            e._aa = this.h;
            e._ac = this.i;
        }
    }
    al() {
        let a = this.l._je;
        let b = CoreUtilities.p(this.aq);
        if (b != a) {
            this.aq = a == null ? null : new WeakReference(a);
            this.i = new SpreadsheetImageBackground(a, this.l._dh);
        }
    }
    am(a) {
        if (a != null && a.ao != null && a.c == null) {
            let b = this.l._ck(a.h, a.ak, a.ab);
            this.f(a, this.j._e5(b));
        }
    }
    an(a, b) {
        if (a != null && a.ao != null && a.c == null) {
            this.f(a, b);
        }
    }
    ao() {
        let a = this.l.displayOptions;
        if (!a.showGridlines) {
            this.h = null;
        }
        else if (this.h == null) {
            let b = a._a2 ? Nullable$1.toNullable(Color.$, null) : Nullable$1.toNullable(Color.$, a._gridlineColor$i);
            this.h = new SpreadsheetGridLinePen(b);
        }
    }
}
InViewPaneInfo.$t = markType(InViewPaneInfo, 'InViewPaneInfo');
/**
 * @hidden
 */
export class InViewPaneInfo_ChartInfo extends Base {
    constructor(a) {
        super();
        this.c = null;
        this.a = false;
        this.c = a;
    }
    d(a) {
        let b = typeCast(List$1.$.specialize(SpreadsheetShape.$), this.c);
        if (b == null) {
            b = new List$1(SpreadsheetShape.$, 0);
            b.add(this.c);
            this.c = b;
        }
        b.add(a);
    }
    e() {
        this.a = true;
    }
    static f(a, b, c) {
        if (c) {
            a.h = true;
        }
        if (b) {
            a.g = true;
        }
        if (b || c) {
            let d = a;
            while (d != null) {
                d.n++;
                d = d.b;
            }
        }
    }
    b(a) {
        if (this.a || a) {
            let b = typeCast(SpreadsheetShape.$, this.c);
            if (b != null) {
                InViewPaneInfo_ChartInfo.f(b, a, this.a);
            }
            else {
                let c = typeCast(List$1.$.specialize(SpreadsheetShape.$), this.c);
                for (let d = 0; d < c.count; d++) {
                    b = c._inner[d];
                    InViewPaneInfo_ChartInfo.f(b, a, this.a);
                }
            }
        }
        return this.a || a;
    }
}
InViewPaneInfo_ChartInfo.$t = markType(InViewPaneInfo_ChartInfo, 'InViewPaneInfo_ChartInfo');
/**
 * @hidden
 */
export class SpreadsheetViewCache extends Base {
    constructor(a) {
        super();
        this.h = null;
        this.k = null;
        this.i = null;
        this.f = null;
        this.j = null;
        this.l = 0;
        this.m = 0;
        this.d = null;
        this.f = a;
        this.h = new Dictionary$2(String_$type, SpreadsheetResolvedRenderFormat.$, 0);
        this.i = new Dictionary$2(WorksheetCellFormatData.$, SpreadsheetResolvedRenderFormat.$, 2, WorksheetCellFormatDataEqualityComparer._a);
        this.k = new Dictionary$2(String_$type, CellConditionalFormat.$, 0);
        this.j = new Dictionary$2(String_$type, WorksheetCellFormatData.$, 0);
        this.d = new RegionLookupTable$1(WorksheetRegionAddress.$, a);
        this.m = -1;
    }
    n(a) {
        this.h.clear();
        this.i.clear();
        this.j.clear();
        if (a) {
            this.k.clear();
            this.d.aa();
            this.l++;
        }
    }
    static e(a, b, c) {
        let d = null;
        if (b != null) {
            switch (a) {
                case 8:
                    d = b.diagonalBorderColorInfo;
                    break;
                case 134217728:
                    d = b.topBorderColorInfo;
                    break;
                case 524288:
                    d = b.leftBorderColorInfo;
                    break;
                case 4:
                    d = b.bottomBorderColorInfo;
                    break;
                case 4194304:
                    d = b.rightBorderColorInfo;
                    break;
            }
        }
        if (WorkbookColorInfo.l_op_Equality(d, null)) {
            d = c._da(a, null);
        }
        return d;
    }
    static b(a, b, c) {
        let d = -1;
        if (b != null) {
            switch (a) {
                case 32:
                    d = b.diagonalBorderStyle;
                    break;
                case 134217728:
                    d = b.topBorderStyle;
                    break;
                case 524288:
                    d = b.leftBorderStyle;
                    break;
                case 4:
                    d = b.bottomBorderStyle;
                    break;
                case 4194304:
                    d = b.rightBorderStyle;
                    break;
            }
        }
        if (d == -1) {
            d = EnumUtil.getEnumValue(CellBorderLineStyle_$type, c._da(a, null));
        }
        return d;
    }
    g(a, b, c) {
        let d;
        let e = b + "-" + c;
        if (!((() => { let f = this.j.tryGetValue(e, d); d = f.p1; return f.ret; })())) {
            d = this.f._b4(a, c);
            let f = this.f._b5(d, b, c);
            if (f != null) {
                this.j.item(e, d = f);
            }
        }
        return d;
    }
    c(a, b) {
        let c = null;
        if (this.f._conditionalFormats$i.count > 0) {
            this.p();
            if (this.d.n(a, b)) {
                let d = a + "-" + b;
                if (!((() => { let e = this.k.tryGetValue(d, c); c = e.p1; return e.ret; })())) {
                    this.k.item(d, c = this.f._getCellConditionalFormat1(a, b));
                }
                if (c != null && c == CellConditionalFormat._a) {
                    c = null;
                }
            }
        }
        return c;
    }
    a(a, b, c) {
        let d = b + "-" + c;
        let e = null;
        if (((() => { let f = this.h.tryGetValue(d, e); e = f.p1; return f.ret; })())) {
            return e;
        }
        let f = this.c(b, c);
        let g = this.g(a, b, c);
        if (f == null) {
            if (((() => { let h = this.i.tryGetValue(g, e); e = h.p1; return h.ret; })())) {
                this.h.item(d, e);
                return e;
            }
        }
        e = new SpreadsheetResolvedRenderFormat();
        let h = null;
        if (f != null && f.cellFormat != null) {
            h = f.cellFormat;
        }
        e.g = h == null || h.fill == null ? g._ar : h.fill;
        if (SpreadsheetUtilities.bc(e.g)) {
            e.g = null;
        }
        else {
            e.g = e.g._c(this.f.workbook);
        }
        e.a = SpreadsheetUtilities.m(h == null || h.diagonalBorderStyle == -1 ? EnumUtil.getEnumValue(DiagonalBorders_$type, g._da(16, null)) : h.diagonalBorders);
        if (e.a != 0) {
            e.c = SpreadsheetViewCache.b(32, h, g);
            e.i = SpreadsheetViewCache.e(8, h, g)._getResolvedColor1(this.f.workbook);
        }
        else {
            e.i = ExcelUtils.gv;
        }
        e.d = SpreadsheetViewCache.b(524288, h, g);
        e.j = e.d == 0 ? ExcelUtils.gv : SpreadsheetViewCache.e(262144, h, g)._getResolvedColor1(this.f.workbook);
        e.f = SpreadsheetViewCache.b(134217728, h, g);
        e.l = e.f == 0 ? ExcelUtils.gv : SpreadsheetViewCache.e(67108864, h, g)._getResolvedColor1(this.f.workbook);
        e.e = SpreadsheetViewCache.b(4194304, h, g);
        e.k = e.e == 0 ? ExcelUtils.gv : SpreadsheetViewCache.e(2097152, h, g)._getResolvedColor1(this.f.workbook);
        e.b = SpreadsheetViewCache.b(4, h, g);
        e.h = e.b == 0 ? ExcelUtils.gv : SpreadsheetViewCache.e(2, h, g)._getResolvedColor1(this.f.workbook);
        if (h == null) {
            this.i.item(g, e);
        }
        this.h.item(d, e);
        return e;
    }
    o(a, b) {
        if (this.k.count > 0) {
            this.k.removeItem(a + "-" + b);
        }
    }
    p() {
        if (this.m != this.l) {
            this.m = this.l;
            this.d.aa();
            for (let a of fromEnum(this.f._conditionalFormats$i)) {
                for (let b = 0; b < a.regions.count; b++) {
                    let c = a.regions.item(b);
                    this.d.x(c, c._h);
                }
            }
        }
    }
}
SpreadsheetViewCache.$t = markType(SpreadsheetViewCache, 'SpreadsheetViewCache');
/**
 * Represents one or more [[SpreadsheetPane]] instances in a vertical column
 */
export class SpreadsheetColumnScrollRegion extends SpreadsheetScrollRegion {
    constructor() {
        super();
    }
    /**
     * @hidden
     */
    _a0() {
        return this._ab != null ? this._ab._bi : null;
    }
    /**
     * @hidden
     */
    _a2() {
        return this._ab != null ? this._ab._bf : null;
    }
    /**
     * @hidden
     */
    get__aw() {
        return false;
    }
    /**
     * @hidden
     */
    get _aw() {
        return this.get__aw();
    }
}
SpreadsheetColumnScrollRegion.$t = markType(SpreadsheetColumnScrollRegion, 'SpreadsheetColumnScrollRegion', SpreadsheetScrollRegion.$);
/**
 * Returns one or more [[SpreadsheetPane]] instances in a horizontal row.
 */
export class SpreadsheetRowScrollRegion extends SpreadsheetScrollRegion {
    constructor() {
        super();
    }
    /**
     * @hidden
     */
    _a0() {
        return this._ab != null ? this._ab._bj : null;
    }
    /**
     * @hidden
     */
    _a2() {
        return this._ab != null ? this._ab._bg : null;
    }
    /**
     * @hidden
     */
    get__aw() {
        return true;
    }
    /**
     * @hidden
     */
    get _aw() {
        return this.get__aw();
    }
}
SpreadsheetRowScrollRegion.$t = markType(SpreadsheetRowScrollRegion, 'SpreadsheetRowScrollRegion', SpreadsheetScrollRegion.$);
/**
 * @hidden
 */
export class SpreadsheetScrollInfo extends ExtendedRangeScrollInfo {
    constructor(a) {
        super();
        this._a1 = null;
        this._a4 = null;
        this._a5 = null;
        this._a6 = 0;
        CoreUtilities.z(a, "owner");
        this._a1 = a;
    }
    _ao(a, b) {
        if (this._a4 != null && this._a4(this._a1, a, b)) {
            return;
        }
        super._ao(a, b);
    }
    _az(a) {
        this._au(a);
    }
    _au(a) {
        if (this._a5 != null) {
            return this._a5(this._a1, a);
        }
        return a;
    }
    get _a2() {
        return this._a1;
    }
    get _a3() {
        return this._a6 > 0;
    }
    _a7() {
        this._a6++;
    }
    _a8() {
        this._a6--;
        if (this._a6 == 0) {
            this._ac = this._au(this._ac);
        }
    }
}
SpreadsheetScrollInfo.$t = markType(SpreadsheetScrollInfo, 'SpreadsheetScrollInfo', ExtendedRangeScrollInfo.$);
/**
 * @hidden
 */
export class SpreadsheetOwnerState extends PropertyChangeNotifierExtended {
    constructor() {
        super(...arguments);
        this._q = false;
        this._n = null;
        this._u = null;
        this._v = null;
        this._i = null;
        this._r = false;
        this._m = null;
        this._g = null;
        this._k = null;
    }
    get _l() {
        return this._k;
    }
    set _l(a) {
        if (this._k != a) {
            this._k = a;
            this.a("ChartAdapter");
        }
    }
    get _w() {
        return this._u;
    }
    set _w(a) {
        if (this._u != a) {
            this._u = a;
            this.a("GetCellText");
        }
    }
    get _s() {
        return this._q;
    }
    set _s(a) {
        if (this._q != a) {
            this._q = a;
            this.a("IsInEditMode");
        }
    }
    get _o() {
        return this._m;
    }
    set _o(a) {
        if (this._m != a) {
            this._m = a;
            this.a("AfterPaneManagerLayout");
        }
    }
    get _x() {
        return this._v;
    }
    set _x(a) {
        if (this._v != a) {
            this._v = a;
            this.a("PasswordNeededAction");
        }
    }
    get _j() {
        return this._i;
    }
    set _j(a) {
        if (this._i != a) {
            this._i = a;
            this.a("RenderCache");
        }
    }
    get _h() {
        return this._g;
    }
    set _h(a) {
        if (this._g != a) {
            this._g = a;
            this.a("Spreadsheet");
        }
    }
    get _t() {
        return this._r;
    }
    set _t(a) {
        if (this._r != a) {
            this._r = a;
            this.a("UsesLogicalPixels");
        }
    }
    get _p() {
        return this._n;
    }
    set _p(a) {
        if (this._n != a) {
            this._n = a;
            this.a("VisitHyperlinkAction");
        }
    }
}
SpreadsheetOwnerState.$t = markType(SpreadsheetOwnerState, 'SpreadsheetOwnerState', PropertyChangeNotifierExtended.$);
/**
 * @hidden
 */
export class SpreadsheetRenderCache_DisposableCache extends Base {
    constructor(a) {
        super();
        this._a = null;
        this._a = a;
    }
    dispose() {
        this._a.aq();
    }
}
SpreadsheetRenderCache_DisposableCache.$t = markType(SpreadsheetRenderCache_DisposableCache, 'SpreadsheetRenderCache_DisposableCache', Base.$, [IDisposable_$type]);
/**
 * @hidden
 */
export class ExcelWorkbookSerializationProvider extends WorkbookSerializationProviderBase {
    constructor(a, ..._rest) {
        a = (a == void 0) ? 0 : a;
        switch (a) {
            case 0:
                {
                    let c = [];
                    for (let b = 0; b < _rest.length; b++) {
                        c[b - 0] = _rest[b];
                    }
                    super(0, ...c);
                }
                break;
            case 1:
                {
                    let d = _rest[0];
                    let e = _rest[1];
                    super(1, d, e);
                }
                break;
        }
    }
    static q(a, b, c, d, e, f, g, h, i, j, k, l, m, n, o, p, q) {
        let r = f;
        if (r) {
            let s = k._de(n, q);
            if (s != null && !c.contains(s)) {
                r = false;
            }
        }
        let t = k._b4(o, q);
        if (r) {
            t = k._b5(t, n, q) || t;
        }
        if (!g) {
            let u = m.worksheet._b4(m, p);
            let v = l;
            if (d) {
                v |= 32640;
            }
            if (!WorksheetCellFormatProxy._y(u, t, v)) {
                if (!e || u.style.name == t.style.name) {
                    return;
                }
            }
        }
        let w = m._bc(p);
        ExcelWorkbookSerializationProvider.v(a, b, d, e, g, h, i, j, l, t, w, true);
    }
    s(a, b, c, d, e, f, g) {
        let h = FormulaParser.bx(e._y).toString();
        if (f && e._conditionalFormats$i.count > 0) {
            SpreadsheetUtilities.eb(e, a);
        }
        if (d._conditionalFormats$i.count > 0) {
            let i = new WorksheetReferenceCollection(e);
            let j = c.l;
            let k = c.k;
            let l = c.b;
            let m = 0;
            for (let n of fromEnum(d._conditionalFormats$i)) {
                if (!n._ab(l)) {
                    continue;
                }
                i.clear();
                let o = n.regions;
                for (let p = 0; p < l.length; p++) {
                    let q = l[p];
                    let r = c.j(p);
                    let s = c.i(p);
                    for (let t = 0; t < o.count; t++) {
                        if (o.item(t)._t(q._ac, q._w, q._ae, q._x)) {
                            let u = o.item(t)._h;
                            let v = new WorksheetRegionAddress(1, Math.max(q._ac, u._ac), Math.min(q._ae, u._ae), Math.max(q._w, u._w), Math.min(q._x, u._x));
                            let w = v._w - q._w + s;
                            let x = v._ac - q._ac + r;
                            let y = v._af;
                            let z = v._ad;
                            let aa = j;
                            let ab = k;
                            for (let ad = 0; ad < a.length; ad++) {
                                let ac = a[ad];
                                let ae = ac._af;
                                let af = ac._ad;
                                for (let ag = 0, ah = intDivide(ae, aa); ag < ah; ag++) {
                                    for (let ai = 0, aj = intDivide(af, ab); ai < aj; ai++) {
                                        let ak = ac._ac + ai * ab + x;
                                        let al = ac._w + ag * aa + w;
                                        let am = new WorksheetRegion(e, ak, al, ak + z - 1, al + y - 1);
                                        i._add(am);
                                    }
                                }
                            }
                        }
                    }
                }
                let an = n._g(i, b);
                an._a9(g);
                e._conditionalFormats$i._ax(m, an);
                m++;
            }
        }
    }
    r(a, b, c, d) {
        if (d._eu.count > 0) {
            let e = new List$1(WorksheetCellComment.$, 0);
            for (let f of fromEnum(d._eu)) {
                for (let g = 0; g < a.length; g++) {
                    if (a[g]._g(f.key)) {
                        e.add(f.value);
                        break;
                    }
                }
            }
            for (let h of fromEnum(e)) {
                h.cell.comment = null;
            }
        }
        if (c._eu.count > 0) {
            let i = d.workbook;
            let j = new List$1(WorksheetCellComment.$, 0);
            let k = b.l;
            let l = b.k;
            let m = b.b;
            for (let n of fromEnum(c._eu)) {
                for (let o = 0; o < m.length; o++) {
                    let p = m[o];
                    if (p._g(n.key)) {
                        let q = b.j(o);
                        let r = b.i(o);
                        let s = n.value;
                        let t = n.key.o - p._ac + q;
                        let u = n.key.m - p._w + r;
                        let v = k;
                        let w = l;
                        for (let y = 0; y < a.length; y++) {
                            let x = a[y];
                            let z = x._af;
                            let aa = x._ad;
                            for (let ab = 0, ac = intDivide(z, v); ab < ac; ab++) {
                                for (let ad = 0, ae = intDivide(aa, w); ad < ae; ad++) {
                                    let af = x._ac + ad * w + t;
                                    let ag = x._w + ab * v + u;
                                    let ah = new WorksheetCellComment();
                                    ah.author = s.author;
                                    ah.visible = s.visible;
                                    ah._ec = s._ec;
                                    if (s.text != null) {
                                        ah.text = new FormattedString(i, typeCast(StringElement.$, s.text._m.g(i)));
                                    }
                                    d._rows$i.item(af).setCellComment(ag, ah);
                                }
                            }
                        }
                    }
                }
            }
        }
    }
    static t(a, b, c, d, e, f) {
        let g = b._bp;
        let h = g.d._am;
        if (h && (!d || !e)) {
            c.formatOptions &= ~4;
        }
        else {
            let i;
            let j = a.tryGetValue(g.d, i);
            i = j.p1;
            let k = i != null;
            if (i == null) {
                if (d && h) {
                    if (ExcelWorkbookSerializationProvider.k == null) {
                        i = ExcelWorkbookSerializationProvider.k = new ResolvedWorksheetCellFormatDataFont(b);
                    }
                    else {
                        ExcelWorkbookSerializationProvider.k._b(b);
                        i = ExcelWorkbookSerializationProvider.k;
                    }
                }
                else {
                    i = g;
                }
            }
            c._a1(i, false, f);
            if (!k) {
                if (d && WorkbookColorInfo.l_op_Inequality(i.colorInfo, null) && nullableNotEquals(i.colorInfo._themeColorType$i, null)) {
                    c.font.colorInfo = i.colorInfo._g(g.d.v);
                }
                if (i != ExcelWorkbookSerializationProvider.k) {
                    a.addItem(g.d, c.d._bp.d);
                }
            }
        }
    }
    static u(a, b, c, d, e, f, g) {
        let h = d;
        for (let i = 1; i != 1073741824; i = (i << 1)) {
            if ((h & i) == 0) {
                continue;
            }
            let j = e._dd(i);
            if (b && (i & 69470538) != 0) {
                if (j == null && c) {
                    let k = e.style;
                    if (k != null && k.isBuiltIn) {
                        j = k._i._dd(i);
                    }
                }
                if (j != null) {
                    switch (i) {
                        case 64:
                            {
                                j = ExcelUtils.j(j, a);
                                break;
                            }
                        case 2:
                        case 2097152:
                        case 262144:
                        case 67108864:
                        case 8:
                        case 256:
                            {
                                j = ExcelUtils.ah(j, a);
                                break;
                            }
                    }
                }
            }
            f._bl(i, j, false, g);
        }
    }
    static v(a, b, c, d, e, f, g, h, i, j, k, l) {
        let m = k.b(true);
        if (d) {
            ExcelWorkbookSerializationProvider.x(b, g, h, j, k, l ? 0 : -97);
        }
        if (c) {
            ExcelWorkbookSerializationProvider.t(f, j, k, e, l, l ? 0 : -97);
        }
        ExcelWorkbookSerializationProvider.u(a, e, l, i, j, k, l ? 1 : -97);
        k.g(m);
    }
    static w(a, b, c, d) {
        if (c._d8) {
            let e = d.workbook;
            let f = e.cellReferenceMode;
            let g = b.l;
            let h = b.k;
            let i = b.b;
            for (let j = 0; j < i.length; j++) {
                let k = i[j];
                let l = b.j(j);
                let m = b.i(j);
                for (let n of fromEnum(c._hyperlinks$i)) {
                    let o = n.sourceRegion._h;
                    if (o._j(k)) {
                        let p = new WorksheetRegionAddress(1, Math.max(k._ac, o._ac), Math.min(k._ae, o._ae), Math.max(k._w, o._w), Math.min(k._x, o._x));
                        let q = p._w - k._w + m;
                        let r = p._ac - k._ac + l;
                        let s = p._af;
                        let t = p._ad;
                        let u = g;
                        let v = h;
                        let w = false;
                        let x = null;
                        if (n.targetNamedReference != null) {
                            x = e._namedReferences$i._find1(n.targetNamedReference.name, d);
                            if (x == null) {
                                x = e._namedReferences$i._find(n.targetNamedReference.name);
                                if (x == null) {
                                    x = n.targetAddress;
                                    w = true;
                                }
                            }
                        }
                        else if (WorksheetCell.l_op_Inequality(n.targetCell, null)) {
                            let y = n.targetCell._toString1(f, true);
                            try {
                                x = d._getCell2(y, f, null);
                            }
                            catch (z) {
                                x = y;
                                w = true;
                            }
                        }
                        else if (n.targetRegion != null) {
                            let aa = n.targetRegion._toString1(f, true);
                            try {
                                x = d._getRegion2(aa, f, null);
                            }
                            catch (ab) {
                                x = aa;
                                w = true;
                            }
                        }
                        else {
                            x = n.targetAddress;
                        }
                        for (let ad = 0; ad < a.length; ad++) {
                            let ac = a[ad];
                            let ae = ac._af;
                            let af = ac._ad;
                            for (let ag = 0, ah = intDivide(ae, u); ag < ah; ag++) {
                                for (let ai = 0, aj = intDivide(af, v); ai < aj; ai++) {
                                    let ak = ac._ac + ai * v + r;
                                    let al = ac._w + ag * u + q;
                                    let am = new WorksheetRegion(d, ak, al, ak + t - 1, al + s - 1);
                                    let an = new WorksheetHyperlink(am, x, n.displayText, n.toolTip);
                                    an._t = w;
                                    d._hyperlinks$i.add(an);
                                }
                            }
                        }
                    }
                }
            }
        }
    }
    static x(a, b, c, d, e, f) {
        let g = d.style;
        let h = null;
        if (g != null && !((() => { let i = b.tryGetValue(g, h); h = i.p1; return i.ret; })())) {
            if (g.isBuiltIn) {
                let i = g;
                h = a._styles$i._item1(g.name);
            }
            if (h == null) {
                let j = g.name.length;
                let k = new List$1(Number_$type, 0);
                for (let l of fromEnum(c)) {
                    if (startsWith1(l.name, g.name, 0)) {
                        if (j != l.name.length) {
                            if (l.name.charAt(j) != ' ' || l.name.length == j + 1) {
                                continue;
                            }
                            let m = l.name.substr(j + 1);
                            let n;
                            if (((() => { let o = tryParseInt32_2(m, 0, a._e6, n); n = o.p3; return o.ret; })()) == false) {
                                continue;
                            }
                            k.add(n);
                        }
                        {
                            h = l;
                            break;
                        }
                    }
                }
                if (h == null) {
                    let o = g.name;
                    if (a._styles$i._item1(g.name) != null) {
                        k.y();
                        let p = 1;
                        for (let q of fromEnum(k)) {
                            if (q != p) {
                                break;
                            }
                            p++;
                        }
                        o += " " + numberToString(p, a._e6);
                    }
                    h = a._styles$i._addUserDefinedStyle(g.styleFormat, o);
                }
            }
            b.item(g, h);
        }
        e._bh(h, false, f);
    }
    y(a, b, c, d, e, f) {
        let g = a.c;
        let h = a.d;
        if (d._tables$i.count > 0) {
            for (let i = d._tables$i.count - 1; i >= 0; i--) {
                let j = d._tables$i._item(i);
                let k = j._by;
                for (let l = 0; l < g.length; l++) {
                    if (g[l]._h(k)) {
                        d._tables$i.removeAt(i, false);
                        break;
                    }
                }
            }
        }
        if (e.count > 0) {
            let m = new List$1(WorksheetTable.$, 1, d._tables$i);
            let n = new HashSet$1(String_$type, 0);
            let o = h.l;
            let p = h.k;
            let q = h.b;
            for (let r of fromEnum(d.workbook._worksheets$i)) {
                for (let s of fromEnum(r._tables$i)) {
                    let t = s.name;
                    n.add_1(t);
                }
            }
            for (let u = 0; u < q.length; u++) {
                let v = q[u];
                let w = h.j(u);
                let x = h.i(u);
                for (let y of fromEnum(e)) {
                    let z = y.name;
                    let aa = y._by;
                    if (v._h(aa)) {
                        let ab = aa._w - v._w + x;
                        let ac = aa._ac - v._ac + w;
                        for (let ad = 0; ad < g.length; ad++) {
                            let ae = g[ad];
                            let af = ae._af;
                            let ag = ae._ad;
                            for (let ah = 0, ai = intDivide(af, o); ah < ai; ah++) {
                                for (let aj = 0, ak = intDivide(ag, p); aj < ak; aj++) {
                                    let al = ae._ac + aj * p + ac;
                                    let am = ae._w + ah * o + ab;
                                    let an = new WorksheetRegionAddress(1, al, al + aa._ad - 1, am, (am + aa._af - 1));
                                    let ao = true;
                                    for (let ap = 0; ap < m.count; ap++) {
                                        if (m._inner[ap]._by._j(an)) {
                                            ao = false;
                                            break;
                                        }
                                    }
                                    if (ao) {
                                        let aq;
                                        if (!n.contains(z)) {
                                            aq = z;
                                        }
                                        else {
                                            let ar = n.count + 2;
                                            do {
                                                aq = z + ar;
                                                ar++;
                                            } while (n.contains(aq));
                                        }
                                        n.add_1(aq);
                                        let as = an._ah(true, true, d.workbook.currentFormat, 1);
                                        let at = d._dd(y, true, as, Nullable$1.toNullable(CellReferenceMode_$type, 1), b);
                                        at.name = aq;
                                        a.i(ad, aj, ah, y, aq);
                                    }
                                }
                            }
                        }
                    }
                }
            }
            for (let au = 0; au < g.length; au++) {
                let av = g[au];
                let aw = av._af;
                let ax = av._ad;
                for (let ay = 0, az = intDivide(aw, o); ay < az; ay++) {
                    for (let a0 = 0, a1 = intDivide(ax, p); a0 < a1; a0++) {
                        let a2 = a.g(au, a0, ay);
                        if (a2 != null) {
                            for (let a3 of fromEnum(a2)) {
                                let a4 = d._tables$i._item1(a3);
                                for (let a5 of fromEnum(a4._columns$i)) {
                                    let a6 = a5.columnFormula;
                                    if (a6 != null) {
                                        f(au, ay, a0, a6);
                                    }
                                    if (a5._aa != null) {
                                        f(au, ay, a0, a5._aa);
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
    }
    z(a, b, c, d, e) {
        if (d._d6) {
            for (let g = 0; g < a.length; g++) {
                let f = a[g];
                d._dataValidationRules$i._remove5(f);
            }
        }
        if (c._d6) {
            for (let h of fromEnum(c._dataValidationRules$i)) {
                let i = null;
                let j = b.l;
                let k = b.k;
                let l = b.b;
                for (let m = 0; m < l.length; m++) {
                    let n = l[m];
                    let o = b.j(m);
                    let p = b.i(m);
                    if (h.value._k(n)) {
                        for (let q of fromEnum(h.value._t)) {
                            if (q._j(n)) {
                                if (i == null) {
                                    i = new WorksheetReferenceCollection(d);
                                }
                                let r = new WorksheetRegionAddress(1, Math.max(n._ac, q._ac), Math.min(n._ae, q._ae), Math.max(n._w, q._w), Math.min(n._x, q._x));
                                let s = r._w - n._w + p;
                                let t = r._ac - n._ac + o;
                                let u = r._af;
                                let v = r._ad;
                                let w = j;
                                let x = k;
                                for (let z = 0; z < a.length; z++) {
                                    let y = a[z];
                                    let aa = y._af;
                                    let ab = y._ad;
                                    for (let ac = 0, ad = intDivide(aa, w); ac < ad; ac++) {
                                        for (let ae = 0, af = intDivide(ab, x); ae < af; ae++) {
                                            let ag = y._ac + ae * x + t;
                                            let ah = y._w + ac * w + s;
                                            let ai = new WorksheetRegion(d, ag, ah, ag + v - 1, ah + u - 1);
                                            i._add(ai);
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                if (i != null) {
                    let aj = h.key;
                    let ak = null;
                    for (let al of fromEnum(d._dataValidationRules$i)) {
                        if (al.key.isEquivalentTo(aj)) {
                            ak = al.key;
                            break;
                        }
                    }
                    if (ak == null) {
                        ak = aj.clone();
                        let am = ak._l(null);
                        let an = ak._m(null);
                        if (am != null) {
                            e(am);
                        }
                        if (an != null) {
                            e(an);
                        }
                    }
                    d._dataValidationRules$i._add5(ak, i);
                }
            }
        }
    }
    static o(a, b) {
        let c = b.workbook;
        let d = a.workbook;
        let e = new Dictionary$2(NamedReferenceBase.$, NamedReferenceBase.$, 0);
        let f = (g, h) => {
            let i;
            if (!((() => { let j = e.tryGetValue(g, i); i = j.p1; return j.ret; })())) {
                let j = typeCast(Worksheet.$, g.scope);
                if (j == a) {
                    i = c._a2(g.name, b);
                }
                else if (j != null) {
                    i = new NamedReferenceUnconnected(1, j.name, c._bf(d._gw), g._p, c.currentFormat, true);
                }
                else {
                    i = c._a3(g.name);
                }
                if (i == null) {
                    if (typeCast(NamedReference.$, g) !== null) {
                        let k = j != null ? b : c;
                        let l = new NamedReference(1, c._namedReferences$i, k, g._p);
                        l._be(g.name, "Name", c.currentFormat);
                        l._v = g._v;
                        l.comment = g.comment;
                        if (g._j != null && !g._r) {
                            let m = g._j._g();
                            h(m);
                            l._j = m;
                        }
                        c._namedReferences$i._x(l);
                        i = l;
                    }
                    else {
                        i = null;
                    }
                }
                e.item(g, i);
            }
            return i;
        };
        return f;
    }
    static l(a, b, c) {
        let d = c._af;
        let e = c._ad;
        if (d % a != 0 || e % b != 0) {
            let f = e % b != 0 || d != 1 ? b : e;
            let g = d % a != 0 || e != 1 ? a : d;
            c = new WorksheetRegionAddress(1, c._ac, c._ac + f - 1, c._w, (c._w + g - 1));
            return {
                ret: true,
                p2: c
            };
        }
        return {
            ret: false,
            p2: c
        };
    }
    static *_n(a, b, c) {
        for (let d = b; d <= c; d++) {
            yield a.item(d);
        }
    }
    static n(a, b, c) {
        return toEnum(() => ExcelWorkbookSerializationProvider._n(a, b, c));
    }
    p(a, b, c = 1) {
        let d = 0;
        let g = a.b;
        for (let f = 0; f < g.length; f++) {
            let e = g[f];
            for (let i = 0; i < b.length; i++) {
                let h = b[i];
                let j = h._c4(e._ac, e._ae, e._w, e._x, false);
                if (j._n) {
                    d += (j._af * j._ad) * c;
                }
            }
        }
        return d;
    }
    m(a, b, c, d = null) {
        let e = a.workbook;
        if (b != e) {
            b.suspendCalculations();
        }
        if (c && WorksheetRegionAddress._p(b._gn, Nullable$1.toNullable(WorksheetRegionAddress.$, null))) {
            c = false;
        }
        let f = c ? [b.windowOptions.selectedWorksheet] : Enumerable.a(Worksheet.$, Enumerable.u(Worksheet.$, b._worksheets$i, (g) => g._w));
        let g = SpreadsheetUtilities.e(e);
        if (g.length % f.length != 0) {
            a.m(0);
            return false;
        }
        let h = a.b;
        let i = a.g;
        let j = a.a;
        let k = b.windowOptions.selectedWorksheet;
        let l = e.windowOptions.selectedWorksheet;
        let m;
        if (c) {
            m = new WorksheetPaneSelection();
            m.b = new WorksheetCellAddress(1, b._gn.value._ac, b._gn.value._w);
            m.f = 0;
            m.a = 3;
            m.d.add(b._gn.value);
        }
        else {
            m = k.displayOptions._af.a(k.displayOptions._z);
        }
        let n = l.displayOptions._af.a(l.displayOptions._z);
        if (m == null || m.d.count == 0) {
            a.m(3);
            return false;
        }
        let o = Enumerable.a(WorksheetRegionAddress.$, m.d);
        let p = (h & 2097152) != 0;
        let q = (h & 8192) != 0;
        let r = new HashSet$1(WorksheetTable.$, 0);
        let s = new HashSet$1(WorksheetTable.$, 0);
        let t = false;
        for (let v = 0; v < f.length; v++) {
            let u = f[v];
            for (let w of fromEnum(u._tables$i)) {
                for (let y = 0; y < o.length; y++) {
                    let x = o[y];
                    let z = w._by;
                    let aa = false;
                    if (x._h(z)) {
                        if (r.add_1(w) && !p) {
                            aa = true;
                        }
                    }
                    else if (q && z._h(x)) {
                        s.add_1(w);
                        aa = true;
                    }
                    if (aa) {
                        t = true;
                        let ab = Math.max(x._ac, z._ac);
                        let ac = Math.min(x._ae, z._ae);
                        for (let ad = ab; ad <= ac; ad++) {
                            let ae = u._rows$i.item(ad);
                        }
                    }
                }
            }
            if (r.count > 0 && f.length > 1) {
                a.m(4);
                return false;
            }
        }
        if (!p) {
            r.clear();
        }
        let af = true;
        let ag = true;
        for (let ai = 0; ai < o.length; ai++) {
            let ah = o[ai];
            if (ah._ac > 0 || ah._ae < b.maxRowCount - 1) {
                af = false;
            }
            if (ah._w > 0 || ah._x < b.maxColumnCount - 1) {
                ag = false;
            }
        }
        let aj = Enumerable.a(WorksheetRegionAddress.$, n.d);
        let ak = false;
        let al;
        if (o.length > 1) {
            if (aj.length > 1) {
                a.m(1);
                return false;
            }
            al = new CellRegionMapMany(o);
        }
        else {
            al = new CellRegionMapSingle(o[0]);
            if (aj.length > 1) {
                let am = o[0]._af;
                let an = o[0]._ad;
                for (let ao = 0; ao < aj.length; ao++) {
                    let ap = aj[ao];
                    let aq = ap._af;
                    let ar = ap._ad;
                    if ((aq > 1 && aq % am != 0) || (ar > 1 && ar % an != 0)) {
                        a.m(2);
                        return false;
                    }
                    if ((aq == 1 && am != 1) || (ar == 1 && an != 1)) {
                        ak = true;
                        aj[ao] = new WorksheetRegionAddress(1, aj[ao]._ac, ar == 1 ? aj[ao]._ac + an - 1 : aj[ao]._ae, aj[ao]._w, aq == 1 ? (aj[ao]._w + am - 1) : aj[ao]._x);
                    }
                }
            }
        }
        if (af || ag) {
            for (let at = 0; at < aj.length; at++) {
                let as = aj[at];
                if ((ag && as._w != 0) || (af && as._ac != 0)) {
                    a.m(2);
                    return false;
                }
            }
        }
        if (aj.length == 1) {
            ak = ((() => { let au = ExcelWorkbookSerializationProvider.l(al.l, al.k, aj[0]); aj[0] = au.p2; return au.ret; })());
        }
        if (a.i(boxArray$1(g), boxArray$1(aj), true) == false) {
            return false;
        }
        let au = 0;
        for (let aw = 0; aw < aj.length; aw++) {
            let av = aj[aw];
            au += (intDivide(av._af, al.l)) * (intDivide(av._ad, al.k));
        }
        let ax = this.p(al, f, au);
        if (!a.h(ax)) {
            return false;
        }
        let ay = Nullable$1.toNullable(WorksheetRegionAddress.$, null);
        if (ak) {
            ay = WorkbookSerializationProviderBase.h(g, aj);
        }
        if (WorksheetRegionAddress._r(ay, Nullable$1.toNullable(WorksheetRegionAddress.$, null))) {
            a.m(5);
            return false;
        }
        let az = new Array(aj.length);
        let a0 = new HashSet$1(IRegionBlockingValue_$type, 0);
        for (let a1 = 0; a1 < g.length; a1++) {
            let a2 = g[a1];
            for (let a3 = 0; a3 < aj.length; a3++) {
                az[a3] = a2._cw(aj[a3]);
            }
            ExcelUtils.gf(az, a0);
        }
        if (a.a == 0) {
            for (let a4 of fromEnum(a0)) {
                a4.removeFromRegion();
            }
        }
        let a5 = (h & 1) != 0;
        let a6 = (h & 2) != 0;
        if (o.length > 1 && (h & 4) != 0) {
            a6 = false;
        }
        let a7 = (h & 64) != 0;
        let a8 = (h & 128) != 0;
        let a9 = (h & 1024) != 0;
        let ba = (h & 8) != 0;
        let bb = (h & 16384) != 0;
        let bc = (h & 8192) != 0 && s.count > 0;
        let bd = (h & 2048) != 0;
        let be = (h & 4096) != 0;
        let bf = (h & 131072) != 0;
        let bg = (h & 262144) != 0;
        let bh = (h & 524288) != 0;
        let bi = (h & 1048576) != 0;
        let bj = (h & 4194304) != 0;
        let bk = (h & 8388608) != 0;
        if (!ba && af && (h & 32768) != 0) {
            ba = true;
        }
        if (!bb && ag && (h & 65536) != 0) {
            bb = true;
        }
        let bl = new HashSet$1(WorksheetMergedCellsRegion.$, 0);
        let bm = new Dictionary$2(WorkbookFontData.$, IWorkbookFont_$type, 0);
        let bn = new Dictionary$2(WorkbookStyle.$, WorkbookStyle.$, 0);
        let bo = Enumerable.z(WorkbookStyle.$, Enumerable.x(WorkbookStyle.$, String_$type, e._styles$i, (bp) => bp.name));
        let bp = SpreadsheetUtilities.g(boxArray$1(aj));
        let bq = 0;
        if ((h & 32) != 0) {
            bq |= 830603265;
        }
        if ((h & 256) != 0) {
            bq |= 1073741888;
        }
        if ((h & 512) != 0) {
            bq |= 1074790400;
        }
        if ((h & 16) != 0) {
            bq |= 1073807360;
        }
        if (a7) {
            bq |= 208404542;
        }
        let br = al.k;
        let bs = al.l;
        let bt = new ExcelWorkbookSerializationProvider_CellRangeTargetInfo(e, aj, al);
        for (let bu = 0; bu < g.length; bu++) {
            let bv = f[bu % f.length];
            let bw = g[bu];
            bl.clear();
            let bx = ExcelWorkbookSerializationProvider.o(bv, bw);
            let by = bw._eh;
            let bz = bq;
            if (bw.isProtected) {
                bz &= ~1048576;
            }
            let b0 = bz != 0 || a8;
            try {
                bw._eh = true;
                if (bf) {
                    let b1;
                    let b2 = SpreadsheetPaneManager._hx(false, false, b1, bw, boxArray$1(bp));
                    b1 = b2.p2;
                    ExcelWorkbookSerializationProvider.w(aj, al, bv, bw);
                }
                if (p) {
                    this.y(bt, bd, bv, bw, r, (b3, b4, b5, b6) => b6._bv(bv, d, bw, Nullable$1.toNullable(Boolean_$type, true), bt.h(b3, b4, b5), bx));
                }
                if (bg) {
                    this.z(aj, al, bv, bw, (b3) => b3._bv(bv, d, bw, Nullable$1.toNullable(Boolean_$type, false), null, bx));
                }
                if (bj) {
                    this.s(aj, bd, al, bv, bw, !bk, (b3, b4) => b4._bv(bv, d, bw, Nullable$1.toNullable(Boolean_$type, false), null, bx));
                }
                if (bh) {
                    this.r(aj, al, bv, bw);
                }
                for (let b3 = 0; b3 < aj.length; b3++) {
                    let b4 = aj[b3];
                    let b5 = b4._ac;
                    let b6 = b4._w;
                    let b7 = bw._rows$i;
                    let b8;
                    if (af) {
                        b8 = true;
                    }
                    else {
                        if (bb && bv.defaultRowHeight != bw.defaultRowHeight) {
                            b8 = false;
                        }
                        else {
                            b8 = true;
                            let b9 = new ReadOnlyResolvedWorksheetCellFormatData(bv.workbook._styles$i.normalStyle._i);
                            let ca = new ReadOnlyResolvedWorksheetCellFormatData(bw.workbook._styles$i.normalStyle._i);
                            let cb = bz;
                            if (a8) {
                                cb |= 32640;
                            }
                            let cc = null;
                            let cd = null;
                            for (let ce = b4._w; ce <= b4._x; ce++) {
                                let cf = false;
                                if (cd == null || !cd.g(ce)) {
                                    cd = bw._cb(ce);
                                    cf = true;
                                }
                                let cg = al.g(ce - b4._w);
                                if (cc == null || !cc.g(cg)) {
                                    cc = bv._cb(cg);
                                    cf = true;
                                }
                                if (cf) {
                                    b9._c(cc.b);
                                    ca._c(cd.b);
                                    if (WorksheetCellFormatProxy._y(b9, ca, cb)) {
                                        b8 = false;
                                        break;
                                    }
                                    else if (a9 && !bd) {
                                        if (b9.style.name != ca.style.name) {
                                            b8 = false;
                                            break;
                                        }
                                    }
                                }
                            }
                        }
                    }
                    if (af && ag) {
                        for (let ch of fromEnum(bv._rows$i._m(0, Math.min(al.k, b4._ae)))) {
                            let ci = b7.item(ch.index);
                        }
                    }
                    else if (b8) {
                        let cj = al.k;
                        let ck = (b4._ae - b4._ac) + 1;
                        let cl = intDivide(ck, cj);
                        let cm = al.c;
                        let cn = b4._ac;
                        for (let co = 0; co < cm.length; co++) {
                            let cp = cm[co]._i;
                            for (let cq of fromEnum(bv._rows$i._m(cp, cm[co]._h))) {
                                let cr = cq.index - cp;
                                for (let cs = 0; cs < cl; cs++) {
                                    let ct = b7.item((cs * cj) + cn + cr);
                                }
                            }
                            cn += (cm[co]._h - cp) + 1;
                        }
                    }
                    if (ba) {
                        let cu = null;
                        let cv = null;
                        for (let cw = b4._w; cw <= b4._x; cw++) {
                            let cx = al.g(cw - b6);
                            if (cu == null || cx > cu.r) {
                                cu = bv._cb(cx);
                            }
                            let cy = cu.v;
                            if (cy < 0) {
                                cy = bv.defaultColumnWidth;
                            }
                            if (cv == null || cw > cv.r) {
                                cv = bw._cb(cw);
                            }
                            let cz = cv.v;
                            if (cz < 0) {
                                cz = bw.defaultColumnWidth;
                            }
                            if (cy != cz || cu.i != cv.i) {
                                bw._columns$i.item(cw).width = cy;
                                bw._columns$i.item(cw).hidden = cu.i;
                            }
                        }
                    }
                    if (af && b0) {
                        let c0 = null;
                        for (let c1 = b4._w; c1 <= b4._x; c1++) {
                            let c2 = al.g(c1 - b6);
                            if (c0 == null || !c0.g(c2)) {
                                c0 = bv._cb(c2);
                            }
                            let c3 = c0.b;
                            let c4 = bw._columns$i.item(c1)._cellFormatInternal;
                            if (!i) {
                                ExcelWorkbookSerializationProvider.v(b, e, a8, a9, bd, bm, bn, bo, bz, c3, c4, false);
                            }
                        }
                    }
                    let c5 = b8 ? b7._m(b4._ac, b4._ae) : ExcelWorkbookSerializationProvider.n(b7, b4._ac, b4._ae);
                    let c6 = new ExcelWorkbookSerializationProvider_TargetColumnIndexHelper(SpreadsheetUtilities.z(b4), al, b0, t);
                    for (let c7 of fromEnum(c5)) {
                        let c8 = c7.index;
                        let c9 = c8 - b5;
                        let da = al.h(c9);
                        let db = (intDivide(c9, br));
                        let dc = bv._rows$i.item(da);
                        if (bb) {
                            c7.height = dc.height;
                            c7.hidden = dc.hidden;
                        }
                        if (ag && b0) {
                            let dd = dc._hasCellFormat ? dc._cellFormatInternal.d : bv.workbook._ca._p;
                            let de = c7._cellFormatInternal;
                            if (!i) {
                                ExcelWorkbookSerializationProvider.v(b, e, a8, a9, bd, bm, bn, bo, bz, dd, de, false);
                            }
                        }
                        let df = ag ? Enumerable.z(IntRange.$, c6.f(dc, c7)) : c6.h();
                        for (let dg = 0; dg < df.count; dg++) {
                            for (let dh = df.item(dg)._i; dh <= df.item(dg)._h; dh++) {
                                let di = dh - b6;
                                let dj = al.g(di);
                                let dk = (intDivide(di, bs));
                                let dl = c7.getCellAssociatedMergedCellsRegion(dh);
                                let dm = null;
                                if (dl != null) {
                                    if (false == bl.add_1(dl)) {
                                        if (b0 && b4._h(dl._h)) {
                                            ExcelWorkbookSerializationProvider.q(b, e, s, a8, a9, bc, bd, bm, bn, bo, bv, bz, c7, da, dc, dh, dj);
                                        }
                                        continue;
                                    }
                                    if (false == b4._h(dl._h)) {
                                        continue;
                                    }
                                }
                                if (be) {
                                    dm = dc.getCellAssociatedMergedCellsRegion(dj);
                                    if (dm == null) {
                                        if (dl != null) {
                                            if (WorksheetRegionAddress._o(dl._h, b4) && al.b.length == 1 && al.b[0]._m) {
                                            }
                                            else {
                                                bw._mergedCellsRegions$i.remove_1(dl);
                                            }
                                        }
                                    }
                                    else if (dl != null && WorksheetRegionAddress._o(dl._h, b4) && al.b.length == 1 && WorksheetRegionAddress._o(al.b[0], dm._h)) {
                                    }
                                    else {
                                        if (!al.e(da, dj)._h(dm._h)) {
                                            continue;
                                        }
                                        let dn = dl;
                                        if (dl != null) {
                                            if (dl._ad != dm._ad || dl._aa != dm._aa) {
                                                bw._mergedCellsRegions$i.remove_1(dl);
                                                dl = null;
                                            }
                                        }
                                        if (dl == null) {
                                            if (dn == null || dm._ad > dn._ad || dm._aa > dn._aa) {
                                                bw._ih(new WorksheetRegionAddress(1, c8, c8 + dm._aa - 1, dh, (dh + dm._ad - 1)), bl);
                                            }
                                            dl = bw._mergedCellsRegions$i._add1(c8, dh, c8 + dm._aa - 1, dh + dm._ad - 1);
                                            bl.add_1(dl);
                                        }
                                    }
                                }
                                if (i && dc._c6(dj) == null) {
                                    continue;
                                }
                                if (b0) {
                                    if (dm != null && dm._hasCellFormat && dl != null) {
                                        ExcelWorkbookSerializationProvider.v(b, e, a8, a9, bd, bm, bn, bo, bz, dm._cellFormatInternal.d, dl._cellFormatInternal, true);
                                    }
                                    let dp = bc;
                                    if (dp) {
                                        if (bw._de(c8, dh) != null) {
                                            dp = false;
                                        }
                                    }
                                    ExcelWorkbookSerializationProvider.q(b, e, s, a8, a9, dp, bd, bm, bn, bo, bv, bz, c7, da, dc, dh, dj);
                                }
                                let dq = a5;
                                if (a6) {
                                    let dr = dc.getCellFormula(dj);
                                    if (dr != null) {
                                        dq = false;
                                        if (dr._s == 1) {
                                            if (j == 0) {
                                                let ds = dr;
                                                let dt = al.e(da, dj);
                                                let du = ds.cellRange._h;
                                                if (da != Math.max(dt._ac, du._ac)) {
                                                    continue;
                                                }
                                                if (dj != Math.max(dt._w, du._w)) {
                                                    continue;
                                                }
                                                let dv = ds._g();
                                                dv._bv(bv, d, bw, SpreadsheetUtilities.cz, bt.h(b3, db, dk), bx);
                                                dv._bw(e, dc, dj, { $type: Point_$type, x: dh - du._w, y: c8 - du._ac });
                                                let dw = bw._cx(c8, dh, c8 + Math.min(dt._ae, du._ae) - da, dh + Math.min(dt._x, du._x) - dj);
                                                dv._applyTo3(dw);
                                            }
                                            else {
                                                dq = a5;
                                            }
                                        }
                                        else {
                                            if (dr._as) {
                                                bv._h3(dr, false);
                                                dr._bt(b);
                                            }
                                            let dx = dr._g();
                                            dx._bv(bv, d, bw, SpreadsheetUtilities.cz, bt.h(b3, db, dk), bx);
                                            dx._bw(e, dc, dj, { $type: Point_$type, x: dh - dj, y: c8 - da });
                                            if (j != 0) {
                                                this.b(j, NaN, dx, c7, dh);
                                            }
                                            else {
                                                dx._bp(c7, dh);
                                            }
                                            if (a5 && dx._ae()) {
                                                let dy = dc._getCellValue1(dj);
                                                if (dy != null && typeCast(FormattedString.$, dy) !== null == false) {
                                                    c7._d0(dh, CalcUtilities.c(dy), true);
                                                }
                                            }
                                        }
                                    }
                                }
                                if (dq) {
                                    let dz = dc._getCellValue1(dj);
                                    if (i == false || dz != null) {
                                        if (j != 0) {
                                            this.b(j, WorkbookSerializationProviderBase.g(b, dz), null, c7, dh);
                                            continue;
                                        }
                                        if (typeCast(FormattedString.$, dz) !== null) {
                                            if (bi) {
                                                let d0 = typeCast(StringElement.$, dz._m.g(e));
                                                if (bd && typeCast(FormattedStringElement.$, d0) !== null) {
                                                    let d1 = d0;
                                                    if (d1._u) {
                                                        for (let d2 of fromEnum(d1._ah)) {
                                                            if (d2.h) {
                                                                let d3 = d2.e();
                                                                if (WorkbookColorInfo.l_op_Inequality(d3.colorInfo, null)) {
                                                                    d3.colorInfo = ExcelUtils.ah(d3.colorInfo, b);
                                                                }
                                                            }
                                                        }
                                                    }
                                                }
                                                dz = new FormattedString(e, d0);
                                            }
                                            else {
                                                dz = dz.unformattedString;
                                            }
                                        }
                                        c7.setCellValue(dh, dz);
                                    }
                                }
                            }
                        }
                    }
                }
            }
            finally {
                bw._eh = by;
            }
            let d4 = bt.f();
            SpreadsheetUtilities.e0(bw, aj, d4);
        }
        return true;
    }
}
ExcelWorkbookSerializationProvider.$t = markType(ExcelWorkbookSerializationProvider, 'ExcelWorkbookSerializationProvider', WorkbookSerializationProviderBase.$);
ExcelWorkbookSerializationProvider.k = null;
/**
 * @hidden
 */
export class BIFF8SerializationProvider extends ExcelWorkbookSerializationProvider {
    constructor() {
        super(1, ["BIFF8"], null);
    }
    j(a) {
        let b = super.j(a);
        if (b != null) {
            let c = a.l("Link");
            if (!stringIsNullOrEmpty(c)) {
                let d = 2;
                let e = c.split('\0');
                let f, g;
                let h, i;
                for (let k = 0; k < e.length; k++) {
                    let j = e[k];
                    if (stringIsNullOrWhiteSpace(j)) {
                        continue;
                    }
                    let l = j.trim();
                    if (startsWith1(l, "R", 1) == false && startsWith1(l, "C", 1) == false) {
                        continue;
                    }
                    let m = ExcelUtils.fu(l, d, null, 0, f, h, g, i);
                    f = m.p4;
                    h = m.p5;
                    g = m.p6;
                    i = m.p7;
                    if (f >= 0 && f < 65536 && g >= 0 && g < 65536 && h >= 0 && h < 256 && i >= 0 && i < 256) {
                        return b;
                    }
                    if (startsWith1(l, "R", 1)) {
                        let n, o;
                        n = o = 0;
                        let p = false;
                        let q;
                        if (((() => { let r = FormulaParser.bc(l, 0, d, n, p, q); n = r.p3; p = r.p4; q = r.p5; return r.ret; })()) == false || p) {
                            continue;
                        }
                        if (l.length == q) {
                            o = n;
                        }
                        else if (l.length == q + 1 || l.charAt(q) != ":") {
                            continue;
                        }
                        else if (((() => { let r = FormulaParser.bc(l, q + 1, d, o, p, q); o = r.p3; p = r.p4; q = r.p5; return r.ret; })()) == false || p) {
                            continue;
                        }
                        return b;
                    }
                    if (startsWith1(l, "C", 1)) {
                        let r, s;
                        r = s = 0;
                        let t = false;
                        let u;
                        if (((() => { let v = FormulaParser.ap(l, 0, d, r, t, u); r = v.p3; t = v.p4; u = v.p5; return v.ret; })()) == false || t) {
                            continue;
                        }
                        if (l.length == u) {
                            s = r;
                        }
                        else if (l.length == u + 1 || l.charAt(u) != ":") {
                            continue;
                        }
                        else if (((() => { let v = FormulaParser.ap(l, u + 1, d, s, t, u); s = v.p3; t = v.p4; u = v.p5; return v.ret; })()) == false || t) {
                            continue;
                        }
                        return b;
                    }
                }
                return null;
            }
        }
        return b;
    }
    c(a) {
        if (a.e("BIFF8")) {
            let b = typeCast(Stream.$, a.j("BIFF8"));
            if (b != null) {
                let c = null;
                let d = a.l("LINK");
                if (!stringIsNullOrEmpty(d)) {
                    let e = d.split('\0');
                    let f = e.length > 1 ? e[1] : null;
                    if (!stringIsNullOrEmpty(f)) {
                        let g = f.indexOf('[');
                        let h = f.lastIndexOf(']');
                        if (g >= 0 && h > g) {
                            let i = f.substr(g + 1, h - g - 1);
                            let j = g > 1 ? f.substr(0, g) : null;
                            let k = j != null ? IOPath.combine1(j, i) : i;
                            c = a.workbook._bf(k);
                            if (c == a.workbook._bb) {
                                c = null;
                            }
                        }
                    }
                }
                let l = Workbook._bs(b);
                return this.m(a, l, true, c);
            }
        }
        return false;
    }
    d(a) {
        throw new NotSupportedException(0);
    }
}
BIFF8SerializationProvider.$t = markType(BIFF8SerializationProvider, 'BIFF8SerializationProvider', ExcelWorkbookSerializationProvider.$);
/**
 * @hidden
 */
export class PlainTextWorkbookSerializationProvider extends WorkbookSerializationProviderBase {
    constructor(...a) {
        super(0, ...a);
    }
    c(a) {
        let b = a.k;
        let c = a.e(b) ? a.j(b) : null;
        if (c == null) {
            return false;
        }
        let d = typeCast(String_$type, c);
        if (d != null) {
            {
                let e = new StringReader(d);
                try {
                    return this.m(a, e, this.k);
                }
                finally {
                    if (e != null) {
                        e.dispose();
                    }
                }
            }
        }
        let f = typeCast(Stream.$, c);
        if (null == f) {
            return false;
        }
        {
            let g = new StreamReader(f);
            try {
                return this.m(a, g, this.k);
            }
            finally {
                if (g != null) {
                    g.dispose();
                }
            }
        }
    }
    static l(a, b) {
        let c = a.a;
        if (c.length > 1) {
            let d = new SortedIntRangeList();
            for (let e = 0; e < c.length; e++) {
                let f = c[e];
                d.n(f._i, f._h);
                if (e < c.length - 1) {
                    let g = c[e + 1]._i;
                    let h = f._h + 1;
                    while (h < g) {
                        let i = b._cb(h);
                        if (!i.i) {
                            d.n(h, Math.min(g - 1, i.r));
                        }
                        h = i.r + 1;
                    }
                }
            }
            c = new Array(d.k);
            for (let j = 0; j < c.length; j++) {
                c[j] = new IntRange(1, d.i(j), d.h(j));
            }
        }
        let k = a.c;
        if (k.length > 1) {
            let l = !b._dv;
            let m = new SortedIntRangeList();
            for (let n = 0; n < k.length; n++) {
                let o = k[n];
                m.n(o._i, o._h);
                if (n < k.length - 1) {
                    let p = k[n + 1]._i;
                    let q = o._h + 1;
                    for (let r of fromEnum(b._rows$i._m(q, p - 1))) {
                        let s = r.index;
                        if (q < s && l) {
                            m.n(q, s - 1);
                        }
                        if (!r.hidden) {
                            m.m(s);
                        }
                        q = s + 1;
                    }
                    if (q < p && l) {
                        m.n(q, p - 1);
                    }
                }
            }
            k = new Array(m.k);
            for (let t = 0; t < k.length; t++) {
                k[t] = new IntRange(1, m.i(t), m.h(t));
            }
        }
        if (c != a.a || k != a.c) {
            let u = new Array(c.length * k.length);
            for (let v = 0; v < k.length; v++) {
                for (let w = 0; w < c.length; w++) {
                    u[v * c.length + w] = new WorksheetRegionAddress(1, k[v]._i, k[v]._h, c[w]._i, c[w]._h);
                }
            }
            if (u.length == 1) {
                a = new CellRegionMapSingle(u[0]);
            }
            else {
                a = new CellRegionMapMany(u);
            }
        }
        return a;
    }
    static o(a, b) {
        let c = 0;
        for (let d = 0; d < b; d++) {
            c = Math.max(a._inner[d].length, c);
        }
        return c;
    }
    m(a, b, c, d = Nullable$1.toNullable(String_$type, '\"')) {
        let e = a.workbook;
        let f = SpreadsheetUtilities.e(e);
        let g = e.windowOptions.selectedWorksheet;
        let h = g.displayOptions._af.a(g.displayOptions._z);
        let i = Enumerable.a(WorksheetRegionAddress.$, h.d);
        if (i.length > 1) {
            a.m(6);
            return false;
        }
        let j = i[0];
        let k = 32759;
        let l = PlainTextReader.a(b, false, d, c, k);
        let m = l.count;
        if (m == 0) {
            return false;
        }
        if (j._ad > 1 && j._ad < m) {
            m = j._ad;
        }
        let n = PlainTextWorkbookSerializationProvider.o(l, m);
        if (j._af > 1 && j._af < n) {
            n = j._af;
        }
        if (j._af > n || j._ad > m) {
        }
        let o = j._af != n;
        let p = j._ad != m;
        if (o || p) {
            j = new WorksheetRegionAddress(1, j._ac, p ? (j._ac + m - 1) : j._ae, j._w, o ? (j._w + n - 1) : j._x);
        }
        if (j._ae >= e.maxRowCount || j._x >= e.maxColumnCount) {
            j = new WorksheetRegionAddress(1, j._ac, Math.min(j._ae, e.maxRowCount - 1), j._w, Math.min(j._x, e.maxColumnCount - 1));
            m = j._ae - j._ac + 1;
            n = j._x - j._w + 1;
        }
        let q = j;
        let r = new HashSet$1(IRegionBlockingValue_$type, 0);
        for (let t = 0; t < f.length; t++) {
            let s = f[t];
            let u = s._hi(j);
            j = u.p0;
            if (WorksheetRegionAddress._q(j, q)) {
                a.m(5);
                return false;
            }
            ExcelUtils.gf([new WorksheetRegion(s, j._ac, j._w, j._ae, j._x, false)], r);
        }
        if (a.i(boxArray$1(f), boxArray$1([j]), false) == false) {
            return false;
        }
        if (!a.h(n * m)) {
            return false;
        }
        if (a.a == 0) {
            for (let v of fromEnum(r)) {
                v.removeFromRegion();
            }
        }
        if (WorksheetRegionAddress._q(i[0], j)) {
            i[0] = j;
            WorkbookSerializationProviderBase.h(f, i);
        }
        let w = a.b;
        let x = a.g;
        let y = (w & 1) != 0;
        let z = (w & 2) != 0;
        let aa = (w & 16) != 0;
        let ab = (w & 4096) != 0;
        let ac = (w & 131072) != 0;
        let ad = new PlainTextWorkbookSerializationProvider_ParseEditValue();
        let ae = new HashSet$1(WorksheetMergedCellsRegion.$, 0);
        let af = [SpreadsheetUtilities.z(j)];
        let ag = new ParseEditValueCache(a);
        let ah = a.a;
        for (let aj = 0; aj < f.length; aj++) {
            let ai = f[aj];
            let ak = j._ac;
            let al = j._w;
            for (let am = 0; am < m; am++) {
                let an = l._inner[am];
                let ao = x ? an.length : n;
                let ap = ai._rows$i.item(ak + am);
                for (let aq = 0; aq < ao; aq++) {
                    let ar = aq >= an.length ? null : an[aq];
                    let as = al + aq;
                    let at;
                    let au = 0;
                    let av = false;
                    let aw = null;
                    if (stringIsNullOrEmpty(ar)) {
                        at = null;
                    }
                    else {
                        ad.b = ar;
                        ad.a = ai._b4(ap, as);
                        at = ((() => { let ax = SpreadsheetEditHelper.ad(ag, ad, false, true, au); au = ax.p4; return ax.ret; })());
                        if (at == ad || (z == false && typeCast(Formula.$, at) !== null)) {
                            at = ar;
                            av = stringContains(ar, "\n");
                        }
                        aw = typeCast(Formula.$, at);
                        if (aa && aw != null && au == -1) {
                            au = SpreadsheetEditHelper.aa(aw, ai, ap.index, as);
                        }
                    }
                    let ax = ap.getCellAssociatedMergedCellsRegion(as);
                    if (ax != null) {
                        if (ab) {
                            ai._mergedCellsRegions$i.remove_1(ax);
                        }
                        else if (ae.add_1(ax) == false) {
                            continue;
                        }
                    }
                    if (ah != 0) {
                        if (typeCast(Formula.$, at) !== null) {
                            this.b(ah, NaN, at, ap, as);
                            continue;
                        }
                        else {
                            let ay = WorkbookSerializationProviderBase.g(e, at);
                            if (isNaN_(ay) && typeof at === 'string') {
                                if (!((() => { let az = ExcelUtils.by(at, e, e._e6, false, ay); ay = az.p4; return az.ret; })())) {
                                    continue;
                                }
                            }
                            this.b(ah, ay, null, ap, as);
                            continue;
                        }
                    }
                    if (at == null) {
                        if (x == false) {
                            ap.setCellValue(as, at);
                        }
                    }
                    else if (aw != null) {
                        aw._bp(ap, as, 1);
                        if (aa && au != -1) {
                            SpreadsheetEditHelper.ai(ap, as, au, ai._b4(ap, as));
                        }
                    }
                    else if (aa) {
                        SpreadsheetEditHelper.ak(ap, as, ad.editCellFormat, at, au, av);
                    }
                    else {
                        ap.setCellValue(as, at);
                        if (av) {
                            ap.getCellFormat(as)._wrapText$i = Nullable$1.toNullable(Boolean_$type, true);
                        }
                    }
                }
            }
            if (ac) {
                let az;
                let a0 = SpreadsheetPaneManager._hx(false, false, az, ai, boxArray$1(af));
                az = a0.p2;
            }
        }
        return true;
    }
    n(a, b, c, d = Nullable$1.toNullable(String_$type, '\"')) {
        let e = new PlainTextWriter(b, d, c);
        let f = a.b.windowOptions.selectedWorksheet;
        let g = f._rows$i;
        let h = f._c4(0, a.b.maxRowCount - 1, 0, (a.b.maxColumnCount - 1), false);
        let i = a.a;
        i = PlainTextWorkbookSerializationProvider.l(i, f);
        let j = Math.max(Math.min(Enumerable.ah(IntRange.$, i.c)._h, h._ae), i.c[0]._i);
        let k = Math.max(Math.min(Enumerable.ah(IntRange.$, i.a)._h, h._x), i.a[0]._i);
        let l = 0;
        let o = i.a;
        for (let n = 0; n < o.length; n++) {
            let m = o[n];
            if (m._i > k) {
                break;
            }
            l += (Math.min(m._h, k) - m._i) + 1;
        }
        let p = 0;
        let s = i.c;
        for (let r = 0; r < s.length; r++) {
            let q = s[r];
            if (q._i > j) {
                break;
            }
            p += (Math.min(q._h, j) - q._i) + 1;
        }
        if ((p * l) > 16384000) {
            if (!a.h()) {
                return false;
            }
        }
        let v = i.c;
        for (let u = 0; u < v.length; u++) {
            let t = v[u];
            let w = t._i;
            for (let x of fromEnum(g._m(t._i, Math.min(t._h, j)))) {
                let y = x.index;
                for (; w < y; w++) {
                    e.l(l - 1);
                    e.k();
                }
                let ab = i.a;
                for (let aa = 0; aa < ab.length; aa++) {
                    let z = ab[aa];
                    for (let ac = z._i, ad = Math.min(z._h, k); ac <= ad; ac++) {
                        let ae = x._getCellText1(ac, 1);
                        e.m(ae);
                    }
                }
                e.k();
                w = y + 1;
            }
            for (; w < Math.min(t._h, j); w++) {
                e.l(l - 1);
                e.k();
            }
        }
        return true;
    }
}
PlainTextWorkbookSerializationProvider.$t = markType(PlainTextWorkbookSerializationProvider, 'PlainTextWorkbookSerializationProvider', WorkbookSerializationProviderBase.$);
/**
 * @hidden
 */
export class CSVWorkbookSerializationProvider extends PlainTextWorkbookSerializationProvider {
    constructor() {
        super(DataFormats.a);
    }
    get_k() {
        return [','];
    }
    get k() {
        return this.get_k();
    }
    d(a) {
        let b = new MemoryStream(0);
        let c = new StreamWriter(1, b, Encoding.uTF8);
        let d = this.n(a, c, ',');
        c.k();
        b.position = 0;
        if (d) {
            a.p(DataFormats.a, b);
        }
        return d;
    }
}
CSVWorkbookSerializationProvider.$t = markType(CSVWorkbookSerializationProvider, 'CSVWorkbookSerializationProvider', PlainTextWorkbookSerializationProvider.$);
/**
 * @hidden
 */
export class IGExcelSerializationProvider extends ExcelWorkbookSerializationProvider {
    constructor() {
        super(0, "IGExcel");
    }
    c(a) {
        if (a.e("IGExcel")) {
            let b = typeCast(Stream.$, a.j("IGExcel"));
            if (b != null) {
                let c = null;
                let d = null;
                d = new WorkbookLoadOptions();
                let e = null;
                e = new IGExcelSerializationProvider_SyncPackageFactory();
                d._c = e;
                let f = Workbook._bs(b, d);
                let g = a.l("IGExcelId");
                if (!stringIsNullOrEmpty(g)) {
                    let h = g.indexOf(';');
                    if (h > 0) {
                        let i = new Guid(3, g.substr(0, h));
                        let j = h < g.length - 1 ? g.substr(h + 1) : null;
                        f._fb = i;
                        f._gw = j;
                        if (Guid.l_op_Inequality(i, a.workbook._fb)) {
                            c = a.workbook._bf(j != null ? j : "Book1");
                            if (c == a.workbook._bb) {
                                c = null;
                            }
                        }
                    }
                }
                return this.m(a, f, false, c);
            }
        }
        return false;
    }
    d(a) {
        let b = new MemoryStream(0);
        let c = new WorkbookSaveOptions();
        let d = new IGExcelSerializationProvider_SelectionWorkbookSaveFilter(a);
        c._g = d;
        let e = this.p(a.a, Enumerable.a(Worksheet.$, a.m), 1);
        if (e > 16384000 && !a.h()) {
            return false;
        }
        let f = null;
        f = new IGExcelSerializationProvider_SyncPackageFactory();
        c._c = f;
        let g = a.b._gw;
        a.b._ix(b, c);
        a.b._gw = g;
        b.position = 0;
        a.p("IGExcel", b);
        let h = a.b._fb.toString2("D") + ";" + g;
        a.p("IGExcelId", h);
        return true;
    }
}
IGExcelSerializationProvider.$t = markType(IGExcelSerializationProvider, 'IGExcelSerializationProvider', ExcelWorkbookSerializationProvider.$);
/**
 * @hidden
 */
export class TSVWorkbookSerializationProvider extends PlainTextWorkbookSerializationProvider {
    constructor() {
        super(DataFormats.e, DataFormats.d, DataFormats.c);
    }
    get_k() {
        return ['\t'];
    }
    get k() {
        return this.get_k();
    }
    d(a) {
        let b = new StringBuilder(0);
        let c = false;
        {
            let d = new StringWriter(2, b);
            try {
                c = this.n(a, d, '\t');
            }
            finally {
                if (d != null) {
                    d.dispose();
                }
            }
        }
        if (c) {
            let e = b.toString();
            for (let f of fromEnum(this.f)) {
                a.p(f, e);
            }
        }
        return c;
    }
}
TSVWorkbookSerializationProvider.$t = markType(TSVWorkbookSerializationProvider, 'TSVWorkbookSerializationProvider', PlainTextWorkbookSerializationProvider.$);
/**
 * @hidden
 */
export class WorkbookDataObjectManager extends Base {
    constructor(a) {
        super();
        this.h = null;
        this.b = null;
        this.settingData = null;
        this.pasting = null;
        this.copying = null;
        this.beforeCopying = null;
        this.error = null;
        CoreUtilities.z(a, "workbook");
        this.b = a;
        this.h = new List$1(WorkbookSerializationProviderBase.$, 0);
        let b = ExcelUtils.au(a.currentFormat) ? Workbook._ez != null && Workbook._e2 != null : Workbook._e1 != null && Workbook._e3 != null;
        if (b) {
            this.h.add(new IGExcelSerializationProvider());
        }
        if (Workbook._ez != null) {
            this.h.add(new BIFF8SerializationProvider());
        }
        this.h.add(new TSVWorkbookSerializationProvider());
        this.h.add(new CSVWorkbookSerializationProvider());
    }
    c(a) {
        let b = this.p(false, a);
        if (null == b) {
            return false;
        }
        try {
            return ClipboardHelper.c(b, true);
        }
        catch (c) {
            this.o(false, c);
            return false;
        }
    }
    static d(a) {
        return a != null && (a.getDataPresent(DataFormats.d) || a.getDataPresent(DataFormats.e) || a.getDataPresent(DataFormats.c) || a.getDataPresent(DataFormats.a) || a.getDataPresent("IGExcel") || a.getDataPresent("BIFF8"));
    }
    e(a) {
        let b = null;
        try {
            b = ClipboardHelper.e();
        }
        catch (c) {
            this.o(true, c);
            return false;
        }
        return this.f(a, b, null);
    }
    f(a, b, c = null) {
        let d = WorksheetCell.l_op_Inequality(c, null);
        if (null == b) {
            return false;
        }
        let e = new WorkbookDataObjectLoadContext(this.b, b, a);
        let f = this.n(e);
        if (stringIsNullOrEmpty(f)) {
            return false;
        }
        e.k = f;
        let g = this.pasting;
        if (g != null) {
            let h = new WorkbookDataObjectPastingEventArgs(b, f, d);
            g(this, h);
            if (h._cancel) {
                return false;
            }
            b = h._dataObject;
            if (b == null) {
                return false;
            }
            e.o = b;
            f = h._formatToApply;
            e.k = f;
        }
        if (stringIsNullOrWhiteSpace(f) || !e.e(f)) {
            return false;
        }
        let i = this.a(f, true);
        if (i == null) {
            return false;
        }
        try {
            return i.c(e);
        }
        catch (j) {
            this.o(true, j);
            return false;
        }
    }
    p(a, b) {
        let c = ClipboardHelper.d();
        if (null == c) {
            return null;
        }
        let d = this.beforeCopying;
        if (d != null) {
            d(this, EventArgs.empty);
        }
        let e;
        let f = SpreadsheetUtilities.cz;
        let g = () => {
            if (!f.hasValue) {
                f = Nullable$1.toNullable(Boolean_$type, b());
            }
            return f.value;
        };
        try {
            e = new WorkbookDataObjectSaveContext(this.b, c, (h) => this.g(c, h), g);
        }
        catch (h) {
            this.o(true, h);
            return null;
        }
        let i = 0;
        for (let j of fromEnum(this.h)) {
            if (j.f.count > 0) {
                if (j.d(e)) {
                    i++;
                }
                else if (f.hasValue) {
                    return null;
                }
            }
        }
        if (i == 0) {
            return null;
        }
        let k = this.copying;
        if (k != null) {
            let l = new WorkbookDataObjectCopyingEventArgs(c, a);
            k(this, l);
            if (l._cancel) {
                return null;
            }
        }
        return c;
    }
    n(a) {
        for (let b of fromEnum(this.h)) {
            let c = b.j(a);
            if (c != null) {
                return c;
            }
        }
        return null;
    }
    a(a, b) {
        for (let c of fromEnum(this.h)) {
            let d = b ? c.e : c.f;
            if (d.contains(a)) {
                return c;
            }
        }
        return null;
    }
    o(a, b) {
        let c = this.error;
        if (c != null) {
            let d = new WorkbookSerializationErrorEventArgs(a, b);
            c(this, d);
        }
    }
    g(a, b) {
        let c = this.settingData;
        if (c != null) {
            let d = new WorkbookDataObjectSettingDataEventArgs(a, b, false);
            c(this, d);
            return !d._cancel;
        }
        return true;
    }
}
WorkbookDataObjectManager.$t = markType(WorkbookDataObjectManager, 'WorkbookDataObjectManager');
/**
 * @hidden
 */
export class SpreadsheetShape extends Base {
    constructor(a, b) {
        super();
        this.b = null;
        this.d = null;
        this.j = null;
        this.i = false;
        this.g = false;
        this.h = false;
        this.n = 0;
        this.a = null;
        this.o = null;
        this.v = null;
        this.s = null;
        this.u = null;
        this.t = null;
        this.k = 0;
        this.e = false;
        this.f = false;
        this.l = null;
        this.d = a;
        this.i = typeCast(WorksheetChart.$, a) !== null;
        this.b = b;
        if (typeCast(WorksheetShapeGroupBase.$, a) !== null) {
            this.j = new List$1(SpreadsheetShape.$, 0);
        }
    }
    p() {
        this.n++;
        if (this.j != null) {
            for (let a = 0; a < this.j.count; a++) {
                this.j._inner[a].p();
            }
        }
    }
    get c() {
        let a = this;
        while (a.b != null) {
            a = a.b;
        }
        return a;
    }
    get m() {
        return this.l;
    }
    set m(a) {
        if (a != this.l) {
            if (this.l != null) {
                this.l.dispose();
                this.l = null;
            }
            this.l = a;
        }
    }
    q() {
        if (this.a != null) {
            if (this.h || this.g) {
                this.a.e(this.d, this.h, this.g);
                this.h = false;
                this.g = false;
            }
        }
    }
    r(a) {
        if (this.j != null) {
            let b = this.d;
            let c = false;
            let d = 0;
            for (let e = 0; e < b._shapes$i.count; e++) {
                let f = b._shapes$i.item(e);
                if (!f.visible || !SpreadsheetUtilities.a4(f, a)) {
                    continue;
                }
                if (d >= this.j.count) {
                    c = true;
                    break;
                }
                if (this.j._inner[d].d != b._shapes$i.item(e)) {
                    c = true;
                    break;
                }
                d++;
            }
            if (!c && d != this.j.count) {
                c = true;
            }
            if (c) {
                let g = new Dictionary$2(WorksheetShape.$, SpreadsheetShape.$, 0);
                for (let h of fromEnum(this.j)) {
                    g.item(h.d, h);
                }
                this.j.clear();
                for (let i of fromEnum(b._shapes$i)) {
                    if (!i.visible || !SpreadsheetUtilities.a4(i, a)) {
                        continue;
                    }
                    let j;
                    if (!((() => { let k = g.tryGetValue(i, j); j = k.p1; return k.ret; })())) {
                        j = new SpreadsheetShape(i, this);
                    }
                    else {
                        g.removeItem(i);
                    }
                    this.j.add(j);
                }
            }
            for (let k of fromEnum(this.j)) {
                k.r(a);
            }
        }
    }
}
SpreadsheetShape.$t = markType(SpreadsheetShape, 'SpreadsheetShape');
/**
 * @hidden
 */
export class SpreadsheetAreaLayoutManager_RowColumnInfo extends Base {
    constructor(a) {
        super();
        this.g = 0;
        this.h = 0;
        this.i = 0;
        this.a = null;
        this.b = false;
        this.e = null;
        this.c = false;
        this.d = false;
        this.f = new List$1(SpreadsheetAreaLayoutManager_SheetLayerInfo$1.$.specialize(SpreadsheetScrollRegion.$), 0);
        this.b = a;
        this.e = boxArray$1(new Array(0));
    }
}
SpreadsheetAreaLayoutManager_RowColumnInfo.$t = markType(SpreadsheetAreaLayoutManager_RowColumnInfo, 'SpreadsheetAreaLayoutManager_RowColumnInfo');
/**
 * @hidden
 */
export class SpreadsheetUserPromptInfo extends Base {
    constructor(a, b, c, d, e) {
        super();
        this.b = false;
        this.c = false;
        this.h = null;
        this.g = null;
        this.d = false;
        this.f = null;
        this.i = null;
        this.a = 0;
        this.a = a;
        this.f = c;
        this.g = d;
        this.d = true;
        this.b = e;
        if (b == null) {
            let f = null;
            switch (a) {
                case 5:
                    f = "DeleteWorksheets_Message";
                    break;
                case 8:
                    f = "InvalidCommand_MixedSelection_Message";
                    break;
                case 6:
                    f = "InvalidCommand_OverlappingSelection_Message";
                    break;
                case 9:
                    f = "InvalidNameBoxValue_Message";
                    break;
                case 10:
                    f = "PasteError_CellRangeSize_Message";
                    break;
                case 11:
                    f = "PasteError_MultipleSourceAndTargetRanges_Message";
                    break;
                case 12:
                    f = "PasteError_InvalidSourceRanges_Message";
                    break;
                case 13:
                    f = "PasteError_InvalidSelectedSheetCount_Message";
                    break;
                case 15:
                    f = "PasteError_IntersectsMergedCells_Message";
                    break;
                case 16:
                    f = "PasteError_MultipleSheetTables_Message";
                    break;
                case 17:
                    f = "Error_IntersectsMergedCells_Message";
                    break;
                case 18:
                    f = "CopyError_InvalidSelection_Message";
                    break;
                case 7:
                    f = "InvalidCommand_MultipleSelection_Message";
                    break;
                case 20:
                    f = "InvalidCommand_TableChangeWithMultipleSheetSelection_Message";
                    break;
                case 21:
                    f = "Error_InvalidHyperlinkAddress_Message";
                    break;
                case 22:
                    f = "Error_InvalidHyperlinkReference_Message";
                    break;
                case 23:
                    f = "Error_InvalidProtectedWorksheetChange_Message";
                    break;
                case 24:
                    f = "Error_NoSingleAllowedEditRange_Message";
                    break;
                case 25:
                    f = "Error_InvalidArrayFormulaLockedState_Message";
                    break;
                case 26:
                    f = "Error_ChangePartOfDataTableError_Message";
                    break;
                case 27:
                    f = "Error_DeletingLockedColumnCells_Message";
                    break;
                case 28:
                    f = "Error_DeletingLockedRowCells_Message";
                    break;
                case 29:
                    f = "Error_LargePasteOperation_Message";
                    break;
                case 30:
                    f = "Error_InvalidSortOrFilterRange_Message";
                    break;
                case 31:
                    f = "Error_LargeOperation_Message";
                    break;
            }
            if (f != null) {
                b = SpreadsheetUtilities.di(null, f);
            }
            else if (c != null) {
                b = c.message;
            }
        }
        this.i = b;
    }
    get e() {
        return this.d && !stringIsNullOrEmpty(this.i);
    }
}
SpreadsheetUserPromptInfo.$t = markType(SpreadsheetUserPromptInfo, 'SpreadsheetUserPromptInfo');
/**
 * @hidden
 */
export class RotationHelper extends Base {
    constructor() {
        super();
        this.a = null;
        this.k = null;
        this.l = null;
        this.c = 0;
        this.d = 0;
        this.a = new Array(8);
        this.k = new Rect(4);
        this.l = new Rect(4);
    }
    get n() {
        return this.l;
    }
    get e() {
        return this.c;
    }
    get f() {
        return this.d;
    }
    get m() {
        return this.k;
    }
    g(a, b, c, d, e, f = false) {
        this.i(a, b, c, d, e, 0, 0, true, f);
    }
    h(a, b, c, d, e, f, g, h = false) {
        this.i(a, b, c, d, e, f, g, false, h);
    }
    i(a, b, c, d, e, f, g, h, i) {
        let j = Math.max(c - a, 0);
        let k = Math.max(d - b, 0);
        if (i) {
            a = (a + j / 2) - k / 2;
            b = (b + k / 2) - j / 2;
            let l = k;
            k = j;
            j = l;
        }
        c = a + j;
        d = b + k;
        this.l.x = a;
        this.l.y = b;
        this.l.width = j;
        this.l.height = k;
        this.c = a + j / 2;
        this.d = b + k / 2;
        let m = h ? this.c : f;
        let n = h ? this.d : g;
        let o = this.a;
        o[0] = o[2] = a;
        o[1] = o[5] = b;
        o[4] = o[6] = c;
        o[3] = o[7] = d;
        if (e != 0) {
            let p = SpreadsheetUtilities.cc(e);
            let q = Math.cos(p);
            let r = Math.sin(p);
            let s, t, u, v;
            s = u = t = v = 0;
            for (let w = 0; w < 7; w += 2) {
                let x = (q * (o[w] - m) - r * (o[w + 1] - n) + m);
                o[w + 1] = (r * (o[w] - m) + q * (o[w + 1] - n) + n);
                o[w] = x;
                if (w == 0) {
                    s = t = o[0];
                    u = v = o[1];
                }
                else {
                    if (t < o[w]) {
                        t = o[w];
                    }
                    else if (s > o[w]) {
                        s = o[w];
                    }
                    if (v < o[w + 1]) {
                        v = o[w + 1];
                    }
                    else if (u > o[w + 1]) {
                        u = o[w + 1];
                    }
                }
            }
            this.k.x = s;
            this.k.y = u;
            this.k.width = t - s;
            this.k.height = v - u;
        }
        else {
            this.k.x = a;
            this.k.y = b;
            this.k.width = j;
            this.k.height = k;
        }
    }
    b(a, b, c, d) {
        return this.k.left > c || this.k.top > d || this.k.right < a || this.k.bottom < b;
    }
    j(a, b, c) {
        if (c != 0) {
            let d = this.a;
            let e = SpreadsheetUtilities.cc(c);
            let f = Math.cos(e);
            let g = Math.sin(e);
            let h, i, j, k;
            h = j = i = k = 0;
            for (let l = 0; l < 7; l += 2) {
                let m = (f * (d[l] - a) - g * (d[l + 1] - b) + a);
                d[l + 1] = (g * (d[l] - a) + f * (d[l + 1] - b) + b);
                d[l] = m;
                if (l == 0) {
                    h = i = d[0];
                    j = k = d[1];
                }
                else {
                    if (i < d[l]) {
                        i = d[l];
                    }
                    else if (h > d[l]) {
                        h = d[l];
                    }
                    if (k < d[l + 1]) {
                        k = d[l + 1];
                    }
                    else if (j > d[l + 1]) {
                        j = d[l + 1];
                    }
                }
            }
            let n = (f * (this.c - a) - g * (this.d - b) + a);
            this.d = (g * (this.c - a) + f * (this.d - b) + b);
            this.c = n;
            this.k.x = h;
            this.k.y = j;
            this.k.width = i - h;
            this.k.height = k - j;
        }
    }
}
RotationHelper.$t = markType(RotationHelper, 'RotationHelper');
/**
 * @hidden
 */
export class SpreadsheetTabInfo extends PropertyChangeNotifierExtended {
    constructor(a) {
        super();
        this._ad = null;
        this._i = null;
        this._g = null;
        this._k = 0;
        this._aj = ColorsInternal.c;
        this._o = false;
        this._p = false;
        this._m = false;
        this._y = 0;
        this._w = 0;
        this._ai = null;
        this._n = false;
        this._q = false;
        this._z = 0;
        CoreUtilities.z(a, "worksheet");
        this._i = a;
        this._ah();
    }
    e(a, b, c) {
        if (a == this) {
            switch (b) {
                case "IsActive":
                case "IsSelected":
                case "ReverseZIndex":
                case "Index":
                    this._af();
                    break;
            }
        }
        super.e(a, b, c);
    }
    get _x() {
        return this._w;
    }
    set _x(a) {
        if (this._w != a) {
            this._w = a;
            this.a("ActualWidth");
        }
    }
    get _ak() {
        return this._aj;
    }
    set _ak(a) {
        if (Color.d(this._aj, a)) {
            this._aj = a;
            this.a("Color");
        }
    }
    get _h() {
        return this._g;
    }
    set _h(a) {
        if (WorkbookColorInfo.l_op_Inequality(this._g, a)) {
            this._g = a;
            this._ak = WorkbookColorInfo.l_op_Equality(this._g, null) ? ColorsInternal.c : this._g._getResolvedColor1(this._i.workbook);
            this.a("ColorInfo");
        }
    }
    get _ac() {
        return CoreUtilities.p(this._ai);
    }
    set _ac(a) {
        this._ai = a == null ? null : new WeakReference(a);
    }
    get _aa() {
        return this._y;
    }
    set _aa(a) {
        if (this._y != a) {
            this._y = a;
            this.a("Index");
        }
    }
    get _r() {
        return this._m;
    }
    set _r(a) {
        if (this._m != a) {
            this._m = a;
            this.a("IsActive");
        }
    }
    get _s() {
        return this._n;
    }
    set _s(a) {
        if (this._n != a) {
            this._n = a;
            this.a("IsEditing");
        }
    }
    get _t() {
        return this._o;
    }
    set _t(a) {
        if (this._o != a) {
            this._o = a;
            this.a("IsProtected");
        }
    }
    get _u() {
        return this._p;
    }
    set _u(a) {
        if (this._p != a) {
            this._p = a;
            this.a("IsSelected");
        }
    }
    get _ae() {
        return this._ad;
    }
    set _ae(a) {
        if (this._ad != a) {
            this._ad = a;
            this.a("Name");
        }
    }
    get _v() {
        return this._q;
    }
    set _v(a) {
        if (this._q != a) {
            this._q = a;
            this.a("ReverseZIndex");
        }
    }
    get _l() {
        return this._k;
    }
    set _l(a) {
        if (this._k != a) {
            this._k = a;
            this.a("Visibility");
        }
    }
    get _j() {
        return this._i;
    }
    get _ab() {
        return this._z;
    }
    set _ab(a) {
        if (this._z != a) {
            this._z = a;
            this.a("ZIndex");
        }
    }
    _af() {
        let a = this._aa;
        if (this._q) {
            a *= -1;
        }
        if (this._u) {
            a += 10000;
        }
        if (this._r) {
            a += 50000;
        }
        this._ab = a;
    }
    _ag(a, b, c) {
        let d = this._i.workbook;
        if (d != null) {
            if (a) {
                if (d.windowOptions.selectedWorksheet != this._i && this._u) {
                    this._i._w = false;
                }
                else {
                    this._i._w = true;
                }
            }
            else if (b) {
                let e = this._i.index;
                let f = d.windowOptions.selectedWorksheet == null ? e : d.windowOptions.selectedWorksheet.index;
                let g = Math.min(e, f);
                let h = g == e ? f : e;
                for (let i = 0; i < d._worksheets$i.count; i++) {
                    let j = d._worksheets$i._item(i);
                    j._w = j.displayOptions.visibility == 0 && i >= g && i <= h;
                }
            }
            else if (c == false && this._i._w) {
                d.windowOptions._ae(this._i, false);
            }
            else {
                let k = d.windowOptions.selectedWorksheet != this._i && SpreadsheetUtilities.a3(this._i.workbook);
                d.windowOptions._ae(this._i, k);
            }
        }
    }
    _ah() {
        this._ae = this._i.name;
        this._h = this._i.displayOptions.tabColorInfo;
        this._l = this._i.displayOptions.visibility;
        this._t = this._i.isProtected;
    }
}
SpreadsheetTabInfo.$t = markType(SpreadsheetTabInfo, 'SpreadsheetTabInfo', PropertyChangeNotifierExtended.$);
/**
 * @hidden
 */
export class SpreadsheetTabItemLayoutManager$1 extends Base {
    constructor($tVisual) {
        super();
        this.$tVisual = null;
        this.g = null;
        this.i = null;
        this.x = null;
        this.k = false;
        this.c = null;
        this.ab = 0;
        this.a = null;
        this.l = false;
        this.m = false;
        this.j = null;
        this.a5 = null;
        this.$tVisual = $tVisual;
        this.$type = this.$type.specialize(this.$tVisual);
        this.i = new PropertyChangeListener$1(SpreadsheetTabItemLayoutManager$1.$.specialize(this.$tVisual), this, runOn(this, this.ar), false);
        this.x = new List$1(this.$tVisual, 0);
    }
    get e() {
        return this.c;
    }
    get h() {
        return this.g;
    }
    set h(a) {
        if (a != this.g) {
            let b = this.g;
            this.ah(true);
            let c = PropertyChangeListenerList.e(SpreadsheetTabManager.$, this.g, a, this.i, true);
            this.g = c.p0;
            this.au(b, a);
        }
    }
    get w() {
        return this.x;
    }
    ad(a, b) {
        let c = new Rect(0, 0, 0, 0, b);
        if (this.g != null) {
            this.g._aq = a;
        }
        if (this.x.count > 0) {
            if (this.k && this.g._o != null) {
                this.g._a4(this.g._o._aa);
            }
            let d = Math.min(this.g._aw, this.x.count - 1);
            let e = this.x.count;
            let f = a;
            let g = 0;
            let h = 0;
            for (let i = d; i < e; i++) {
                if (c.width > 0) {
                    c.x += Math.max(c.width + this.g._at, 0);
                }
                let j = this.x._inner[i];
                c.width = this.d(j)._x;
                this.ae(j, c);
                if (c.width > 0) {
                    h++;
                    if (f < 0) {
                        g++;
                    }
                }
                f -= c.width;
            }
            let k = c.right > a && (g > 0 || h > 1);
            this.g._ac = k;
            c.x = 0;
            for (let l = d - 1; l >= 0; l--) {
                let m = this.x._inner[l];
                c.width = this.d(m)._x;
                c.x -= Math.max(c.width + this.g._at, 0);
                this.ae(m, c);
            }
            this.g._ae = c.x < 0;
        }
        if (this.m) {
            this.aw();
        }
        this.k = false;
    }
    aj() {
        this.ak();
        this.ai();
    }
    a8() {
        let a = new Size(0);
        let b = Enumerable.g(this.$tVisual, SpreadsheetTabInfo.$, this.x, (c) => this.d(c));
        this.x.clear();
        if (this.g != null) {
            let c = this.g._aw;
            for (let d of fromEnum(this.g._k)) {
                let e;
                if (((() => { let f = b.tryGetValue(d, e); e = f.p1; return f.ret; })())) {
                    b.removeItem(d);
                }
                else {
                    e = this.f(d);
                    d._ac = getBoxIfEnum(this.$tVisual, e);
                }
                this.x.add(e);
            }
            this.a4();
            for (let f of fromEnum(this.x)) {
                let g = this.d(f);
                let h = g._l == 0 ? this.z(f) : 0;
                g._x = h;
                if (g._aa >= c) {
                    if (a.width > 0) {
                        a.width += Math.max(h + this.g._at, 0);
                    }
                    else {
                        a.width += h;
                    }
                }
            }
            a.height = this.y();
        }
        for (let i of fromEnum(b)) {
            this.az(i.value);
            if (Base.equalsStatic(getBoxIfEnum(this.$tVisual, i.value), i.key._ac)) {
                i.key._ac = null;
            }
        }
        return a;
    }
    ao() {
        this.ah(true);
    }
    ap() {
        this.ag();
        this.af();
    }
    aq(a) {
        this.ah(true);
    }
    q(a, b) {
        this.af();
        let c = this.b;
        let d = this.d(b);
        if (c != null && d != null) {
            switch (a.a()) {
                case 2:
                    {
                        if (!this.p(b) && c != null && c._d7(true) && c._v.focus()) {
                            d._ag(false, false, false);
                            c._v._ShowTabContextMenu$i(d, a.h());
                        }
                        return true;
                    }
                case 1:
                    {
                        this.ag();
                        if (a.e() == 2 && c._bc.i && d._r) {
                            this.ay(b);
                            c._cz(113, null, getBoxIfEnum(this.$tVisual, b));
                        }
                        else if (!this.p(b) && !c._d7(true)) {
                        }
                        else if (!c._v.focus()) {
                        }
                        else {
                            let e = a.g();
                            let f = (e & 2) == 2;
                            let g = (e & 4) == 4;
                            if (f == false && a.c()) {
                                this.a5 = a.h();
                                if (!this.o(b)) {
                                    this.ag();
                                }
                                else {
                                    this.j = new TimedOperation(() => this.at(b), SpreadsheetUtilities.cl);
                                }
                            }
                            d._ag(f, g, true);
                        }
                        return true;
                    }
            }
        }
        return false;
    }
    r(a) {
        if (this.c != null) {
            this.ah(false);
            return true;
        }
        return false;
    }
    s(a) {
        if (this.c != null) {
            let b = a.h();
            this.m = true;
            let c = this.ab;
            if (b.x < 0) {
                this.a1(true);
                this.ab = this.g._aw;
            }
            else if (b.x > this.aa()) {
                this.a1(false);
                this.ab = this.g._ay() + 1;
            }
            else {
                this.a3();
                this.ab = this.ac(b.x);
            }
            if (c != this.ab) {
                this.aw();
            }
            return true;
        }
        return false;
    }
    t(a, b) {
        if (this.j != null && PointUtil.notEquals(this.a5, null)) {
            let c = a.h();
            let d = this.a5;
            if (Math.abs(c.x - d.x) > 16 || Math.abs(c.y - d.y) > 16) {
                this.a2(b);
            }
            return true;
        }
        return false;
    }
    u(a, b) {
        if (this.j != null || PointUtil.notEquals(this.a5, null)) {
            this.af();
            this.ay(b);
            return true;
        }
        return false;
    }
    a7(a, b) {
        let c;
        let d = 0;
        if (this.ab < this.g._aw) {
            c = this.x._inner[this.g._aw];
        }
        else if (this.ab >= this.x.count) {
            c = Enumerable.ah(this.$tVisual, this.x);
            d = this.d(c)._x;
        }
        else {
            c = this.x._inner[this.ab];
        }
        let e = this.a6(c, d, 0).x;
        return new Rect(0, e - a / 2, -b, a, b);
    }
    af() {
        if (this.j != null) {
            this.j.c();
            this.j = null;
        }
    }
    ag() {
        this.a5 = null;
    }
    ah(a) {
        if (this.c != null) {
            let b = this.ab;
            let c = this.c;
            this.ab = -1;
            this.m = false;
            this.c = null;
            this.ax();
            this.a3();
            this.al();
            if (!a) {
                let d = this.g._y;
                if (d != null) {
                    let e = Enumerable.a(SpreadsheetTabInfo.$, Enumerable.y(SpreadsheetTabInfo.$, Number_$type, this.g._j, (f) => f._aa));
                    let f = b != c._aa && b != (c._aa + 1);
                    if (f) {
                        for (let h = 0; h < e.length; h++) {
                            let g = e[h];
                            if (g._aa < b) {
                                b--;
                            }
                            g._j.moveToIndex(b);
                        }
                        let i = this.g._o;
                        if (i != null) {
                            if (this.g._j.count > 1) {
                                let j = Enumerable.a(SpreadsheetTabInfo.$, this.g._j);
                                for (let l = 0; l < j.length; l++) {
                                    let k = j[l];
                                    if (k != i) {
                                        k._j._w = false;
                                    }
                                }
                            }
                            this.v(i);
                        }
                    }
                }
            }
        }
    }
    ac(a) {
        let b = Math.min(this.g._aw, this.x.count - 1);
        let c = this.x.count;
        let d = 0;
        let e = 0;
        for (let f = b; f < c; f++) {
            e += Math.max(d + this.g._at, 0);
            let g = this.x._inner[f];
            d = this.d(g)._x;
            if (d > 0 && a <= e + d) {
                return f;
            }
        }
        return this.x.count;
    }
    p(a) {
        let b = this.d(a);
        return b != null && b == this.g._p;
    }
    am(a, b) {
        if (this.l && this.g._ae) {
            this.b._cz(106, null, null);
            this.m = true;
            this.ab = this.g._aw;
        }
        else if (!this.l && this.g._ac) {
            this.b._cz(105, null, null);
            this.m = true;
            this.ab = this.g._ay() + 1;
        }
    }
    as(a, b, c) {
        switch (b != null ? b : "") {
            case "Add":
            case "Remove":
            case "Replace":
            case "Move":
            case "Reset":
                if (this.g._af(a) || this.g._ag(a)) {
                    this.ak();
                    this.ai();
                }
                break;
            case "FirstVisibleTabIndex":
            case "InterTabSpacing":
                if (a == this.h) {
                    this.af();
                    this.ak();
                    this.ai();
                }
                break;
            case "ActiveTab":
                if (a == this.h) {
                    this.k = true;
                    this.ai();
                }
                break;
            case "Visibility":
                if (typeCast(SpreadsheetTabInfo.$, a) !== null) {
                    this.ak();
                    this.ai();
                }
                break;
        }
    }
    ar(a, b, c, d) {
        a.as(b, c, d);
    }
    at(a) {
        this.a2(a);
    }
    aw() {
        this.m = false;
        this.av();
    }
    v(a) {
        if (a != null) {
            if (a._r) {
                this.k = true;
                this.ai();
                return true;
            }
            else if (a != null) {
                this.g._a4(a._aa);
            }
        }
        return false;
    }
    a0(a, b) {
        this.ah(true);
        this.c = this.d(a);
        this.ab = this.c._aa;
        if (!this.n()) {
            this.c = null;
        }
        else if (this.c != null) {
            this.an();
            this.aw();
        }
    }
    a1(a) {
        this.l = a;
        if (this.a == null) {
            this.a = new PlatformTimer();
            this.a.g = 250;
            let b = this.a;
            b.tick = delegateCombine(b.tick, runOn(this, this.am));
        }
        if (this.a.b == false) {
            this.a.k();
        }
    }
    a2(a) {
        let b = this.a5;
        this.af();
        this.ay(a);
        let c = this.d(a);
        if (c != null) {
            if (c._j.workbook == null || c._j.workbook.protection.allowEditStructure == false) {
                return;
            }
        }
        let d = this.b;
        if (d != null && d._d7(true)) {
            this.a0(a, b);
        }
    }
    a3() {
        if (this.a != null) {
            this.a.l();
        }
    }
}
SpreadsheetTabItemLayoutManager$1.$t = markType(SpreadsheetTabItemLayoutManager$1, 'SpreadsheetTabItemLayoutManager$1');
/**
 * @hidden
 */
export class SpreadsheetTabManager extends PropertyChangeNotifierExtended {
    constructor(a) {
        super();
        this._l = null;
        this._x = null;
        this._u = null;
        this._am = null;
        this._g = null;
        this._i = null;
        this._m = null;
        this._r = null;
        this._h = null;
        this._s = null;
        this._n = null;
        this._t = null;
        this._v = 0;
        this._z = false;
        this._av = 0;
        this._au = 0;
        this._ap = -1;
        this._an = 0;
        this._ao = 0;
        this._q = 0;
        this._l = a;
        let b = PropertyChangeListenerList.e(ObservableCollectionExtended$1.$.specialize(SpreadsheetTabInfo.$), this._g, new ObservableCollectionExtended$1(SpreadsheetTabInfo.$, 0), this, false);
        this._g = b.p0;
        this._i = new ReadOnlyNotifyCollection$1(SpreadsheetTabInfo.$, this._g);
        this._u = new DeferredOperation(runOn(this, this._bd));
        this._am = new List$1(ChangeInfo.$, 0);
        let c = PropertyChangeListenerList.e(SpreadsheetTabManager_SelectedTabsCollection.$, this._r, new SpreadsheetTabManager_SelectedTabsCollection(this), this, false);
        this._r = c.p0;
        this._h = new ReadOnlyNotifyCollection$1(SpreadsheetTabInfo.$, this._r);
        this._s = new SpreadsheetTabManager_VisibleTabsCollection(this._i);
        this._t = new SpreadsheetTabManager_ZIndexTabsCollection(this._i);
    }
    e(a, b, c) {
        switch (b != null ? b : "") {
            case "FirstVisibleTabIndex":
                if (a == this && this._x != null) {
                    this._x.windowOptions.firstVisibleTabIndex = this._aw;
                }
                break;
            case "Width":
                if (a == this && this._x != null) {
                    this._x.windowOptions.tabBarWidth = this._a1;
                }
                break;
            case "Add":
            case "Remove":
            case "Replace":
            case "Move":
            case "Reset":
                if (a == this._g) {
                    this._t._q();
                }
                break;
            case "ZIndex":
                if (typeCast(SpreadsheetTabInfo.$, a) !== null) {
                    this._t._q();
                }
                break;
        }
        super.e(a, b, c);
    }
    get _o() {
        return this._m;
    }
    set _o(a) {
        if (this._m != a) {
            if (this._m != null) {
                this._m._r = false;
            }
            this._m = a;
            if (this._m != null) {
                this._m._r = true;
            }
            this.a("ActiveTab");
            if (this._x != null) {
                if (a != null) {
                    this._x.windowOptions._ae(a._j, false);
                }
            }
        }
    }
    get _aq() {
        return this._an;
    }
    set _aq(a) {
        if (this._an != a) {
            this._an = a;
            this.a("ActualWidth");
        }
    }
    get _as() {
        return this._ao;
    }
    set _as(a) {
        if (this._ao != a) {
            this._ao = a;
            this.a("ExtraAvailableWidth");
        }
    }
    get _aw() {
        return this._au;
    }
    set _aw(a) {
        if (this._au != a) {
            this._au = a;
            this.a("FirstVisibleTabIndex");
        }
    }
    get _at() {
        return this._ap;
    }
    set _at(a) {
        if (!isNaN_(a)) {
            if (this._ap != a) {
                this._ap = a;
                this.a("InterTabSpacing");
            }
        }
    }
    get _ac() {
        return this._aa(32);
    }
    set _ac(a) {
        this._aj(32, a);
    }
    get _ae() {
        return this._aa(64);
    }
    set _ae(a) {
        this._aj(64, a);
    }
    get _ah() {
        return this._z;
    }
    set _ah(a) {
        if (this._z != a) {
            this._z = a;
            this.a("IsVisible");
        }
    }
    get _ai() {
        return this._aa(256);
    }
    set _ai(a) {
        if (this._aj(256, a)) {
            this._ba(16);
        }
    }
    get _j() {
        return this._h;
    }
    get _w() {
        return this._v;
    }
    set _w(a) {
        if (this._v != a) {
            this._v = a;
            this.a("ScrollBars");
        }
    }
    get _p() {
        return this._n;
    }
    set _p(a) {
        if (a != this._n) {
            let b = this._n;
            this._n = a;
            if (b != null) {
                b._s = false;
            }
            if (this._n != null) {
                this._n._s = true;
            }
            this.a("TabInEdit");
        }
    }
    get _k() {
        return this._i;
    }
    get _ak() {
        return this._s;
    }
    get _a1() {
        return this._av;
    }
    set _a1(a) {
        if (this._av != a) {
            this._av = a;
            this.a("Width");
        }
    }
    get _y() {
        return this._x;
    }
    set _y(a) {
        if (a != this._x) {
            this._x = a;
            this._ba(15);
        }
    }
    get _al() {
        return this._t;
    }
    _a4(a) {
        if (a < this._aw) {
            this._aw = a;
        }
        else {
            let b = this._az(this._aq + this._as);
            if (b < a) {
                this._aw = this._ax(a);
            }
        }
    }
    _a5(a) {
        if (this._x == null) {
            return;
        }
        this._bd();
        let b = this._au;
        let c = this._m != null ? this._m._aa : -1;
        switch (a) {
            case 5:
                this._aw = this._a0(b + 1, true, b);
                break;
            case 4:
                this._aw = this._a0(b - 1, false, b);
                break;
            case 2:
                this._aw = this._a0(0, true, b);
                break;
            case 3:
                let d = this._ax(this._k.count - 1);
                if (this._aw < d || this._aw >= this._k.count) {
                    this._aw = d;
                }
                break;
            case 7:
                this._a2(this._az(this._aq) + 1, true);
                break;
            case 6:
                this._a2(this._aw - 1, false);
                break;
            case 8:
                this._a2(c + 1, true);
                break;
            case 9:
                this._a2(c - 1, false);
                break;
            case 10:
                this._a2(c + 1, true, true);
                break;
            case 11:
                this._a2(c - 1, false, true);
                break;
            case 0:
                this._a3(1, c + 1);
                break;
            case 1:
                this._a3(Math.max(this._r.count, 1), Math.max(c, 0));
                break;
            case 12:
                {
                    this._r.beginUpdate();
                    this._r.clear();
                    for (let e of fromEnum(this._i)) {
                        if (e._l == 0) {
                            this._r.add(e);
                        }
                    }
                    this._r.endUpdate();
                    this._bb(4, true);
                }
                break;
            case 13:
                {
                    let f = this._m;
                    this._r.beginUpdate();
                    this._r.clear();
                    if (this._m != null) {
                        this._r.add(this._m);
                    }
                    this._r.endUpdate();
                    this._bb(4, true);
                }
                break;
            case 14:
                {
                    let g = this._x._worksheets$i;
                    let h = Enumerable.a(Worksheet.$, Enumerable.o(SpreadsheetTabInfo.$, Worksheet.$, this._h, (i) => i._j));
                    let i = c;
                    let j = i;
                    for (let l = 0; l < h.length; l++) {
                        let k = h[l];
                        if (k.index < i) {
                            j--;
                        }
                    }
                    for (let n = 0; n < h.length; n++) {
                        let m = h[n];
                        g.remove_1(m);
                    }
                    if (g.count > 0) {
                        let o = Enumerable.ag(Worksheet.$, Enumerable.r(Worksheet.$, g, j), (p) => p.displayOptions.visibility == 0);
                        if (o == null) {
                            for (let p = j - 1; p >= 0; p--) {
                                if (g._item(p).displayOptions.visibility == 0) {
                                    o = g._item(p);
                                    break;
                                }
                            }
                        }
                        if (o != null) {
                            this._x.windowOptions.selectedWorksheet = o;
                        }
                    }
                    break;
                }
        }
    }
    _ay() {
        return this._az(this._aq);
    }
    _a0(a, b, c) {
        if (a >= 0 && a < this._i.count) {
            let d = b ? this._i.count : -1;
            let e = b ? 1 : -1;
            for (let f = a; f != d; f += e) {
                if (this._i.item(f)._l == 0) {
                    return f;
                }
            }
        }
        return c;
    }
    _af(a) {
        return a == this._r || a == this._h;
    }
    _ag(a) {
        return a == this._i || a == this._g;
    }
    _a6(a) {
        if (SpreadsheetTabManager._ad(a.a)) {
            this._am.add(a);
            this._u.m();
        }
    }
    _a7(a) {
        this._p = a;
    }
    _a8() {
        this._p = null;
    }
    _bd() {
        this._u.i();
        this._a9();
        this._g.beginUpdate();
        this._r.beginUpdate();
        if (this._aa(1)) {
            this._bb(1, false);
            this._bb(2 | 4 | 16, true);
            this._be();
        }
        if (this._aa(2)) {
            if (this._x == null) {
                this._o = null;
            }
            else {
                this._l._ix();
                this._o = Enumerable.ag(SpreadsheetTabInfo.$, this._i, (a) => a._j == this._x.windowOptions.selectedWorksheet);
            }
            this._bb(4, true);
            this._bb(2, false);
        }
        if (this._aa(4)) {
            this._bb(4, false);
            let a = false;
            for (let b of fromEnum(this._i)) {
                if (b._u != b._j._w) {
                    a = true;
                    break;
                }
            }
            if (a) {
                let c = Enumerable.a(SpreadsheetTabInfo.$, Enumerable.u(SpreadsheetTabInfo.$, this._i, (d) => d._j._w));
                this._r._a3(c);
            }
            else {
                let d = Enumerable.a(SpreadsheetTabInfo.$, Enumerable.x(SpreadsheetTabInfo.$, Number_$type, this._r, (e) => e._j.index));
                if (!CoreUtilities.d(SpreadsheetTabInfo.$, boxArray$1(d), this._r)) {
                    this._r._a3(d);
                }
            }
            if (this._m != null && !this._r.contains(this._m)) {
                this._r.clear();
                if (this._m != null) {
                    this._r.add(this._m);
                }
            }
        }
        if (this._aa(16)) {
            for (let e = 0, f = this._i.count; e < f; e++) {
                let g = this._i.item(e);
                g._ah();
                g._aa = e;
                g._v = this._ai;
            }
            this._bb(16, false);
        }
        if (this._aa(8)) {
            this._bc();
        }
        this._g.endUpdate();
        this._r.endUpdate();
    }
    _a2(a, b, c = false) {
        let d = this._a0(a, b, -1);
        if (d < 0) {
            return;
        }
        this._x.windowOptions._ae(this._i.item(d)._j, false);
        if (c) {
            let e = this._i.item(d);
            if (!e._u) {
                this._r.add(e);
                this._ba(4);
            }
        }
        this._a4(d);
    }
    _a3(a, b) {
        let c = 0;
        let d = this._x._sheets$i;
        let e = this._x._worksheets$i;
        for (let f of fromEnum(d)) {
            c = Math.max(c, f._am);
        }
        let g = b;
        let h = 1;
        if (b >= 0 && b < e.count) {
            b = e._item(b).sheetIndex;
        }
        else if (b > 0 && b == e.count) {
            b = e._item(b - 1).sheetIndex + 1;
        }
        for (let i = 0; i < a; i++) {
            c++;
            let j = null;
            do {
                h++;
                j = this._l._fs("NewSheetName", h);
            } while (d.exists(j));
            d._insert1(b, j, c, 0);
            b++;
        }
        this._bd();
        this._a2(g, true);
    }
    _aa(a) {
        return (this._q & a) != 0;
    }
    _ax(a) {
        let b = this._aq;
        let c = a;
        for (let d = a; d >= 0; d--) {
            let e = this._k.item(d)._x;
            if (c != a) {
                e = Math.max(e + this._at, 0);
            }
            if (e > b) {
                break;
            }
            if (e > 0) {
                b -= e;
                a = d;
            }
        }
        return a;
    }
    _az(a) {
        let b = this._i.count;
        let c = this._aw;
        for (; c < b; c++) {
            let d = Math.max(this._i.item(c)._x + this._at, 0);
            if (d > a) {
                return Math.max(c - 1, this._aw);
            }
            a -= d;
        }
        return Math.min(c, b - 1);
    }
    _ab() {
        let a = this._x != null ? this._x._worksheets$i.count : 0;
        if (this._g.count != a) {
            return true;
        }
        if (a == 0) {
            return false;
        }
        let b = this._x._worksheets$i;
        for (let c = 0, d = this._g.count; c < d; c++) {
            if (this._g._inner[c]._j != b._item(c)) {
                return true;
            }
        }
        return false;
    }
    static _ad(a) {
        switch (a) {
            case 91:
            case 92:
            case 35:
            case 87:
            case 9:
            case 90:
            case 65:
            case 86: return true;
            default: return false;
        }
    }
    _a9() {
        let a = false;
        let b = false;
        let c = false;
        let d = false;
        let e = false;
        for (let f of fromEnum(this._am)) {
            switch (f.a) {
                case 91:
                case 92:
                    e = a = true;
                    break;
                case 35:
                    switch (f.c) {
                        case "Reset":
                        case "Visibility":
                            e = b = c = true;
                            break;
                        case "TabColorInfo":
                            b = true;
                            break;
                        case "IsTabSelected":
                            c = true;
                            break;
                    }
                    break;
                case 87:
                    if (f.c == "WorksheetMoved") {
                        e = a = true;
                    }
                    break;
                case 90:
                case 9:
                case 65:
                    switch (f.c) {
                        case "Name":
                        case "IsProtected":
                            b = true;
                            break;
                        case "IsTabSelected":
                            c = true;
                            break;
                        case "TabColorInfo":
                            b = true;
                            break;
                    }
                    break;
                case 86:
                    switch (f.c) {
                        case "Reset":
                            d = c = true;
                            break;
                        case "SelectedSheet":
                            c = true;
                            this._bb(128, true);
                            break;
                        case "ScrollBars":
                        case "TabBarVisible":
                        case "TabBarWidth":
                        case "FirstVisibleTabIndex":
                            d = true;
                            break;
                    }
                    break;
            }
        }
        this._am.clear();
        if (a) {
            this._bb(1, true);
        }
        if (c) {
            this._bb(2 | 4, true);
        }
        if (b) {
            this._bb(16, true);
        }
        if (d) {
            this._bb(8, true);
        }
        if (e) {
            this._s._q();
        }
    }
    _ba(a) {
        if ((this._q & a) != a) {
            this._bb(a, true);
            this._u.m();
        }
    }
    _bb(a, b) {
        if (b) {
            this._q |= a;
        }
        else {
            this._q &= ~a;
        }
    }
    _aj(a, b) {
        let c = this._q;
        if (b) {
            c |= a;
        }
        else {
            c &= ~a;
        }
        if (c == this._q) {
            return false;
        }
        this._q = c;
        this.a(EnumUtil.getName(SpreadsheetTabManager_InternalFlags_$type, a));
        return true;
    }
    _bc() {
        this._bb(8, false);
        this._w = this._x != null ? this._x.windowOptions.scrollBars : 0;
        this._ah = this._x != null && this._x.windowOptions.tabBarVisible;
        if (this._x != null) {
            this._a1 = this._x.windowOptions.tabBarWidth;
            this._aw = this._x.windowOptions.firstVisibleTabIndex;
        }
    }
    _be() {
        this._g.beginUpdate();
        if (this._ab()) {
            let a = new Dictionary$2(Worksheet.$, SpreadsheetTabInfo.$, 0);
            for (let b of fromEnum(this._g)) {
                a.item(b._j, b);
            }
            this._g.clear();
            if (this._x != null) {
                for (let c of fromEnum(this._x._worksheets$i)) {
                    let d;
                    if (!((() => { let e = a.tryGetValue(c, d); d = e.p1; return e.ret; })())) {
                        d = new SpreadsheetTabInfo(c);
                    }
                    this._g.add(d);
                }
            }
        }
        this._g.endUpdate();
    }
}
SpreadsheetTabManager.$t = markType(SpreadsheetTabManager, 'SpreadsheetTabManager', PropertyChangeNotifierExtended.$);
/**
 * @hidden
 */
export class SpreadsheetTabManager_SelectedTabsCollection extends ObservableCollectionExtended$1 {
    constructor(a) {
        super(SpreadsheetTabInfo.$, 0);
        this._a5 = null;
        this._a5 = a;
    }
    get__ai() {
        return true;
    }
    _au(a) {
        a._j._w = true;
        a._u = true;
        super._au(a);
    }
    _ax(a) {
        if (this._a5._y != null) {
            a._j._w = false;
        }
        a._u = false;
        super._ax(a);
    }
}
SpreadsheetTabManager_SelectedTabsCollection.$t = markType(SpreadsheetTabManager_SelectedTabsCollection, 'SpreadsheetTabManager_SelectedTabsCollection', ObservableCollectionExtended$1.$.specialize(SpreadsheetTabInfo.$));
/**
 * @hidden
 */
export class SpreadsheetTabManager_VisibleTabsCollection extends LazyReadOnlyNotifyCollection$1 {
    constructor(a) {
        super(SpreadsheetTabInfo.$);
        this._p = null;
        this._p = a;
    }
    _o(a) {
        a.clear();
        for (let b of fromEnum(this._p)) {
            if (b._l == 0) {
                a.add(b);
            }
        }
    }
    _q() {
        this._h();
    }
}
SpreadsheetTabManager_VisibleTabsCollection.$t = markType(SpreadsheetTabManager_VisibleTabsCollection, 'SpreadsheetTabManager_VisibleTabsCollection', LazyReadOnlyNotifyCollection$1.$.specialize(SpreadsheetTabInfo.$));
/**
 * @hidden
 */
export class SpreadsheetTabManager_ZIndexTabsCollection extends LazyReadOnlyNotifyCollection$1 {
    constructor(a) {
        super(SpreadsheetTabInfo.$);
        this._p = null;
        this._p = a;
    }
    _o(a) {
        a.clear();
        for (let b of fromEnum(Enumerable.x(SpreadsheetTabInfo.$, Number_$type, this._p, (c) => c._ab))) {
            a.add(b);
        }
    }
    _q() {
        this._h();
    }
}
SpreadsheetTabManager_ZIndexTabsCollection.$t = markType(SpreadsheetTabManager_ZIndexTabsCollection, 'SpreadsheetTabManager_ZIndexTabsCollection', LazyReadOnlyNotifyCollection$1.$.specialize(SpreadsheetTabInfo.$));
/**
 * @hidden
 */
export class SpreadsheetUndoTransaction extends UndoTransaction {
    constructor(a, b, c, d, e) {
        super(null, null);
        this._an = null;
        this._ah = null;
        this._ak = null;
        this._aj = 0;
        this._al = null;
        CoreUtilities.z(b, "sheet");
        this._an = a == null ? null : new WeakReference(a);
        this._al = d;
        this._aj = c;
        this._ah = e;
        this._ak = b;
    }
    k(a) {
        return new SpreadsheetUndoTransaction(this._ai, this._ak, this._aj, this._al, this._ah);
    }
    b(a) {
        let b = this._ai;
        if (b != null) {
            b._ir();
        }
        try {
            let c = super.b(a);
            let d = this._ak.workbook;
            if (d != null) {
                d.windowOptions.selectedSheet = this._ak;
            }
            return c;
        }
        finally {
            if (b != null) {
                b._ia();
            }
        }
    }
    e(a, b) {
        let c = "Undo_" + enumGetBox(SpreadsheetTransactionOperation_$type, this._aj);
        let d = this._am(this._ah);
        return SpreadsheetUtilities.di(this._ai, c, d, this._al);
    }
    get _ai() {
        return typeCast(Spreadsheet.$, CoreUtilities.p(this._an));
    }
    _am(a) {
        let b = this._ak.workbook;
        let c = b != null ? b.cellReferenceMode : 1;
        return SpreadsheetCellRange._ag(boxArray$1(a), c);
    }
    get sheet() {
        return this._ak;
    }
}
SpreadsheetUndoTransaction.$t = markType(SpreadsheetUndoTransaction, 'SpreadsheetUndoTransaction', UndoTransaction.$, [IWorksheetUndoUnit_$type]);
/**
 * @hidden
 */
export class SpreadsheetSelectionUndoTransaction extends SpreadsheetUndoTransaction {
    constructor(a, b, c, d, e, f, g) {
        super(a, b, c, d, e);
        this._ap = null;
        this._ao = null;
        CoreUtilities.z(g, "setSelection");
        this._ap = g;
        this._ao = f;
    }
    k(a) {
        return new SpreadsheetSelectionUndoTransaction(this._ai, this._ak, this._aj, this._al, this._ah, this._ao, this._ap);
    }
    b(a) {
        let b = this._ai;
        if (b != null) {
            b._ir();
        }
        try {
            let c = super.b(a);
            this._ap(this._ao, false);
            return c;
        }
        finally {
            if (b != null) {
                b._ia();
            }
        }
    }
}
SpreadsheetSelectionUndoTransaction.$t = markType(SpreadsheetSelectionUndoTransaction, 'SpreadsheetSelectionUndoTransaction', SpreadsheetUndoTransaction.$);
/**
 * @hidden
 */
export class WorkbookUndoUnit$2 extends WorkbookUndoUnitBase {
    constructor($tContext, $tValue, a, b, c) {
        super();
        this.$tContext = null;
        this.$tValue = null;
        this._g = null;
        this._h = null;
        this._k = null;
        this._i = null;
        this._j = null;
        this.$tContext = $tContext;
        this.$tValue = $tValue;
        this.$type = this.$type.specialize(this.$tContext, this.$tValue);
        this._g = a;
        this._h = b;
        this._i = c;
        this._k = c.l(a);
        this._j = c.k(a);
    }
    b(a) {
        this._i.y(this._g, this._h);
        return false;
    }
    e(a, b) {
        return SpreadsheetUtilities.da(SpreadsheetUtilities.x(this._k), this._i.a, this._i.c);
    }
    get_d() {
        return this._k;
    }
    get d() {
        return this.get_d();
    }
    get_sheet() {
        return this._j;
    }
    get sheet() {
        return this.get_sheet();
    }
}
WorkbookUndoUnit$2.$t = markType(WorkbookUndoUnit$2, 'WorkbookUndoUnit$2', WorkbookUndoUnitBase.$);
/**
 * @hidden
 */
export let ISpreadsheetVisualDataManager_$type = new Type(null, 'ISpreadsheetVisualDataManager');
/**
 * @hidden
 */
export class SpreadsheetVisualDataManager extends Base {
    exportVisualData(a) {
        let b = new SpreadsheetVisualData();
        let c = a._a8;
        let d = a._v.getLayoutManager();
        for (let e of fromEnum(c._dm)) {
            b.rowHeaderAreas.add(this.b(a, e));
        }
        for (let f of fromEnum(c._dg)) {
            b.columnHeaderAreas.add(this.b(a, f));
        }
        for (let g of fromEnum(c._dl)) {
            b.cellAreas.add(this.a(a, g));
        }
        return b;
    }
    a(a, b) {
        let c = new SpreadsheetCellAreaVisualData();
        let d = a._v._getPaneRect$i(b);
        c.relativeBounds = new RectData(d.x, d.y, d.width, d.height);
        this.c(b.columnScrollRegion, false, c.columns);
        this.c(b.rowScrollRegion, false, c.rows);
        return c;
    }
    b(a, b) {
        let c = new SpreadsheetHeaderAreaVisualData();
        let d = a._v._getRect$i(b);
        c.relativeBounds = new RectData(d.x, d.y, d.width, d.height);
        this.c(b, true, c.items);
        return c;
    }
    c(a, b, c) {
        let d = b ? a._l : a._m;
        for (let e of fromEnum(d)) {
            let f = new SpreadsheetRowColumnVisualData();
            f.index = e._j;
            f.offset = a._b4(e._m) * a._bx;
            f.extent = a._b4(e._i) * a._bx;
            c.add(f);
        }
    }
}
SpreadsheetVisualDataManager.$t = markType(SpreadsheetVisualDataManager, 'SpreadsheetVisualDataManager', Base.$, [ISpreadsheetVisualDataManager_$type]);
/**
 * @hidden
 */
export class FormulaBarButtonAreaElement extends VisualElement {
    constructor(a) {
        super(a, "FormulaBarButtonContainer");
        this.cf = null;
        this.cg = null;
        this.cf = new ButtonVisualElement(this, "FormulaBarCancelButton");
        this.cg = new ButtonVisualElement(this, "FormulaBarEnterButton");
        let b = a.g(SpreadsheetVisualElement.$).dq;
        b._h8(this.cf, 78);
        b._h8(this.cg, 75);
    }
    b7(a, b, c, d) {
        let e = a;
        this.cf.al(e, b, this.cf.a3, d);
        e += this.cf.a3;
        this.cg.al(e, b, this.cg.a3, d);
        e += this.cg.a3;
        super.b7(a, b, c, d);
    }
}
FormulaBarButtonAreaElement.$t = markType(FormulaBarButtonAreaElement, 'FormulaBarButtonAreaElement', VisualElement.$);
/**
 * @hidden
 */
export class FormulaBarNameBoxAreaElement extends VisualElement {
    constructor(a) {
        super(a, "FormulaBarNameBoxContainer");
        this.cf = null;
        this.cf = new FormulaBarNameBoxElement(this);
        let b = this.cf;
        b.valueChanged = delegateCombine(b.valueChanged, runOn(this, this.cg));
    }
    b7(a, b, c, d) {
        this.cf.al(a, b, c, d);
        super.b7(a, b, c, d);
    }
    cg(a, b) {
        let c = this.g(SpreadsheetVisualElement.$);
        if (c != null) {
            let d = c.co;
            if (!c.dq._dw(this.cf.co, d != null && (d.ba & 4) != 0, d != null && (d.ba & 2) != 0)) {
                this.cf.co = c.dq._ft;
            }
        }
    }
}
FormulaBarNameBoxAreaElement.$t = markType(FormulaBarNameBoxAreaElement, 'FormulaBarNameBoxAreaElement', VisualElement.$);
/**
 * @hidden
 */
export class FormulaBarNameBoxElement extends ComboBoxVisualElement {
    constructor(a) {
        super(a, "ComboBox");
        this.cr = null;
    }
}
FormulaBarNameBoxElement.$t = markType(FormulaBarNameBoxElement, 'FormulaBarNameBoxElement', ComboBoxVisualElement.$);
/**
 * @hidden
 */
export class FormulaBarNameBoxSplitter extends AdjustableVisualElement {
    constructor(a) {
        super(a, "FormulaBarNameBoxSplitter");
        this.cq = 0;
        this.cp = 0;
    }
    cm() {
        let a = this.g(FormulaBarVisualElement.$);
        let b = a.g(SpreadsheetVisualElement.$);
        this.cq = b.dq.nameBoxWidth;
        this.cp = Math.max(this.cq, a.a4 - (this.a3 + a.cf.a1 + a.ci.az));
        super.cm();
    }
    ck(a, b) {
    }
    cl(a, b) {
        let c = this.g(SpreadsheetVisualElement.$);
        c.dq.nameBoxWidth = Math.max(Math.min(this.cq + a, this.cp), 102);
    }
    ad(a) {
        if (a.a() == 1) {
            if (a.e() == 2) {
                let b = this.g(SpreadsheetVisualElement.$);
                if (b != null) {
                    b.dq.executeCommand(169);
                    return true;
                }
            }
        }
        return super.ad(a);
    }
}
FormulaBarNameBoxSplitter.$t = markType(FormulaBarNameBoxSplitter, 'FormulaBarNameBoxSplitter', AdjustableVisualElement.$);
/**
 * @hidden
 */
export class FormulaBarTextAreaElement extends VisualElement {
    constructor(a) {
        super(a, "FormulaBarTextAreaContainer");
        this.cf = null;
        this.cg = null;
        this.ch = 0;
        this.ci = 3;
        this.cg = new ToggleButtonVisualElement(this, "ToggleButton");
        this.cf = new TextBoxVisualElement(this, "TextBox");
        let b = this.cf;
        b.textChanged = delegateCombine(b.textChanged, runOn(this, this.ck));
        let c = this.cg;
        c.isCheckedChanged = delegateCombine(c.isCheckedChanged, runOn(this, this.cj));
        this.cl();
    }
    ad(a) {
        let b = this.g(SpreadsheetVisualElement.$).dq;
        if (b.isInEditMode && a.a() == 2) {
            return b._at.j(5, this, a.h());
        }
        return super.ad(a);
    }
    b7(a, b, c, d) {
        this.cg.al(a + c - this.cg.a3, b, this.cg.a3, this.cg.av);
        this.cf.al(a, b, c - this.cg.a3, d);
        super.b7(a, b, c, d);
    }
    cj(a, b) {
        if (this.cg.cl) {
            let c = this.ci;
            let d = this._parent.co();
            if (c > d) {
                this.ci = d;
            }
        }
        this.cl();
        this._parent.cr();
    }
    ck(a, b) {
        let c = this.g(SpreadsheetVisualElement.$);
        if (c != null) {
            c.dq._ha(this.cf.co);
        }
    }
    cl() {
        let a = this.cg.cl ? this.ci : 1;
        this.cf.cl = a;
    }
}
FormulaBarTextAreaElement.$t = markType(FormulaBarTextAreaElement, 'FormulaBarTextAreaElement', VisualElement.$);
/**
 * @hidden
 */
export class FormulaBarTextAreaSplitter extends AdjustableVisualElement {
    constructor(a) {
        super(a, "FormulaBarTextBoxSplitter");
        this.cp = false;
        this.cs = 0;
        this.cq = 0;
        this.cr = 0;
    }
    cm() {
        let a = this._parent;
        this.cp = a.ci.cg.cl;
        this.cs = a.ci.ci;
        this.cq = a.ci.av;
        this.cr = Math.max(this.cs, a.co());
        super.cm();
    }
    ck(a, b) {
        let c = this._parent;
        if (!c.ci.cg.cl) {
            c.ci.ci = this.cs;
        }
    }
    cl(a, b) {
        let c = this._parent;
        let d = Math.min(c.cn(b + this.cq), this.cr);
        if (d <= 1) {
            c.ci.ci = this.cs;
            c.ci.cg.cl = false;
        }
        else {
            c.ci.ci = d;
            c.ci.cg.cl = true;
        }
        c.ci.cl();
        c.cr();
    }
}
FormulaBarTextAreaSplitter.$t = markType(FormulaBarTextAreaSplitter, 'FormulaBarTextAreaSplitter', AdjustableVisualElement.$);
/**
 * @hidden
 */
export class FormulaBarVisualElement extends VisualElement {
    constructor(a) {
        super(a, "FormulaBar");
        this.cg = null;
        this.cf = null;
        this.cj = null;
        this.ch = null;
        this.ci = null;
        this.cm = 0;
        this.ck = 0;
        this.cl = 0;
        this.cg = new FormulaBarNameBoxAreaElement(this);
        this.ch = new FormulaBarNameBoxSplitter(this);
        this.cf = new FormulaBarButtonAreaElement(this);
        this.ci = new FormulaBarTextAreaElement(this);
        this.cj = new FormulaBarTextAreaSplitter(this);
        this.cp();
        this.ac = a.dq.isFormulaBarVisible;
        this.ck = a.dq.nameBoxWidth;
        this.cg.cf.u = !a.dq.isDisabled;
        this.cg.cf.ck = a.dq._ef;
        this.cg.cf.co = a.dq._ft;
        let b = a.dq;
        b.propertyChanged = delegateCombine(b.propertyChanged, runOn(this, this.cq));
    }
    bz() {
        let a = this._parent;
        if (a != null) {
            let b = a.dq;
            b.propertyChanged = delegateRemove(b.propertyChanged, runOn(this, this.cq));
        }
        super.bz();
    }
    co() {
        let a = this.g(SpreadsheetVisualElement.$);
        let b = a.dq._ad.ax();
        let c = a.dr.av - b;
        return this.cn(this.ci.av + c);
    }
    cp() {
        let a = this._parent.dq._a1;
        this.ch.a3 = a.ap.width;
        this.cg.h = a.c;
        this.cf.h = a.a;
        this.cf.cg.a3 = a.am.width;
        this.cf.cf.a3 = a.al.width;
        this.cj.av = a.ao.height;
        this.ci.ch = a.o - a.n;
        this.ci.cg.a3 = a.an.width;
        this.ci.cg.av = a.an.height;
        this.h = a.b;
        this.cr();
    }
    cq(a, b) {
        switch (b.propertyName) {
            case "IsFormulaBarVisible":
                this.ac = a.isFormulaBarVisible;
                break;
            case "NameBoxWidth":
                this.ck = a.nameBoxWidth;
                this.t = true;
                break;
            case "NameBoxValue":
                this.cg.cf.co = a._ft;
                break;
        }
    }
    b7(a, b, c, d) {
        super.b7(a, b, c, d);
        let e = this.ck;
        let f = a;
        this.cg.al(f, b, e, this.cm);
        f += e;
        this.ch.al(f, b, this.ch.a3, this.cm);
        f += this.ch.a3;
        let g = this.cf.au(this.cf.cf.a3 + this.cf.cg.a3);
        this.cf.al(f, b, g, this.cm);
        f += g;
        this.ci.al(f, b, Math.max(c + a - f, 0), d - this.cj.av);
        this.cj.al(a, Math.max(b, b + d - this.cj.av), c, this.cj.av);
    }
    b8() {
        let a = this._parent;
        let b = a.dq;
        b.propertyChanged = delegateRemove(b.propertyChanged, runOn(this, this.cq));
        super.b8();
    }
    cr() {
        let a = this._parent.dq._a1;
        let b = this.cg.at(a.l);
        let c = a.ap.height;
        let d = this.cf.at(Math.max(a.am.height, a.al.height));
        let e = this.ci.at(Math.max(a.m, a.an.height));
        let f = Math.max(Math.max(b, c), Math.max(d, e));
        this.cm = f;
        let g = a.m;
        if (this.ci.cg.cl) {
            g += (a.o - a.n) * (this.ci.ci - 1);
        }
        g = this.ci.at(g);
        f += this.cj.av;
        g += this.cj.av;
        let h = this.cl;
        this.cl = Math.max(this.at(f), this.at(g));
        if (h != this.cl && this._parent != null) {
            this._parent.t = true;
        }
    }
    cn(a) {
        let b = this.cm;
        let c = a - b;
        if (c <= 0) {
            return 1;
        }
        else {
            return 1 + truncate(Math.floor(c / this.ci.ch));
        }
    }
}
FormulaBarVisualElement.$t = markType(FormulaBarVisualElement, 'FormulaBarVisualElement', VisualElement.$);
/**
 * @hidden
 */
export class SpreadsheetAreaVisualElement extends VisualElement {
    constructor(a) {
        super(a, "SpreadsheetArea");
        this.cf = null;
    }
    ai(a, b) {
        if (this.cf.c != null) {
            this.cf.c._d1(b * -3, a.g() == 2);
            return true;
        }
        return super.ai(a, b);
    }
    ag(a) {
        if (a.b()) {
            this.cf.dj(a.h());
            return true;
        }
        return super.ag(a);
    }
    ah(a) {
        if (a.b()) {
            this.cf.dk();
            return true;
        }
        return super.ah(a);
    }
    b4() {
        this.cf.cc();
        super.b4();
    }
    an(a, b, c, d) {
        let e = super.an(a, b, c, d);
        if (e) {
            this.cf.cx();
        }
        return e;
    }
}
SpreadsheetAreaVisualElement.$t = markType(SpreadsheetAreaVisualElement, 'SpreadsheetAreaVisualElement', VisualElement.$);
/**
 * @hidden
 */
export class SpreadsheetInplaceBackgroundElement extends VisualElement {
    constructor(a) {
        super(a, "InplaceBackground");
        this.cf = null;
        this.ch = false;
        this.cm = null;
        this.ci = false;
        this.cl = null;
        this.w = false;
    }
    an(a, b, c, d) {
        let e = super.an(a, b, c, d);
        if (e) {
            this.cj = true;
        }
        return e;
    }
    get cg() {
        return this.cf;
    }
    set cg(a) {
        if (a != this.cf) {
            this.cf = a;
            this.cj = true;
        }
    }
    get cn() {
        return this.cm;
    }
    set cn(a) {
        if (Rect.l_op_Inequality(a, this.cm)) {
            this.cm = a;
            this.ck = true;
        }
    }
    get cj() {
        return this.ch;
    }
    set cj(a) {
        if (a != this.ch) {
            this.ch = a;
            if (a) {
                this.b1();
            }
        }
    }
    get ck() {
        return this.ci;
    }
    set ck(a) {
        if (a != this.ci) {
            this.ci = a;
            if (a) {
                this.b1();
            }
        }
    }
}
SpreadsheetInplaceBackgroundElement.$t = markType(SpreadsheetInplaceBackgroundElement, 'SpreadsheetInplaceBackgroundElement', VisualElement.$);
/**
 * @hidden
 */
export class SpreadsheetInplaceEditorElement extends VisualElement {
    constructor(a) {
        super(a, "InplaceEditor");
        this.dd = null;
        this.cm = false;
        this.ct = false;
        this.cu = true;
        this.c8 = null;
        this.cl = false;
        this.df = null;
        this.cq = false;
        this.ch = null;
        this.cn = false;
        this.cf = 0;
        this.cp = false;
        this.cj = 0;
        this.cr = false;
        this.db = new Color();
        this.co = false;
        this.c5 = 0;
        this.cs = false;
        this.cellValueChanged = null;
        this.w = this.c3;
    }
    ad(a) {
        let b = this.g(SpreadsheetVisualElement.$).dq;
        if (b.isInEditMode && a.a() == 2) {
            return b._at.j(4, this, a.h());
        }
        return super.ad(a);
    }
    get c9() {
        return this.c8;
    }
    set c9(a) {
        if (a != this.c8) {
            this.c8 = a;
            this.cv = true;
        }
    }
    get de() {
        return this.dd;
    }
    set de(a) {
        if (Rect.l_op_Inequality(a, this.dd)) {
            this.dd = a;
            this.cw = true;
        }
    }
    get ci() {
        return this.ch;
    }
    set ci(a) {
        if (this.ch != a) {
            this.ch = a;
            this.cx = true;
        }
    }
    get dc() {
        return this.db;
    }
    set dc(a) {
        if (Color.d(this.db, a)) {
            this.db = a;
            this.cy = true;
        }
    }
    get cv() {
        return this.cl;
    }
    set cv(a) {
        if (a != this.cl) {
            this.cl = a;
            if (a) {
                this.b1();
            }
        }
    }
    get cw() {
        return this.cm;
    }
    set cw(a) {
        if (a != this.cm) {
            this.cm = a;
            if (a) {
                this.b1();
            }
        }
    }
    get cx() {
        return this.cn;
    }
    set cx(a) {
        if (a != this.cn) {
            this.cn = a;
            if (a) {
                this.b1();
            }
        }
    }
    get cy() {
        return this.co;
    }
    set cy(a) {
        if (a != this.co) {
            this.co = a;
            if (a) {
                this.b1();
            }
        }
    }
    get cz() {
        return this.cp;
    }
    set cz(a) {
        if (a != this.cp) {
            this.cp = a;
            if (a) {
                this.b1();
            }
        }
    }
    get c0() {
        return this.cq;
    }
    set c0(a) {
        if (a != this.cq) {
            this.cq = a;
            if (a) {
                this.b1();
            }
        }
    }
    get c1() {
        return this.cr;
    }
    set c1(a) {
        if (a != this.cr) {
            this.cr = a;
            if (a) {
                this.b1();
            }
        }
    }
    get c2() {
        return this.cs;
    }
    set c2(a) {
        if (a != this.cs) {
            this.cs = a;
            if (a) {
                this.b1();
            }
        }
    }
    get cg() {
        return this.cf;
    }
    set cg(a) {
        if (this.cf != a) {
            this.cf = a;
            this.cz = true;
        }
    }
    get c3() {
        return this.ct;
    }
    set c3(a) {
        if (a != this.ct) {
            this.ct = a;
            this.c4 = true;
        }
    }
    get c4() {
        return this.cu;
    }
    set c4(a) {
        if (a != this.cu) {
            this.cu = a;
            this.w = this.c3;
            if (a) {
                this.b1();
            }
        }
    }
    get dg() {
        return this.df;
    }
    set dg(a) {
        if (this.df != a) {
            this.df = a;
            this.c0 = true;
        }
    }
    get ck() {
        return this.cj;
    }
    set ck(a) {
        if (this.cj != a) {
            this.cj = a;
            this.c1 = true;
        }
    }
    get c6() {
        return this.c5;
    }
    set c6(a) {
        if (this.c5 != a) {
            this.c5 = a;
            this.c2 = true;
        }
    }
    da() {
        let a = this.cellValueChanged;
        if (a != null) {
            a(this, EventArgs.empty);
        }
    }
}
SpreadsheetInplaceEditorElement.$t = markType(SpreadsheetInplaceEditorElement, 'SpreadsheetInplaceEditorElement', VisualElement.$);
/**
 * @hidden
 */
export class SpreadsheetInputMessageElement extends VisualElement {
    constructor(a) {
        super(a, "InputMessage");
        this.cl = null;
        this.ck = null;
        this.ch = false;
        this.cj = 0;
        this.ci = 0;
        this.cf = null;
        this.cg = null;
        this.cg = new VisualElement(this, "InputMessageTitle");
        this.cf = new VisualElement(this, "InputMessageBody");
        this.cg.q = false;
        this.cf.q = false;
    }
    cm(a, b) {
        this.ch = this.ch || a != this.cl || b != this.ck;
        this.cl = a;
        this.ck = b;
        if (this.ch) {
            this.b1();
        }
    }
    get_x() {
        return true;
    }
    ad(a) {
        if (a.a() == 1) {
            if (a.e() == 2) {
                this._parent.cf.dh();
                return true;
            }
            else {
                let b = a.h();
                let c = { $type: Point_$type, x: b.x + this.ax, y: b.y + this.a2 };
                this._parent.cf.eb(b, c);
                return true;
            }
        }
        return super.ad(a);
    }
}
SpreadsheetInputMessageElement.$t = markType(SpreadsheetInputMessageElement, 'SpreadsheetInputMessageElement', VisualElement.$);
/**
 * @hidden
 */
export class SpreadsheetPaneSplitterElement extends VisualElement {
    constructor(a, b) {
        super(a, "PaneSplitter");
        this.cf = 0;
        this.cf = b;
    }
    get_x() {
        return true;
    }
    ad(a) {
        let b = a.h();
        let c = { $type: Point_$type, x: b.x + this.ax, y: b.y + this.a2 };
        if (this._parent.cf.ak(this.cf, a, c)) {
            return true;
        }
        return super.ad(a);
    }
    ag(a) {
        if (this._parent.cf.al(a)) {
            return true;
        }
        return super.ag(a);
    }
    ah(a) {
        this._parent.cf.dq(a);
        return super.ah(a);
    }
    b4() {
        this._parent.cf.dp();
        super.b4();
    }
}
SpreadsheetPaneSplitterElement.$t = markType(SpreadsheetPaneSplitterElement, 'SpreadsheetPaneSplitterElement', VisualElement.$);
/**
 * @hidden
 */
export class SpreadsheetSelectAllButtonElement extends VisualElement {
    constructor(a) {
        super(a, "SelectAllButton");
        this.cf = false;
    }
    get_x() {
        return true;
    }
    ad(a) {
        let b = this._parent.cf.c;
        if (b._dv(a, this)) {
            return true;
        }
        return super.ad(a);
    }
    get cg() {
        return this.cf;
    }
    set cg(a) {
        if (a != this.cf) {
            this.cf = a;
            this.s = a;
        }
    }
}
SpreadsheetSelectAllButtonElement.$t = markType(SpreadsheetSelectAllButtonElement, 'SpreadsheetSelectAllButtonElement', VisualElement.$);
/**
 * @hidden
 */
export class SpreadsheetShapeVisualElementBase extends VisualElement {
    constructor(a, b) {
        super(a, b);
        this.cf = null;
        this.ch = false;
        this.cj = 0;
        this.cl = 0;
    }
    get cm() {
        return this.cl;
    }
    set cm(a) {
        if (a != this.cl) {
            this.cl = a;
            this.ci = true;
        }
    }
    get ck() {
        return this.cj;
    }
    set ck(a) {
        if (a != this.cj) {
            this.cj = a;
            this.ci = true;
        }
    }
    get cg() {
        return this.cf;
    }
    set cg(a) {
        if (a != this.cf) {
            this.cf = a;
            this.ci = true;
        }
    }
    get ci() {
        return this.ch;
    }
    set ci(a) {
        if (a != this.ch) {
            this.ch = a;
            if (a) {
                this.b1();
            }
        }
    }
}
SpreadsheetShapeVisualElementBase.$t = markType(SpreadsheetShapeVisualElementBase, 'SpreadsheetShapeVisualElementBase', VisualElement.$);
/**
 * @hidden
 */
export class SpreadsheetShapeVisualElement extends SpreadsheetShapeVisualElementBase {
    constructor(a) {
        super(a, "Shape");
        this.co = null;
        this.cn = null;
    }
    an(a, b, c, d) {
        let e = this.a3;
        let f = this.av;
        let g = super.an(a, b, c, d);
        if (g && (e != this.a3 || f != this.av)) {
            this.ci = true;
        }
        return g;
    }
}
SpreadsheetShapeVisualElement.$t = markType(SpreadsheetShapeVisualElement, 'SpreadsheetShapeVisualElement', SpreadsheetShapeVisualElementBase.$);
/**
 * @hidden
 */
export class SpreadsheetChartVisualElement extends SpreadsheetShapeVisualElementBase {
    constructor(a, b, c) {
        super(a, "Chart");
        this.cn = null;
        this.cp = null;
        this.cr = null;
        this.cq = null;
        this.co = null;
        this.cn = c;
        this.cp = b;
    }
    bz() {
        super.bz();
        this.cs();
    }
    cs() {
        if (this.cq != null) {
            let a = this.co;
            let b = this.cq;
            this.cq = null;
            this.co = null;
            if (a != null) {
                a.i();
            }
            b.rootWrapper.remove();
            if (a != null) {
                a.h();
            }
        }
    }
}
SpreadsheetChartVisualElement.$t = markType(SpreadsheetChartVisualElement, 'SpreadsheetChartVisualElement', SpreadsheetShapeVisualElementBase.$);
/**
 * @hidden
 */
export class SpreadsheetTabAreaSplitterElement extends VisualElement {
    constructor(a) {
        super(a, "TabAreaSplitter");
    }
    get_x() {
        return true;
    }
    ad(a) {
        let b = a.h();
        let c = { $type: Point_$type, x: b.x + this.ax, y: b.y + this.a2 };
        if (this._parent.cf.an(b, c)) {
            return true;
        }
        return super.ad(a);
    }
}
SpreadsheetTabAreaSplitterElement.$t = markType(SpreadsheetTabAreaSplitterElement, 'SpreadsheetTabAreaSplitterElement', VisualElement.$);
/**
 * @hidden
 */
export class SpreadsheetTabItemAreaElement extends VisualElement {
    constructor(a, b) {
        super(a, b);
        this.ci = null;
        this.cl = null;
        this.ck = null;
        this.cj = null;
        this.cg = null;
        this.cm = null;
        this.cf = null;
        this.ch = null;
        this.co = 0;
        this.cp = 0;
        this.ci = new ButtonVisualElement(this, "TabScrollFirst");
        this.cl = new RepeatButtonVisualElement(this, "TabScrollPrev");
        this.ck = new RepeatButtonVisualElement(this, "TabScrollNext");
        this.cj = new ButtonVisualElement(this, "TabScrollLast");
        this.cg = new ButtonVisualElement(this, "TabActivatePrev");
        this.cm = new SpreadsheetTabItemPanel(this);
        this.cf = new ButtonVisualElement(this, "TabActivateNext");
        this.ch = new ButtonVisualElement(this, "AddWorksheetButton");
        let c = a.g(SpreadsheetVisualElement.$).dq;
        c._h8(this.ci, 107);
        c._h8(this.cl, 106);
        c._h8(this.ck, 105);
        c._h8(this.cj, 108);
        c._h8(this.cg, 109);
        c._h8(this.cf, 110);
        c._h8(this.ch, 99);
    }
    b7(a, b, c, d) {
        super.b7(a, b, c, d);
        let e = this.cm.cf;
        let f = this.cp;
        if (!this.ch.ac) {
            f -= this.ch.a3;
        }
        let g = Math.min(c - f, e.a8().width);
        e.ad(g, d);
        let h = a;
        h = this.cn(h, b, d, this.ci);
        h = this.cn(h, b, d, this.cl);
        h = this.cn(h, b, d, this.ck);
        h = this.cn(h, b, d, this.cj);
        h = this.cn(h, b, d, this.cg);
        this.cm.al(h, b, g, d);
        h += g;
        h = this.cn(h, b, d, this.cf);
        if (this.ch.ac) {
            h = this.cn(h, b, d, this.ch);
        }
    }
    an(a, b, c, d) {
        let e = super.an(a, b, c, d);
        let f = this.cm.cf.a8().width;
        if (f != this.cm.a3) {
            this.t = true;
        }
        return e;
    }
    cq() {
        let a = [this.ci, this.cj, this.ck, this.cl, this.cf, this.cg, this.ch];
        let b = this._parent;
        let c = b.cf.c._a1;
        let d = [c.ac, c.ae, c.ag, c.ai, c.g, c.i, c.k];
        let e = [c.ab, c.ad, c.af, c.ah, c.f, c.h, c.j];
        let f = 0;
        let g = 0;
        for (let h = 0; h < a.length; h++) {
            a[h].a3 = d[h];
            a[h].av = e[h];
            g += d[h];
            if (e[h] > f) {
                f = e[h];
            }
        }
        this.cp = g;
        this.co = f;
        this.t = true;
        b.cf.cx();
    }
    cn(a, b, c, d) {
        let e = d.a3;
        d.al(a, b, e, c);
        return a + e;
    }
}
SpreadsheetTabItemAreaElement.$t = markType(SpreadsheetTabItemAreaElement, 'SpreadsheetTabItemAreaElement', VisualElement.$);
/**
 * @hidden
 */
export class SpreadsheetTabItemElement extends VisualElement {
    constructor(a, b) {
        super(a, "SheetTabItem");
        this.cn = 31;
        this.cf = null;
        this.cl = 0;
        this.cv = -1;
        this.cm = null;
        this.cf = b;
        b.propertyChanged = delegateCombine(b.propertyChanged, runOn(this, this.cx));
    }
    get_x() {
        return true;
    }
    cy(a, b) {
        let c = this.cn;
        if (b) {
            c |= a;
        }
        else {
            c &= ~a;
        }
        if (c != this.cn) {
            this.cn = c;
            this.b1();
        }
    }
    get ck() {
        return (this.cn & 1) != 0;
    }
    set ck(a) {
        this.cy(1, a);
    }
    get ci() {
        return (this.cn & 2) != 0;
    }
    set ci(a) {
        this.cy(2, a);
    }
    get cj() {
        return (this.cn & 4) != 0;
    }
    set cj(a) {
        this.cy(4, a);
    }
    get cg() {
        return (this.cn & 8) != 0;
    }
    set cg(a) {
        this.cy(8, a);
    }
    get ch() {
        return (this.cn & 16) != 0;
    }
    set ch(a) {
        this.cy(16, a);
    }
    cw() {
        if (this._parent != null) {
            this._parent.cf.aj();
        }
    }
    cx(a, b) {
        if (stringIsNullOrEmpty(b.propertyName)) {
            this.cv = -1;
            this.cy(31, true);
            this.cw();
        }
        else {
            switch (b.propertyName) {
                case "Name":
                    this.cv = -1;
                    this.ch = true;
                    this.cw();
                    break;
                case "Color":
                    this.cg = true;
                    break;
                case "IsActive":
                    this.ci = true;
                    break;
                case "IsSelected":
                    this.ck = true;
                    break;
                case "IsProtected":
                    this.cj = true;
                    this.cw();
                    break;
            }
        }
    }
    b4() {
        this._parent.cf.ap();
        super.b4();
    }
    ad(a) {
        if (this._parent.cf.q(a, this)) {
            return true;
        }
        return super.ad(a);
    }
    ag(a) {
        if (this._parent.cf.t(a, this)) {
            return true;
        }
        return super.ag(a);
    }
    ah(a) {
        return this._parent.cf.u(a, this);
    }
    bz() {
        let a = this.cf;
        a.propertyChanged = delegateRemove(a.propertyChanged, runOn(this, this.cx));
        super.bz();
    }
}
SpreadsheetTabItemElement.$t = markType(SpreadsheetTabItemElement, 'SpreadsheetTabItemElement', VisualElement.$);
/**
 * @hidden
 */
export class SpreadsheetTabItemElementLayoutManager extends SpreadsheetTabItemLayoutManager$1 {
    constructor(a) {
        super(SpreadsheetTabItemElement.$);
        this.ba = null;
        this.bb = 0;
        this.bc = 0;
        this.a9 = null;
        this.ba = a;
    }
    get_b() {
        return this.ba._parent._parent.cf.c;
    }
    get b() {
        return this.get_b();
    }
    ae(a, b) {
        a.am(b);
    }
    bd() {
        this.bc++;
    }
    n() {
        return this.ba.d().cq(this.ba);
    }
    o(a) {
        return this.ba.d().cq(a);
    }
    f(a) {
        return new SpreadsheetTabItemElement(this.ba, a);
    }
    y() {
        return this.b._a1.y;
    }
    z(a) {
        return a.cl;
    }
    a6(a, b, c) {
        return { $type: Point_$type, x: a.ax + b, y: a.a2 + c };
    }
    d(a) {
        return a.cf;
    }
    aa() {
        return this.ba.a3;
    }
    ai() {
        if (this.ba._parent != null) {
            this.ba._parent.t = true;
        }
        this.b.scheduleArrange();
    }
    ak() {
        if (this.ba._parent != null) {
            this.ba._parent.t = true;
        }
        this.b.scheduleArrange();
    }
    al() {
        let a = this.a9;
        this.a9 = null;
        if (a != null) {
            a.ab = true;
        }
        this.ba.bw = null;
    }
    an() {
        if (this.a9 == null) {
            this.a9 = new VisualElement(this.ba._parent._parent, "TabDropIndicator");
            this.a9.w = false;
            this.a9.bu = 20000;
        }
        this.ba.bw = SpreadsheetCursorHelper.a(4);
    }
    au(a, b) {
    }
    av() {
        let a = this.a7(0, 0);
        this.a9.al(a.x + this.ba.ax + this.ba._parent.ax, a.y + this.ba.a2 + this.ba._parent.a2, 0, 0);
    }
    ax() {
        this.ba.d().dk(this.ba);
    }
    ay(a) {
        this.ba.d().dk(a);
    }
    az(a) {
        a.ab = true;
    }
    a4() {
        let a = 0;
        let b = this.h._k;
        for (let c = 0, d = b.count; c < d; c++) {
            let e = b.item(c)._ac;
            if (e != null && e.cf._l == 0) {
                if (e.cv != this.bc) {
                    e.cl = this.b._a0.j(e.cf);
                    e.cv = this.bc;
                }
                a += e.cl;
            }
        }
        this.bb = a;
    }
}
SpreadsheetTabItemElementLayoutManager.$t = markType(SpreadsheetTabItemElementLayoutManager, 'SpreadsheetTabItemElementLayoutManager', SpreadsheetTabItemLayoutManager$1.$.specialize(SpreadsheetTabItemElement.$));
/**
 * @hidden
 */
export class SpreadsheetTabItemPanel extends VisualElement {
    constructor(a) {
        super(a, "TabItemPanel");
        this.cf = null;
        this.cf = new SpreadsheetTabItemElementLayoutManager(this);
    }
    b4() {
        this.cf.ao();
        super.b4();
    }
    ad(a) {
        this.cf.aq(a);
        return super.ad(a);
    }
    ag(a) {
        if (this.cf.s(a)) {
            return true;
        }
        return super.ag(a);
    }
    ah(a) {
        if (a.a() == 1) {
            return this.cf.r(a);
        }
        return super.ah(a);
    }
}
SpreadsheetTabItemPanel.$t = markType(SpreadsheetTabItemPanel, 'SpreadsheetTabItemPanel', VisualElement.$);
/**
 * @hidden
 */
export class SpreadsheetVisualElement extends RootVisualElement {
    constructor(a) {
        super("Spreadsheet");
        this.dq = null;
        this.dr = null;
        this.dp = null;
        this.dq = a;
        this.dp = new FormulaBarVisualElement(this);
        this.dp.bu = 1000;
        this.dr = new SpreadsheetAreaVisualElement(this);
    }
    c8(a) {
        if (this.dq.activeWorksheet == null || this.dq.activeWorksheet.workbook == null) {
            this.dq._fy(false);
        }
        super.c8(a);
    }
    da(a, b) {
        super.da(a, b);
        if (a != null) {
            a.onKeyDown = delegateRemove(a.onKeyDown, runOn(this, this.ds));
        }
        if (b != null) {
            b.onKeyDown = delegateCombine(b.onKeyDown, runOn(this, this.ds));
        }
    }
    cw(a) {
        if (this.dq._at.h()) {
            this.dq._at.l();
            return true;
        }
        return super.cw(a);
    }
    cx(a, b) {
        if (this.dq._at.h()) {
            this.dq._at.l();
        }
        return super.cx(a, b);
    }
    b7(a, b, c, d) {
        super.b7(a, b, c, d);
        let e = b;
        if (this.dp.ac) {
            let f = this.dp.cl;
            f += d % 1;
            this.dp.al(a, e, c, f);
            e += f;
            d = Math.max(d - f, 0);
        }
        this.dr.al(a, e, c, d);
    }
    ds(a) {
        let b = this.co.ba;
        let c = SpreadsheetUtilities.c1(this.co.am);
        return this.dq._dy(a, b, c);
    }
}
SpreadsheetVisualElement.$t = markType(SpreadsheetVisualElement, 'SpreadsheetVisualElement', RootVisualElement.$);
/**
 * @hidden
 */
export class FilterDialogManager extends Base {
    constructor(a, b) {
        super();
        this.a = null;
        this.e = null;
        this.c = null;
        this.b = null;
        this.j = null;
        this.h = null;
        this.f = null;
        this.g = null;
        this.k = null;
        this.i = null;
        this.c = a;
        this.a = b;
    }
    q() {
        let a = this.l(1);
        let b = this.l(2);
        let c = this.n(1);
        let d = this.n(2);
        let e = this.d();
        this.c._gi(43, () => this.a.aa(a, c, b, d, e));
    }
    r() {
        let a;
        let b = this.c.css;
        this.e = document.createElement("div");
        this.e.className = b.filterDialog;
        this.e.id = "FilterDialog_Main_Content_Element";
        let c = document.createElement("div");
        c.innerText = this.o("FilterDialog_ShowRowsWhere");
        c.className = b.filterDialogShowRowsWhere;
        this.e.appendChild(c);
        let d = document.createElement("div");
        d.id = "lblColumnName";
        d.innerText = this.a.w;
        d.className = b.filterDialogColumnName;
        this.e.appendChild(d);
        let e = document.createElement("div");
        e.className = b.filterDialogCondition1;
        this.e.appendChild(e);
        this.j = document.createElement("select");
        this.j.id = "cboOperator1";
        e.appendChild(this.j);
        this.h = document.createElement("select");
        this.h.id = "cboOperand1";
        e.appendChild(this.h);
        let f = document.createElement("div");
        f.className = b.filterDialogConditionalOperator;
        this.e.appendChild(f);
        let g = document.createElement("label");
        f.appendChild(g);
        this.f = document.createElement("input");
        this.f.name = "conditionalOperator";
        this.f.type = "radio";
        this.f.id = "optAnd";
        g.appendChild(this.f);
        let h = document.createElement("text");
        h.innerText = ((() => { let i = this.p("FilterDialog_And", a); a = i.p1; return i.ret; })());
        this.f.accessKey = a;
        g.appendChild(h);
        let i = document.createElement("label");
        f.appendChild(i);
        this.g = document.createElement("input");
        this.g.name = "conditionalOperator";
        this.g.type = "radio";
        this.g.id = "optOr";
        i.appendChild(this.g);
        let j = document.createElement("text");
        j.innerText = ((() => { let k = this.p("FilterDialog_Or", a); a = k.p1; return k.ret; })());
        this.g.accessKey = a;
        i.appendChild(j);
        let k = document.createElement("div");
        k.className = b.filterDialogCondition2;
        this.e.appendChild(k);
        this.k = document.createElement("select");
        this.k.id = "cboOperator2";
        k.appendChild(this.k);
        this.i = document.createElement("select");
        this.i.id = "cboOperand2";
        k.appendChild(this.i);
        let l = document.createElement("div");
        l.className = b.filterDialogHintText;
        this.e.appendChild(l);
        let m = document.createElement("div");
        m.innerText = this.o("FilterDialog_QuestionMarkHint");
        l.appendChild(m);
        let n = document.createElement("div");
        n.innerText = this.o("FilterDialog_AsteriskHint");
        l.appendChild(n);
        let o = document.createElement("div");
        o.className = b.filterDialogButtons;
        let p = SpreadsheetDialogUtilities.a();
        let q = (r) => {
            this.q();
            this.s();
        };
        let r = q;
        p.id = "btnOK";
        p.addEventListener("click", r, false);
        p.innerText = ((() => { let s = this.p("FilterDialog_OK", a); a = s.p1; return s.ret; })());
        p.accessKey = a;
        let s = SpreadsheetDialogUtilities.a();
        let t = (u) => this.s();
        let u = t;
        s.id = "btnCancel";
        s.addEventListener("click", u, false);
        s.innerText = ((() => { let v = this.p("FilterDialog_Cancel", a); a = v.p1; return v.ret; })());
        s.accessKey = a;
        o.appendChild(p);
        o.appendChild(s);
        this.e.appendChild(o);
        let v = FilterDialogViewModel.i(this.c);
        for (let w of fromEnum(v)) {
            let x = document.createElement("option");
            x.innerText = w.displayText;
            x.setAttribute("value", w.dataValue);
            this.j.appendChild(x);
            let y = document.createElement("option");
            y.innerText = w.displayText;
            y.setAttribute("value", w.dataValue);
            this.k.appendChild(y);
        }
        for (let z of fromEnum(this.a.k)) {
            let aa = document.createElement("option");
            let ab = z.toString();
            aa.innerText = ab;
            aa.setAttribute("value", ab);
            this.h.appendChild(aa);
            let ac = document.createElement("option");
            let ad = z.toString();
            ac.innerText = ad;
            ac.setAttribute("value", ad);
            this.i.appendChild(ac);
        }
        let ae = this.a.n;
        if (ae.hasValue) {
            this.j.value = EnumUtil.getName(ExcelComparisonOperator_$type, this.a.n.value);
        }
        let af = this.a.p;
        if (af.hasValue) {
            this.k.value = EnumUtil.getName(ExcelComparisonOperator_$type, this.a.p.value);
        }
        let ag = this.a.z(1);
        let ah = this.a.z(2);
        switch (this.a.d) {
            case 0:
                this.f.checked = true;
                break;
            case 1:
                this.g.checked = true;
                break;
            default: break;
        }
        this.t(this.h);
        this.t(this.i);
    }
    s() {
        this.b.close(false);
    }
    t(a) {
    }
    d() {
        if (this.f.checked) {
            return 0;
        }
        if (this.g.checked) {
            return 1;
        }
        return 0;
    }
    o(a) {
        let b = this.c._fs(a);
        b = SpreadsheetUtilities.c2(b);
        return b;
    }
    p(a, b) {
        let c = this.c._fs(a);
        c = ((() => { let d = SpreadsheetUtilities.c3(c, b); b = d.p1; return d.ret; })());
        return {
            ret: c,
            p1: b
        };
    }
    m(a) {
        let b = a.selectedIndex;
        let c = a.options.item(b);
        if (null == c) {
            return null;
        }
        let d = c.getAttribute("value");
        return d;
    }
    l(a) {
        let b = a == 1 ? this.j : this.k;
        let c = this.m(b);
        if (null == c) {
            return Nullable$1.toNullable(ExcelComparisonOperator_$type, null);
        }
        let d = c.toString();
        if (stringIsNullOrEmpty(d)) {
            return Nullable$1.toNullable(ExcelComparisonOperator_$type, null);
        }
        let e = EnumUtil.getEnumValue(ExcelComparisonOperator_$type, EnumUtil.parse(ExcelComparisonOperator_$type, d, true));
        return Nullable$1.toNullable(ExcelComparisonOperator_$type, e);
    }
    n(a) {
        let b = a == 1 ? this.h : this.i;
        throw new NotImplementedException(0);
    }
    u() {
        this.r();
        let a = this.e;
        let b = this.c._fs("FilterDialog_Title");
        this.b = this.c._r(a, b);
    }
}
FilterDialogManager.$t = markType(FilterDialogManager, 'FilterDialogManager');
/**
 * @hidden
 */
export class FormatCellsDialogManager extends Base {
    constructor(a, b, c) {
        super();
        this.t = null;
        this.v = null;
        this.ag = null;
        this.ah = null;
        this.u = null;
        this.y = null;
        this.z = false;
        this.r = null;
        this.a0 = null;
        this.ay = null;
        this.af = null;
        this.bw = null;
        this.az = null;
        this.bx = null;
        this.by = null;
        this.ac = null;
        this.bv = null;
        this.bu = null;
        this.bt = null;
        this.b5 = null;
        this.b6 = null;
        this.ar = null;
        this.at = null;
        this.as = null;
        this.av = null;
        this.aq = null;
        this.au = null;
        this.aw = null;
        this.ax = null;
        this.b1 = null;
        this.b3 = null;
        this.b2 = null;
        this.b4 = null;
        this.ak = null;
        this.an = null;
        this.ap = null;
        this.ao = null;
        this.al = null;
        this.am = null;
        this.x = null;
        this.q = null;
        this.p = null;
        this.o = null;
        this.b0 = null;
        this.ai = null;
        this.aj = null;
        this.j = null;
        this.k = null;
        this.i = null;
        this.h = null;
        this.d = null;
        this.a = null;
        this.c = null;
        this.f = null;
        this.e = null;
        this.g = null;
        this.b = null;
        this.bz = null;
        this.n = null;
        this.ad = null;
        this.ae = null;
        this.l = null;
        this.v = a;
        this.t = b;
        this.y = c;
    }
    get w() {
        return this.v.css;
    }
    get bs() {
        return this.ag;
    }
    get s() {
        if (null == this.r) {
            this.r = this.t._b;
        }
        return this.r;
    }
    ea() {
        throw new NotSupportedException(0);
    }
    b8(a, b, c) {
        if (stringIsNullOrEmpty(b) || stringIsNullOrEmpty(c)) {
            return a;
        }
        if (null == a) {
            a = stringEmpty();
        }
        let d = a.split(';');
        let e = new List$1(StyleAttributeMember.$, 0);
        for (let g = 0; g < d.length; g++) {
            let f = d[g];
            if (false == stringIsNullOrEmpty(f)) {
                let h = f.split(':');
                if (h.length == 2) {
                    e.add(new StyleAttributeMember(h[0].trim(), h[1].trim()));
                }
            }
        }
        b = b.trim();
        let i = null;
        for (let j of fromEnum(e)) {
            if (b == j.a) {
                i = j;
                break;
            }
        }
        ;
        if (null != i) {
            i.b = c;
        }
        else {
            e.add(new StyleAttributeMember(b, c));
        }
        let k = new StringBuilder(0);
        e.q((l) => {
            k.l(l.a);
            k.l(": ");
            k.l(l.b);
            k.l("; ");
        });
        return k.toString();
    }
    dr() {
        this.t._cl();
    }
    ds() {
        this.ag = document.createElement("div");
        this.ag.className = this.w.formatCellsDialog;
        this.ag.id = "SFCD_DIALOG_ROOT_ELEMENT";
        this.ah = document.createElement("div");
        this.ah.id = "SFCD_DIALOG_ROOT_GRID_ELEMENT";
        this.ag.appendChild(this.ah);
        this.ah.setAttribute("style", SpreadsheetDialogUtilities.k("11fr 2em", "5fr 2fr 2fr", ".5em"));
        let a = this.aa(this.w);
        this.ah.appendChild(this.a0);
        this.a0.setAttribute("style", SpreadsheetDialogUtilities.j(1, 1, 1, 3));
        this.d5(a);
        this.dv(this.w);
        this.ah.appendChild(this.ay);
        this.ay.setAttribute("style", SpreadsheetDialogUtilities.j(2, 1, 2, 1, "height: 2em;"));
        this.ah.appendChild(this.af);
        this.af.setAttribute("style", SpreadsheetDialogUtilities.j(2, 1, 3, 1, "height: 2em;"));
    }
    dt(a, b) {
        this.eb();
    }
    du() {
        throw new NotSupportedException(0);
    }
    a1() {
        let a = document.createElement("div");
        a.className = this.v.css.formatCellsDialogTab;
        a.id = "SFCD_AT";
        a.setAttribute("style", "height: " + "555px" + "; ");
        let b = document.createElement("div");
        b.setAttribute("style", SpreadsheetDialogUtilities.k("1em 1em 2em 2em 2em 1em 1em 1.5em 1.5em 1.5em 1fr", "2em 3fr 2fr 3fr", "10px", "height: 100%; box-sizing: border-box; "));
        a.appendChild(b);
        let c = this.bl(b, "FormatCellsDialog_AlignmentTab_Text_TextAlignment", null);
        let d = this.dg(c);
        c.setAttribute("style", SpreadsheetDialogUtilities.j(1, 1, 1, 2, d + " display: block;"));
        c = this.bl(b, "FormatCellsDialog_AlignmentTab_Text_Horizontal", null);
        d = this.dg(c);
        c.setAttribute("style", SpreadsheetDialogUtilities.j(2, 1, 2, 1, d + " display: block;"));
        c = this.a2(b);
        d = this.dg(c);
        c.setAttribute("style", SpreadsheetDialogUtilities.j(3, 1, 2, 1, d));
        c = this.bl(b, "FormatCellsDialog_AlignmentTab_Text_Indent", null);
        d = this.dg(c);
        c.setAttribute("style", SpreadsheetDialogUtilities.j(3, 1, 3, 1, d + " display: block; margin-top: 1em;"));
        c = this.bl(b, "FormatCellsDialog_AlignmentTab_Text_Vertical", null);
        d = this.dg(c);
        c.setAttribute("style", SpreadsheetDialogUtilities.j(4, 1, 2, 1, d + " display: block; margin-top: 1em;"));
        c = this.a3(b);
        d = this.dg(c);
        c.setAttribute("style", SpreadsheetDialogUtilities.j(4, 1, 3, 1, d));
        c = this.a4(b);
        d = this.dg(c);
        c.setAttribute("style", SpreadsheetDialogUtilities.j(5, 1, 2, 1, d));
        c = this.bl(b, "FormatCellsDialog_AlignmentTab_Text_TextControl", null);
        d = this.dg(c);
        c.setAttribute("style", SpreadsheetDialogUtilities.j(7, 1, 1, 2, d + " display: block;"));
        let e = (f) => this.t._br = Nullable$1.toNullable(Boolean_$type, this.bv.checked);
        let f = this.m(b, "chkWrapText", "FormatCellsDialog_AlignmentTab_Text_WrapText", this.t._br, e);
        this.bv = f.c;
        c = f.a;
        d = this.dg(c);
        c.setAttribute("style", SpreadsheetDialogUtilities.j(8, 1, 2, 1, d));
        let g = (h) => this.t._bq = Nullable$1.toNullable(Boolean_$type, this.bu.checked);
        f = this.m(b, "TESTID_AT_ShrinkToFit", "FormatCellsDialog_AlignmentTab_Text_ShrinkToFit", this.t._bq, g);
        this.bu = f.c;
        this.bu.disabled = (false == this.t._a7);
        c = f.a;
        d = this.dg(c);
        c.setAttribute("style", SpreadsheetDialogUtilities.j(9, 1, 2, 1, d));
        let h = (i) => this.t._bo = Nullable$1.toNullable(Boolean_$type, this.bt.checked);
        f = this.m(b, "TESTID_AT_MergeCells", "FormatCellsDialog_AlignmentTab_Text_MergeCells", this.t._bo, h);
        this.bt = f.c;
        this.bt.disabled = (false == this.t._a4);
        c = f.a;
        d = this.dg(c);
        c.setAttribute("style", SpreadsheetDialogUtilities.j(10, 1, 2, 1, d));
        return a;
    }
    m(a, b, c, d, e) {
        let f = document.createElement("input");
        f.id = b;
        f.setAttribute("Type", "checkbox");
        let g = document.createElement("div");
        g.appendChild(f);
        a.appendChild(g);
        if (false == d.hasValue) {
            f.indeterminate = true;
        }
        else {
            f.checked = d.value;
        }
        if (null != e) {
            f.addEventListener("change", e, false);
        }
        let h = null;
        if (false == stringIsNullOrEmpty(c)) {
            h = this.bl(g, c, b);
            let i = this.b8((h.getAttribute("style")), "display", "inline");
            i = this.b8(i, "vertical-align", "top");
            h.setAttribute("style", i);
        }
        return new CheckboxElementInfo(f, g, h);
    }
    bj(a, b, c = "1px", d = "gray", e = "solid") {
        let f;
        let g = document.createElement("fieldset");
        let h = document.createElement("legend");
        g.setAttribute("style", stringFormat(" border-width: {0}; border-color: {1}; border-style: {2};", c, d, e));
        h.setAttribute("style", " color: black; font-weight: NORMAL;");
        h.innerText = ((() => { let i = this.di(b, f); f = i.p1; return i.ret; })());
        h.accessKey = f;
        g.appendChild(h);
        a.appendChild(g);
        return g;
    }
    bk(a, b, c, d, e, f) {
        if (true == e && false == stringIsNullOrEmpty(d)) {
            this.bl(a, d, b);
        }
        let g = document.createElement("input");
        g.id = b;
        if (false == stringIsNullOrEmpty(c)) {
            g.setAttribute("Type", c);
        }
        if (null != f) {
            g.addEventListener("change", f, false);
        }
        a.appendChild(g);
        if (false == e && false == stringIsNullOrEmpty(d)) {
            this.bl(a, d, b);
        }
        return g;
    }
    bl(a, b, c) {
        let d;
        let e = document.createElement("label");
        if (false == stringIsNullOrEmpty(b)) {
            e.innerText = ((() => { let f = this.di(b, d); d = f.p1; return f.ret; })());
            e.accessKey = d;
        }
        if (false == stringIsNullOrEmpty(c)) {
            e.setAttribute("for", c);
        }
        a.appendChild(e);
        return e;
    }
    b7(a, b, c, d = 0) {
        let e = document.createElement("select");
        e.id = b;
        if (null != c) {
            e.addEventListener("change", c, false);
        }
        if (d > 0) {
            e.size = d;
        }
        e.setAttribute("style", "overflow: auto;");
        a.appendChild(e);
        return e;
    }
    a2(a) {
        let b = (c) => {
            let d = this.bx.selectedIndex;
            let e = this.bx.options.item(d);
            if (null != e) {
                let f = EnumWrapper$1._b(HorizontalCellAlignment_$type, this.t._au, e.innerText);
                this.t._ad = f._enumValue$i;
            }
        };
        this.bx = this.b7(a, "cmbHorizontalTextAlignment", b);
        for (let c of this.t._au) {
            let d = document.createElement("option");
            d.innerText = c.toString();
            d.setAttribute("value", c.toString());
            this.bx.appendChild(d);
            if (EnumUtil.getName(HorizontalCellAlignment_$type, this.t._ad) == c._h) {
                this.bx.value = c;
            }
        }
        return this.bx;
    }
    a3(a) {
        throw new NotSupportedException(0);
    }
    a4(a) {
        let b = (c) => {
            let d = this.by.selectedIndex;
            let e = this.by.options.item(d);
            if (null != e) {
                let f = EnumWrapper$1._b(VerticalCellAlignment_$type, this.t._av, e.innerText);
                this.t._af = f._enumValue$i;
            }
        };
        this.by = this.b7(a, "cmbVerticalTextAlignment", b);
        for (let c of this.t._av) {
            let d = document.createElement("option");
            d.innerText = c.toString();
            d.setAttribute("value", c.toString());
            this.by.appendChild(d);
            if (EnumUtil.getName(VerticalCellAlignment_$type, this.t._af) == c._h) {
                this.by.value = c;
            }
        }
        return this.by;
    }
    a5(a) {
        let b = (c) => {
            let d = this.bz.selectedIndex;
            let e = this.bz.options.item(d);
            if (null != e) {
                let f = (e.textContent);
                let g = EnumWrapper$1._b(CellBorderLineStyle_$type, this.t._as, f);
                this.t._v = g._enumValue$i;
            }
        };
        this.bz = this.b7(a, "TESTID_BT_LineStyles", b, 7);
        for (let c of this.t._as) {
            let d = document.createElement("option");
            d.innerText = c.toString();
            d.setAttribute("value", c.toString());
            this.bz.appendChild(d);
            if (EnumUtil.getName(CellBorderLineStyle_$type, this.t._v) == c._h) {
                this.bz.value = c;
            }
        }
        return this.bz;
    }
    a6(a) {
        this.ae = document.createElement("div");
        this.ae.id = "TESTID_BT_BordersPreview";
        a.appendChild(this.ae);
        return this.ae;
    }
    a7(a) {
        let b = (c) => {
            let d = this.b0.selectedIndex;
            let e = this.b0.options.item(d);
            if (null != e) {
                let f = (e.textContent);
                let g = EnumWrapper$1._b(FillPatternStyle_$type, this.t._at, f);
                this.t._ab = g._enumValue$i;
            }
        };
        this.b0 = this.b7(a, "TESTID_FILLT_PatternStyle", b);
        for (let c of this.t._at) {
            let d = document.createElement("option");
            d.innerText = c.toString();
            d.setAttribute("value", c.toString());
            this.b0.appendChild(d);
            if (EnumUtil.getName(FillPatternStyle_$type, this.t._ab) == c._h) {
                this.b0.value = c;
            }
        }
        return this.b0;
    }
    a8(a) {
        this.aj = document.createElement("div");
        a.appendChild(this.aj);
        return this.aj;
    }
    a9(a) {
        let b = (c) => {
            let d = this.b1.selectedIndex;
            let e = this.b1.options.item(d);
            if (null != e) {
                let f = (e.textContent);
                let g = this.s._ae._inner[0];
                for (let h of fromEnum(this.s._ae)) {
                    if (h == f) {
                        g = h;
                        break;
                    }
                }
                if (false == stringIsNullOrEmpty(g)) {
                    this.s._ax = g;
                }
            }
        };
        this.b1 = this.b7(a, "TESTID_FT_FontNames", b, 5);
        for (let c of fromEnum(this.s._ae)) {
            let d = document.createElement("option");
            d.innerText = c;
            d.setAttribute("value", c.toString());
            this.b1.appendChild(d);
        }
        this.b1.value = this.s._ax;
        return this.b1;
    }
    ba(a) {
        let b = (c) => {
            let d = this.b2.selectedIndex;
            let e = this.b2.options.item(d);
            if (null != e) {
                let f = (e.textContent);
                let g = this.s._af._inner[0];
                for (let h of fromEnum(this.s._af)) {
                    if (h.toString() == f) {
                        g = h;
                        break;
                    }
                }
                this.s._aj = g;
            }
        };
        this.b2 = this.b7(a, "TESTID_FT_FontSizes", b, 5);
        for (let c of fromEnum(this.s._af)) {
            let d = document.createElement("option");
            d.innerText = c.toString();
            d.setAttribute("value", c.toString());
            this.b2.appendChild(d);
        }
        this.b2.value = this.s._aj.toString();
        return this.b2;
    }
    bb(a) {
        let b = (c) => {
            let d = this.b3.selectedIndex;
            let e = this.b3.options.item(d);
            if (null != e) {
                let f = (e.textContent);
                let g = this.s._ag._inner[0];
                for (let h of fromEnum(this.s._ag)) {
                    if (h.b == f) {
                        g = h;
                        break;
                    }
                }
                if (null != g) {
                    this.s._d = g;
                }
            }
        };
        this.b3 = this.b7(a, "TESTID_FT_FontStyles", b, 5);
        for (let c of fromEnum(this.s._ag)) {
            let d = document.createElement("option");
            d.innerText = c.b;
            d.setAttribute("value", c.toString());
            this.b3.appendChild(d);
        }
        let e = this.s._d;
        if (null != e) {
            this.b3.value = e.b;
        }
        return this.b3;
    }
    bc(a) {
        let b = (c) => {
            let d = this.b4.selectedIndex;
            let e = this.b4.options.item(d);
            if (null != e) {
                let f = (e.textContent);
                let g = EnumUtil.getEnumValue(FontUnderlineStyle_$type, EnumUtil.parse(FontUnderlineStyle_$type, f, true));
                this.s._h = g;
            }
        };
        this.b4 = this.b7(a, "cmbFontUnderlineStyles", b);
        for (let c of this.s._n) {
            let d = document.createElement("option");
            d.innerText = EnumUtil.getName(FontUnderlineStyle_$type, c);
            d.setAttribute("value", EnumUtil.getName(FontUnderlineStyle_$type, c));
            this.b4.appendChild(d);
        }
        this.b4.value = EnumUtil.getName(FontUnderlineStyle_$type, this.s._h);
        return this.b4;
    }
    bd(a) {
        this.am = document.createElement("div");
        a.appendChild(this.am);
        return this.am;
    }
    be(a) {
        let b = (c) => {
            let d = this.b5.selectedIndex;
            let e = this.b5.options.item(d);
            if (null != e) {
                let f = (e.textContent);
                let g = null;
                for (let h of fromEnum(this.t._ba)) {
                    if (h._aa == f) {
                        g = h;
                        break;
                    }
                }
                if (null != g) {
                    this.t._n = g;
                }
            }
        };
        this.b5 = this.b7(a, "TESTID_NT_Category", b, 10);
        for (let c of fromEnum(this.t._ba)) {
            let d = document.createElement("option");
            d.innerText = c._aa;
            d.setAttribute("value", c.toString());
            this.b5.appendChild(d);
        }
        this.b5.value = this.t._n.toString();
        return this.b5;
    }
    bf(a) {
        throw new NotSupportedException(0);
    }
    bg(a) {
        let b = (c) => {
            let d = this.b6.selectedIndex;
            let e = this.b6.options.item(d);
            if (null != e) {
                let f = null;
                for (let g of fromEnum(this.t._n._w)) {
                    if (g._e == (e.value)) {
                        f = g;
                        break;
                    }
                }
                if (null != f) {
                    this.t._k = f;
                }
            }
        };
        this.b6 = this.b7(a, "TESTID_NT_Formats", b, 4);
        return this.b6;
    }
    bh(a) {
        let b = document.createElement("div");
        b.setAttribute("style", SpreadsheetDialogUtilities.k("1fr 1fr 5fr", "1fr", "3px", "overflow: hidden; box-sizing: border-box; "));
        a.appendChild(b);
        this.av = this.bl(b, null, "formatsList");
        let c = this.dg(this.av);
        b.appendChild(this.av);
        this.av.setAttribute("style", SpreadsheetDialogUtilities.j(1, 1, 1, 1, c));
        let d = (e) => {
            let f = this.bv.checked;
            this.t._bx = this.aq.value;
        };
        this.aq = this.bk(a, "TESTID_NT_CustomizedFormatMask", null, null, false, d);
        c = this.dg(this.aq);
        b.appendChild(this.aq);
        this.aq.setAttribute("style", SpreadsheetDialogUtilities.j(2, 1, 1, 1, c));
        let e = this.bg(b);
        c = this.dg(e);
        b.appendChild(e);
        e.setAttribute("style", SpreadsheetDialogUtilities.j(3, 1, 1, 1, c));
        return b;
    }
    bi(a) {
        this.ax = document.createElement("div");
        a.appendChild(this.ax);
        return this.ax;
    }
    ab(a, b, c, d) {
        let e = SpreadsheetDialogUtilities.a();
        if (false == stringIsNullOrEmpty(b)) {
            e.className = b;
        }
        e.id = a;
        e.addEventListener("click", d, false);
        let f = stringEmpty();
        if (false == stringIsNullOrEmpty(c)) {
            e.innerText = ((() => { let g = this.di(c, f); f = g.p1; return g.ret; })());
        }
        e.accessKey = f;
        return e;
    }
    bm() {
        let a = document.createElement("div");
        a.className = this.v.css.formatCellsDialogTab;
        a.id = "SFCD_BT";
        a.setAttribute("style", "height: " + "555px" + "; ");
        let b = document.createElement("div");
        b.setAttribute("style", SpreadsheetDialogUtilities.k("1fr 2.2fr 20px 1fr", "2.5fr 20px 3.5fr 50px", "10px", "height: 100%; box-sizing: border-box; "));
        a.appendChild(b);
        let c = this.bj(b, "FormatCellsDialog_BorderTab_Text_Line");
        let d = c;
        let e = this.dg(c);
        c.setAttribute("style", SpreadsheetDialogUtilities.j(1, 2, 1, 1, e + " overflow: hidden; border-color: #fff; "));
        let f = document.createElement("div");
        f.setAttribute("style", SpreadsheetDialogUtilities.k("1em 1fr 1em 1em 2em 2em", "1fr", "10px", "height: 100%; box-sizing: border-box; "));
        d.appendChild(f);
        c = this.bl(f, "FormatCellsDialog_BorderTab_Text_Style", "TESTID_BT_LineStyles");
        e = this.dg(c);
        c.setAttribute("style", SpreadsheetDialogUtilities.j(1, 1, 1, 1, e + " display: block;"));
        c = this.a5(f);
        e = this.dg(c);
        c.setAttribute("style", SpreadsheetDialogUtilities.j(2, 1, 1, 1, e));
        c = this.bl(f, "FormatCellsDialog_BorderTab_Text_Color", "TESTID_BT_LineColor");
        e = this.dg(c);
        c.setAttribute("style", SpreadsheetDialogUtilities.j(4, 1, 1, 1, e + " display: block;"));
        let g = (h) => this.t._al = h;
        this.n = new ColorPickerProxy(this, "SpreadsheetThemeColorPickerControl_Text_Automatic", "SpreadsheetThemeColorPickerControl_Text_NoColor", true, g);
        c = this.n.m;
        f.appendChild(c);
        e = this.dg(c);
        c.setAttribute("style", SpreadsheetDialogUtilities.j(5, 1, 1, 1, e));
        this.dy();
        c = this.bj(b, "FormatCellsDialog_BorderTab_Text_Presets");
        d = c;
        e = this.dg(c);
        c.setAttribute("style", SpreadsheetDialogUtilities.j(1, 1, 3, 1, e + " overflow: hidden; border-color: #fff; border-bottom-style: none; border-left-style: none; border-right-style: none; "));
        let h = document.createElement("div");
        h.setAttribute("style", SpreadsheetDialogUtilities.k("50px 1em ", "50px 2px 50px 2px 50px 1fr", "10px", "height: 100%; box-sizing: border-box; "));
        d.appendChild(h);
        this.j = new BorderLineButtonElementProxy("TESTID_BT_NonePreset", false, 0, false, runOn(this, this.d7), runOn(this, this.d6));
        let i;
        c = i = this.j.ab;
        i.width = 50;
        i.height = 50;
        h.appendChild(c);
        e = this.dg(c);
        c.setAttribute("style", SpreadsheetDialogUtilities.j(1, 1, 1, 1, e));
        this.j.ah();
        c = this.bl(h, "FormatCellsDialog_BorderTab_Text_PresetNone", "TESTID_BT_NonePreset");
        e = this.dg(c);
        c.setAttribute("style", SpreadsheetDialogUtilities.j(2, 1, 1, 1, e + " display: block; margin: 0px;"));
        this.k = new BorderLineButtonElementProxy("TESTID_BT_OutlinePreset", false, 1, false, runOn(this, this.d7), runOn(this, this.d6));
        c = i = this.k.ab;
        i.width = 50;
        i.height = 50;
        h.appendChild(c);
        e = this.dg(c);
        c.setAttribute("style", SpreadsheetDialogUtilities.j(1, 1, 3, 1, e));
        this.k.ah();
        c = this.bl(h, "FormatCellsDialog_BorderTab_Text_PresetOutline", "TESTID_BT_OutlinePreset");
        e = this.dg(c);
        c.setAttribute("style", SpreadsheetDialogUtilities.j(2, 1, 3, 1, e + " display: block; margin: 0px;"));
        this.i = new BorderLineButtonElementProxy("TESTID_BT_InsidePreset", false, 2, false == this.t._d._au, runOn(this, this.d7), runOn(this, this.d6));
        c = i = this.i.ab;
        i.width = 50;
        i.height = 50;
        h.appendChild(c);
        e = this.dg(c);
        c.setAttribute("style", SpreadsheetDialogUtilities.j(1, 1, 5, 1, e));
        this.i.ah();
        c = this.bl(h, "FormatCellsDialog_BorderTab_Text_PresetInside", "TESTID_BT_InsidePreset");
        e = this.dg(c);
        c.setAttribute("style", SpreadsheetDialogUtilities.j(2, 1, 5, 1, e + " display: block; margin: 0px;"));
        c = this.bj(b, "FormatCellsDialog_BorderTab_Text_Border");
        d = c;
        e = this.dg(c);
        c.setAttribute("style", SpreadsheetDialogUtilities.j(2, 1, 3, 1, e + " overflow: hidden; border-color: #fff; border-bottom-style: none; border-left-style: none; border-right-style: none; "));
        let j = document.createElement("div");
        j.setAttribute("style", SpreadsheetDialogUtilities.k("40px 1fr 40px 1fr 40px 1fr 40px 1fr ", "40px 2px 40px 2px 40px 2px 40px 2px 40px 1fr", "10px", "height: 100%; box-sizing: border-box; "));
        d.appendChild(j);
        this.h = new BorderLineButtonElementProxy("TESTID_BT_AddTopLine", true, 10, false, runOn(this, this.d7), runOn(this, this.d6));
        c = i = this.h.ab;
        i.width = 40;
        i.height = 40;
        j.appendChild(c);
        e = this.dg(c);
        c.setAttribute("style", SpreadsheetDialogUtilities.j(1, 1, 1, 1, e));
        this.h.ah();
        this.d = new BorderLineButtonElementProxy("TESTID_BT_AddInsideHorizontalLine", true, 6, false == this.t._d._av, runOn(this, this.d7), runOn(this, this.d6));
        c = i = this.d.ab;
        i.width = 40;
        i.height = 40;
        j.appendChild(c);
        e = this.dg(c);
        c.setAttribute("style", SpreadsheetDialogUtilities.j(3, 1, 1, 1, e));
        this.d.ah();
        this.a = new BorderLineButtonElementProxy("TESTID_BT_AddBottomLine", true, 3, false, runOn(this, this.d7), runOn(this, this.d6));
        c = i = this.a.ab;
        i.width = 40;
        i.height = 40;
        j.appendChild(c);
        e = this.dg(c);
        c.setAttribute("style", SpreadsheetDialogUtilities.j(5, 1, 1, 1, e));
        this.a.ah();
        this.c = new BorderLineButtonElementProxy("TESTID_BT_AddDiagonalUpLine", true, 5, false, runOn(this, this.d7), runOn(this, this.d6));
        c = i = this.c.ab;
        i.width = 40;
        i.height = 40;
        j.appendChild(c);
        e = this.dg(c);
        c.setAttribute("style", SpreadsheetDialogUtilities.j(7, 1, 1, 1, e));
        this.c.ah();
        this.f = new BorderLineButtonElementProxy("TESTID_BT_AddLeftLine", true, 8, false, runOn(this, this.d7), runOn(this, this.d6));
        c = i = this.f.ab;
        i.width = 40;
        i.height = 40;
        j.appendChild(c);
        e = this.dg(c);
        c.setAttribute("style", SpreadsheetDialogUtilities.j(7, 1, 3, 1, e));
        this.f.ah();
        this.e = new BorderLineButtonElementProxy("TESTID_BT_AddInsideVerticalLine", true, 7, false == this.t._d._ax, runOn(this, this.d7), runOn(this, this.d6));
        c = i = this.e.ab;
        i.width = 40;
        i.height = 40;
        j.appendChild(c);
        e = this.dg(c);
        c.setAttribute("style", SpreadsheetDialogUtilities.j(7, 1, 5, 1, e));
        this.e.ah();
        this.g = new BorderLineButtonElementProxy("TESTID_BT_AddRightLine", true, 9, false, runOn(this, this.d7), runOn(this, this.d6));
        c = i = this.g.ab;
        i.width = 40;
        i.height = 40;
        j.appendChild(c);
        e = this.dg(c);
        c.setAttribute("style", SpreadsheetDialogUtilities.j(7, 1, 7, 1, e));
        this.g.ah();
        this.b = new BorderLineButtonElementProxy("TESTID_BT_AddDiagonalDownLine", true, 4, false, runOn(this, this.d7), runOn(this, this.d6));
        c = i = this.b.ab;
        i.width = 40;
        i.height = 40;
        j.appendChild(c);
        e = this.dg(c);
        c.setAttribute("style", SpreadsheetDialogUtilities.j(7, 1, 9, 1, e));
        this.b.ah();
        c = this.a6(j);
        e = this.dg(c);
        c.setAttribute("style", SpreadsheetDialogUtilities.j(1, 5, 3, 5, e));
        this.eb();
        c = this.bl(b, "FormatCellsDialog_BorderTab_Text_Description", "");
        e = this.dg(c);
        c.setAttribute("style", SpreadsheetDialogUtilities.j(4, 1, 1, 4, e + " display: block;"));
        return a;
    }
    dv(a) {
        let b = (c) => {
            this.dr();
            this.du();
        };
        this.ay = this.ab("TESTID_DIALOG_OK", a.formatCellsDialogButtons, "FormatCellsDialog_OK", b);
        let c = (d) => this.du();
        this.af = this.ab("TESTID_DIALOG_Cancel", a.formatCellsDialogButtons, "FormatCellsDialog_Cancel", c);
    }
    bn() {
        let a = document.createElement("div");
        a.className = this.v.css.formatCellsDialogTab;
        a.id = "SFCD_FILLT";
        a.setAttribute("style", "height: " + "555px" + "; ");
        let b = document.createElement("div");
        b.setAttribute("style", SpreadsheetDialogUtilities.k("1em 2em 1em 2em 2fr 1fr", "1fr 50px 1fr", "10px", "height: 100%; box-sizing: border-box; "));
        a.appendChild(b);
        let c = this.bl(b, "FormatCellsDialog_FillTab_Text_BackgroundColor", "TESTID_FILLT_NoColor");
        let d = this.dg(c);
        c.setAttribute("style", SpreadsheetDialogUtilities.j(1, 1, 1, 1, d + " display: block;"));
        c = this.bl(b, "FormatCellsDialog_FillTab_Text_PatternColor", "TESTID_FILLT_PatternColor");
        d = this.dg(c);
        c.setAttribute("style", SpreadsheetDialogUtilities.j(1, 1, 3, 1, d + " display: block;"));
        let e = (f) => {
            this.t._ak = f;
            if (WorkbookColorInfo.l_op_Equality(null, f)) {
                this.t._bg++;
            }
        };
        this.o = new ColorPickerProxy(this, "SpreadsheetThemeColorPickerControl_Text_Automatic", "SpreadsheetThemeColorPickerControl_Text_NoColor", false, e);
        c = this.o.m;
        b.appendChild(c);
        d = this.dg(c);
        c.setAttribute("style", SpreadsheetDialogUtilities.j(2, 1, 1, 1, d));
        this.o.w(WorkbookColorInfo.l_op_Equality(null, this.t._ak));
        let f = (g) => this.t._am = g;
        this.p = new ColorPickerProxy(this, "SpreadsheetThemeColorPickerControl_Text_Automatic", "SpreadsheetThemeColorPickerControl_Text_NoColor", true, f);
        c = this.p.m;
        b.appendChild(c);
        d = this.dg(c);
        c.setAttribute("style", SpreadsheetDialogUtilities.j(2, 1, 3, 1, d));
        this.d0();
        c = this.bl(b, "FormatCellsDialog_FillTab_Text_PatternStyle", "TESTID_FILLT_PatternStyle");
        d = this.dg(c);
        c.setAttribute("style", SpreadsheetDialogUtilities.j(3, 1, 3, 1, d + " display: block;"));
        c = this.a7(b);
        d = this.dg(c);
        c.setAttribute("style", SpreadsheetDialogUtilities.j(4, 1, 3, 1, d));
        c = this.bj(b, "FormatCellsDialog_FillTab_Text_Sample");
        let g = c;
        d = this.dg(c);
        c.setAttribute("style", SpreadsheetDialogUtilities.j(6, 1, 1, 3, d + " overflow: hidden; "));
        c = this.a8(g);
        d = this.dg(c);
        c.setAttribute("style", d);
        return a;
    }
    bo() {
        let a = document.createElement("div");
        a.className = this.v.css.formatCellsDialogTab;
        a.id = "SFCD_FT";
        a.setAttribute("style", "height: " + "555px" + "; ");
        let b = document.createElement("div");
        b.setAttribute("style", SpreadsheetDialogUtilities.k("1em 8em 1em 2em 11em 1fr", "2fr 1fr 1fr", "10px", "height: 100%; box-sizing: border-box; "));
        a.appendChild(b);
        let c = this.bl(b, "SpreadsheetFontControl_FontLabel", "TESTID_FT_FontNames");
        let d = this.dg(c);
        c.setAttribute("style", SpreadsheetDialogUtilities.j(1, 1, 1, 1, d + " display: block;"));
        c = this.bl(b, "SpreadsheetFontControl_FontStyleLabel", "TESTID_FT_FontStyles");
        d = this.dg(c);
        c.setAttribute("style", SpreadsheetDialogUtilities.j(1, 1, 2, 1, d + " display: block;"));
        c = this.bl(b, "SpreadsheetFontControl_SizeLabel", "TESTID_FT_FontSizes");
        d = this.dg(c);
        c.setAttribute("style", SpreadsheetDialogUtilities.j(1, 1, 3, 1, d + " display: block;"));
        c = this.a9(b);
        d = this.dg(c);
        c.setAttribute("style", SpreadsheetDialogUtilities.j(2, 1, 1, 1, d));
        c = this.bb(b);
        d = this.dg(c);
        c.setAttribute("style", SpreadsheetDialogUtilities.j(2, 1, 2, 1, d));
        c = this.ba(b);
        d = this.dg(c);
        c.setAttribute("style", SpreadsheetDialogUtilities.j(2, 1, 3, 1, d));
        c = this.bl(b, "SpreadsheetFontControl_UnderlineLabel", "cmbFontUnderlineStyles");
        d = this.dg(c);
        c.setAttribute("style", SpreadsheetDialogUtilities.j(3, 1, 1, 1, d + " display: block;"));
        c = this.bl(b, "SpreadsheetFontControl_ColorLabel", "TESTID_FT_FontColor");
        d = this.dg(c);
        c.setAttribute("style", SpreadsheetDialogUtilities.j(3, 1, 2, 1, d + " display: block;"));
        c = this.bc(b);
        d = this.dg(c);
        c.setAttribute("style", SpreadsheetDialogUtilities.j(4, 1, 1, 1, d));
        let e = (f) => this.s._m = f;
        this.q = new ColorPickerProxy(this, "SpreadsheetThemeColorPickerControl_Text_Automatic", "SpreadsheetThemeColorPickerControl_Text_NoColor", true, e);
        c = this.q.m;
        b.appendChild(c);
        d = this.dg(c);
        c.setAttribute("style", SpreadsheetDialogUtilities.j(4, 1, 2, 1, d));
        this.d2();
        let f = (g) => this.s._x = this.ak.checked;
        let g = this.m(b, "TESTID_FT_NormalFont", "SpreadsheetFontControl_NormalFontLabel", Nullable$1.toNullable(Boolean_$type, this.s._x), f);
        this.ak = g.c;
        c = g.a;
        d = this.dg(c);
        c.setAttribute("style", SpreadsheetDialogUtilities.j(4, 1, 3, 1, d));
        c = this.bj(b, "SpreadsheetFontControl_Text_Effects");
        let h = c;
        d = this.dg(c);
        c.setAttribute("style", SpreadsheetDialogUtilities.j(5, 1, 1, 1, d));
        let i = (j) => this.s._aq = Nullable$1.toNullable(Boolean_$type, this.an.checked);
        g = this.m(b, "TESTID_FT_Strikethrough", "SpreadsheetFontControl_StrikethroughLabel", this.s._aq, i);
        this.an = g.c;
        c = g.a;
        h.appendChild(c);
        d = this.dg(c);
        c.setAttribute("style", d + " margin-top: .5em; margin-bottom: .5em;");
        let j = (k) => this.s._as = Nullable$1.toNullable(Boolean_$type, this.ap.checked);
        g = this.m(b, "TESTID_FT_Superscript", "SpreadsheetFontControl_SuperscriptLabel", this.s._as, j);
        this.ap = g.c;
        c = g.a;
        h.appendChild(c);
        d = this.dg(c);
        c.setAttribute("style", d + " margin-bottom: .5em;");
        let k = (l) => this.s._ar = Nullable$1.toNullable(Boolean_$type, this.ao.checked);
        g = this.m(b, "TESTID_FT_Subscript", "SpreadsheetFontControl_SubscriptLabel", this.s._ar, k);
        this.ao = g.c;
        h.appendChild(g.a);
        c = this.bj(b, "SpreadsheetFontControl_Text_Preview");
        h = c;
        d = this.dg(c);
        c.setAttribute("style", SpreadsheetDialogUtilities.j(5, 1, 2, 2, d + " overflow: hidden; "));
        c = this.bd(h);
        d = this.dg(c);
        c.setAttribute("style", d + " margin-left: 40px; ");
        return a;
    }
    aa(a) {
        this.a0 = document.createElement("div");
        this.a0.className = a.formatCellsDialogTabs;
        this.a0.id = "MainTabControl";
        let b = document.createElement("ul");
        if (this.t._a5) {
            b.appendChild(this.br("#" + "SFCD_NT", this.dh("FormatCellsDialog_NumberTabCaption")));
        }
        if (this.t._a0) {
            b.appendChild(this.br("#" + "SFCD_AT", this.dh("FormatCellsDialog_AlignmentTabCaption")));
        }
        if (this.t._a3) {
            b.appendChild(this.br("#" + "SFCD_FT", this.dh("FormatCellsDialog_FontTabCaption")));
        }
        if (this.t._a1) {
            b.appendChild(this.br("#" + "SFCD_BT", this.dh("FormatCellsDialog_BorderTabCaption")));
        }
        if (this.t._a2) {
            b.appendChild(this.br("#" + "SFCD_FILLT", this.dh("FormatCellsDialog_FillTabCaption")));
        }
        if (this.t._a6) {
            b.appendChild(this.br("#" + "SFCD_PT", this.dh("FormatCellsDialog_ProtectionTabCaption")));
        }
        this.a0.appendChild(b);
        let c = new List$1(FormatCellsDialogTab_$type, 2, 6);
        if (this.t._a5) {
            this.a0.appendChild(this.bp());
            c.add(1);
        }
        if (this.t._a0) {
            this.a0.appendChild(this.a1());
            c.add(2);
        }
        if (this.t._a3) {
            this.a0.appendChild(this.bo());
            c.add(4);
        }
        if (this.t._a1) {
            this.a0.appendChild(this.bm());
            c.add(8);
        }
        if (this.t._a2) {
            this.a0.appendChild(this.bn());
            c.add(16);
        }
        if (this.t._a6) {
            this.a0.appendChild(this.bq());
            c.add(32);
        }
        return c;
    }
    bp() {
        let a = document.createElement("div");
        a.className = this.v.css.formatCellsDialogTab;
        a.id = "SFCD_NT";
        a.setAttribute("style", "height: " + "555px" + "; ");
        let b = document.createElement("div");
        b.setAttribute("style", SpreadsheetDialogUtilities.k("1.5em 3fr 1fr 5fr 3fr", "1fr 3fr", "10px", "height: 100%; box-sizing: border-box; "));
        a.appendChild(b);
        let c = this.bl(b, "FormatCellsDialog_NumberTab_CategoryLabel", null);
        let d = this.dg(c);
        c.setAttribute("style", SpreadsheetDialogUtilities.j(1, 1, 1, 1, d));
        c = this.be(b);
        d = this.dg(c);
        c.setAttribute("style", SpreadsheetDialogUtilities.j(2, 3, 1, 1, d));
        c = this.bj(b, "FormatCellsDialog_NumberTab_SampleLabel");
        let e = c;
        d = this.dg(c);
        c.setAttribute("style", SpreadsheetDialogUtilities.j(2, 1, 2, 1, d + " overflow: hidden; "));
        c = this.bi(e);
        d = this.dg(c);
        c.setAttribute("style", d + " margin-left: 40px; ");
        c = this.bf(b);
        d = this.dg(c);
        c.setAttribute("style", SpreadsheetDialogUtilities.j(3, 1, 2, 1, d));
        if (null != this.t._n) {
            this.d9(this.as, this.t._n._y > -1);
        }
        c = this.bh(b);
        d = this.dg(c);
        c.setAttribute("style", SpreadsheetDialogUtilities.j(4, 1, 2, 1, d));
        c = this.au = this.bl(b, null, null);
        d = this.dg(c);
        c.setAttribute("style", SpreadsheetDialogUtilities.j(5, 1, 1, 2, d + " display: block;"));
        this.d8();
        return a;
    }
    bq() {
        let a = document.createElement("div");
        a.className = this.v.css.formatCellsDialogTab;
        a.id = "SFCD_PT";
        a.setAttribute("style", "height: " + "555px" + "; ");
        let b = document.createElement("div");
        b.setAttribute("style", SpreadsheetDialogUtilities.k("1em 1em 1fr", "1fr", "10px", "height: 100%; box-sizing: border-box; "));
        a.appendChild(b);
        let c = (d) => {
            let e = this.bw.checked;
            this.t._bn = Nullable$1.toNullable(Boolean_$type, this.bw.checked);
        };
        let d = this.t._bn.hasValue && true == this.t._bn.value;
        let e = this.m(b, "TESTID_PT_Locked", "FormatCellsDialog_ProtectionTab_Text_Locked", this.t._bn, c);
        this.bw = e.c;
        let f = e.a;
        let g = this.dg(f);
        f.setAttribute("style", SpreadsheetDialogUtilities.j(1, 1, 1, 1, g));
        f = this.az = this.bl(b, "FormatCellsDialog_ProtectionTab_Text_Summary", null);
        g = this.dg(f);
        f.setAttribute("style", SpreadsheetDialogUtilities.j(3, 1, 1, 1, g + " display: block;"));
        return a;
    }
    br(a, b) {
        let c = document.createElement("li");
        let d = document.createElement("a");
        d.innerText = b;
        d.setAttribute("href", a);
        c.appendChild(d);
        return c;
    }
    dw(a, b) {
        let c = this.x._worksheets$i._item(0)._getCell("A1");
        switch (b.propertyName) {
            case "IsNormalFont":
                this.ak.checked = this.s._x;
                break;
            case "Superscript":
                if (this.s._as.hasValue) {
                    this.ap.checked = this.s._as.value;
                }
                else {
                    this.ap.checked = false;
                }
                this.s._a8(c);
                break;
            case "Subscript":
                if (this.s._ar.hasValue) {
                    this.ao.checked = this.s._ar.value;
                }
                else {
                    this.ao.checked = false;
                }
                this.s._a8(c);
                break;
            case "SelectedFontName":
                this.b1.selectedIndex = this.s._ae.indexOf(this.s._ax);
                this.s._a8(c);
                break;
            case "SelectedFontStyle":
                this.b3.selectedIndex = this.s._ag.indexOf(this.s._d);
                this.s._a8(c);
                break;
            case "SelectedFontUnderlineStyle":
                for (let d = 0; d < this.s._n.length; d++) {
                    let e = EnumUtil.getEnumValue(FontUnderlineStyle_$type, (this.s._n[d]));
                    if (e == this.s._h) {
                        this.b4.selectedIndex = d;
                        break;
                    }
                }
                this.s._a8(c);
                break;
            case "SelectedFontSize":
                this.b2.selectedIndex = this.s._af.indexOf(this.s._aj);
                this.s._a8(c);
                break;
            case "Strikeout":
                if (this.s._aq.hasValue) {
                    this.an.checked = this.s._aq.value;
                }
                else {
                    this.an.checked = false;
                }
                this.s._a8(c);
                break;
            case "SelectedFontColorInfo":
                this.d2();
                this.s._a8(c);
                break;
        }
    }
    dx(a, b) {
        throw new NotSupportedException(0);
    }
    dg(a) {
        let b = a.getAttribute("style");
        if (null == b) {
            return stringEmpty();
        }
        return b;
    }
    dh(a) {
        let b = this.v._fs(a);
        b = SpreadsheetUtilities.c2(b);
        return b;
    }
    di(a, b) {
        let c = this.v._fs(a);
        c = ((() => { let d = SpreadsheetUtilities.c3(c, b); b = d.p1; return d.ret; })());
        return {
            ret: c,
            p1: b
        };
    }
    dy() {
        this.n.v();
        if (WorkbookColorInfo.l_op_Inequality(null, this.t._al)) {
            if (this.t._al.isAutomatic) {
                this.n.x();
            }
            else {
                this.n.y(this.t._al._getResolvedColor1(this.t._ag));
            }
        }
        else {
            this.n.x();
        }
    }
    dz(a = 1, b = 1) {
        throw new NotSupportedException(0);
    }
    d0() {
        this.p.v();
        if (WorkbookColorInfo.l_op_Inequality(null, this.t._am)) {
            if (this.t._am.isAutomatic) {
                this.p.x();
            }
            else {
                this.p.y(this.t._am._getResolvedColor1(this.t._ag));
            }
        }
        else {
            this.p.x();
        }
    }
    d1(a = 2, b = 1) {
        throw new NotSupportedException(0);
    }
    d2() {
        this.q.v();
        if (WorkbookColorInfo.l_op_Inequality(null, this.s._m)) {
            if (this.s._m.isAutomatic) {
                this.q.x();
            }
            else {
                this.q.y(this.s._a9);
            }
        }
        else {
            this.q.x();
        }
    }
    d3(a = 2, b = 1) {
        throw new NotSupportedException(0);
    }
    d4(a = 2, b = 1) {
        throw new NotSupportedException(0);
    }
    d5(a) {
        throw new NotSupportedException(0);
    }
    d6(a) {
        let b = typeCast(BorderLineButtonElementProxy.$, a);
        switch (b.s) {
            case 0:
                this.t._ck(0);
                break;
            case 1:
                this.t._ck(1);
                break;
            case 2:
                this.t._ck(2);
                break;
            default: break;
        }
    }
    d7(a) {
        let b = typeCast(BorderLineButtonElementProxy.$, a);
        switch (b.s) {
            case 10:
                this.t._cv(1);
                break;
            case 6:
                this.t._cv(5);
                break;
            case 3:
                this.t._cv(3);
                break;
            case 5:
                this.t._cv(7);
                break;
            case 8:
                this.t._cv(0);
                break;
            case 7:
                this.t._cv(4);
                break;
            case 9:
                this.t._cv(2);
                break;
            case 4:
                this.t._cv(6);
                break;
            default: break;
        }
    }
    d8() {
        this.d9(this.b6, this.t._n._h);
        this.d9(this.aq, this.t._n._l, 0);
        this.d9(this.as, this.t._n._y > -1);
        let a = false;
        if (false == stringIsNullOrEmpty(this.t._n._ae)) {
            a = true;
        }
        this.d9(this.av, a);
        this.au.innerText = this.t._n._ac;
        this.av.innerText = this.t._n._ae;
        this.aq.value = this.t._ce;
        if (this.t._n._h) {
            this.ec(1);
        }
    }
    d9(a, b, c = 1, d = false) {
        let e = 2;
        if (false == b) {
            e = c;
        }
        let f = EnumUtil.getName(FormatCellsDialogManager_ElementVisibility_$type, e);
        let g = null;
        let h = null;
        if (e == 0) {
            g = "none";
        }
        else if (d) {
            g = "grid";
            g = "-ms-grid";
        }
        else {
            g = "block";
        }
        let i = this.b8((a.getAttribute("style")), "display", g);
        if (false == stringIsNullOrEmpty(h)) {
            i = this.b8(i, "display", h);
        }
        i = this.b8(i, "visibility", f);
        if (e == 2) {
            i = this.b8(i, "opacity", "1");
        }
        else {
            i = this.b8(i, "opacity", "0");
        }
        a.setAttribute("style", i);
    }
    eb() {
        let a = this.t._d;
        this.h.y = a._a1;
        this.d.y = a._aw;
        this.a.y = a._ar;
        this.c.y = a._at;
        this.f.y = a._az;
        this.e.y = a._ay;
        this.g.y = a._a0;
        this.b.y = a._as;
    }
    ec(a = 0) {
        let b = this.b6.selectedIndex;
        SpreadsheetDialogUtilities.l(this.b6);
        this.b6.selectedIndex = -1;
        let c = this.t._n._w.count;
        let d = -1;
        let e = this.t._k;
        for (let f = 0; f < c; f++) {
            let g = this.t._n._w._inner[f];
            let h = document.createElement("option");
            h.innerText = g._g;
            h.setAttribute("value", g._e);
            h.setAttribute("style", stringFormat("color: {0};", g._c));
            this.b6.appendChild(h);
            if (g == e) {
                d = f;
            }
        }
        if (a == 2) {
            this.b6.selectedIndex = Math.max(0, b);
        }
        else if (a == 1 && d != -1) {
            this.b6.selectedIndex = d;
        }
    }
}
FormatCellsDialogManager.$t = markType(FormatCellsDialogManager, 'FormatCellsDialogManager');
/**
 * @hidden
 */
export class ColorPickerProxy extends Base {
    constructor(a, b, c, d, e) {
        super();
        this.e = false;
        this.g = null;
        this.k = null;
        this.h = null;
        this.i = null;
        this.l = null;
        this.j = null;
        this.d = null;
        this.o = 0;
        this.c = null;
        this.p = null;
        this.q = null;
        this.aa = new Color();
        this.b = 0;
        this.a = 0;
        this.f = false;
        this.c = a;
        this.e = d;
        this.q = a.dh(c);
        this.p = a.dh(b);
        this.d = e;
        let f = ColorPickerProxy.n.toString();
        this.o = ColorPickerProxy.n;
        ColorPickerProxy.n++;
        if (this.e) {
            this.j = document.createElement("div");
            this.j.id = "dropdown-color-picker" + f;
            this.j.setAttribute("style", "border-style: solid; border-color: gray; border-width: 1px; padding: 2px;");
            let g = (h) => this.s();
            this.c.bs.addEventListener("mousedown", g, true);
            let h = document.createElement("div");
            h.setAttribute("style", SpreadsheetDialogUtilities.k("1fr", "1fr 1em", "2px", "height: 100%; box-sizing: border-box; "));
            this.j.appendChild(h);
            let i = (j) => {
                switch (this.b) {
                    case 0: break;
                    case 2:
                        if (null != this.d) {
                            this.d(WorkbookColorInfo.automatic);
                        }
                        break;
                    case 1:
                        if (null != this.d) {
                            this.d(new WorkbookColorInfo(this.aa));
                        }
                        break;
                }
            };
            this.g = a.ab(this.r("btn-selectedcolor", f), a.w.formatCellsDialogButtons, "", i);
            this.g.disabled = true;
            let j = a.dg(this.g);
            this.g.setAttribute("style", SpreadsheetDialogUtilities.j(1, 1, 1, 1, j + " border-style: none; border-width: 0px; background: transparent; "));
            h.appendChild(this.g);
            let k = (l) => this.s();
            let l = a.w.formatCellsDialogColorPickerDropdownButton + " ui-icon-triangle-1-s" + " ui-icon";
            this.k = a.ab(this.r("btn-dropdown", f), l, "", k);
            j = a.dg(this.k);
            this.k.setAttribute("style", SpreadsheetDialogUtilities.j(1, 1, 2, 1, j + " border-style: none; height: 100%; "));
            h.appendChild(this.k);
            this.l = document.createElement("div");
            this.l.id = this.r("dropdown-content", f);
            this.l.setAttribute("style", SpreadsheetDialogUtilities.k("2em 1fr", "1fr", "0px", "height: 184px; width: 200px; box-sizing: border-box; "));
            this.j.appendChild(this.l);
            let m = (n) => {
                this.u();
                this.s();
            };
            this.h = a.ab(this.r("btn-action", f), a.w.formatCellsDialogButtons, "", m);
            j = a.dg(this.h);
            this.h.setAttribute("style", SpreadsheetDialogUtilities.j(1, 1, 1, 1, j + " border-style: solid; border-width: 1px; "));
            this.l.appendChild(this.h);
            this.i = document.createElement("div");
            this.i.id = this.r("color-picker", f);
            this.i.setAttribute("style", SpreadsheetDialogUtilities.j(2, 1, 1, 1, j));
            this.l.appendChild(this.i);
        }
        else {
            this.j = document.createElement("div");
            this.j.id = this.r("inplace-color-picker-container", f);
            this.j.setAttribute("style", SpreadsheetDialogUtilities.k("2em 1fr", "1fr", "0px", "height: 184px; width: 200px; box-sizing: border-box; "));
            let n = (o) => this.u();
            this.h = a.ab(this.r("btn-action", f), a.w.formatCellsDialogButtons, "", n);
            let o = a.dg(this.h);
            this.h.setAttribute("style", SpreadsheetDialogUtilities.j(1, 1, 1, 1, o + " border-style: solid; border-width: 1px; "));
            this.j.appendChild(this.h);
            this.i = document.createElement("div");
            this.i.id = this.r("color-picker", f);
            this.i.setAttribute("style", SpreadsheetDialogUtilities.j(2, 1, 1, 1, o));
            this.j.appendChild(this.i);
        }
    }
    get m() {
        return this.j;
    }
    t() {
        throw new NotSupportedException(0);
    }
    w(a) {
        let b = a ? "#CCE8FF" : "transparent";
        let c = this.c.b8((this.h.getAttribute("style")), "background", b);
        this.h.setAttribute("style", c);
        this.h.innerText = this.q;
        this.a = 1;
    }
    v() {
        let a = this.c.b8((this.h.getAttribute("style")), "background", "transparent");
        this.h.setAttribute("style", a);
        this.h.innerText = this.p;
        this.a = 2;
    }
    y(a) {
        let b = this.c.b8((this.g.getAttribute("style")), "background", a.colorString);
        this.g.setAttribute("style", b);
        this.g.innerText = "";
        this.b = 1;
        this.aa = a;
    }
    x() {
        let a = this.c.b8((this.g.getAttribute("style")), "background", "transparent");
        this.g.setAttribute("style", a);
        this.g.innerText = this.p;
        this.b = 2;
    }
    z() {
    }
    r(a, b) {
        return a + b;
    }
    s() {
        if (this.f) {
            this.f = false;
        }
    }
    u() {
        switch (this.a) {
            case 0: break;
            case 2:
                if (null != this.d) {
                    this.d(WorkbookColorInfo.automatic);
                }
                break;
            case 1:
                if (null != this.d) {
                    this.d(null);
                }
                break;
        }
    }
}
ColorPickerProxy.$t = markType(ColorPickerProxy, 'ColorPickerProxy');
ColorPickerProxy.n = 0;
/**
 * @hidden
 */
export class BorderPreviewSpreadsheetHelper extends Base {
    constructor(a, b, c, d, e) {
        super();
        this.c = null;
        this.a = null;
        this.j = new Color();
        this.i = new Color();
        this.b = null;
        this.b = a;
        this.c = SingleCellSpreadsheetPreviewHelper.a(b, c, d, e, false);
        this.a = new CellBordersPreviewControlHelper(this.c, a._d, b, c, a._ag, 4);
    }
    get k() {
        return this.i;
    }
    set k(a) {
        this.i = a;
        for (let b = 0; b < 4; b++) {
            for (let c = 0; c < 4; c++) {
                this.c._worksheets$i._item(0)._rows$i.item(b)._cells$i.item(c).cellFormat.fill = CellFill._createSolidFill(new WorkbookColorInfo(a));
            }
        }
    }
    get l() {
        return this.j;
    }
    set l(a) {
        this.j = a;
        for (let b = 0; b < 4; b++) {
            for (let c = 0; c < 4; c++) {
                this.c._worksheets$i._item(0)._rows$i.item(b)._cells$i.item(c).cellFormat.font.colorInfo = new WorkbookColorInfo(a);
            }
        }
    }
    get f() {
        return this.a.s;
    }
    get g() {
        return this.a.t;
    }
    get d() {
        return this.c;
    }
    e(a, b, c) {
        return this.a.f(a, b, c);
    }
    h(a, b, c) {
        return this.a.u(a, b, c);
    }
}
BorderPreviewSpreadsheetHelper.$t = markType(BorderPreviewSpreadsheetHelper, 'BorderPreviewSpreadsheetHelper');
/**
 * @hidden
 */
export class ColorSortingCriteriaControl extends Base {
    constructor(a, b) {
        super();
        this.p = 50;
        this.o = 15;
        this.r = "<img src='${image}' width='{0}px' height='{1}px'/><span>${displayText}</span>";
        this.q = "<img src='{0}' width='{1}px' height='{2}px' /><span class='{4}'>{3}</span>";
        this.d = new WorkbookColorInfo(Colors.a);
        this.c = null;
        this.a = null;
        this.b = null;
        this.i = null;
        this.m = null;
        this.n = null;
        this.e = true;
        this.f = new Dictionary$2(ColorSortingCriteriaControl_ColorSortingCriteriaElementPart_$type, HTMLElement.$, 1, 3);
        this.a = a;
        this.c = b;
        this.s();
    }
    k() {
        let a;
        this.m = document.createElement("div");
        this.m.id = "cboColor";
        a = SpreadsheetDialogUtilities.j(1, 1, 1, 1, "display: block; width: 100%;");
        this.m.setAttribute("style", a);
        return this.m;
    }
    l() {
        let a;
        let b = this.a.css;
        this.n = document.createElement("select");
        this.n.id = "cboDirection";
        a = SpreadsheetDialogUtilities.j(1, 1, 2, 1, "display: block; width: 100%;");
        this.n.setAttribute("style", a);
        this.ab();
        let c = (d) => {
            if (this.e) {
                return;
            }
            let e = EnumUtil.getEnumValue(SortDirectionWithCustomListOptions_$type, SpreadsheetDialogUtilities.i(this.n, SortDirectionWithCustomListOptions_$type));
            this.b._e = e;
        };
        let d = c;
        this.n.addEventListener("change", d, false);
        return this.n;
    }
    s() {
        let a = this.a.css;
        this.i = document.createElement("div");
        this.i.id = "colorSortingCriteriaControl";
        let b = document.createElement("div");
        b.id = "colorSortingCriteriaControlInnerGrid";
        this.i.appendChild(b);
        let c = SpreadsheetDialogUtilities.k("auto", "1fr 1fr", "3px");
        b.setAttribute("style", c);
        let d = this.k();
        let e = this.l();
        this.f.item(0, d);
        this.f.item(1, e);
        b.appendChild(d);
        b.appendChild(e);
    }
    static g(a, b) {
        let c = document.createElement("canvas");
        c.width = a;
        c.height = b;
        return c;
    }
    h(a) {
        let b;
        let c;
        let d = this.v(b, c);
        b = d.p0;
        c = d.p1;
        let e = null;
        switch (this.b._h) {
            case 1:
                let f = typeCast(CellFill.$, a.dataValue);
                if (null != f) {
                    e = SpreadsheetUtilities.ce(this.a, f, b, c, this.d);
                }
                break;
            case 2:
                let g = typeCast(WorkbookColorInfo.$, a.dataValue);
                if (WorkbookColorInfo.l_op_Inequality(null, g)) {
                    e = SpreadsheetUtilities.cg(this.a, g, b, c, this.d);
                }
                break;
            case 3:
                let h = typeCast(Tuple$2.$.specialize(FormatConditionIconSet_$type, Nullable$1.$.specialize(Number_$type)), a.dataValue);
                if (null != h) {
                    let i = h.c;
                    let j = h.d;
                    let k = SpreadsheetUtilities.am(i, j);
                    e = SpreadsheetUtilities.cf(this.a, k, b, c);
                }
                break;
            case 0:
            case 4: break;
            default: break;
        }
        let l = e != null ? e.getNativeElement() : null;
        if (null == l) {
            l = ColorSortingCriteriaControl.g(b, c);
        }
        {
            l.style.verticalAlign = "middle";
            l.style.marginRight = "5px";
        }
        return l;
    }
    u(a) {
        switch (a) {
            case "cboColor":
                this.m.focus();
                break;
            default: break;
        }
    }
    v(a, b) {
        switch (this.b._h) {
            case 4:
            case 0:
                a = 0;
                b = 0;
                break;
            case 1:
            case 2:
                a = this.p;
                b = this.o;
                break;
            case 3:
                a = 16;
                b = 16;
                break;
            default:
                a = 0;
                b = 0;
                break;
        }
        return {
            p0: a,
            p1: b
        };
    }
    w(a, b, c, d) {
        b = null;
        c = null;
        d = null;
        if (null != a) {
            let e = (a.count());
            if (e == 1) {
                let f = a[0];
                let g = f.data;
                b = g.dataValue;
                c = (g.displayText);
                d = g.image;
            }
        }
        return {
            p1: b,
            p2: c,
            p3: d
        };
    }
    x() {
    }
    y(a) {
        this.b = a;
        this.n.value = EnumUtil.getName(SortDirectionWithCustomListOptions_$type, a._e);
        let b = this.b;
        b.propertyChanged = delegateCombine(b.propertyChanged, runOn(this, this.aa));
        this.ac();
        let c = this.b._u();
        this.z(c);
        this.ad();
        this.e = false;
    }
    z(a) {
    }
    ab() {
        SpreadsheetDialogUtilities.n(this.n, this.c._an);
    }
    ac() {
    }
    ad() {
    }
    ae(a) {
    }
    get j() {
        return this.i;
    }
    t(a, b) {
        let c = b.items;
        let d;
        let e;
        let f;
        let g = this.w(c, d, e, f);
        d = g.p1;
        e = g.p2;
        f = g.p3;
        this.b._aa = d;
        this.ae(c);
    }
    aa(a, b) {
        switch (b.propertyName) {
            case "ColorSortingCriteriaListItems":
                this.ac();
                break;
        }
    }
}
ColorSortingCriteriaControl.$t = markType(ColorSortingCriteriaControl, 'ColorSortingCriteriaControl');
/**
 * @hidden
 */
export class SortCriteriaRow extends Base {
    constructor(a, b, c) {
        super();
        this._d = null;
        this._b = null;
        this._c = null;
        this._k = null;
        this._m = null;
        this._n = null;
        this._g = null;
        this._a = null;
        this._f = new Dictionary$2(SortCriteriaRow_RowElementPart_$type, HTMLElement.$, 1, 3);
        this._o = null;
        this._b = a;
        this._d = b;
        this._c = c;
        this._p();
        let d = this._c;
        d.propertyChanged = delegateCombine(d.propertyChanged, runOn(this, this._t));
    }
    _h() {
        let a;
        let b = this._b.css;
        let c = document.createElement("div");
        c.id = "pnlColumn";
        let d = document.createElement("div");
        d.id = "pnlColumnContentsGrid";
        a = SpreadsheetDialogUtilities.k("auto", "auto 1fr", "3px");
        d.setAttribute("style", a);
        c.appendChild(d);
        this._k = document.createElement("label");
        this._k.id = "lblLabel";
        a = SpreadsheetDialogUtilities.j(1, 1, 1, 1, "display: block; ");
        this._k.setAttribute("style", a);
        this._k.innerText = this._c._af;
        d.appendChild(this._k);
        this._m = document.createElement("select");
        this._m.id = "cbCombo";
        a = SpreadsheetDialogUtilities.j(1, 1, 2, 1, "display: block; width: 100%;");
        this._m.setAttribute("style", a);
        this._y(false);
        d.appendChild(this._m);
        let e = (f) => {
            let g = SpreadsheetDialogUtilities.h(this._m);
            this._c._t = Convert.toInt321(g);
        };
        let f = e;
        this._m.addEventListener("change", f, false);
        return c;
    }
    _p() {
        let a = this._b.css;
        this._f.item(0, this._h());
        this._f.item(1, this._j());
        this._f.item(2, this._i());
        this._x();
        this._aa();
        this._u();
    }
    _i() {
        let a;
        let b = this._b.css;
        this._g = document.createElement("div");
        this._g.id = "pnlSortCriteria";
        let c = document.createElement("div");
        this._g.id = "orderElementInnerGrid";
        a = SpreadsheetDialogUtilities.k("1fr", "1fr", "0px", "width:100%; height:100%");
        c.setAttribute("style", a);
        this._g.appendChild(c);
        this._n = document.createElement("select");
        this._n.id = "cboSortDirection";
        a = SpreadsheetDialogUtilities.j(1, 1, 1, 1, "width:100%; height:100%");
        this._n.setAttribute("style", a);
        this._ab(false);
        let d = (e) => {
            let f = EnumUtil.getEnumValue(SortDirectionWithCustomListOptions_$type, SpreadsheetDialogUtilities.i(this._n, SortDirectionWithCustomListOptions_$type));
            this._c._e = f;
        };
        let e = d;
        this._n.addEventListener("change", e, false);
        this._a = new ColorSortingCriteriaControl(this._b, this._d);
        let f = this._a.j;
        f.id = "colorSortingCriteriaControl";
        f.setAttribute("style", a);
        c.appendChild(this._n);
        c.appendChild(f);
        return this._g;
    }
    _j() {
        let a = this._b.css;
        this._o = document.createElement("select");
        this._o.id = "cboSortType";
        SpreadsheetDialogUtilities.n(this._o, this._d._ap);
        let b = (c) => {
            if (null != this._o.value) {
                let d = EnumUtil.getEnumValue(SpreadsheetSortDialogConditionType_$type, SpreadsheetDialogUtilities.i(this._o, SpreadsheetSortDialogConditionType_$type));
                this._c._g = d;
            }
        };
        let c = b;
        this._o.addEventListener("change", c, false);
        return this._o;
    }
    _q(a) {
        switch (a) {
            case "cboColor":
                this._a.u(a);
                break;
            default: break;
        }
    }
    _r() {
        this._a.x();
        this._s(this._c);
        this._z();
    }
    _s(a) {
        this._o.value = EnumUtil.getName(SpreadsheetSortDialogConditionType_$type, a._g);
        this._m.value = a._t.toString();
        switch (a._g) {
            case 4: break;
            case 0:
                this._n.value = EnumUtil.getName(SortDirectionWithCustomListOptions_$type, a._e);
                break;
            case 1:
            case 2:
            case 3:
                this._n.value = EnumUtil.getName(SortDirectionWithCustomListOptions_$type, (0));
                break;
        }
        this._a.y(a);
    }
    _u() {
        let a = this._b.css;
        let b = new StringBuilder(0);
        b.l(a.sortDialogSortConditionRow);
        if (this._e) {
            b.l(" ");
            b.l(a.sortDialogSortConditionActiveRow);
        }
        this._item(0).className = b.toString();
    }
    _v() {
        this._a.ab();
    }
    _w() {
        this._a.ac();
    }
    _x() {
        let a;
        a = SpreadsheetDialogUtilities.j(this._c._w + 1, 1, 1, 1, "display: block; width: 100%;");
        this._item(0).setAttribute("style", a);
        a = SpreadsheetDialogUtilities.j(this._c._w + 1, 1, 2, 1, "display: block; width: 100%;");
        this._item(1).setAttribute("style", a);
        a = SpreadsheetDialogUtilities.j(this._c._w + 1, 1, 3, 1, "display: block; width: 100%;");
        this._item(2).setAttribute("style", a);
    }
    _y(a) {
        let b = SpreadsheetDialogUtilities.h(this._m);
        SpreadsheetDialogUtilities.n(this._m, this._d._b);
        if (a) {
            this._m.value = b;
        }
    }
    _z() {
        this._k.innerText = this._c._af;
    }
    _aa() {
        let a = this._c._h;
        switch (a) {
            case 0:
                this._n.style.visibility = "visible";
                this._a.j.style.visibility = "hidden";
                break;
            case 1:
            case 2:
            case 3:
            case 4:
                this._n.style.visibility = "hidden";
                this._a.j.style.visibility = "visible";
                break;
        }
    }
    _ab(a) {
        let b = SpreadsheetDialogUtilities.h(this._n);
        SpreadsheetDialogUtilities.n(this._n, this._c._r);
        if (a) {
            this._n.value = b;
        }
    }
    _item(a) {
        return this._f.item(a);
    }
    get _e() {
        return this._c._m;
    }
    getEnumerator() {
        return new SortCriteriaRow_SortCriteriaRowEnumerator(this);
    }
    getEnumeratorObject() {
        return new SortCriteriaRow_SortCriteriaRowEnumerator(this);
    }
    _t(a, b) {
        switch (b.propertyName) {
            case "SortByLabelText":
                this._z();
                break;
            case "SortConditionType":
                this._aa();
                this._ab(false);
                this._w();
                break;
            case "SortDirection":
                this._n.value = EnumUtil.getName(SortDirectionWithCustomListOptions_$type, this._c._e);
                break;
            case "Column":
                this._ab(true);
                this._w();
                break;
        }
    }
}
SortCriteriaRow.$t = markType(SortCriteriaRow, 'SortCriteriaRow', Base.$, [IEnumerable$1_$type.specialize(HTMLElement.$)]);
/**
 * @hidden
 */
export class SortCriteriaRow_SortCriteriaRowEnumerator extends Base {
    constructor(a) {
        super();
        this._a = null;
        this._b = -1;
        this._a = a;
    }
    get current() {
        return this._a._item(this._b);
    }
    get currentObject() {
        return this._a._item(this._b);
    }
    dispose() {
    }
    moveNext() {
        this._b++;
        return (this._b < this._a._f.count);
    }
    reset() {
        this._b = 0;
    }
}
SortCriteriaRow_SortCriteriaRowEnumerator.$t = markType(SortCriteriaRow_SortCriteriaRowEnumerator, 'SortCriteriaRow_SortCriteriaRowEnumerator', Base.$, [IEnumerator_$type, IEnumerator$1_$type.specialize(HTMLElement.$)]);
/**
 * @hidden
 */
export class SortOptionsDialogManager extends Base {
    constructor(a, b, c) {
        super();
        this.c = null;
        this.d = null;
        this.b = null;
        this.a = null;
        this.h = null;
        this.e = null;
        this.g = null;
        this.f = null;
        this.b = a;
        this.c = b;
        this.h = c;
    }
    k() {
        this.c._ab = this.e.checked;
        if (this.f.checked) {
            this.c._p = 1;
        }
        else {
            this.c._p = 0;
        }
    }
    m() {
        let a = this.b.css;
        this.d = document.createElement("div");
        this.d.className = a.sortDialog;
        this.d.id = "SortOptionsDialog_Main_Content_Element";
        this.l(a);
        this.o(a);
        this.n(a);
    }
    l(a) {
        let b;
        let c = document.createElement("div");
        c.className = a.sortOptionsDialogCaseSensitiveCheckboxArea;
        let d;
        let e = ((() => { let f = this.j("SortOptionsDialog_CaseSensitive", b); b = f.p1; return f.ret; })());
        let f = ((() => { let g = SpreadsheetDialogUtilities.c("chkCaseSensitive", e, b, d); d = g.p3; return g.ret; })());
        this.e = d;
        c.appendChild(f);
        this.d.appendChild(c);
    }
    o(a) {
        let b;
        let c = document.createElement("div");
        c.className = a.sortOptionsDialogOrientationArea;
        this.d.appendChild(c);
        let d = document.createElement("label");
        d.id = "lblOrientation";
        d.innerText = ((() => { let e = this.j("SortOptionsDialog_Orientation", b); b = e.p1; return e.ret; })());
        d.accessKey = b;
        c.appendChild(d);
        let e = document.createElement("br");
        c.appendChild(e);
        let f;
        let g = ((() => { let h = this.j("SortOptionsDialog_SortTopToBottom", b); b = h.p1; return h.ret; })());
        let h = ((() => { let i = SpreadsheetDialogUtilities.d("radSortTopToBottom", "sortOrientation", g, b, f); f = i.p4; return i.ret; })());
        this.g = f;
        c.appendChild(h);
        e = document.createElement("br");
        c.appendChild(e);
        let i;
        let j = ((() => { let k = this.j("SortOptionsDialog_SortLeftToRight", b); b = k.p1; return k.ret; })());
        let k = ((() => { let l = SpreadsheetDialogUtilities.d("radSortLeftToRight", "sortOrientation", j, b, i); i = l.p4; return l.ret; })());
        this.f = i;
        c.appendChild(k);
        this.f.disabled = !this.c._t;
        e = document.createElement("br");
        c.appendChild(e);
        this.d.appendChild(c);
    }
    n(a) {
        let b;
        let c = document.createElement("div");
        c.className = a.sortOptionsDialogOkCancelButtonsArea;
        let d = SpreadsheetDialogUtilities.a();
        let e = (f) => {
            this.k();
            this.p();
        };
        let f = e;
        d.id = "btnOK";
        d.addEventListener("click", f, false);
        d.innerText = ((() => { let g = this.j("SortOptionsDialog_OK", b); b = g.p1; return g.ret; })());
        d.accessKey = b;
        let g = SpreadsheetDialogUtilities.a();
        let h = (i) => this.p();
        let i = h;
        g.id = "btnCancel";
        g.addEventListener("click", i, false);
        g.innerText = ((() => { let j = this.j("SortOptionsDialog_Cancel", b); b = j.p1; return j.ret; })());
        g.accessKey = b;
        c.appendChild(d);
        c.appendChild(g);
        this.d.appendChild(c);
    }
    p() {
        this.a.close(false);
    }
    i(a) {
        let b = this.b._fs(a);
        b = SpreadsheetUtilities.c2(b);
        return b;
    }
    j(a, b) {
        let c = this.b._fs(a);
        c = ((() => { let d = SpreadsheetUtilities.c3(c, b); b = d.p1; return d.ret; })());
        return {
            ret: c,
            p1: b
        };
    }
    q() {
        this.e.checked = this.c._ab;
        switch (this.c._p) {
            case 1:
                this.f.checked = true;
                break;
            case 0:
                this.g.checked = true;
                break;
        }
    }
    r() {
        this.m();
        this.q();
        let a = this.d;
        let b = this.b._fs("SortOptionsDialog_Title");
        let c = () => SpreadsheetUtilities.d7(this.h);
        this.a = this.b._q(a, b, c);
    }
}
SortOptionsDialogManager.$t = markType(SortOptionsDialogManager, 'SortOptionsDialogManager');
/**
 * @hidden
 */
export class SortDialogManager extends Base {
    constructor(a, b) {
        super();
        this.e = null;
        this.r = null;
        this.d = null;
        this.c = null;
        this.b = null;
        this.v = Nullable$1.toNullable(Number_$type, null);
        this.g = new List$1(SortCriteriaRow.$, 0);
        this.m = null;
        this.l = null;
        this.s = null;
        this.o = null;
        this.q = null;
        this.p = null;
        this.i = null;
        this.h = null;
        this.k = null;
        this.j = null;
        this.n = null;
        this.d = a;
        this.e = b;
        let c = this.e;
        c._activeRowIndexChanged = delegateCombine(c._activeRowIndexChanged, runOn(this, this.am));
        let d = this.e;
        d.propertyChanged = delegateCombine(d.propertyChanged, runOn(this, this.an));
    }
    get u() {
        if (nullableEquals(null, this.v)) {
            this.v = Nullable$1.toNullable(Number_$type, SpreadsheetDialogUtilities.g());
        }
        return this.v.value;
    }
    get y() {
        return stringFormat("{0}px", this.u);
    }
    t(a) {
        let b = this.g.count;
        this.ag(b, a);
        return b;
    }
    f() {
        let a = false;
        let b = null;
        this.d._gi(43, () => a = ((() => { let c = this.e._u(b); b = c.p0; return c.ret; })()));
        if (false == a) {
            if (null == b) {
                return false;
            }
            let c = b.b;
            if (-1 != c) {
                this.e._ax = Nullable$1.toNullable(Number_$type, c);
                switch (b.d) {
                    case "Cell Color":
                    case "Font Color":
                    case "Conditional Formatting Icon":
                        this.g._inner[c]._q("cboColor");
                        break;
                    default: break;
                }
            }
            alert(b.c);
        }
        return a;
    }
    z() {
        let a = this.d.css;
        this.r = document.createElement("div");
        this.r.className = a.sortDialog;
        this.r.id = "SortDialog_Main_Content_Element";
        this.ad(a);
        this.ac(a);
        this.ab(a);
        this.aa(a);
    }
    ad(a) {
        let b;
        let c = document.createElement("div");
        c.className = a.sortDialogTopButtonsArea;
        this.r.appendChild(c);
        let d = SpreadsheetDialogUtilities.a();
        d.className = a.sortDialogAddLevelButton;
        let e = (f) => this.e._f();
        let f = e;
        d.id = "btnAddLevel";
        d.addEventListener("click", f, false);
        d.innerText = ((() => { let g = this.x("SortDialog_AddLevel", b); b = g.p1; return g.ret; })());
        d.accessKey = b;
        this.i = SpreadsheetDialogUtilities.a();
        this.i.className = a.sortDialogDeleteLevelButton;
        let g = (h) => this.e._bv();
        let h = g;
        this.i.id = "btnDeleteLevel";
        this.i.addEventListener("click", h, false);
        this.i.innerText = ((() => { let i = this.x("SortDialog_DeleteLevel", b); b = i.p1; return i.ret; })());
        this.i.accessKey = b;
        this.h = SpreadsheetDialogUtilities.a();
        this.h.className = a.sortDialogCopyLevelButton;
        let i = (j) => this.e._bu();
        let j = i;
        this.h.id = "btnCopyLevel";
        this.h.addEventListener("click", j, false);
        this.h.innerText = ((() => { let k = this.x("SortDialog_CopyLevel", b); b = k.p1; return k.ret; })());
        this.h.accessKey = b;
        this.k = SpreadsheetDialogUtilities.a();
        this.k.className = a.sortDialogMoveUpButton;
        let k = (l) => this.e._b0();
        let l = k;
        this.k.id = "btnMoveUp";
        this.k.addEventListener("click", l, false);
        this.k.innerText = ((() => { let m = this.x("SortDialog_MoveUp", b); b = m.p1; return m.ret; })());
        this.k.accessKey = b;
        this.j = SpreadsheetDialogUtilities.a();
        this.j.className = a.sortDialogMoveDownButton;
        let m = (n) => this.e._bz();
        let n = m;
        this.j.id = "btnMoveDown";
        this.j.addEventListener("click", n, false);
        this.j.innerText = ((() => { let o = this.x("SortDialog_MoveDown", b); b = o.p1; return o.ret; })());
        this.j.accessKey = b;
        let o = SpreadsheetDialogUtilities.a();
        let p = (q) => this.ak();
        let q = p;
        o.id = "btnOptions";
        o.addEventListener("click", q, false);
        o.innerText = ((() => { let r = this.x("SortDialog_Options", b); b = r.p1; return r.ret; })());
        o.accessKey = b;
        let r = ((() => { let s = this.x("SortDialog_MyDataHasHeaders", b); b = s.p1; return s.ret; })());
        this.n = ((() => { let s = SpreadsheetDialogUtilities.c("chkDataHasHeaders", r, b, this.s); this.s = s.p3; return s.ret; })());
        this.n.className = a.sortDialogMyDataHasHeaderCheckBox;
        let s = (t) => this.e._ah = this.s.checked;
        let t = s;
        this.s.addEventListener("change", t, false);
        c.appendChild(d);
        c.appendChild(this.i);
        c.appendChild(this.h);
        c.appendChild(this.k);
        c.appendChild(this.j);
        c.appendChild(o);
        c.appendChild(this.n);
    }
    ac(a) {
        let b = document.createElement("div");
        this.m = document.createElement("div");
        this.m.id = "grdHeaders";
        let c = stringFormat("margin-right:{0};", this.y);
        b.setAttribute("style", c);
        this.o = document.createElement("label");
        this.o.className = a.sortDialogSortConditionsGridHeader;
        this.aq();
        this.o.setAttribute("style", SpreadsheetDialogUtilities.j(1, 1, 1, 1, "display: block; "));
        this.q = document.createElement("label");
        this.q.className = a.sortDialogSortConditionsGridHeader;
        this.q.innerText = this.e._bi;
        this.q.setAttribute("style", SpreadsheetDialogUtilities.j(1, 1, 2, 1, "display: block; "));
        this.p = document.createElement("label");
        this.p.className = a.sortDialogSortConditionsGridHeader;
        this.p.innerText = this.e._bf;
        this.p.setAttribute("style", SpreadsheetDialogUtilities.j(1, 1, 3, 1, "display: block; "));
        this.m.appendChild(this.o);
        this.m.appendChild(this.q);
        this.m.appendChild(this.p);
        b.appendChild(this.m);
        this.r.appendChild(b);
    }
    ab(a) {
        let b = new StringBuilder(0);
        let c = document.createElement("div");
        c.id = "divScroll";
        b.l("overflow-y:scroll;");
        b.l("height:200px;");
        c.setAttribute("style", b.toString());
        this.l = document.createElement("div");
        this.l.id = "grdSortConditions";
        c.appendChild(this.l);
        this.r.appendChild(c);
    }
    aa(a) {
        let b;
        let c = document.createElement("div");
        c.className = a.sortDialogOkCancelButtonsArea;
        let d = SpreadsheetDialogUtilities.a();
        let e = (f) => {
            let g = this.f();
            if (g) {
                this.af();
            }
        };
        let f = e;
        d.id = "btnOK";
        d.addEventListener("click", f, false);
        d.innerText = ((() => { let g = this.x("SortDialog_OK", b); b = g.p1; return g.ret; })());
        d.accessKey = b;
        let g = SpreadsheetDialogUtilities.a();
        let h = (i) => this.af();
        let i = h;
        g.id = "btnCancel";
        g.addEventListener("click", i, false);
        g.innerText = ((() => { let j = this.x("SortDialog_Cancel", b); b = j.p1; return j.ret; })());
        g.accessKey = b;
        c.appendChild(d);
        c.appendChild(g);
        this.r.appendChild(c);
    }
    ae() {
        for (let a = this.g.count - 1; a >= 0; a--) {
            let b = this.g._inner[a];
            this.ai(b);
        }
        this.g.clear();
    }
    af() {
        this.c.close(false);
    }
    a(a, b) {
        for (let c of fromEnum(this.g)) {
            if (c._item(b) == a) {
                return c;
            }
        }
        return null;
    }
    w(a) {
        let b = this.d._fs(a);
        b = SpreadsheetUtilities.c2(b);
        return b;
    }
    x(a, b) {
        let c = this.d._fs(a);
        c = ((() => { let d = SpreadsheetUtilities.c3(c, b); b = d.p1; return d.ret; })());
        return {
            ret: c,
            p1: b
        };
    }
    ag(a, b) {
        let c = new SortCriteriaRow(this.d, this.e, b);
        let d = a * 3;
        let e = c._item(0);
        SpreadsheetDialogUtilities.m(this.l, e, d);
        d++;
        let f = c._item(1);
        SpreadsheetDialogUtilities.m(this.l, f, d);
        d++;
        let g = c._item(2);
        SpreadsheetDialogUtilities.m(this.l, g, d);
        this.g.insert(a, c);
        c._r();
    }
    ah(a, b) {
        if (a.hasValue) {
            let c = a.value;
            if (c >= 0 && c < this.g.count) {
                this.g._inner[c]._u();
            }
        }
        if (b.hasValue) {
            let d = b.value;
            this.g._inner[d]._u();
        }
        this.ap();
    }
    ai(a) {
        for (let b of fromEnum(a)) {
            this.l.removeChild(b);
        }
        this.g.remove(a);
    }
    ao() {
        this.ae();
        let a = this.e._ar;
        for (let b of fromEnum(a)) {
            this.t(b);
        }
        this.ah(Nullable$1.toNullable(Number_$type, null), this.e._ax);
    }
    ap() {
        this.k.disabled = !this.e._z;
        this.j.disabled = !this.e._y;
        this.h.disabled = !this.e._w;
        this.i.disabled = !this.e._x;
    }
    aq() {
        this.o.innerText = this.e._a3;
    }
    ar() {
        this.s.disabled = !this.e._aj;
    }
    aj(a) {
        this.z();
        let b = this.r;
        let c = this.d._fs("SortDialog_Title");
        let d = runOn(this, this.as);
        window.addEventListener("focus", d, true);
        let e = () => {
            window.removeEventListener("focus", d, true);
            if (a != null) {
                a();
            }
            this.d._v.focus();
        };
        this.c = this.d._q(b, c, e);
        this.s.checked = this.e._ah;
        this.s.disabled = !this.e._aj;
        this.ao();
        let f = this.e._ar;
        f.collectionChanged = delegateCombine(f.collectionChanged, runOn(this, this.al));
        let g = this.r.innerHTML;
    }
    ak() {
        let a = document.activeElement;
        this.b = new SortOptionsDialogManager(this.d, this.e, a);
        this.b.r();
    }
    al(a, b) {
        switch (b.action) {
            case 0:
                let c = b.newItems.item(0);
                this.ag(b.newStartingIndex, c);
                for (let d = b.newStartingIndex; d < this.g.count; d++) {
                    this.g._inner[d]._x();
                }
                break;
            case 1:
                this.ai(this.g._inner[b.oldStartingIndex]);
                for (let e = b.oldStartingIndex; e < this.g.count; e++) {
                    this.g._inner[e]._x();
                }
                break;
            case 4:
                this.ao();
                break;
        }
    }
    am(a, b) {
        this.ah(b._oldActiveRowIndex, b._newActiveRowIndex);
    }
    an(a, b) {
        switch (b.propertyName) {
            case "SortOrientation":
                this.aq();
                for (let c of fromEnum(this.g)) {
                    c._y(false);
                    c._v();
                    c._ab(true);
                    c._w();
                }
                break;
            case "ColumnColumnHeaderText":
                this.aq();
                break;
            case "MyDataHasHeadersEnabled":
                this.ar();
                break;
            case "MyDataHasHeaders":
                for (let d of fromEnum(this.g)) {
                    d._y(true);
                }
                break;
        }
    }
    as(a) {
        let b = document.activeElement;
        if (null == b) {
            return;
        }
        let c = b;
        let d = null;
        let t1 = c.id;
        L0: while (true) {
            switch (t1) {
                case "pnlColumn":
                    d = this.a(c, 0);
                    break;
                case "cboSortType":
                    d = this.a(c, 1);
                    break;
                case "pnlSortCriteria":
                    d = this.a(c, 2);
                    break;
                case "cbCombo":
                case "lvlLabel":
                case "cboColumn":
                    c = SpreadsheetDialogUtilities.e(c, "pnlColumn");
                    if (null != c) {
                        t1 = "pnlColumn";
                        continue L0;
                    }
                    break;
                case "cboSortDirection":
                case "colorSortingCriteriaControl":
                case "cboColor":
                case "cboDirection":
                    c = SpreadsheetDialogUtilities.e(c, "pnlSortCriteria");
                    if (null != c) {
                        t1 = "pnlSortCriteria";
                        continue L0;
                    }
                    break;
            }
            break;
        }
        if (null != d) {
            let e = this.g.indexOf(d);
            this.e._ax = Nullable$1.toNullable(Number_$type, e);
        }
    }
}
SortDialogManager.$t = markType(SortDialogManager, 'SortDialogManager');
/**
 * @hidden
 */
export class TopOrBottomDialogManager extends Base {
    constructor(a, b) {
        super();
        this.a = null;
        this.f = null;
        this.c = null;
        this.b = null;
        this.h = null;
        this.g = null;
        this.i = null;
        this.c = a;
        this.a = b;
    }
    m() {
        let a = this.e();
        let b = this.j();
        let c = this.d();
        this.c._gi(43, () => this.a.q(a, c, b));
    }
    n() {
        let a;
        let b = this.c.css;
        this.f = document.createElement("div");
        this.f.className = b.topOrBottomDialog;
        this.f.id = "TopOrBottomDialog_Main_Content_Element";
        let c = document.createElement("div");
        c.innerText = this.k("TopOrBottomDialog_Show");
        c.className = b.topOrBottomDialogShow;
        this.f.appendChild(c);
        let d = document.createElement("div");
        d.className = b.topOrBottomDialogInputArea;
        this.f.appendChild(d);
        this.h = document.createElement("select");
        this.h.id = "cboOperator";
        d.appendChild(this.h);
        this.g = document.createElement("input");
        this.g.id = "nudValue";
        d.appendChild(this.g);
        this.i = document.createElement("select");
        this.i.id = "cboType";
        d.appendChild(this.i);
        let e = document.createElement("div");
        e.className = b.topOrBottomDialogButtons;
        let f = SpreadsheetDialogUtilities.a();
        let g = (h) => {
            this.m();
            this.o();
        };
        let h = g;
        f.id = "btnOK";
        f.addEventListener("click", h, false);
        f.innerText = ((() => { let i = this.l("TopOrBottomDialog_OK", a); a = i.p1; return i.ret; })());
        f.accessKey = a;
        let i = SpreadsheetDialogUtilities.a();
        let j = (k) => this.o();
        let k = j;
        i.id = "btnCancel";
        i.addEventListener("click", k, false);
        i.innerText = ((() => { let l = this.l("TopOrBottomDialog_Cancel", a); a = l.p1; return l.ret; })());
        i.accessKey = a;
        e.appendChild(f);
        e.appendChild(i);
        this.f.appendChild(e);
        let l = TopOrBottomDialogViewModel.k(this.c);
        for (let m of fromEnum(l)) {
            let n = document.createElement("option");
            n.innerText = m.displayText;
            n.setAttribute("value", m.dataValue);
            this.h.appendChild(n);
        }
        let o = TopOrBottomDialogViewModel.l(this.c);
        for (let p of fromEnum(o)) {
            let q = document.createElement("option");
            q.innerText = p.displayText;
            q.setAttribute("value", p.dataValue);
            this.i.appendChild(q);
        }
        this.p(this.g);
        this.h.value = this.a.j.toString();
        this.g.value = this.a.n.toString();
        this.i.value = this.a.h.toString();
    }
    o() {
        this.b.close(false);
    }
    p(a) {
    }
    k(a) {
        let b = this.c._fs(a);
        b = SpreadsheetUtilities.c2(b);
        return b;
    }
    l(a, b) {
        let c = this.c._fs(a);
        c = ((() => { let d = SpreadsheetUtilities.c3(c, b); b = d.p1; return d.ret; })());
        return {
            ret: c,
            p1: b
        };
    }
    e() {
        let a = this.h;
        let b = SpreadsheetDialogUtilities.h(a);
        if (null == b) {
            return true;
        }
        let c = b.toString();
        if (stringIsNullOrEmpty(c)) {
            return true;
        }
        let d = false;
        let e = tryParseBool(c, d);
        d = e.p1;
        return d;
    }
    d() {
        let a = this.i;
        let b = SpreadsheetDialogUtilities.h(a);
        if (null == b) {
            return true;
        }
        let c = b.toString();
        if (stringIsNullOrEmpty(c)) {
            return true;
        }
        let d = false;
        let e = tryParseBool(c, d);
        d = e.p1;
        return d;
    }
    j() {
        let a = this.g.value;
        if (null == a) {
            return 10;
        }
        let b = 10;
        if (typeof a === 'number') {
            b = typeGetValue(a);
        }
        else {
            let c = tryParseInt32_1(a.toString(), b);
            b = c.p1;
        }
        return b;
    }
    q() {
        this.n();
        let a = this.f;
        let b = this.c._fs("TopOrBottomDialog_Title");
        this.b = this.c._r(a, b);
    }
}
TopOrBottomDialogManager.$t = markType(TopOrBottomDialogManager, 'TopOrBottomDialogManager');
/**
 * @hidden
 */
export class CellBordersPreviewControlHelper extends Base {
    constructor(a, b, c, d, e, f) {
        super();
        this.r = 0;
        this.q = 0;
        this.p = 0;
        this.o = 0;
        this.a = null;
        this.e = null;
        this.d = null;
        this.b = null;
        this.i = 0;
        this.h = 0;
        this.k = 0;
        this.m = 0;
        this.j = 0;
        this.l = 0;
        this.n = 0;
        CoreUtilities.z(a, "workbook");
        CoreUtilities.z(b, "cellBorderInfo");
        CoreUtilities.z(e, "originalWorkbook");
        this.e = a;
        this.b = b;
        this.i = c;
        this.h = d;
        this.d = e;
        this.n = f;
        this.am();
    }
    get t() {
        return this.p;
    }
    get s() {
        return this.o;
    }
    f(a, b, c) {
        let d = this.v(a, b);
        if (stringIsNullOrEmpty(d)) {
            return null;
        }
        let e = this.e.windowOptions.selectedWorksheet._getCell(d).getResolvedCellFormat();
        switch (c) {
            case "Left": return e.leftBorderColorInfo;
            case "Top": return e.topBorderColorInfo;
            case "Right": return e.rightBorderColorInfo;
            case "Bottom": return e.bottomBorderColorInfo;
            case "DiagonalUp":
            case "DiagonalDown":
                let f = e.diagonalBorders;
                if ((c == "DiagonalUp" && f == 5) || (c == "DiagonalDown" && f == 3) || (f == 7)) {
                    return e.diagonalBorderColorInfo;
                }
                else {
                    return WorkbookColorInfo.automatic;
                }
        }
        return null;
    }
    u(a, b, c) {
        let d = this.v(a, b);
        if (stringIsNullOrEmpty(d)) {
            return Nullable$1.toNullable(CellBorderLineStyle_$type, null);
        }
        let e = this.e.windowOptions.selectedWorksheet._getCell(d).getResolvedCellFormat();
        switch (c) {
            case "Left": return Nullable$1.toNullable(CellBorderLineStyle_$type, e.leftBorderStyle);
            case "Top": return Nullable$1.toNullable(CellBorderLineStyle_$type, e.topBorderStyle);
            case "Right": return Nullable$1.toNullable(CellBorderLineStyle_$type, e.rightBorderStyle);
            case "Bottom": return Nullable$1.toNullable(CellBorderLineStyle_$type, e.bottomBorderStyle);
            case "DiagonalUp":
            case "DiagonalDown":
                let f = e.diagonalBorders;
                if ((c == "DiagonalUp" && f == 5) || (c == "DiagonalDown" && f == 3) || (f == 7)) {
                    return Nullable$1.toNullable(CellBorderLineStyle_$type, e.diagonalBorderStyle);
                }
                else {
                    return Nullable$1.toNullable(CellBorderLineStyle_$type, 0);
                }
        }
        return Nullable$1.toNullable(CellBorderLineStyle_$type, null);
    }
    w() {
        this.ap(this.a[this.m], (a) => a.cellFormat.bottomBorderColorInfo = this.g(this.b._aa));
    }
    x() {
        this.ap(this.a[this.m], (a) => a.cellFormat.bottomBorderStyle = this.b._i);
    }
    y() {
        this.an((a) => a.cellFormat.diagonalBorderColorInfo = this.g(this.b._ab));
    }
    z() {
        this.an((a) => {
            a.cellFormat.diagonalBorders = this.b._r;
            a.cellFormat.diagonalBorderStyle = this.c(this.b);
        });
    }
    aa() {
        this.an((a) => a.cellFormat.diagonalBorderColorInfo = this.g(this.b._ac));
    }
    ab() {
        this.an((a) => {
            a.cellFormat.diagonalBorders = this.b._r;
            a.cellFormat.diagonalBorderStyle = this.c(this.b);
        });
    }
    ac() {
        if (this.p > 1) {
            this.ap(this.a[this.k], (a) => a.cellFormat.bottomBorderColorInfo = this.g(this.b._ad));
        }
    }
    ad() {
        if (this.p > 1) {
            this.ap(this.a[this.k], (a) => a.cellFormat.bottomBorderStyle = this.b._l);
        }
    }
    ae() {
        if (this.o > 1) {
            this.ao(this.j, (a) => a.cellFormat.rightBorderColorInfo = this.g(this.b._ae));
        }
    }
    af() {
        if (this.o > 1) {
            this.ao(this.j, (a) => a.cellFormat.rightBorderStyle = this.b._m);
        }
    }
    ag() {
        this.ao(this.j, (a) => a.cellFormat.leftBorderColorInfo = this.g(this.b._af));
    }
    ah() {
        this.ao(this.j, (a) => a.cellFormat.leftBorderStyle = this.b._n);
    }
    ai() {
        this.ao(this.l, (a) => a.cellFormat.rightBorderColorInfo = this.g(this.b._ag));
    }
    aj() {
        this.ao(this.l, (a) => a.cellFormat.rightBorderStyle = this.b._o);
    }
    ak() {
        this.ap(this.a[this.k], (a) => a.cellFormat.topBorderColorInfo = this.g(this.b._ah));
    }
    al() {
        this.ap(this.a[this.k], (a) => a.cellFormat.topBorderStyle = this.b._p);
    }
    c(a) {
        switch (a._r) {
            case 1: return 0;
            case 7: return a._j;
            case 3: return a._j;
            case 5: return a._k;
            default: return -1;
        }
    }
    v(a, b) {
        if (a >= this.t || b >= this.s) {
            return stringEmpty();
        }
        let c = "";
        let d = "";
        if (a == 0) {
            c = "2";
        }
        else {
            c = "3";
        }
        if (b == 0) {
            d = "B";
        }
        else {
            d = "C";
        }
        return stringFormat("{0}{1}", d, c);
    }
    g(a) {
        if (WorkbookColorInfo.l_op_Inequality(null, a)) {
            return new WorkbookColorInfo(a._getResolvedColor1(this.d));
        }
        return null;
    }
    am() {
        let a = this.e._worksheets$i._item(0);
        for (let b = 0; b < 4; b++) {
            a._rows$i.item(b).hidden = true;
            for (let c = 0; c < 4; c++) {
                a._columns$i.item(c).hidden = true;
            }
        }
        if (this.b._av) {
            this.r = 4;
            this.p = 2;
            this.k = 0;
            this.m = 1;
            this.a = new Array(this.p);
        }
        else {
            this.r = 3;
            this.p = 1;
            this.k = 0;
            this.m = 0;
            this.a = new Array(this.p);
        }
        if (this.b._ax) {
            this.q = 4;
            this.o = 2;
            this.j = 1;
            this.l = 2;
        }
        else {
            this.q = 3;
            this.o = 1;
            this.j = 1;
            this.l = 1;
        }
        let d = a._rows$i;
        let e = intDivide(((this.i) - (2 * this.n)), this.o);
        let f = intDivide(((this.h) - (2 * this.n)), this.p);
        let g = 0;
        for (let h = 0; h < this.r; h++) {
            let i = h > 0 && h < (this.r - 1);
            let j = d.item(h);
            j.hidden = false;
            j.height = truncate(Workbook._ep(this.e, i ? f : this.n, true));
            if (i) {
                this.a[g] = j;
                g++;
            }
            for (let k = 0; k < this.q; k++) {
                let l = k > 0 && k < (this.q - 1);
                a._columns$i.item(k).setWidth(l ? e : this.n, 3);
                a._columns$i.item(k).hidden = false;
                let m = j._cells$i.item(k);
                let n = m.cellFormat;
                n.alignment = 2;
                n.verticalAlignment = 1;
                if (i && l) {
                    m.value = SpreadsheetUtilities.di(null, "FormatCellsDialog_BorderTab_Text_SampleText");
                }
            }
        }
        this.ar();
        let o = this.b;
        o.propertyChanged = delegateCombine(o.propertyChanged, runOn(this, this.aq));
    }
    an(a) {
        let d = this.a;
        for (let c = 0; c < d.length; c++) {
            let b = d[c];
            this.ap(b, a);
        }
    }
    ao(a, b) {
        for (let c = this.k; c <= this.m; c++) {
            b(this.a[c]._cells$i.item(a));
        }
    }
    ap(a, b) {
        for (let c = this.j; c <= this.l; c++) {
            b(a._cells$i.item(c));
        }
    }
    aq(a, b) {
        switch (b.propertyName) {
            case "BottomCellBorderColorInfo":
                this.w();
                break;
            case "BottomCellBorderStyle":
                this.x();
                break;
            case "InsideHorizontalCellBorderColorInfo":
                this.ac();
                break;
            case "InsideHorizontalCellBorderStyle":
                this.ad();
                break;
            case "InsideVerticalCellBorderColorInfo":
                this.ae();
                break;
            case "InsideVerticalCellBorderStyle":
                this.af();
                break;
            case "LeftCellBorderColorInfo":
                this.ag();
                break;
            case "LeftCellBorderStyle":
                this.ah();
                break;
            case "RightCellBorderColorInfo":
                this.ai();
                break;
            case "RightCellBorderStyle":
                this.aj();
                break;
            case "TopCellBorderColorInfo":
                this.ak();
                break;
            case "TopCellBorderStyle":
                this.al();
                break;
            case "DiagonalDownCellBorderColorInfo":
                this.y();
                break;
            case "DiagonalDownCellBorderStyle":
                this.z();
                break;
            case "DiagonalUpCellBorderColorInfo":
                this.aa();
                break;
            case "DiagonalUpCellBorderStyle":
                this.ab();
                break;
        }
    }
    ar() {
        this.w();
        this.x();
        this.ac();
        this.ad();
        this.ae();
        this.af();
        this.ag();
        this.ah();
        this.ai();
        this.aj();
        this.ak();
        this.al();
        this.aa();
        this.ab();
    }
}
CellBordersPreviewControlHelper.$t = markType(CellBordersPreviewControlHelper, 'CellBordersPreviewControlHelper');
/**
 * @hidden
 */
export class FontControlViewModel extends Base {
    constructor(a, b, c, d, e, f, g, h, i, j, k, l, m, n, o) {
        super();
        this._e = null;
        this._ab = null;
        this._aa = null;
        this._ac = null;
        this._q = false;
        this._at = null;
        this._ai = 0;
        this._c = null;
        this._g = 0;
        this._l = null;
        this._am = Nullable$1.toNullable(Boolean_$type, null);
        this._an = Nullable$1.toNullable(Boolean_$type, null);
        this._al = Nullable$1.toNullable(Boolean_$type, null);
        this._o = false;
        this._p = false;
        this._ad = null;
        this._i = null;
        this._ak = Nullable$1.toNullable(DialogFontStyle_$type, null);
        this._v = false;
        this._w = false;
        this._y = false;
        this._z = false;
        this._f = null;
        this._k = null;
        this.propertyChanged = null;
        CoreUtilities.z(i, "dialogServicesManager");
        this._e = i;
        this._p = true;
        this._k = n;
        this._f = o;
        this._ax = a;
        let p = this._b(c, d);
        this._d = Enumerable.ag(DialogFontStyleInfo.$, this._ag, (q) => q.a == p);
        this._h = g;
        if (b > -1) {
            this._aj = intDivide(b, 20);
        }
        else {
            this._aj = b;
        }
        if (f != -1) {
            this._ar = Nullable$1.toNullable(Boolean_$type, this._s(f));
            this._as = Nullable$1.toNullable(Boolean_$type, this._t(f));
        }
        else {
            this._ar = Nullable$1.toNullable(Boolean_$type, null);
            this._as = Nullable$1.toNullable(Boolean_$type, null);
        }
        this._aq = this._ao(e);
        this._m = h;
        this._v = j;
        this._w = j;
        this._y = l;
        this._z = m;
        this._a5(true);
        this._p = false;
        this._ad = new List$1(String_$type, 0);
    }
    get _ah() {
        return this._ad;
    }
    get _ae() {
        if (null == this._aa) {
            this._aa = this._e.fontsService.getFontNames();
        }
        return this._aa;
    }
    get _af() {
        if (null == this._ab) {
            this._ab = this._e.fontsService.getFontSizes();
        }
        return this._ab;
    }
    get _ag() {
        if (null == this._ac) {
            this._ac = new List$1(DialogFontStyleInfo.$, 0);
            this._ac.add(new DialogFontStyleInfo(1));
            this._ac.add(new DialogFontStyleInfo(2));
            this._ac.add(new DialogFontStyleInfo(3));
            this._ac.add(new DialogFontStyleInfo(4));
        }
        return this._ac;
    }
    set _ag(a) {
        this._ag = a;
        this._a7("FontStyles");
    }
    get _n() {
        return EnumUtil.getValues(FontUnderlineStyle_$type);
    }
    get _x() {
        return this._q;
    }
    set _x(a) {
        if (a != this._q) {
            this._q = a;
            this._a7("IsNormalFont");
        }
    }
    get _a9() {
        if (WorkbookColorInfo.l_op_Inequality(null, this._l) && null != this._k) {
            return this._l._getResolvedColor1(this._k);
        }
        if (null != this._k) {
            return WorkbookColorInfo.automatic._getResolvedColor1(this._k);
        }
        return WorkbookColorInfo.automatic._getResolvedColor();
    }
    get _m() {
        return this._l;
    }
    set _m(a) {
        if (WorkbookColorInfo.l_op_Inequality(a, this._l)) {
            this._l = a;
            this._a7("SelectedFontColorInfo");
        }
    }
    get _ax() {
        return this._at;
    }
    set _ax(a) {
        if (a != this._at) {
            this._at = a;
            this._a7("SelectedFontName");
        }
    }
    get _aj() {
        return this._ai;
    }
    set _aj(a) {
        if (a != this._ai) {
            this._ai = a;
            this._a7("SelectedFontSize");
        }
    }
    get _d() {
        return this._c;
    }
    set _d(a) {
        if (a != this._c) {
            this._c = a;
            this._a7("SelectedFontStyle");
        }
    }
    get _h() {
        return this._g;
    }
    set _h(a) {
        if (a != this._g) {
            this._g = a;
            this._a7("SelectedFontUnderlineStyle");
        }
    }
    get _aq() {
        return this._al;
    }
    set _aq(a) {
        let b = this._ap(a);
        if (nullableNotEquals(b, this._al)) {
            this._al = b;
            this._a7("Strikeout");
        }
    }
    get _ar() {
        return this._am;
    }
    set _ar(a) {
        let b = this._ap(a);
        if (nullableNotEquals(b, this._am)) {
            this._am = b;
            this._a7("Subscript");
            if (nullableEquals(true, this._am)) {
                this._as = Nullable$1.toNullable(Boolean_$type, false);
            }
            else if (!this._p && false == this._as.hasValue) {
                this._as = Nullable$1.toNullable(Boolean_$type, false);
            }
        }
    }
    get _as() {
        return this._an;
    }
    set _as(a) {
        let b = this._ap(a);
        if (nullableNotEquals(b, this._an)) {
            this._an = b;
            this._a7("Superscript");
            if (nullableEquals(true, this._an)) {
                this._ar = Nullable$1.toNullable(Boolean_$type, false);
            }
            else if (!this._p && false == this._ar.hasValue) {
                this._ar = Nullable$1.toNullable(Boolean_$type, false);
            }
        }
    }
    get _j() {
        if (null == this._i) {
            this._i = this._k._styles$i.normalStyle.styleFormat.font;
        }
        return this._i;
    }
    get _a() {
        if (false == this._ak.hasValue) {
            this._ak = Nullable$1.toNullable(DialogFontStyle_$type, this._b(this._j._bold$i, this._j._italic$i));
        }
        return this._ak.value;
    }
    _a8(a) {
        a.value = this._ax;
        a.cellFormat.font.height = this._aj < 0 ? this._aj : this._aj * 20;
        a.cellFormat.font.name = this._ax;
        if (null != this._d) {
            let b = this._d.a;
            a.cellFormat.font._italic$i = Nullable$1.toNullable(Boolean_$type, (b == 3 || b == 4) ? true : false);
            a.cellFormat.font._bold$i = Nullable$1.toNullable(Boolean_$type, (b == 2 || b == 4) ? true : false);
        }
        a.cellFormat.font.colorInfo = this._m;
        a.cellFormat.font._strikeout$i = Nullable$1.toNullable(Boolean_$type, nullableEquals(false, this._aq) ? false : true);
        if (nullableEquals(true, this._ar)) {
            a.cellFormat.font.superscriptSubscriptStyle = 2;
        }
        else if (nullableEquals(true, this._as)) {
            a.cellFormat.font.superscriptSubscriptStyle = 1;
        }
        else {
            a.cellFormat.font.superscriptSubscriptStyle = 0;
        }
        a.cellFormat.font.underlineStyle = this._h;
    }
    _a5(a = false) {
        if (false == a && false == this._x) {
            return;
        }
        this._x = this._aj == intDivide(this._j.height, 20) && this._ax == this._j.name && null != this._d && this._d.a == this._a && this._h == this._j.underlineStyle && this._u(this._j._strikeout$i, this._aq) && nullableEquals(this._ar, this._s(this._j.superscriptSubscriptStyle)) && nullableEquals(this._as, this._t(this._j.superscriptSubscriptStyle)) && WorkbookColorInfo.l_op_Inequality(null, this._m) && (WorkbookColorInfo.l_op_Equality(this._m, this._j.colorInfo) || (this._m._themeColorType$i.hasValue && nullableEquals(this._m._themeColorType$i.value, this._j.colorInfo._themeColorType$i) && (nullableEquals(this._m._tint$i, null) || nullableEquals(this._m._tint$i, 0))));
    }
    _r(a) {
        return nullableEquals(a, true);
    }
    _ao(a) {
        if (nullableEquals(a, null)) {
            return Nullable$1.toNullable(Boolean_$type, null);
        }
        else {
            return Nullable$1.toNullable(Boolean_$type, nullableEquals(a, true));
        }
    }
    _s(a) {
        return a == 2;
    }
    _t(a) {
        return a == 1;
    }
    _u(a, b) {
        if (nullableEquals(a, null)) {
            return false == b.hasValue;
        }
        if (nullableEquals(null, b)) {
            return false;
        }
        if (nullableEquals(a, true)) {
            return b.value == true;
        }
        else {
            return b.value == false;
        }
    }
    _ap(a) {
        if (a.hasValue) {
            return Nullable$1.toNullable(Boolean_$type, a.value);
        }
        if (this._p) {
            return Nullable$1.toNullable(Boolean_$type, null);
        }
        else {
            return Nullable$1.toNullable(Boolean_$type, false);
        }
    }
    _a6(a) {
        if (this._p) {
            return;
        }
        if (null != this._ad && !this._ad.contains(a)) {
            this._ad.add(a);
        }
        switch (a) {
            case "SelectedFontName":
            case "SelectedFontSize":
            case "SelectedFontStyle":
            case "SelectedFontUnderlineStyle":
            case "Strikeout":
            case "Superscript":
            case "Subscript":
            case "SelectedFontColorInfo":
                if (false == this._o) {
                    this._a5();
                }
                break;
            case "IsNormalFont":
                if (this._o) {
                    break;
                }
                if (true == this._x) {
                    this._ad.clear();
                    this._o = true;
                    try {
                        this._ax = this._j.name;
                        this._aj = intDivide(this._j.height, 20);
                        this._d = Enumerable.ag(DialogFontStyleInfo.$, this._ag, (b) => b.a == this._a);
                        this._h = this._j.underlineStyle;
                        this._aq = Nullable$1.toNullable(Boolean_$type, false);
                        this._ar = Nullable$1.toNullable(Boolean_$type, false);
                        this._as = Nullable$1.toNullable(Boolean_$type, false);
                        this._m = this._j.colorInfo;
                    }
                    finally {
                        this._o = false;
                    }
                }
                break;
        }
    }
    _b(a, b) {
        if (nullableEquals(a, null) || nullableEquals(b, null)) {
            return 0;
        }
        if (nullableEquals(a, false) && nullableEquals(b, false)) {
            return 1;
        }
        else if (nullableEquals(a, true) && nullableEquals(b, false)) {
            return 2;
        }
        else if (nullableEquals(a, false) && nullableEquals(b, true)) {
            return 3;
        }
        else {
            return 4;
        }
    }
    _a7(a) {
        this._a6(a);
        let b = this.propertyChanged;
        if (null != b) {
            b(this, new PropertyChangedEventArgs(a));
        }
    }
}
FontControlViewModel.$t = markType(FontControlViewModel, 'FontControlViewModel', Base.$, [INotifyPropertyChanged_$type]);
/**
 * @hidden
 */
export class DialogFontStyleInfo extends Base {
    constructor(a) {
        super();
        this.a = 0;
        this.a = a;
    }
    toString() {
        return this.b;
    }
    get b() {
        switch (this.a) {
            case 1: return SpreadsheetUtilities.di(null, "SpreadsheetFontControl_FontStyle_Regular");
            case 2: return SpreadsheetUtilities.di(null, "SpreadsheetFontControl_FontStyle_Bold");
            case 3: return SpreadsheetUtilities.di(null, "SpreadsheetFontControl_FontStyle_Italic");
            case 4: return SpreadsheetUtilities.di(null, "SpreadsheetFontControl_FontStyle_BoldItalic");
        }
        return stringEmpty();
    }
}
DialogFontStyleInfo.$t = markType(DialogFontStyleInfo, 'DialogFontStyleInfo');
/**
 * @hidden
 */
export class SpreadsheetDialogFormatsService extends Base {
    a(a, b, c, d, e) {
        let f = new ValueFormatter(0, a, b, a._e6);
        let g = f.h(c, d, c, 0, null, null, false, false);
        e = g.g;
        return {
            p4: e
        };
    }
    getFormatCategories(a) {
        let b = (c) => SpreadsheetUtilities.di(null, c);
        let c = new List$1(SpreadsheetDialogFormatCategory.$, 0);
        let d = ((() => {
            let $ret = new SpreadsheetDialogFormatCategory();
            $ret._aa = b("FormatInfo_General");
            $ret._y = -1;
            $ret._h = false;
            $ret._ac = b("FormatInfo_General_NumberFormat_Description");
            $ret._e = 0;
            return $ret;
        })());
        d._b("General");
        c.add(d);
        let e = ((() => {
            let $ret = new SpreadsheetDialogFormatCategoryEx();
            $ret._aa = b("FormatInfo_Number");
            $ret._ae = b("FormatInfo_FormatHeader_NegativeNumbers");
            $ret._ac = b("FormatInfo_Number_NumberFormat_Description");
            $ret._e = 1;
            return $ret;
        })());
        let f = a || new Workbook();
        let g = stringEmpty();
        let h = stringEmpty();
        let i = 0;
        let j = i.toString();
        ;
        i = -1234.1;
        j = i.toString();
        h = "0.00";
        let k = this.a(f, h, i, i.toString(), g);
        g = k.p4;
        e._w.add(new SpreadsheetDialogFormat(0, h, g));
        h = "0.00;[Red]0.00";
        let l = this.a(f, h, i, i.toString(), g);
        g = l.p4;
        e._w.add(new SpreadsheetDialogFormat(1, h, g, "#FF0000"));
        h = "0.00;(#.00)";
        let m = this.a(f, h, i, i.toString(), g);
        g = m.p4;
        e._w.add(new SpreadsheetDialogFormat(0, h, g));
        h = "0.00;[Red](#.00)";
        let n = this.a(f, h, i, i.toString(), g);
        g = n.p4;
        e._w.add(new SpreadsheetDialogFormat(1, h, g, "#FF0000"));
        c.add(e);
        let o = ((() => {
            let $ret = new SpreadsheetDialogFormatCategoryEx();
            $ret._aa = b("FormatInfo_Currency");
            $ret._ae = b("FormatInfo_FormatHeader_NegativeNumbers");
            $ret._ac = b("FormatInfo_Currency_NumberFormat_Description");
            $ret._e = 2;
            return $ret;
        })());
        h = "$#,##0.00";
        let p = this.a(f, h, i, i.toString(), g);
        g = p.p4;
        o._w.add(new SpreadsheetDialogFormat(0, h, g));
        h = "$#,##0.00;[Red]$#,##0.00";
        let q = this.a(f, h, i, i.toString(), g);
        g = q.p4;
        o._w.add(new SpreadsheetDialogFormat(1, h, g, "#FF0000"));
        h = "$#,##0.00_);($#,##0.00)";
        let r = this.a(f, h, i, i.toString(), g);
        g = r.p4;
        o._w.add(new SpreadsheetDialogFormat(0, h, g));
        h = "$#,##0.00_);[Red]($#,##0.00)";
        let s = this.a(f, h, i, i.toString(), g);
        g = s.p4;
        o._w.add(new SpreadsheetDialogFormat(1, h, g, "#FF0000"));
        c.add(o);
        let t = ((() => {
            let $ret = new SpreadsheetDialogFormatCategoryEx();
            $ret._aa = b("FormatInfo_Accounting");
            $ret._h = false;
            $ret._ac = b("FormatInfo_Accounting_NumberFormat_Description");
            $ret._y = 2;
            $ret._e = 3;
            return $ret;
        })());
        h = "_($* #,##0.00_);_($* (#,##0.00);_($* \" - \"??_);_(@_)";
        let u = this.a(f, h, i, i.toString(), g);
        g = u.p4;
        t._w.add(new SpreadsheetDialogFormat(0, h, g));
        c.add(t);
        let v = ((() => {
            let $ret = new SpreadsheetDialogFormatCategory();
            $ret._aa = b("FormatInfo_Date");
            $ret._y = -1;
            $ret._ae = b("FormatInfo_FormatHeader_Type");
            $ret._ac = b("FormatInfo_Date_NumberFormat_Description");
            $ret._e = 4;
            return $ret;
        })());
        let w = b("FormatCellsDialog_NumberTab_DateFormatMasks");
        let x = stringSplit(w, ["\r\n", "\r", "\n"], 1);
        let y = dateFromValues(2012, 3, 14, 13, 30, 55, 0);
        let z = ExcelUtils.b0(f, y, i);
        i = z.p2;
        for (let ab = 0; ab < x.length; ab++) {
            let aa = x[ab];
            h = aa;
            let ac = this.a(f, h, i, i.toString(), g);
            g = ac.p4;
            if (stringContains(aa, "[$-F800") || stringContains(aa, "[$-F400")) {
                g = "*" + g;
            }
            v._w.add(new SpreadsheetDialogFormat(0, h, g));
        }
        c.add(v);
        let ad = ((() => {
            let $ret = new SpreadsheetDialogFormatCategory();
            $ret._aa = b("FormatInfo_Time");
            $ret._y = -1;
            $ret._ae = b("FormatInfo_FormatHeader_Type");
            $ret._ac = b("FormatInfo_Time_NumberFormat_Description");
            $ret._e = 5;
            return $ret;
        })());
        w = b("FormatCellsDialog_NumberTab_TimeFormatMasks");
        x = stringSplit(w, ["\r\n", "\r", "\n"], 1);
        for (let af = 0; af < x.length; af++) {
            let ae = x[af];
            h = ae;
            let ag = this.a(f, h, i, i.toString(), g);
            g = ag.p4;
            if (stringContains(ae, "[$-F800") || stringContains(ae, "[$-F400")) {
                g = "*" + g;
            }
            ad._w.add(new SpreadsheetDialogFormat(0, h, g));
        }
        c.add(ad);
        let ah = ((() => {
            let $ret = new SpreadsheetDialogFormatCategoryEx();
            $ret._aa = b("FormatInfo_Percentage");
            $ret._ac = b("FormatInfo_Percentage_NumberFormat_Description");
            $ret._h = false;
            $ret._y = 2;
            $ret._e = 6;
            return $ret;
        })());
        ah._b("0.00%");
        c.add(ah);
        let ai = ((() => {
            let $ret = new SpreadsheetDialogFormatCategory();
            $ret._aa = b("FormatInfo_Fraction");
            $ret._y = -1;
            $ret._ae = b("FormatInfo_FormatHeader_Type");
            $ret._ac = "";
            $ret._e = 7;
            return $ret;
        })());
        ai._w.add(new SpreadsheetDialogFormat(0, "# ?/?", b("FormatInfo_Fraction_OneDigit")));
        ai._w.add(new SpreadsheetDialogFormat(0, "# ??/??", b("FormatInfo_Fraction_TwoDigits")));
        ai._w.add(new SpreadsheetDialogFormat(0, "# ???/???", b("FormatInfo_Fraction_ThreeDigits")));
        ai._w.add(new SpreadsheetDialogFormat(0, "# ?/2", b("FormatInfo_Fraction_Halves")));
        ai._w.add(new SpreadsheetDialogFormat(0, "# ?/4", b("FormatInfo_Fraction_Quarters")));
        ai._w.add(new SpreadsheetDialogFormat(0, "# ?/8", b("FormatInfo_Fraction_Eighths")));
        ai._w.add(new SpreadsheetDialogFormat(0, "# ??/16", b("FormatInfo_Fraction_Sixteenths")));
        ai._w.add(new SpreadsheetDialogFormat(0, "# ??/10", b("FormatInfo_Fraction_Tenths")));
        ai._w.add(new SpreadsheetDialogFormat(0, "# ??/100", b("FormatInfo_Fraction_Hundreths")));
        c.add(ai);
        let aj = ((() => {
            let $ret = new SpreadsheetDialogFormatCategoryEx();
            $ret._aa = b("FormatInfo_Scientific");
            $ret._ac = "";
            $ret._h = false;
            $ret._y = 2;
            $ret._e = 8;
            return $ret;
        })());
        aj._b("0.00E+00");
        c.add(aj);
        let ak = ((() => {
            let $ret = new SpreadsheetDialogFormatCategory();
            $ret._aa = b("FormatInfo_Text");
            $ret._ac = b("FormatInfo_Text_NumberFormat_Description");
            $ret._h = false;
            $ret._y = -1;
            $ret._e = 9;
            return $ret;
        })());
        ak._b("@");
        c.add(ak);
        let al = ((() => {
            let $ret = new SpreadsheetDialogFormatCategory();
            $ret._aa = b("FormatInfo_Special");
            $ret._y = -1;
            $ret._ae = b("FormatInfo_FormatHeader_Type");
            $ret._ac = b("FormatInfo_Special_NumberFormat_Description");
            $ret._e = 10;
            return $ret;
        })());
        al._w.add(new SpreadsheetDialogFormat(0, "00000", b("FormatInfo_Special_ZipCode")));
        al._w.add(new SpreadsheetDialogFormat(0, "00000-0000", b("FormatInfo_Special_ZipCodePlus4")));
        al._w.add(new SpreadsheetDialogFormat(0, "[<=9999999]###-####;(###) ###-####", b("FormatInfo_Special_PhoneNumber")));
        al._w.add(new SpreadsheetDialogFormat(0, "000-00-0000", b("FormatInfo_Special_SocialSecurityNumber")));
        c.add(al);
        let am = ((() => {
            let $ret = new SpreadsheetDialogFormatCategory();
            $ret._aa = b("FormatInfo_Custom");
            $ret._y = -1;
            $ret._ae = b("FormatInfo_FormatHeader_Type");
            $ret._l = true;
            $ret._ac = b("FormatInfo_Custom_NumberFormat_Description");
            return $ret;
        })());
        for (let an = 1; an < c.count; an++) {
            for (let ao of fromEnum(c._inner[an]._w)) {
                am._b(ao._e);
            }
        }
        am._w = Enumerable.z(SpreadsheetDialogFormat.$, Enumerable.x(SpreadsheetDialogFormat.$, String_$type, Enumerable.o(SpreadsheetDialogFormat.$, SpreadsheetDialogFormat.$, am._w, (ap) => ap), (ap) => ap._e));
        am._w.insert(0, c._inner[0]._w._inner[0]);
        for (let ap of fromEnum(a._b2.m())) {
            let aq = a._b2.item(ap);
            if (null == Enumerable.ag(SpreadsheetDialogFormat.$, am._w, (ar) => ar._e == aq)) {
                am._b(aq);
            }
        }
        c.add(am);
        return c;
    }
}
SpreadsheetDialogFormatsService.$t = markType(SpreadsheetDialogFormatsService, 'SpreadsheetDialogFormatsService', Base.$, [ISpreadsheetDialogFormatsService_$type]);
/**
 * @hidden
 */
export class FilterDialogViewModel extends Base {
    constructor(a, ..._rest) {
        super();
        this.f = null;
        this.j = null;
        this.v = null;
        this.m = Nullable$1.toNullable(ExcelComparisonOperator_$type, null);
        this.o = Nullable$1.toNullable(ExcelComparisonOperator_$type, null);
        this.r = null;
        this.t = null;
        this.c = 0;
        this.a = 0;
        this.g = null;
        this.l = 0;
        this.h = null;
        this.b = 0;
        a = (a == void 0) ? 0 : a;
        switch (a) {
            case 0:
                {
                    let c = _rest[0];
                    let d = _rest[1];
                    let e = _rest[2];
                    this.g = c;
                    this.l = d;
                    this.b = e;
                    this.f = c.filterSettings.getFilter(d);
                    this.j = ((() => { let f = SpreadsheetUtilities.bz(c, d, this.a); this.a = f.p2; return f.ret; })());
                    this.v = FilterDialogViewModel.x(c, d);
                    this.ac();
                }
                break;
            case 1:
                {
                    let c = _rest[0];
                    let d = _rest[1];
                    this.h = c;
                    this.b = d;
                    this.g = this.h.table.worksheet;
                    this.f = c.filter;
                    this.j = ((() => { let e = SpreadsheetUtilities.b1(c, this.a); this.a = e.p1; return e.ret; })());
                    this.v = FilterDialogViewModel.y(c);
                    this.ac();
                }
                break;
        }
    }
    ac() {
        this.m = Nullable$1.toNullable(ExcelComparisonOperator_$type, 0);
        this.o = Nullable$1.toNullable(ExcelComparisonOperator_$type, null);
        this.r = null;
        this.t = null;
        this.c = 0;
        let a;
        let b;
        let c;
        let d;
        let e;
        let f = this.ad(a, c, b, d, e);
        a = f.p0;
        c = f.p1;
        b = f.p2;
        d = f.p3;
        e = f.p4;
        let g;
        let h;
        let i = this.ab(g, h);
        g = i.p0;
        h = i.p1;
        if (g.hasValue) {
            if (nullableNotEquals(g, a)) {
                this.m = g;
                this.o = h;
                return;
            }
            if (h.hasValue && nullableNotEquals(h, b)) {
                this.m = g;
                this.o = h;
                return;
            }
        }
        if (a.hasValue) {
            this.m = a;
            this.o = b;
            this.r = c;
            this.t = d;
            this.c = e;
        }
    }
    ad(a, b, c, d, e) {
        b = null;
        d = null;
        a = Nullable$1.toNullable(ExcelComparisonOperator_$type, null);
        c = Nullable$1.toNullable(ExcelComparisonOperator_$type, null);
        e = 0;
        if (null == this.f) {
            return {
                p0: a,
                p1: b,
                p2: c,
                p3: d,
                p4: e
            };
        }
        if (typeCast(DatePeriodFilter.$, this.f) !== null || typeCast(FillFilter.$, this.f) !== null || typeCast(IconFilter.$, this.f) !== null || typeCast(FontColorFilter.$, this.f) !== null) {
            return {
                p0: a,
                p1: b,
                p2: c,
                p3: d,
                p4: e
            };
        }
        let f = typeCast(CustomFilter.$, this.f);
        if (null != f) {
            let g = f.condition1;
            if (null != g) {
                a = Nullable$1.toNullable(ExcelComparisonOperator_$type, g.comparisonOperator);
                b = g.value;
            }
            let h = f.condition2;
            if (null != h) {
                c = Nullable$1.toNullable(ExcelComparisonOperator_$type, h.comparisonOperator);
                d = h.value;
            }
            e = f.conditionalOperator;
            return {
                p0: a,
                p1: b,
                p2: c,
                p3: d,
                p4: e
            };
        }
        let i = typeCast(AverageFilter.$, this.f);
        if (null != i) {
            b = i.average;
            switch (i.type) {
                case 0:
                    a = Nullable$1.toNullable(ExcelComparisonOperator_$type, 2);
                    break;
                case 1:
                    a = Nullable$1.toNullable(ExcelComparisonOperator_$type, 4);
                    break;
                default: break;
            }
            return {
                p0: a,
                p1: b,
                p2: c,
                p3: d,
                p4: e
            };
        }
        let j = typeCast(FixedValuesFilter.$, this.f);
        if (null != j) {
            e = 1;
            a = Nullable$1.toNullable(ExcelComparisonOperator_$type, 0);
            let k = j._displayValues$i.count;
            if (k == 0 || k > 2) {
                return {
                    p0: a,
                    p1: b,
                    p2: c,
                    p3: d,
                    p4: e
                };
            }
            b = j._displayValues$i.item(0);
            if (k > 1) {
                c = Nullable$1.toNullable(ExcelComparisonOperator_$type, 0);
                d = j._displayValues$i.item(1);
            }
            return {
                p0: a,
                p1: b,
                p2: c,
                p3: d,
                p4: e
            };
        }
        let l = typeCast(DateRangeFilter.$, this.f);
        if (null != l) {
            this.c = 0;
            a = Nullable$1.toNullable(ExcelComparisonOperator_$type, 3);
            c = Nullable$1.toNullable(ExcelComparisonOperator_$type, 4);
            b = l.start;
            d = l.end;
            return {
                p0: a,
                p1: b,
                p2: c,
                p3: d,
                p4: e
            };
        }
        let m = typeCast(TopOrBottomFilter.$, this.f);
        if (null != m) {
            switch (m._v) {
                case 2:
                    a = Nullable$1.toNullable(ExcelComparisonOperator_$type, 0);
                    break;
                case 4:
                    a = Nullable$1.toNullable(ExcelComparisonOperator_$type, 2);
                    break;
                case 6:
                    a = Nullable$1.toNullable(ExcelComparisonOperator_$type, 3);
                    break;
                case 1:
                    a = Nullable$1.toNullable(ExcelComparisonOperator_$type, 4);
                    break;
                case 3:
                    a = Nullable$1.toNullable(ExcelComparisonOperator_$type, 5);
                    break;
                case 5:
                    a = Nullable$1.toNullable(ExcelComparisonOperator_$type, 1);
                    break;
            }
            b = m._z;
            return {
                p0: a,
                p1: b,
                p2: c,
                p3: d,
                p4: e
            };
        }
        return {
            p0: a,
            p1: b,
            p2: c,
            p3: d,
            p4: e
        };
    }
    ab(a, b) {
        a = Nullable$1.toNullable(ExcelComparisonOperator_$type, null);
        b = Nullable$1.toNullable(ExcelComparisonOperator_$type, null);
        switch (this.b) {
            case 0:
            case 1:
            case 2:
            case 3:
            case 4:
            case 5:
            case 6:
            case 7:
            case 8:
            case 9:
            case 10:
            case 11:
                a = Nullable$1.toNullable(ExcelComparisonOperator_$type, FilterDialogViewModel.e(this.b));
                break;
            case 12:
                a = Nullable$1.toNullable(ExcelComparisonOperator_$type, 3);
                b = Nullable$1.toNullable(ExcelComparisonOperator_$type, 4);
                break;
            case 13: break;
            default: break;
        }
        return {
            p0: a,
            p1: b
        };
    }
    static x(a, b) {
        let c = a.filterSettings;
        let d = c != null ? c.region : null;
        if (null == c || null == d) {
            return null;
        }
        let e = d.firstRow;
        let f = d.firstColumn + b;
        let g = a._rows$i.item(e);
        let h = SpreadsheetUtilities.dg(g, f);
        return h;
    }
    static y(a) {
        let b = a._worksheet;
        let c = a.wholeColumnRegion.firstRow;
        let d = a._at;
        let e = new HashSet$1(Base.$, 0);
        let f = b._rows$i.item(c);
        return SpreadsheetUtilities.dg(f, d);
    }
    static e(a) {
        switch (a) {
            case 0: return 0;
            case 1: return 1;
            case 2: return 2;
            case 3: return 3;
            case 4: return 4;
            case 5: return 5;
            case 6: return 6;
            case 7: return 7;
            case 8: return 8;
            case 9: return 9;
            case 10: return 10;
            case 11: return 11;
            case 12:
            case 13: return 0;
            default: return 0;
        }
    }
    q(a, b) {
        if (a.hasValue && CustomFilterCondition._h(a.value)) {
            return b;
        }
        switch (this.a) {
            case 3:
                {
                    let c;
                    if (((() => { let d = tryParseNumber(b, c); c = d.p1; return d.ret; })())) {
                        return c;
                    }
                }
                break;
            case 2:
                {
                    let d;
                    if (((() => { let e = dateTryParse(b, d); d = e.p1; return e.ret; })())) {
                        return d;
                    }
                }
                break;
        }
        return b;
    }
    aa(a, b, c, d, e) {
        let f = this.q(a, b);
        let g = new CustomFilterCondition(a.value, f);
        let h = null;
        if (nullableNotEquals(null, c) && false == stringIsNullOrEmpty(c.toString())) {
            if (c.hasValue) {
                let i = this.q(a, d);
                h = new CustomFilterCondition(c.value, i);
            }
            else {
                return;
            }
        }
        if (null != this.h) {
            this.h._applyCustomFilter1(g, h, e);
        }
        else {
            this.g.filterSettings._applyCustomFilter1(this.l, g, h, e);
        }
    }
    static i(a) {
        let b;
        let c = new List$1(ComboBoxListItem.$, 0);
        b = new ComboBoxListItem(stringEmpty(), stringEmpty());
        c.add(b);
        let d = EnumUtil.getValues(ExcelComparisonOperator_$type);
        let e = "ExcelComparisonOperator_{0}_DisplayText";
        for (let g = 0; g < d.length; g++) {
            let f = d[g];
            let h = stringFormat(e, EnumUtil.getName(ExcelComparisonOperator_$type, f));
            let i = a._fs(h);
            b = new ComboBoxListItem(enumGetBox(ExcelComparisonOperator_$type, f), i);
            c.add(b);
        }
        return c;
    }
    z(a) {
        let b = null;
        switch (a) {
            case 1:
                b = this.s;
                break;
            case 2:
                b = this.u;
                break;
            default: throw new ArgumentOutOfRangeException(1, "index must be 1 or 2.");
        }
        if (null == b) {
            return null;
        }
        if (typeCast(Date_$type, b) !== null) {
            let c = b;
            let d = +c != +(dateGetDate(c));
            let e = this.g.workbook;
            let f = e._e6;
            let g;
            if (d) {
                g = e._b2.a(22);
            }
            else {
                g = e._b2.a(14);
            }
            let h;
            let i = ((() => { let j = ExcelUtils.b0(e, b, h); h = j.p2; return j.ret; })());
            let j = g.h(h, b.toString(), b, 0, null, null, false, false);
            return j.g;
        }
        return b.toString();
    }
    get k() {
        return this.j;
    }
    get w() {
        return this.v;
    }
    get s() {
        return this.r;
    }
    get u() {
        return this.t;
    }
    get n() {
        return this.m;
    }
    get p() {
        return this.o;
    }
    get d() {
        return this.c;
    }
}
FilterDialogViewModel.$t = markType(FilterDialogViewModel, 'FilterDialogViewModel');
/**
 * @hidden
 */
export class FormatCellsDialogViewModel extends Base {
    constructor(a, b, c, d, e) {
        super();
        this._e = null;
        this._f = null;
        this._i = null;
        this._a8 = null;
        this._m = null;
        this._j = null;
        this._aw = false;
        this._a9 = null;
        this._ax = false;
        this._a = null;
        this._r = null;
        this._ac = 0;
        this._ae = 0;
        this._aa = 0;
        this._w = null;
        this._x = null;
        this._t = 0;
        this._aj = null;
        this._ah = null;
        this._ai = WorkbookColorInfo.automatic;
        this._bc = -1;
        this._bk = Nullable$1.toNullable(Boolean_$type, null);
        this._bj = Nullable$1.toNullable(Boolean_$type, null);
        this._bi = Nullable$1.toNullable(Boolean_$type, null);
        this._bh = Nullable$1.toNullable(Boolean_$type, null);
        this._c = null;
        this._o = null;
        this._bb = -1;
        this._ay = false;
        this._bt = null;
        this._l = null;
        this._ap = null;
        this._bd = 0;
        this._aq = null;
        this._ar = null;
        this._ao = null;
        this._q = null;
        this._h = 0;
        this._bs = null;
        this._a4 = false;
        this.propertyChanged = null;
        CoreUtilities.z(a, "dialogOptions");
        CoreUtilities.z(b, "dialogData");
        CoreUtilities.z(c, "dialogServicesManager");
        this._f = a;
        this._e = b;
        this._i = c;
        this._bs = d;
        this._a4 = this._f.f;
        this._a9 = new List$1(String_$type, 0);
        let f = (false == a.i.hasValue) ? a.i : (a.i.value & a.a) != 0 ? a.i : Nullable$1.toNullable(FormatCellsDialogTab_$type, null);
        this._cm(e, f);
    }
    get _a0() {
        return (this._f.a & 2) != 0;
    }
    get _a1() {
        return (this._f.a & 8) != 0;
    }
    get _a2() {
        return (this._f.a & 16) != 0;
    }
    get _a3() {
        return (this._f.a & 4) != 0;
    }
    get _a5() {
        return (this._f.a & 1) != 0;
    }
    get _a6() {
        return (this._f.a & 32) != 0;
    }
    get _ak() {
        return this._ah;
    }
    set _ak(a) {
        if (WorkbookColorInfo.l_op_Inequality(a, this._ah)) {
            this._ah = a;
            this._cq("BackgroundColorInfo");
        }
    }
    get _d() {
        return this._c;
    }
    set _d(a) {
        if (a != this._c) {
            this._c = a;
            this._cq("CellBorderInfo");
        }
    }
    get _cx() {
        if (WorkbookColorInfo.l_op_Inequality(null, this._ai) && null != this._ag) {
            return this._ai._getResolvedColor1(this._ag);
        }
        if (null != this._ag) {
            return WorkbookColorInfo.automatic._getResolvedColor1(this._ag);
        }
        return WorkbookColorInfo.automatic._getResolvedColor();
    }
    get _al() {
        return this._ai;
    }
    set _al(a) {
        if (WorkbookColorInfo.l_op_Inequality(a, this._ai)) {
            this._ai = a;
            this._cq("CellBorderLineColorInfo");
        }
    }
    get _as() {
        if (null == this._ao) {
            let a = new List$1(EnumWrapper$1.$.specialize(CellBorderLineStyle_$type), 0);
            for (let b of fromEnum(EnumUtil.getValues(CellBorderLineStyle_$type))) {
                a.add(new EnumWrapper$1(CellBorderLineStyle_$type, b, "CellBorderLineStyle"));
            }
            this._ao = a.toArray();
        }
        return this._ao;
    }
    get _bx() {
        return this._bt;
    }
    set _bx(a) {
        if (a != this._bt) {
            this._bt = a;
            this._cq("CustomizedFormatMask");
            this._cq("SelectedFormatResolved");
        }
    }
    get _be() {
        return this._bb;
    }
    set _be(a) {
        if (a != this._bb) {
            this._bb = a;
            this._cq("DecimalPlacesInSelectedNumberFormat");
        }
    }
    get _am() {
        return this._aj;
    }
    set _am(a) {
        if (WorkbookColorInfo.l_op_Inequality(a, this._aj)) {
            this._aj = a;
            this._cq("FillPatternColorInfo");
        }
    }
    get _at() {
        if (null == this._ap) {
            let a = new List$1(FillPatternStyle_$type, 1, EnumUtil.getValues(FillPatternStyle_$type));
            a.remove(-1);
            let b = new List$1(EnumWrapper$1.$.specialize(FillPatternStyle_$type), 0);
            for (let c of fromEnum(a)) {
                b.add(new EnumWrapper$1(FillPatternStyle_$type, c, "FillPatternStyle"));
            }
            this._ap = b.toArray();
        }
        return this._ap;
    }
    get _b() {
        if (null == this._a) {
            this._a = new FontControlViewModel(this._e.ah, this._e.x, this._e.z, this._e.aa, this._e.ab, this._e.k, this._e.l, this._e.r, this._i, this._f.b, this._f.c, this._f.g, this._f.h, this._ag, this._s);
        }
        return this._a;
    }
    get _ba() {
        if (null == this._a8) {
            this._a8 = this._p.getFormatCategories(this._ag);
        }
        return this._a8;
    }
    get _au() {
        if (null == this._aq) {
            let a = new List$1(EnumWrapper$1.$.specialize(HorizontalCellAlignment_$type), 0);
            for (let b of fromEnum(EnumUtil.getValues(HorizontalCellAlignment_$type))) {
                a.add(new EnumWrapper$1(HorizontalCellAlignment_$type, b, "HorizontalCellAlignment"));
            }
            this._aq = a.toArray();
        }
        return this._aq;
    }
    get _bf() {
        return this._bc;
    }
    set _bf(a) {
        if (a != this._bc) {
            this._bc = a;
            this._cq("Indent");
            if (this._bc > 0) {
                switch (this._ad) {
                    case 7:
                    case 1:
                    case 3: break;
                    default:
                        this._ad = 1;
                        break;
                }
            }
        }
    }
    get _a7() {
        return this._ay;
    }
    set _a7(a) {
        if (a != this._ay) {
            this._ay = a;
            this._cq("IsShrinkToFitSelectionEnabled");
        }
    }
    get _bn() {
        return this._bh;
    }
    set _bn(a) {
        let b = this._bp(a);
        if (nullableNotEquals(b, this._bh)) {
            this._bh = b;
            this._cq("Locked");
        }
    }
    get _bo() {
        return this._bi;
    }
    set _bo(a) {
        let b = this._bp(a);
        if (nullableNotEquals(b, this._bi)) {
            this._bi = b;
            this._cq("MergeCells");
        }
    }
    get _bg() {
        return this._bd;
    }
    set _bg(a) {
        if (a != this._bd) {
            this._bd = a;
            this._cq("NoColorVersion");
            this._cs();
        }
    }
    get _v() {
        return this._t;
    }
    set _v(a) {
        if (a != this._t) {
            this._t = a;
            this._cq("SelectedCellBorderLineStyle");
        }
    }
    get _y() {
        return this._w;
    }
    set _y(a) {
        if (a != this._w) {
            this._w = a;
            this._cq("SelectedFill");
        }
    }
    get _z() {
        return this._x;
    }
    set _z(a) {
        if (a != this._x) {
            this._x = a;
            this._cq("SelectedFillForPreview");
        }
    }
    get _ab() {
        return this._aa;
    }
    set _ab(a) {
        if (a != this._aa) {
            this._aa = a;
            this._cq("SelectedFillPatternStyle");
        }
    }
    get _k() {
        return this._j;
    }
    set _k(a) {
        let b = a;
        let c = null != b ? Enumerable.ag(SpreadsheetDialogFormat.$, this._n._w, (d) => d._e == b._e) : null;
        if (c != this._j) {
            this._j = c;
            this._cq("SelectedFormat");
            if (null != this._j) {
                this._bx = this._j._e;
            }
            this._cq("SelectedFormatResolved");
        }
    }
    get _ce() {
        if (null != this._n && this._n._l && null != this._bx) {
            let a = new ValueFormatter(0, this._ag, this._bx, this._ag._e6);
            if (a.o) {
                return this._bx;
            }
        }
        if (null != this._k) {
            return this._k._e;
        }
        else {
            return stringEmpty();
        }
    }
    get _n() {
        if (null == this._m) {
            if (null != this._ba && this._ba.count > 0) {
                this._m = this._ba._inner[0];
            }
        }
        return this._m;
    }
    set _n(a) {
        this._l = this._m;
        if (null != this._l) {
            this._l._d = this._k;
        }
        if (a != this._m) {
            if (null != this._l) {
                let b = this._l;
                b.propertyChanged = delegateRemove(b.propertyChanged, runOn(this, this._co));
            }
            this._m = a;
            this._cq("SelectedFormatCategory");
            a.propertyChanged = delegateCombine(a.propertyChanged, runOn(this, this._co));
            let c = SpreadsheetUtilities.di(null, "FormatInfo_General");
            if (a._aa != c) {
                this._cq("SelectedFormat");
            }
            if (a._l && this._a9.contains("CustomizedFormatMask")) {
                this._a9.remove("CustomizedFormatMask");
            }
        }
    }
    get _ad() {
        return this._ac;
    }
    set _ad(a) {
        if (a != this._ac) {
            this._ac = a;
            this._cq("SelectedHorizontalCellAlignment");
            this._cw();
            if (this._bf > 0) {
                switch (this._ad) {
                    case 7:
                    case 1:
                    case 3: break;
                    default:
                        this._bf = 0;
                        break;
                }
            }
        }
    }
    get _af() {
        return this._ae;
    }
    set _af(a) {
        if (a != this._ae) {
            this._ae = a;
            this._cq("SelectedVerticalCellAlignment");
            this._cw();
        }
    }
    get _bq() {
        return this._bj;
    }
    set _bq(a) {
        let b = this._bp(a);
        if (nullableNotEquals(b, this._bj)) {
            this._bj = b;
            this._cq("ShrinkToFit");
        }
    }
    get _s() {
        if (null == this._r) {
            let a = SpreadsheetUtilities.di(null, "SpreadsheetFontControl_Text_Automatic");
            this._r = new ThemeColorPickerControlViewModel(this._ag, a);
        }
        return this._r;
    }
    get _av() {
        if (null == this._ar) {
            let a = new List$1(EnumWrapper$1.$.specialize(VerticalCellAlignment_$type), 0);
            for (let b of fromEnum(EnumUtil.getValues(VerticalCellAlignment_$type))) {
                a.add(new EnumWrapper$1(VerticalCellAlignment_$type, b, "VerticalCellAlignment"));
            }
            this._ar = a.toArray();
        }
        return this._ar;
    }
    get _ag() {
        return this._e.o;
    }
    get _br() {
        return this._bk;
    }
    set _br(a) {
        let b = this._bp(a);
        if (nullableNotEquals(b, this._bk)) {
            this._bk = b;
            this._cq("WrapText");
            this._cw();
        }
    }
    get _p() {
        if (null == this._o) {
            this._o = new SpreadsheetDialogFormatsService();
        }
        return this._o;
    }
    _ck(a) {
        switch (a) {
            case 0:
                this._d._i = 0;
                this._d._l = 0;
                this._d._m = 0;
                this._d._n = 0;
                this._d._o = 0;
                this._d._p = 0;
                this._d._j = 0;
                this._d._k = 0;
                this._d._r = 1;
                break;
            case 2:
                if (FormatCellsDialogBorderInfo._aq(this._d._l) || WorkbookColorInfo.l_op_Inequality(this._d._ad, this._al) || this._d._l != this._v) {
                    this._d._l = this._v;
                    this._d._ad = this._al;
                }
                if (FormatCellsDialogBorderInfo._aq(this._d._m) || WorkbookColorInfo.l_op_Inequality(this._d._ae, this._al) || this._d._m != this._v) {
                    this._d._m = this._v;
                    this._d._ae = this._al;
                }
                break;
            case 1:
                if (FormatCellsDialogBorderInfo._aq(this._d._i) || WorkbookColorInfo.l_op_Inequality(this._d._aa, this._al) || this._d._i != this._v) {
                    this._d._i = this._v;
                    this._d._aa = this._al;
                }
                if (FormatCellsDialogBorderInfo._aq(this._d._n) || WorkbookColorInfo.l_op_Inequality(this._d._af, this._al) || this._d._n != this._v) {
                    this._d._n = this._v;
                    this._d._af = this._al;
                }
                if (FormatCellsDialogBorderInfo._aq(this._d._o) || WorkbookColorInfo.l_op_Inequality(this._d._ag, this._al) || this._d._o != this._v) {
                    this._d._o = this._v;
                    this._d._ag = this._al;
                }
                if (FormatCellsDialogBorderInfo._aq(this._d._p) || WorkbookColorInfo.l_op_Inequality(this._d._ah, this._al) || this._d._p != this._v) {
                    this._d._p = this._v;
                    this._d._ah = this._al;
                }
                break;
        }
    }
    _cl() {
        for (let a of fromEnum(this._a9)) {
            switch (a) {
                case "SelectedFormat":
                case "CustomizedFormatMask":
                    let b = stringEmpty();
                    let c = true;
                    if (this._n._l) {
                        try {
                            let d = new ValueFormatter(0, this._ag, this._bx, this._ag._e6);
                            c = d.o;
                        }
                        catch (e) {
                            c = false;
                        }
                        if (c) {
                            b = this._bx;
                        }
                    }
                    else {
                        b = this._k._e;
                    }
                    if (false == c) {
                        let f = SpreadsheetUtilities.di(null, "FormatCellsDialog_NumberTabInvalidMaskError");
                        f = stringFormat(f, this._bx);
                        this._q = new SpreadsheetDialogResult(true, ((() => {
                            let $ret = new FormatCellsDialogViewModel_FormatCellsDialogState();
                            $ret.a = this._h;
                            return $ret;
                        })()), f);
                        return;
                    }
                    else {
                        this._e.ai = b;
                    }
                    break;
                case "SelectedHorizontalCellAlignment":
                    this._e.m = this._ad;
                    break;
                case "SelectedVerticalCellAlignment":
                    this._e.n = this._af;
                    break;
                case "Indent":
                    this._e.y = this._bf;
                    break;
                case "WrapText":
                    if (false == this._br.hasValue) {
                        this._e.ag = Nullable$1.toNullable(Boolean_$type, null);
                    }
                    else if (true == this._br.value) {
                        this._e.ag = Nullable$1.toNullable(Boolean_$type, true);
                    }
                    else {
                        this._e.ag = Nullable$1.toNullable(Boolean_$type, false);
                    }
                    break;
                case "ShrinkToFit":
                    if (false == this._bq.hasValue) {
                        this._e.af = Nullable$1.toNullable(Boolean_$type, null);
                    }
                    else if (true == this._bq.value) {
                        this._e.af = Nullable$1.toNullable(Boolean_$type, true);
                    }
                    else {
                        this._e.af = Nullable$1.toNullable(Boolean_$type, false);
                    }
                    break;
                case "MergeCells":
                    if (false == this._bo.hasValue) {
                        this._e.ad = Nullable$1.toNullable(Boolean_$type, null);
                    }
                    else if (true == this._bo.value) {
                        this._e.ad = Nullable$1.toNullable(Boolean_$type, true);
                    }
                    else {
                        this._e.ad = Nullable$1.toNullable(Boolean_$type, false);
                    }
                    break;
                case "Locked":
                    if (false == this._bn.hasValue) {
                        this._e.ac = Nullable$1.toNullable(Boolean_$type, null);
                    }
                    else if (true == this._bn.value) {
                        this._e.ac = Nullable$1.toNullable(Boolean_$type, true);
                    }
                    else {
                        this._e.ac = Nullable$1.toNullable(Boolean_$type, false);
                    }
                    break;
                case "SelectedFillPatternStyle":
                case "BackgroundColorInfo":
                case "FillPatternColorInfo":
                    this._e.i = this._y;
                    break;
                default: break;
            }
        }
        this._e.p = this._c._aa;
        this._e.b = this._c._i;
        this._e.s = this._c._ad;
        this._e.d = this._c._l;
        this._e.t = this._c._ae;
        this._e.e = this._c._m;
        this._e.u = this._c._af;
        this._e.f = this._c._n;
        this._e.v = this._c._ag;
        this._e.g = this._c._o;
        this._e.w = this._c._ah;
        this._e.h = this._c._p;
        this._e.j = this._c._r;
        this._e.q = this._c._ab;
        if (false == FormatCellsDialogBorderInfo._aq(this._c._k)) {
            this._e.c = this._c._k;
        }
        else if (false == FormatCellsDialogBorderInfo._aq(this._c._j)) {
            this._e.c = this._c._j;
        }
        else {
            this._e.c = 0;
        }
        for (let g of fromEnum(this._b._ah)) {
            switch (g) {
                case "SelectedFontName":
                    this._e.ah = this._b._ax;
                    break;
                case "SelectedFontSize":
                    if (this._b._aj > -1) {
                        this._e.x = this._b._aj * 20;
                    }
                    break;
                case "SelectedFontStyle":
                    {
                        let h = this._b._d.a;
                        if (this._b._d.a != 0) {
                            this._e.z = Nullable$1.toNullable(Boolean_$type, (h == 2 || h == 4) ? true : false);
                            this._e.aa = Nullable$1.toNullable(Boolean_$type, (h == 3 || h == 4) ? true : false);
                        }
                        else {
                            this._e.z = Nullable$1.toNullable(Boolean_$type, null);
                            this._e.aa = Nullable$1.toNullable(Boolean_$type, null);
                        }
                        break;
                    }
                case "Subscript":
                case "Superscript":
                    if (nullableEquals(true, this._b._ar)) {
                        this._e.k = 2;
                    }
                    else if (nullableEquals(true, this._b._as)) {
                        this._e.k = 1;
                    }
                    else {
                        this._e.k = 0;
                    }
                    break;
                case "Strikeout":
                    if (false == this._b._aq.hasValue) {
                        this._e.ab = Nullable$1.toNullable(Boolean_$type, null);
                    }
                    else if (true == this._b._aq.value) {
                        this._e.ab = Nullable$1.toNullable(Boolean_$type, true);
                    }
                    else {
                        this._e.ab = Nullable$1.toNullable(Boolean_$type, false);
                    }
                    break;
                case "SelectedFontColorInfo":
                    this._e.r = this._b._m;
                    break;
                case "SelectedFontUnderlineStyle":
                    this._e.l = this._b._h;
                    break;
                default: break;
            }
        }
        this._q = new SpreadsheetDialogResult(false, ((() => {
            let $ret = new FormatCellsDialogViewModel_FormatCellsDialogState();
            $ret.a = this._h;
            return $ret;
        })()), "");
    }
    _cv(a) {
        switch (a) {
            case 3:
                this._d._i = this._u(this._d._i, this._d._aa);
                if (this._d._i != 0) {
                    this._d._aa = this._al;
                }
                break;
            case 5:
                this._d._l = this._u(this._d._l, this._d._ad);
                if (this._d._l != 0) {
                    this._d._ad = this._al;
                }
                break;
            case 4:
                this._d._m = this._u(this._d._m, this._d._ae);
                if (this._d._m != 0) {
                    this._d._ae = this._al;
                }
                break;
            case 0:
                this._d._n = this._u(this._d._n, this._d._af);
                if (this._d._n != 0) {
                    this._d._af = this._al;
                }
                break;
            case 2:
                this._d._o = this._u(this._d._o, this._d._ag);
                if (this._d._o != 0) {
                    this._d._ag = this._al;
                }
                break;
            case 1:
                this._d._p = this._u(this._d._p, this._d._ah);
                if (this._d._p != 0) {
                    this._d._ah = this._al;
                }
                break;
            case 6:
                this._d._j = this._u(this._d._j, this._d._ab);
                if (this._d._j != 0) {
                    this._d._ab = this._al;
                }
                break;
            case 7:
                this._d._k = this._u(this._d._k, this._d._ac);
                if (this._d._k != 0) {
                    this._d._ac = this._al;
                }
                break;
        }
    }
    _az(a) {
        return nullableEquals(a, true);
    }
    _bl(a) {
        if (nullableEquals(a, null)) {
            return Nullable$1.toNullable(Boolean_$type, null);
        }
        else {
            return Nullable$1.toNullable(Boolean_$type, nullableEquals(a, true));
        }
    }
    _bm(a) {
        if (WorkbookColorInfo.l_op_Equality(null, a)) {
            return Nullable$1.toNullable(Color.$, null);
        }
        return Nullable$1.toNullable(Color.$, a._getResolvedColor1(this._ag));
    }
    _g() {
        if (this._a5) {
            return 1;
        }
        if (this._a0) {
            return 2;
        }
        if (this._a3) {
            return 4;
        }
        if (this._a1) {
            return 8;
        }
        if (this._a2) {
            return 16;
        }
        if (this._a6) {
            return 32;
        }
        return 0;
    }
    _b1(a) {
        for (let b of fromEnum(a._w)) {
            let c = this._b2(b._e);
            if (false == stringIsNullOrEmpty(c)) {
                return c;
            }
        }
        return null;
    }
    _b2(a) {
        let b = ["black", "green", "white", "blue", "magenta", "yellow", "cyan", "red"];
        let c = [0, 0, 0, 0, 0, 0, 0, 0];
        let d = a.toLowerCase();
        for (let e = 0; e < b.length; e++) {
            if (stringContains(d, b[e])) {
                c[e]++;
            }
        }
        let f = null;
        for (let g = 0; g < c.length; g++) {
            if (c[g] > 0) {
                if (stringIsNullOrEmpty(f)) {
                    f = b[g];
                }
                else {
                    return stringEmpty();
                }
            }
        }
        return f;
    }
    _an(a, b) {
        if (WorkbookColorInfo.l_op_Equality(null, a) || Color.c(Nullable$1.toNullable(Color.$, null), a._color$i)) {
            if (Color.e(Nullable$1.toNullable(Color.$, null), b)) {
                return new WorkbookColorInfo(b.value);
            }
        }
        else if (Color.e(Nullable$1.toNullable(Color.$, null), b)) {
            if (b.value.l == 0) {
                return new WorkbookColorInfo(b, Nullable$1.toNullable(WorkbookThemeColorType_$type, null), Nullable$1.toNullable(Number_$type, null), false, false);
            }
            else {
                return new WorkbookColorInfo(b, Nullable$1.toNullable(WorkbookThemeColorType_$type, null), Nullable$1.toNullable(Number_$type, null), false, true);
            }
        }
        return null;
    }
    _u(a, b) {
        if (a == this._v && WorkbookColorInfo.l_op_Equality(b, this._al)) {
            return 0;
        }
        return this._v;
    }
    _cn(a) {
        if (stringIsNullOrEmpty(a)) {
            this._k = null;
            this._n = null;
        }
        else {
            while (stringContains(a, "\"$\"")) {
                a = stringReplace(a, "\"$\"", "$");
            }
            while (stringContains(a, "\\")) {
                a = stringReplace(a, "\\", "");
            }
            let b = false;
            let c = null;
            let d = null;
            for (let e of fromEnum(this._ba)) {
                c = e._c(a);
                if (c != null) {
                    d = e;
                    b = e._l;
                    break;
                }
            }
            let f = null;
            let g = null;
            if (null == c || b) {
                let h = new ValueFormatter(0, this._ag, a, this._ag._e6);
                if (h.o) {
                    let i = true;
                    let j = true;
                    let k = true;
                    let l = true;
                    let m = true;
                    let n = -1;
                    let o = 0;
                    let p = a.split(';');
                    for (let q = 0; q < 4; q++) {
                        let r = h.c(q);
                        if (null == r) {
                            break;
                        }
                        o++;
                        if (false == r.isNumberSection) {
                            i = false;
                            break;
                        }
                        if (r.percentCount < 1) {
                            k = false;
                        }
                        for (let t = 0; t < p.length; t++) {
                            let s = p[t];
                            if (false == stringContains(s, "$")) {
                                j = false;
                            }
                            if (false == stringContains(s, "E+")) {
                                l = false;
                            }
                            if (false == stringContains(s, "_(")) {
                                m = false;
                            }
                        }
                        if (n == -1) {
                            n = r.fractionDigitCount;
                        }
                        else if (n != r.fractionDigitCount) {
                            n = -1;
                            break;
                        }
                    }
                    if (i && n != -1) {
                        let u = this._b2(a);
                        if (l) {
                            f = Enumerable.ag(SpreadsheetDialogFormatCategory.$, this._ba, (v) => v._r);
                        }
                        else if (j) {
                            let v = Enumerable.ag(SpreadsheetDialogFormatCategory.$, this._ba, (w) => w._j);
                            if (null == u || u == this._b1(v)) {
                                f = v;
                            }
                        }
                        else if (k) {
                            f = Enumerable.ag(SpreadsheetDialogFormatCategory.$, this._ba, (w) => w._q);
                        }
                        else if (m) {
                            f = Enumerable.ag(SpreadsheetDialogFormatCategory.$, this._ba, (w) => w._i);
                        }
                        else {
                            let w = Enumerable.ag(SpreadsheetDialogFormatCategory.$, this._ba, (x) => x._p);
                            if (null == u || u == this._b1(w)) {
                                f = w;
                            }
                        }
                        if (null != f) {
                            f._y = n;
                            if (b && null != c) {
                                g = c;
                            }
                            else {
                                let x = f._c(a);
                                if (null != x) {
                                    g = x;
                                }
                                else {
                                    g = Enumerable.ad(SpreadsheetDialogFormat.$, f._w);
                                }
                            }
                        }
                    }
                }
            }
            if (null != f) {
                this._n = f;
                this._k = g;
                if (null == this._k) {
                    this._n = d;
                    this._k = c;
                }
            }
            else if (null == c) {
                let y = Enumerable.ae(SpreadsheetDialogFormatCategory.$, this._ba, (z) => z._l);
                this._n = y;
                this._k = y._b(a);
            }
            else {
                this._n = d;
                this._k = c;
            }
        }
    }
    _cm(a, b) {
        this._ax = true;
        this._cn(this._e.ai);
        this._ad = this._e.m;
        this._af = this._e.n;
        this._bf = this._e.y;
        this._br = this._bl(this._e.ag);
        this._bq = this._bl(this._e.af);
        this._bo = this._bl(this._e.ad);
        this._cw();
        this._c = new FormatCellsDialogBorderInfo(this._f.d, this._f.e);
        this._c._aa = this._e.p;
        this._c._i = this._e.b;
        this._c._ad = this._e.s;
        this._c._l = this._e.d;
        this._c._ae = this._e.t;
        this._c._m = this._e.e;
        this._c._af = this._e.u;
        this._c._n = this._e.f;
        this._c._ag = this._e.v;
        this._c._o = this._e.g;
        this._c._ah = this._e.w;
        this._c._p = this._e.h;
        this._c._r = this._e.j;
        this._c._ab = this._e.q;
        if (this._e.j == 7 || this._e.j == 3) {
            this._c._j = this._e.c;
        }
        this._c._ac = this._e.q;
        if (this._e.j == 7 || this._e.j == 5) {
            this._c._k = this._e.c;
        }
        this._v = 1;
        if (typeCast(CellFillPattern.$, this._e.i) !== null) {
            let c = this._e.i;
            this._ak = c.backgroundColorInfo;
            this._ab = c.patternStyle;
            this._am = c.patternColorInfo;
            this._cr();
        }
        else {
            this._ak = WorkbookColorInfo.automatic;
            this._ab = 0;
            this._am = WorkbookColorInfo.automatic;
            this._y = null;
            this._z = null;
        }
        this._bn = this._bl(this._e.ac);
        this._q = new SpreadsheetDialogResult(true, null, "");
        let d = typeCast(FormatCellsDialogViewModel_FormatCellsDialogState.$, a);
        if (null != d) {
            if (b.hasValue && (b.value == 2 || b.value == 8 || b.value == 16 || b.value == 4 || b.value == 1 || b.value == 32)) {
                this._h = b.value;
            }
            else {
                this._h = d.a;
            }
        }
        else {
            this._h = this._g();
        }
        this._ax = false;
    }
    _bp(a) {
        if (a.hasValue) {
            return Nullable$1.toNullable(Boolean_$type, a.value);
        }
        if (this._ax) {
            return Nullable$1.toNullable(Boolean_$type, null);
        }
        else {
            return Nullable$1.toNullable(Boolean_$type, false);
        }
    }
    _co(a, b) {
        if (b.propertyName == "DecimalPlaces") {
            if (false == this._a9.contains("SelectedFormat")) {
                this._a9.add("SelectedFormat");
            }
            this._cq("SelectedFormatResolved");
            this._cu();
        }
    }
    _cp(a) {
        if (this._ax) {
            return;
        }
        if (this._aw) {
            return;
        }
        this._aw = true;
        try {
            if (false == this._a9.contains(a)) {
                this._a9.add(a);
            }
            switch (a) {
                case "SelectedFormat": break;
                case "SelectedFormatCategory":
                    if (this._n != null) {
                        if (true == this._n._l && null != this._l && null != this._l._d && false == this._l._l) {
                            let b = Enumerable.ag(SpreadsheetDialogFormat.$, this._n._w, (c) => c._e == this._l._d._e);
                            this._k = b;
                            if (null == b) {
                                this._bx = this._l._d._e;
                                this._cq("SelectedFormatResolved");
                            }
                        }
                        else if (null == this._n._d) {
                            this._k = Enumerable.af(SpreadsheetDialogFormat.$, this._n._w);
                        }
                        else {
                            this._k = Enumerable.ag(SpreadsheetDialogFormat.$, this._n._w, (c) => c._e == this._n._d._e);
                        }
                        this._cu();
                    }
                    break;
                case "BackgroundColorInfo":
                    this._cs();
                    break;
                case "SelectedFillPatternStyle":
                case "FillPatternColorInfo":
                    this._cr();
                    break;
            }
        }
        finally {
            this._aw = false;
        }
    }
    _cr() {
        this._y = new CellFillPattern(this._ak, this._am, this._ab);
        this._z = new CellFillPattern(WorkbookColorInfo.l_op_Equality(null, this._ak) ? null : new WorkbookColorInfo(this._ak._getResolvedColor1(this._e.o)), WorkbookColorInfo.l_op_Equality(null, this._am) ? null : new WorkbookColorInfo(this._am._getResolvedColor1(this._e.o)), this._ab);
    }
    _cs() {
        if (WorkbookColorInfo.l_op_Inequality(this._ak, null)) {
            if (this._ab == 0) {
                this._ab = 1;
            }
        }
        else {
            this._ab = 0;
        }
        this._cr();
    }
    _ct(a, b) {
        switch (b.propertyName) {
            case "DecimalPlaces":
                {
                    this._cu();
                    break;
                }
            default: break;
        }
    }
    _cu() {
        this._bb = -999999;
        this._be = this._m._y;
    }
    _cw() {
        if (this._ad == 4 || this._ad == 5 || this._ad == 7 || this._af == 3 || this._af == 4 || nullableEquals(this._br, true)) {
            this._a7 = false;
        }
        else {
            this._a7 = true;
        }
    }
    _cq(a) {
        this._cp(a);
        let b = this.propertyChanged;
        if (null != b) {
            b(this, new PropertyChangedEventArgs(a));
        }
    }
}
FormatCellsDialogViewModel.$t = markType(FormatCellsDialogViewModel, 'FormatCellsDialogViewModel', Base.$, [INotifyPropertyChanged_$type]);
/**
 * For Internal Use only.
 * @typedef TEnum
 */
export class EnumWrapper$1 extends Base {
    constructor($tEnum, a, b) {
        super();
        this.$tEnum = null;
        this._d = null;
        this._f = null;
        this._g = null;
        this.$tEnum = $tEnum;
        this.$type = this.$type.specialize(this.$tEnum);
        this._d = a;
        this._f = b;
    }
    /**
     * Returns a string representation of the object.
     * @return
     */
    toString() {
        return this.enumValueNameLocalized;
    }
    /**
     * For Internal Use only.
     */
    get enumValue() {
        return this._enumValue$i;
    }
    /**
     * @hidden
     */
    get _enumValue$i() {
        return this._d;
    }
    /**
     * For Internal Use only.
     */
    get enumValueNameLocalized() {
        if (stringIsNullOrEmpty(this._g)) {
            let a = this._f + "_" + this._h;
            this._g = SpreadsheetUtilities.di(null, a);
        }
        return this._g;
    }
    /**
     * @hidden
     */
    get _h() {
        return stringToString$1(this.$tEnum, this._d);
    }
    /**
     * @hidden
     */
    static _a($tEnum, a, b) {
        for (let c of a) {
            let d = typeCast(EnumWrapper$1.$.specialize($tEnum), c);
            if (null != d && d._h == b) {
                return d;
            }
        }
        return null;
    }
    /**
     * @hidden
     */
    static _b($tEnum, a, b) {
        for (let c of a) {
            let d = typeCast(EnumWrapper$1.$.specialize($tEnum), c);
            if (null != d && d.enumValueNameLocalized == b) {
                return d;
            }
        }
        return null;
    }
    /**
     * @hidden
     */
    static _c($tEnum, a, b) {
        for (let c of a) {
            let d = typeCast(EnumWrapper$1.$.specialize($tEnum), c);
            if (null != d && Base.equalsStatic(d._enumValue$i, getBoxIfEnum($tEnum, b))) {
                return d;
            }
        }
        return null;
    }
}
EnumWrapper$1.$t = markType(EnumWrapper$1, 'EnumWrapper$1');
/**
 * @hidden
 */
export class TopOrBottomDialogViewModel extends Base {
    constructor(a, ..._rest) {
        super();
        this.a = null;
        this.c = 0;
        this.i = false;
        this.g = false;
        this.m = 0;
        this.e = null;
        this.o = 0;
        this.f = null;
        a = (a == void 0) ? 0 : a;
        switch (a) {
            case 0:
                {
                    let c = _rest[0];
                    let d = _rest[1];
                    this.e = c;
                    this.o = d;
                    this.a = c.filterSettings.getFilter(d);
                    this.r();
                }
                break;
            case 1:
                {
                    let c = _rest[0];
                    this.f = c;
                    this.e = this.f.table.worksheet;
                    this.a = c.filter;
                    this.r();
                }
                break;
        }
    }
    r() {
        let a = typeCast(TopOrBottomFilter.$, this.a);
        if (null != a) {
            this.c = a.type;
            this.m = a.value;
        }
        else {
            this.c = 0;
            this.m = 10;
        }
        switch (this.c) {
            case 3:
            case 1:
                this.i = false;
                break;
            case 2:
            case 0:
                this.i = true;
                break;
        }
        switch (this.c) {
            case 3:
            case 2:
                this.g = true;
                break;
            case 0:
            case 1:
                this.g = false;
                break;
        }
    }
    static b(a, b) {
        if (a) {
            if (b) {
                return 2;
            }
            else {
                return 0;
            }
        }
        else {
            if (b) {
                return 3;
            }
            else {
                return 1;
            }
        }
    }
    q(a, b, c) {
        let d = TopOrBottomDialogViewModel.b(a, b);
        this.p(d, c);
    }
    p(a, b) {
        if (null != this.f) {
            this.f._applyTopOrBottomFilter1(a, b);
        }
        else {
            this.e.filterSettings._applyTopOrBottomFilter1(this.o, a, b);
        }
    }
    static k(a) {
        let b;
        let c = new List$1(ComboBoxListItem.$, 0);
        let d = true;
        let e = "ExcelTopOrBottomFilterDirection_Top_DisplayText";
        let f = a._fs(e);
        b = new ComboBoxListItem(d, f);
        c.add(b);
        d = false;
        e = "ExcelTopOrBottomFilterDirection_Bottom_DisplayText";
        f = a._fs(e);
        b = new ComboBoxListItem(d, f);
        c.add(b);
        return c;
    }
    static l(a) {
        let b;
        let c = new List$1(ComboBoxListItem.$, 0);
        let d = false;
        let e = "ExcelTopOrBottomFilterTypes_Items_DisplayText";
        let f = a._fs(e);
        b = new ComboBoxListItem(d, f);
        c.add(b);
        d = true;
        e = "ExcelTopOrBottomFilterTypes_Percent_DisplayText";
        f = a._fs(e);
        b = new ComboBoxListItem(d, f);
        c.add(b);
        return c;
    }
    get d() {
        return this.c;
    }
    get n() {
        return this.m;
    }
    get j() {
        return this.i;
    }
    get h() {
        return this.g;
    }
}
TopOrBottomDialogViewModel.$t = markType(TopOrBottomDialogViewModel, 'TopOrBottomDialogViewModel');
//# sourceMappingURL=SpreadsheetChartAdapterBase_combined.js.map
